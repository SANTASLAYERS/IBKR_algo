2025-06-05 10:54:17,221 - __main__ - INFO - ================================================================================
2025-06-05 10:54:17,221 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 10:54:17,222 - __main__ - INFO - ================================================================================
2025-06-05 10:54:17,225 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:54:17,226 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:54:17,229 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:54:19,102 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:54:19,103 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:54:19,139 - src.tws_connection - INFO - ✅ Next valid order ID received: 156
2025-06-05 10:54:19,139 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:54:19,140 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:54:19,144 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:54:19,145 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:54:19,146 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:54:19,147 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:54:19,148 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:54:19,150 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 10:54:19,151 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:54:19,152 - __main__ - INFO - 
============================================================
2025-06-05 10:54:19,153 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:54:19,154 - __main__ - INFO - ============================================================
2025-06-05 10:54:19,155 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:54:19,155 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:54:19,156 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:54:19,157 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:54:19,157 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:54:19,158 - src.order.base - INFO - Order 66df2450-63a6-466c-abdf-e38058ced874 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:54:19,160 - src.order.manager - INFO - Submitting order 66df2450-63a6-466c-abdf-e38058ced874 to TWS
2025-06-05 10:54:19,161 - src.order.manager - INFO - Got broker order ID 156 for order 66df2450-63a6-466c-abdf-e38058ced874
2025-06-05 10:54:19,163 - src.order.manager - INFO - Calling placeOrder with ID 156, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:54:19,164 - src.order.manager - INFO - placeOrder called successfully for order 66df2450-63a6-466c-abdf-e38058ced874
2025-06-05 10:54:19,164 - src.order.base - INFO - Order 66df2450-63a6-466c-abdf-e38058ced874 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:54:19,165 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:54:19,166 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:54:19,207 - src.tws_connection - INFO - ✅ Next valid order ID received: 156
2025-06-05 10:54:19,310 - src.tws_connection - INFO - ✅ Next valid order ID received: 156
2025-06-05 10:54:19,557 - src.tws_connection - INFO - Open Order - ID: 156, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:54:20,179 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:54:20,179 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.05 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:54:20,180 - src.order.base - INFO - Order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:54:20,181 - src.order.manager - INFO - Submitting order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a to TWS
2025-06-05 10:54:20,182 - src.order.manager - INFO - Got broker order ID 156 for order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a
2025-06-05 10:54:20,182 - src.order.manager - INFO - Calling placeOrder with ID 156, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:54:20,183 - src.order.manager - INFO - placeOrder called successfully for order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a
2025-06-05 10:54:20,183 - src.order.base - INFO - Order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:54:20,184 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 18ae4c47-6f93-4bcb-ab2c-1f803532f73a at $310.05
2025-06-05 10:54:20,184 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:54:20,185 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.45 (ATR: 0.0450 * 3.0 = 0.1350)
2025-06-05 10:54:20,185 - src.order.base - INFO - Order 02186e78-60b7-4b4c-9eef-191aff3c29f7 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:54:20,186 - src.order.manager - INFO - Submitting order 02186e78-60b7-4b4c-9eef-191aff3c29f7 to TWS
2025-06-05 10:54:20,186 - src.order.manager - INFO - Got broker order ID 157 for order 02186e78-60b7-4b4c-9eef-191aff3c29f7
2025-06-05 10:54:20,186 - src.order.manager - INFO - Calling placeOrder with ID 157, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.450000 DAY
2025-06-05 10:54:20,187 - src.order.manager - INFO - placeOrder called successfully for order 02186e78-60b7-4b4c-9eef-191aff3c29f7
2025-06-05 10:54:20,187 - src.tws_connection - WARNING - ⚠️ TWS Error 105: Order being modified does not match original order. (reqId: 156)
2025-06-05 10:54:20,188 - src.order.base - INFO - Order 02186e78-60b7-4b4c-9eef-191aff3c29f7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:54:20,188 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 02186e78-60b7-4b4c-9eef-191aff3c29f7 at $310.45
2025-06-05 10:54:20,189 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:54:20,189 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:54:20,312 - src.tws_connection - INFO - Open Order - ID: 157, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:54:20,455 - src.tws_connection - INFO - Open Order - ID: 156, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:54:20,487 - src.order.base - INFO - Order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a status changed: submitted -> filled (Order fully filled)
2025-06-05 10:54:20,488 - src.order.base - INFO - Order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a filled: 100.0 @ 310.33 (100.0/100)
2025-06-05 10:54:20,487 - src.tws_connection - INFO - Open Order - ID: 156, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:54:20,489 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - stop order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a filled at $310.33
2025-06-05 10:54:20,490 - src.order.base - INFO - Order 66df2450-63a6-466c-abdf-e38058ced874 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 10:54:20,491 - src.order.manager - INFO - Cancelling order 66df2450-63a6-466c-abdf-e38058ced874 with broker ID 156
2025-06-05 10:54:20,493 - src.rule.linked_order_actions - INFO - Cancelled remaining order 66df2450-63a6-466c-abdf-e38058ced874 for GLD
2025-06-05 10:54:20,493 - src.tws_connection - INFO - Open Order - ID: 156, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:54:20,493 - src.order.base - INFO - Order 02186e78-60b7-4b4c-9eef-191aff3c29f7 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 10:54:20,503 - src.tws_connection - WARNING - ⚠️ TWS Error 10148: OrderId 156 that needs to be cancelled cannot be cancelled, state: Filled. (reqId: 156)
2025-06-05 10:54:20,503 - src.order.manager - INFO - Cancelling order 02186e78-60b7-4b4c-9eef-191aff3c29f7 with broker ID 157
2025-06-05 10:54:20,504 - src.rule.linked_order_actions - INFO - Cancelled remaining order 02186e78-60b7-4b4c-9eef-191aff3c29f7 for GLD
2025-06-05 10:54:20,505 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 10:54:20,505 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 10:54:20,599 - src.order.base - INFO - Order 02186e78-60b7-4b4c-9eef-191aff3c29f7 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 10:54:20,599 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 157)
2025-06-05 10:54:20,700 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['18ae4c47-6f93-4bcb-ab2c-1f803532f73a']
2025-06-05 10:54:20,701 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:54:25,721 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:54:25,721 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.34, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.20, original_qty=100, dd_qty=100
2025-06-05 10:54:25,722 - src.order.base - INFO - Order 61e731c6-6535-4458-870b-7d28ff221421 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:54:25,723 - src.order.manager - INFO - Submitting order 61e731c6-6535-4458-870b-7d28ff221421 to TWS
2025-06-05 10:54:25,723 - src.order.manager - INFO - Got broker order ID 158 for order 61e731c6-6535-4458-870b-7d28ff221421
2025-06-05 10:54:25,724 - src.order.manager - INFO - Calling placeOrder with ID 158, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.200000 DAY
2025-06-05 10:54:25,724 - src.order.manager - INFO - placeOrder called successfully for order 61e731c6-6535-4458-870b-7d28ff221421
2025-06-05 10:54:25,725 - src.order.base - INFO - Order 61e731c6-6535-4458-870b-7d28ff221421 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:54:25,726 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:54:25,727 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.20
2025-06-05 10:54:25,730 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:54:25,732 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 66df2450-63a6-466c-abdf-e38058ced874 for GLD
2025-06-05 10:54:25,837 - src.tws_connection - INFO - Open Order - ID: 158, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:54:29,159 - __main__ - INFO - 
============================================================
2025-06-05 10:54:29,159 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:54:29,160 - __main__ - INFO - ============================================================
2025-06-05 10:54:29,160 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:54:29,160 - __main__ - INFO - Order 61e731c6-6535-4458-870b-7d28ff221421: limit buy 100 @ 310.2 - Status: submitted
2025-06-05 10:54:29,163 - __main__ - INFO - Order 66df2450-63a6-466c-abdf-e38058ced874: market buy 100 @ MARKET - Status: pending_cancel
2025-06-05 10:54:29,164 - __main__ - INFO - Order 18ae4c47-6f93-4bcb-ab2c-1f803532f73a: stop sell -100 @ 310.05 - Status: filled
2025-06-05 10:54:29,165 - __main__ - INFO - Order 02186e78-60b7-4b4c-9eef-191aff3c29f7: limit sell -100 @ 310.45 - Status: cancelled
2025-06-05 10:54:29,166 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:54:29,166 - __main__ - INFO - Stop orders: 1
2025-06-05 10:54:29,167 - __main__ - INFO - Target orders: 1
2025-06-05 10:54:29,167 - __main__ - INFO - Double down orders: 1
2025-06-05 10:54:29,167 - __main__ - INFO - 
Double down order details:
2025-06-05 10:54:29,167 - __main__ - INFO -   ID: 61e731c6-6535-4458-870b-7d28ff221421
2025-06-05 10:54:29,168 - __main__ - INFO -   Status: submitted
2025-06-05 10:54:29,168 - __main__ - INFO -   Limit price: 310.2
2025-06-05 10:54:29,168 - __main__ - INFO -   Quantity: 100
2025-06-05 10:54:29,168 - __main__ - INFO - 
Original protective orders:
2025-06-05 10:54:29,169 - __main__ - INFO -   Stop: -100 @ $310.05
2025-06-05 10:54:29,169 - __main__ - INFO -   Target: -100 @ $310.45
2025-06-05 10:54:29,169 - __main__ - INFO - 
============================================================
2025-06-05 10:54:29,169 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 10:54:29,170 - __main__ - INFO - ============================================================
2025-06-05 10:54:29,170 - __main__ - INFO - Waiting for double down order 61e731c6-6535-4458-870b-7d28ff221421 to fill at $310.2...
2025-06-05 10:54:29,171 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 10:54:34,183 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 10:54:39,193 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 10:54:41,540 - src.order.base - INFO - Order 61e731c6-6535-4458-870b-7d28ff221421 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 10:54:41,540 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 158)
2025-06-05 10:55:43,979 - __main__ - INFO - ================================================================================
2025-06-05 10:55:43,979 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 10:55:43,980 - __main__ - INFO - ================================================================================
2025-06-05 10:55:43,981 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:55:43,982 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:55:43,983 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:55:45,815 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:55:45,816 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:55:45,845 - src.tws_connection - INFO - ✅ Next valid order ID received: 159
2025-06-05 10:55:45,845 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:55:45,845 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:55:45,846 - src.tws_connection - INFO - ✅ Next valid order ID received: 159
2025-06-05 10:55:45,847 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:55:45,848 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:55:45,848 - src.tws_connection - INFO - ✅ Next valid order ID received: 159
2025-06-05 10:55:45,849 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:55:45,850 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:55:45,850 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:55:45,851 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 10:55:45,851 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:55:45,852 - __main__ - INFO - 
============================================================
2025-06-05 10:55:45,852 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:55:45,852 - __main__ - INFO - ============================================================
2025-06-05 10:55:45,853 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:55:45,853 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:55:45,854 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:55:45,854 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:55:45,854 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:55:45,855 - src.order.base - INFO - Order 624906ac-bf6d-4703-987a-3075cbf6c382 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:55:45,855 - src.order.manager - INFO - Submitting order 624906ac-bf6d-4703-987a-3075cbf6c382 to TWS
2025-06-05 10:55:45,855 - src.order.manager - INFO - Got broker order ID 159 for order 624906ac-bf6d-4703-987a-3075cbf6c382
2025-06-05 10:55:45,856 - src.order.manager - INFO - Calling placeOrder with ID 159, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:55:45,856 - src.order.manager - INFO - placeOrder called successfully for order 624906ac-bf6d-4703-987a-3075cbf6c382
2025-06-05 10:55:45,856 - src.order.base - INFO - Order 624906ac-bf6d-4703-987a-3075cbf6c382 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:55:45,857 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:55:45,857 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:55:46,085 - src.tws_connection - INFO - Open Order - ID: 159, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:55:46,094 - src.order.base - INFO - Order 624906ac-bf6d-4703-987a-3075cbf6c382 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:55:46,094 - src.order.base - INFO - Order 624906ac-bf6d-4703-987a-3075cbf6c382 filled: 100.0 @ 310.36 (100.0/100)
2025-06-05 10:55:46,094 - src.tws_connection - INFO - Open Order - ID: 159, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:55:46,095 - src.tws_connection - INFO - Open Order - ID: 159, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:55:46,863 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:55:46,864 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.09 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:55:46,864 - src.order.base - INFO - Order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:55:46,865 - src.order.manager - INFO - Submitting order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce to TWS
2025-06-05 10:55:46,865 - src.order.manager - INFO - Got broker order ID 160 for order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce
2025-06-05 10:55:46,865 - src.order.manager - INFO - Calling placeOrder with ID 160, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:55:46,866 - src.order.manager - INFO - placeOrder called successfully for order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce
2025-06-05 10:55:46,866 - src.order.base - INFO - Order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:55:46,866 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss f99a4e87-db88-4e0e-a5c4-56d1c652b2ce at $310.09
2025-06-05 10:55:46,866 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:55:46,867 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.72 (ATR: 0.0450 * 8.0 = 0.3600)
2025-06-05 10:55:46,867 - src.order.base - INFO - Order e697ff1e-16c5-4862-8b3c-e5e989ac0d56 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:55:46,867 - src.order.manager - INFO - Submitting order e697ff1e-16c5-4862-8b3c-e5e989ac0d56 to TWS
2025-06-05 10:55:46,867 - src.order.manager - INFO - Got broker order ID 161 for order e697ff1e-16c5-4862-8b3c-e5e989ac0d56
2025-06-05 10:55:46,867 - src.order.manager - INFO - Calling placeOrder with ID 161, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.720000 DAY
2025-06-05 10:55:46,868 - src.order.manager - INFO - placeOrder called successfully for order e697ff1e-16c5-4862-8b3c-e5e989ac0d56
2025-06-05 10:55:46,868 - src.order.base - INFO - Order e697ff1e-16c5-4862-8b3c-e5e989ac0d56 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:55:46,868 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e697ff1e-16c5-4862-8b3c-e5e989ac0d56 at $310.72
2025-06-05 10:55:46,868 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:55:46,868 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:55:46,944 - src.tws_connection - INFO - Open Order - ID: 160, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:55:46,945 - src.order.base - INFO - Order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:55:47,036 - src.tws_connection - INFO - Open Order - ID: 161, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:55:47,372 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['f99a4e87-db88-4e0e-a5c4-56d1c652b2ce']
2025-06-05 10:55:47,372 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:55:52,383 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:55:52,385 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.34, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.20, original_qty=100, dd_qty=100
2025-06-05 10:55:52,386 - src.order.base - INFO - Order 33c5c867-4230-409f-99d8-65f6b3287721 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:55:52,387 - src.order.manager - INFO - Submitting order 33c5c867-4230-409f-99d8-65f6b3287721 to TWS
2025-06-05 10:55:52,387 - src.order.manager - INFO - Got broker order ID 162 for order 33c5c867-4230-409f-99d8-65f6b3287721
2025-06-05 10:55:52,388 - src.order.manager - INFO - Calling placeOrder with ID 162, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.200000 DAY
2025-06-05 10:55:52,388 - src.order.manager - INFO - placeOrder called successfully for order 33c5c867-4230-409f-99d8-65f6b3287721
2025-06-05 10:55:52,389 - src.order.base - INFO - Order 33c5c867-4230-409f-99d8-65f6b3287721 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:55:52,390 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:55:52,390 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.20
2025-06-05 10:55:52,391 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:55:52,391 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 624906ac-bf6d-4703-987a-3075cbf6c382 for GLD
2025-06-05 10:55:52,508 - src.tws_connection - INFO - Open Order - ID: 162, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:55:55,860 - __main__ - INFO - 
============================================================
2025-06-05 10:55:55,863 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:55:55,865 - __main__ - INFO - ============================================================
2025-06-05 10:55:55,866 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:55:55,867 - __main__ - INFO - Order 33c5c867-4230-409f-99d8-65f6b3287721: limit buy 100 @ 310.2 - Status: submitted
2025-06-05 10:55:55,867 - __main__ - INFO - Order 624906ac-bf6d-4703-987a-3075cbf6c382: market buy 100 @ MARKET - Status: filled
2025-06-05 10:55:55,867 - __main__ - INFO - Order e697ff1e-16c5-4862-8b3c-e5e989ac0d56: limit sell -100 @ 310.72 - Status: submitted
2025-06-05 10:55:55,868 - __main__ - INFO - Order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce: stop sell -100 @ 310.09 - Status: accepted
2025-06-05 10:55:55,868 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:55:55,869 - __main__ - INFO - Stop orders: 1
2025-06-05 10:55:55,869 - __main__ - INFO - Target orders: 1
2025-06-05 10:55:55,870 - __main__ - INFO - Double down orders: 1
2025-06-05 10:55:55,870 - __main__ - INFO - 
Double down order details:
2025-06-05 10:55:55,870 - __main__ - INFO -   ID: 33c5c867-4230-409f-99d8-65f6b3287721
2025-06-05 10:55:55,871 - __main__ - INFO -   Status: submitted
2025-06-05 10:55:55,871 - __main__ - INFO -   Limit price: 310.2
2025-06-05 10:55:55,871 - __main__ - INFO -   Quantity: 100
2025-06-05 10:55:55,871 - __main__ - INFO - 
Original protective orders:
2025-06-05 10:55:55,871 - __main__ - INFO -   Stop: -100 @ $310.09
2025-06-05 10:55:55,872 - __main__ - INFO -   Target: -100 @ $310.72
2025-06-05 10:55:55,872 - __main__ - INFO - 
============================================================
2025-06-05 10:55:55,872 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 10:55:55,872 - __main__ - INFO - ============================================================
2025-06-05 10:55:55,872 - __main__ - INFO - Waiting for double down order 33c5c867-4230-409f-99d8-65f6b3287721 to fill at $310.2...
2025-06-05 10:55:55,872 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 10:56:00,876 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 10:56:05,879 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 10:56:10,751 - src.order.base - INFO - Order 33c5c867-4230-409f-99d8-65f6b3287721 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:56:10,751 - src.tws_connection - INFO - Open Order - ID: 162, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:56:10,755 - src.order.base - INFO - Order 33c5c867-4230-409f-99d8-65f6b3287721 filled: 100.0 @ 310.2 (100.0/100)
2025-06-05 10:56:10,756 - src.tws_connection - INFO - Open Order - ID: 162, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:56:10,883 - __main__ - INFO - ✅ Double down order filled at $310.2!
2025-06-05 10:56:20,895 - __main__ - INFO - 
============================================================
2025-06-05 10:56:20,896 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 10:56:20,897 - __main__ - INFO - ============================================================
2025-06-05 10:56:20,898 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 10:56:20,898 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 10:56:20,903 - __main__ - INFO - 
New stop order:
2025-06-05 10:56:20,903 - __main__ - INFO -   ID: f99a4e87-db88-4e0e-a5c4-56d1c652b2ce
2025-06-05 10:56:20,903 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 10:56:20,903 - __main__ - INFO -   Stop price: $310.09 (was $310.09)
2025-06-05 10:56:20,904 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 10:56:20,904 - __main__ - INFO - 
New target order:
2025-06-05 10:56:20,904 - __main__ - INFO -   ID: e697ff1e-16c5-4862-8b3c-e5e989ac0d56
2025-06-05 10:56:20,905 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 10:56:20,905 - __main__ - INFO -   Limit price: $310.72 (was $310.72)
2025-06-05 10:56:20,905 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 10:56:20,905 - __main__ - INFO - 
PositionManager state:
2025-06-05 10:56:20,905 - __main__ - INFO -   Symbol: GLD
2025-06-05 10:56:20,905 - __main__ - INFO -   Side: BUY
2025-06-05 10:56:20,905 - __main__ - INFO -   Stop orders: 1
2025-06-05 10:56:20,906 - __main__ - INFO -   Target orders: 1
2025-06-05 10:56:20,906 - __main__ - INFO -   All orders: {'33c5c867-4230-409f-99d8-65f6b3287721', '624906ac-bf6d-4703-987a-3075cbf6c382', 'e697ff1e-16c5-4862-8b3c-e5e989ac0d56', 'f99a4e87-db88-4e0e-a5c4-56d1c652b2ce'}
2025-06-05 10:56:20,906 - __main__ - INFO - 
============================================================
2025-06-05 10:56:20,906 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:56:20,906 - __main__ - INFO - ============================================================
2025-06-05 10:56:20,906 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:56:20,907 - src.order.manager - WARNING - Cannot cancel inactive order 33c5c867-4230-409f-99d8-65f6b3287721 with status filled
2025-06-05 10:56:20,907 - src.order.manager - WARNING - Cannot cancel inactive order 624906ac-bf6d-4703-987a-3075cbf6c382 with status filled
2025-06-05 10:56:20,907 - src.order.base - INFO - Order e697ff1e-16c5-4862-8b3c-e5e989ac0d56 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 10:56:20,907 - src.order.manager - INFO - Cancelling order e697ff1e-16c5-4862-8b3c-e5e989ac0d56 with broker ID 161
2025-06-05 10:56:20,910 - src.order.base - INFO - Order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 10:56:20,910 - src.order.manager - INFO - Cancelling order f99a4e87-db88-4e0e-a5c4-56d1c652b2ce with broker ID 160
2025-06-05 10:56:20,910 - __main__ - INFO - Cancelled 2 orders
2025-06-05 10:56:20,910 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:56:20,952 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:56:20,952 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:56:20,953 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:56:20,957 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:56:20,958 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:57:25,230 - __main__ - INFO - ================================================================================
2025-06-05 10:57:25,231 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 10:57:25,231 - __main__ - INFO - ================================================================================
2025-06-05 10:57:25,232 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:57:25,233 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:57:25,234 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:57:27,919 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:57:28,054 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:57:28,056 - src.tws_connection - INFO - ✅ Next valid order ID received: 163
2025-06-05 10:57:28,059 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:57:28,060 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:57:28,061 - src.tws_connection - INFO - ✅ Next valid order ID received: 163
2025-06-05 10:57:28,062 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:57:28,119 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:57:28,119 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:57:28,120 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:57:28,120 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:57:28,063 - src.tws_connection - INFO - ✅ Next valid order ID received: 163
2025-06-05 10:57:28,121 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 10:57:28,121 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:57:28,121 - __main__ - INFO - 
============================================================
2025-06-05 10:57:28,121 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:57:28,121 - __main__ - INFO - ============================================================
2025-06-05 10:57:28,122 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:57:28,122 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:57:28,122 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:57:28,122 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:57:28,122 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:57:28,122 - src.order.base - INFO - Order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:57:28,122 - src.order.manager - INFO - Submitting order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 to TWS
2025-06-05 10:57:28,122 - src.order.manager - INFO - Got broker order ID 163 for order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758
2025-06-05 10:57:28,122 - src.order.manager - INFO - Calling placeOrder with ID 163, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:57:28,123 - src.order.manager - INFO - placeOrder called successfully for order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758
2025-06-05 10:57:28,123 - src.order.base - INFO - Order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:57:28,123 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:57:28,123 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:57:28,244 - src.tws_connection - INFO - Open Order - ID: 163, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:57:28,245 - src.order.base - INFO - Order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:57:28,250 - src.order.base - INFO - Order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 status changed: accepted -> filled (Order fully filled)
2025-06-05 10:57:28,251 - src.order.base - INFO - Order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 filled: 100.0 @ 310.33 (100.0/100)
2025-06-05 10:57:28,253 - src.tws_connection - INFO - Open Order - ID: 163, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:57:28,255 - src.tws_connection - INFO - Open Order - ID: 163, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:57:29,139 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:57:29,140 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.07 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:57:29,140 - src.order.base - INFO - Order 22e0c1bb-a680-428e-8e7b-785c40c4a992 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:57:29,140 - src.order.manager - INFO - Submitting order 22e0c1bb-a680-428e-8e7b-785c40c4a992 to TWS
2025-06-05 10:57:29,140 - src.order.manager - INFO - Got broker order ID 164 for order 22e0c1bb-a680-428e-8e7b-785c40c4a992
2025-06-05 10:57:29,140 - src.order.manager - INFO - Calling placeOrder with ID 164, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:57:29,142 - src.order.manager - INFO - placeOrder called successfully for order 22e0c1bb-a680-428e-8e7b-785c40c4a992
2025-06-05 10:57:29,142 - src.order.base - INFO - Order 22e0c1bb-a680-428e-8e7b-785c40c4a992 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:57:29,143 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 22e0c1bb-a680-428e-8e7b-785c40c4a992 at $310.07
2025-06-05 10:57:29,143 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:57:29,144 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.70 (ATR: 0.0450 * 8.0 = 0.3600)
2025-06-05 10:57:29,144 - src.order.base - INFO - Order ed161d3e-929f-4ad0-8251-3dae6191e6c9 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:57:29,144 - src.order.manager - INFO - Submitting order ed161d3e-929f-4ad0-8251-3dae6191e6c9 to TWS
2025-06-05 10:57:29,144 - src.order.manager - INFO - Got broker order ID 165 for order ed161d3e-929f-4ad0-8251-3dae6191e6c9
2025-06-05 10:57:29,144 - src.order.manager - INFO - Calling placeOrder with ID 165, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.700000 DAY
2025-06-05 10:57:29,144 - src.order.manager - INFO - placeOrder called successfully for order ed161d3e-929f-4ad0-8251-3dae6191e6c9
2025-06-05 10:57:29,145 - src.order.base - INFO - Order ed161d3e-929f-4ad0-8251-3dae6191e6c9 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:57:29,145 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit ed161d3e-929f-4ad0-8251-3dae6191e6c9 at $310.70
2025-06-05 10:57:29,145 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:57:29,145 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:57:29,219 - src.tws_connection - INFO - Open Order - ID: 164, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:57:29,220 - src.order.base - INFO - Order 22e0c1bb-a680-428e-8e7b-785c40c4a992 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:57:29,286 - src.tws_connection - INFO - Open Order - ID: 165, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:57:29,654 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['22e0c1bb-a680-428e-8e7b-785c40c4a992']
2025-06-05 10:57:29,654 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:57:34,671 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:57:34,671 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.31, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.18, original_qty=100, dd_qty=100
2025-06-05 10:57:34,672 - src.order.base - INFO - Order b947ee25-7331-40c7-9a37-8046069f2ee2 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:57:34,672 - src.order.manager - INFO - Submitting order b947ee25-7331-40c7-9a37-8046069f2ee2 to TWS
2025-06-05 10:57:34,672 - src.order.manager - INFO - Got broker order ID 166 for order b947ee25-7331-40c7-9a37-8046069f2ee2
2025-06-05 10:57:34,673 - src.order.manager - INFO - Calling placeOrder with ID 166, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.180000 DAY
2025-06-05 10:57:34,673 - src.order.manager - INFO - placeOrder called successfully for order b947ee25-7331-40c7-9a37-8046069f2ee2
2025-06-05 10:57:34,673 - src.order.base - INFO - Order b947ee25-7331-40c7-9a37-8046069f2ee2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:57:34,674 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:57:34,674 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.18
2025-06-05 10:57:34,674 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:57:34,674 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 for GLD
2025-06-05 10:57:34,830 - src.tws_connection - INFO - Open Order - ID: 166, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:57:38,139 - __main__ - INFO - 
============================================================
2025-06-05 10:57:38,139 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:57:38,140 - __main__ - INFO - ============================================================
2025-06-05 10:57:38,140 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:57:38,140 - __main__ - INFO - Order ed161d3e-929f-4ad0-8251-3dae6191e6c9: limit sell -100 @ 310.7 - Status: submitted
2025-06-05 10:57:38,141 - __main__ - INFO - Order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758: market buy 100 @ MARKET - Status: filled
2025-06-05 10:57:38,141 - __main__ - INFO - Order b947ee25-7331-40c7-9a37-8046069f2ee2: limit buy 100 @ 310.18 - Status: submitted
2025-06-05 10:57:38,141 - __main__ - INFO - Order 22e0c1bb-a680-428e-8e7b-785c40c4a992: stop sell -100 @ 310.07 - Status: accepted
2025-06-05 10:57:38,141 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:57:38,141 - __main__ - INFO - Stop orders: 1
2025-06-05 10:57:38,141 - __main__ - INFO - Target orders: 1
2025-06-05 10:57:38,141 - __main__ - INFO - Double down orders: 1
2025-06-05 10:57:38,141 - __main__ - INFO - 
Double down order details:
2025-06-05 10:57:38,142 - __main__ - INFO -   ID: b947ee25-7331-40c7-9a37-8046069f2ee2
2025-06-05 10:57:38,142 - __main__ - INFO -   Status: submitted
2025-06-05 10:57:38,142 - __main__ - INFO -   Limit price: 310.18
2025-06-05 10:57:38,142 - __main__ - INFO -   Quantity: 100
2025-06-05 10:57:38,142 - __main__ - INFO - 
Original protective orders:
2025-06-05 10:57:38,142 - __main__ - INFO -   Stop: -100 @ $310.07
2025-06-05 10:57:38,142 - __main__ - INFO -   Target: -100 @ $310.7
2025-06-05 10:57:38,143 - __main__ - INFO - 
============================================================
2025-06-05 10:57:38,143 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 10:57:38,143 - __main__ - INFO - ============================================================
2025-06-05 10:57:38,143 - __main__ - INFO - Waiting for double down order b947ee25-7331-40c7-9a37-8046069f2ee2 to fill at $310.18...
2025-06-05 10:57:38,143 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 10:57:43,156 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 10:57:48,164 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 10:57:53,169 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 10:57:58,175 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 10:58:03,183 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 10:58:03,579 - src.tws_connection - INFO - Open Order - ID: 166, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:58:03,580 - src.order.base - INFO - Order b947ee25-7331-40c7-9a37-8046069f2ee2 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:58:03,580 - src.order.base - INFO - Order b947ee25-7331-40c7-9a37-8046069f2ee2 filled: 100.0 @ 310.18 (100.0/100)
2025-06-05 10:58:03,624 - src.tws_connection - INFO - Open Order - ID: 166, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:58:08,188 - __main__ - INFO - ✅ Double down order filled at $310.18!
2025-06-05 10:58:18,202 - __main__ - INFO - 
============================================================
2025-06-05 10:58:18,204 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 10:58:18,205 - __main__ - INFO - ============================================================
2025-06-05 10:58:18,205 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 10:58:18,205 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 10:58:18,205 - __main__ - INFO - 
New stop order:
2025-06-05 10:58:18,206 - __main__ - INFO -   ID: 22e0c1bb-a680-428e-8e7b-785c40c4a992
2025-06-05 10:58:18,206 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 10:58:18,206 - __main__ - INFO -   Stop price: $310.07 (was $310.07)
2025-06-05 10:58:18,206 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 10:58:18,206 - __main__ - INFO - 
New target order:
2025-06-05 10:58:18,206 - __main__ - INFO -   ID: ed161d3e-929f-4ad0-8251-3dae6191e6c9
2025-06-05 10:58:18,206 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 10:58:18,206 - __main__ - INFO -   Limit price: $310.7 (was $310.7)
2025-06-05 10:58:18,206 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 10:58:18,206 - __main__ - INFO - 
PositionManager state:
2025-06-05 10:58:18,206 - __main__ - INFO -   Symbol: GLD
2025-06-05 10:58:18,207 - __main__ - INFO -   Side: BUY
2025-06-05 10:58:18,207 - __main__ - INFO -   Stop orders: 1
2025-06-05 10:58:18,207 - __main__ - INFO -   Target orders: 1
2025-06-05 10:58:18,207 - __main__ - INFO -   All orders: {'ed161d3e-929f-4ad0-8251-3dae6191e6c9', '3630ea0c-183f-4fe1-b56f-9b03b2cbb758', 'b947ee25-7331-40c7-9a37-8046069f2ee2', '22e0c1bb-a680-428e-8e7b-785c40c4a992'}
2025-06-05 10:58:18,207 - __main__ - INFO - 
============================================================
2025-06-05 10:58:18,208 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:58:18,208 - __main__ - INFO - ============================================================
2025-06-05 10:58:18,208 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:58:18,208 - src.order.base - INFO - Order ed161d3e-929f-4ad0-8251-3dae6191e6c9 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 10:58:18,208 - src.order.manager - INFO - Cancelling order ed161d3e-929f-4ad0-8251-3dae6191e6c9 with broker ID 165
2025-06-05 10:58:18,208 - src.order.manager - WARNING - Cannot cancel inactive order 3630ea0c-183f-4fe1-b56f-9b03b2cbb758 with status filled
2025-06-05 10:58:18,208 - src.order.manager - WARNING - Cannot cancel inactive order b947ee25-7331-40c7-9a37-8046069f2ee2 with status filled
2025-06-05 10:58:18,208 - src.order.base - INFO - Order 22e0c1bb-a680-428e-8e7b-785c40c4a992 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 10:58:18,212 - src.order.manager - INFO - Cancelling order 22e0c1bb-a680-428e-8e7b-785c40c4a992 with broker ID 164
2025-06-05 10:58:18,214 - __main__ - INFO - Cancelled 2 orders
2025-06-05 10:58:18,214 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:58:18,215 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:58:18,215 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:58:18,215 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:58:18,221 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:58:18,223 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:58:59,011 - __main__ - INFO - ================================================================================
2025-06-05 10:58:59,011 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 10:58:59,011 - __main__ - INFO - ================================================================================
2025-06-05 10:58:59,013 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:58:59,013 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:58:59,015 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:59:01,393 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:59:01,394 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:59:01,425 - src.tws_connection - INFO - ✅ Next valid order ID received: 167
2025-06-05 10:59:01,427 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:59:01,427 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:59:01,427 - src.tws_connection - INFO - ✅ Next valid order ID received: 167
2025-06-05 10:59:01,428 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:59:01,429 - src.tws_connection - INFO - ✅ Next valid order ID received: 167
2025-06-05 10:59:01,429 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:59:01,430 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:59:01,430 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:59:01,430 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:59:01,431 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 10:59:01,431 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:59:01,431 - __main__ - INFO - 
============================================================
2025-06-05 10:59:01,431 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:59:01,432 - __main__ - INFO - ============================================================
2025-06-05 10:59:01,432 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:59:01,433 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:59:01,433 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:59:01,433 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:59:01,433 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:59:01,434 - src.order.base - INFO - Order 204a0449-27ce-43cf-aa72-009c87803710 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:59:01,434 - src.order.manager - INFO - Submitting order 204a0449-27ce-43cf-aa72-009c87803710 to TWS
2025-06-05 10:59:01,434 - src.order.manager - INFO - Got broker order ID 167 for order 204a0449-27ce-43cf-aa72-009c87803710
2025-06-05 10:59:01,435 - src.order.manager - INFO - Calling placeOrder with ID 167, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:59:01,435 - src.order.manager - INFO - placeOrder called successfully for order 204a0449-27ce-43cf-aa72-009c87803710
2025-06-05 10:59:01,435 - src.order.base - INFO - Order 204a0449-27ce-43cf-aa72-009c87803710 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:59:01,435 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:59:01,436 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:59:01,544 - src.tws_connection - INFO - Open Order - ID: 167, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:59:01,545 - src.order.base - INFO - Order 204a0449-27ce-43cf-aa72-009c87803710 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:59:01,579 - src.order.base - INFO - Order 204a0449-27ce-43cf-aa72-009c87803710 status changed: accepted -> filled (Order fully filled)
2025-06-05 10:59:01,579 - src.tws_connection - INFO - Open Order - ID: 167, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:59:01,581 - src.order.base - INFO - Order 204a0449-27ce-43cf-aa72-009c87803710 filled: 100.0 @ 310.0 (100.0/100)
2025-06-05 10:59:01,582 - src.tws_connection - INFO - Open Order - ID: 167, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:59:02,449 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:59:02,449 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $309.73 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:59:02,449 - src.order.base - INFO - Order 9d1840d4-e813-49cd-b643-182927d4ad4d status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:59:02,450 - src.order.manager - INFO - Submitting order 9d1840d4-e813-49cd-b643-182927d4ad4d to TWS
2025-06-05 10:59:02,450 - src.order.manager - INFO - Got broker order ID 168 for order 9d1840d4-e813-49cd-b643-182927d4ad4d
2025-06-05 10:59:02,450 - src.order.manager - INFO - Calling placeOrder with ID 168, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:59:02,450 - src.order.manager - INFO - placeOrder called successfully for order 9d1840d4-e813-49cd-b643-182927d4ad4d
2025-06-05 10:59:02,451 - src.order.base - INFO - Order 9d1840d4-e813-49cd-b643-182927d4ad4d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:59:02,451 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9d1840d4-e813-49cd-b643-182927d4ad4d at $309.73
2025-06-05 10:59:02,451 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:59:02,452 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.36 (ATR: 0.0450 * 8.0 = 0.3600)
2025-06-05 10:59:02,452 - src.order.base - INFO - Order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:59:02,452 - src.order.manager - INFO - Submitting order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe to TWS
2025-06-05 10:59:02,453 - src.order.manager - INFO - Got broker order ID 169 for order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe
2025-06-05 10:59:02,453 - src.order.manager - INFO - Calling placeOrder with ID 169, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.360000 DAY
2025-06-05 10:59:02,454 - src.order.manager - INFO - placeOrder called successfully for order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe
2025-06-05 10:59:02,458 - src.order.base - INFO - Order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:59:02,459 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit ce9f4d11-6bac-4946-a8c7-dda3a7c260fe at $310.36
2025-06-05 10:59:02,460 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:59:02,460 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:59:02,534 - src.tws_connection - INFO - Open Order - ID: 168, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:59:02,535 - src.order.base - INFO - Order 9d1840d4-e813-49cd-b643-182927d4ad4d status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:59:02,611 - src.tws_connection - INFO - Open Order - ID: 169, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:59:02,968 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9d1840d4-e813-49cd-b643-182927d4ad4d']
2025-06-05 10:59:02,968 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:59:07,981 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:59:07,982 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.07, stop_distance=$0.27, dd_distance=$0.13, dd_price=$309.94, original_qty=100, dd_qty=100
2025-06-05 10:59:07,983 - src.order.base - INFO - Order 0059f239-60cd-43b8-ab49-69fd07344b85 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:59:07,983 - src.order.manager - INFO - Submitting order 0059f239-60cd-43b8-ab49-69fd07344b85 to TWS
2025-06-05 10:59:07,984 - src.order.manager - INFO - Got broker order ID 170 for order 0059f239-60cd-43b8-ab49-69fd07344b85
2025-06-05 10:59:07,984 - src.order.manager - INFO - Calling placeOrder with ID 170, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@309.940000 DAY
2025-06-05 10:59:07,985 - src.order.manager - INFO - placeOrder called successfully for order 0059f239-60cd-43b8-ab49-69fd07344b85
2025-06-05 10:59:07,985 - src.order.base - INFO - Order 0059f239-60cd-43b8-ab49-69fd07344b85 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:59:07,985 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:59:07,985 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $309.94
2025-06-05 10:59:07,986 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:59:07,986 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 204a0449-27ce-43cf-aa72-009c87803710 for GLD
2025-06-05 10:59:08,113 - src.tws_connection - INFO - Open Order - ID: 170, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:59:11,447 - __main__ - INFO - 
============================================================
2025-06-05 10:59:11,448 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:59:11,448 - __main__ - INFO - ============================================================
2025-06-05 10:59:11,448 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:59:11,449 - __main__ - INFO - Order 9d1840d4-e813-49cd-b643-182927d4ad4d: stop sell -100 @ 309.73 - Status: accepted
2025-06-05 10:59:11,449 - __main__ - INFO - Order 204a0449-27ce-43cf-aa72-009c87803710: market buy 100 @ MARKET - Status: filled
2025-06-05 10:59:11,450 - __main__ - INFO - Order 0059f239-60cd-43b8-ab49-69fd07344b85: limit buy 100 @ 309.94 - Status: submitted
2025-06-05 10:59:11,450 - __main__ - INFO - Order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe: limit sell -100 @ 310.36 - Status: submitted
2025-06-05 10:59:11,451 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:59:11,451 - __main__ - INFO - Stop orders: 1
2025-06-05 10:59:11,451 - __main__ - INFO - Target orders: 1
2025-06-05 10:59:11,452 - __main__ - INFO - Double down orders: 1
2025-06-05 10:59:11,452 - __main__ - INFO - 
Double down order details:
2025-06-05 10:59:11,452 - __main__ - INFO -   ID: 0059f239-60cd-43b8-ab49-69fd07344b85
2025-06-05 10:59:11,452 - __main__ - INFO -   Status: submitted
2025-06-05 10:59:11,452 - __main__ - INFO -   Limit price: 309.94
2025-06-05 10:59:11,453 - __main__ - INFO -   Quantity: 100
2025-06-05 10:59:11,453 - __main__ - INFO - 
Original protective orders:
2025-06-05 10:59:11,453 - __main__ - INFO -   Stop: -100 @ $309.73
2025-06-05 10:59:11,454 - __main__ - INFO -   Target: -100 @ $310.36
2025-06-05 10:59:11,454 - __main__ - INFO - 
============================================================
2025-06-05 10:59:11,454 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 10:59:11,454 - __main__ - INFO - ============================================================
2025-06-05 10:59:11,457 - __main__ - INFO - Waiting for double down order 0059f239-60cd-43b8-ab49-69fd07344b85 to fill at $309.94...
2025-06-05 10:59:11,457 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 10:59:16,460 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 10:59:21,492 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 10:59:26,495 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 10:59:31,508 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 10:59:36,512 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 10:59:41,514 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 10:59:46,518 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 10:59:51,527 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 10:59:56,531 - __main__ - INFO - Waiting... (45s elapsed, order status: submitted)
2025-06-05 11:00:01,538 - __main__ - INFO - Waiting... (50s elapsed, order status: submitted)
2025-06-05 11:00:06,550 - __main__ - INFO - Waiting... (55s elapsed, order status: submitted)
2025-06-05 11:00:11,560 - __main__ - INFO - Waiting... (60s elapsed, order status: submitted)
2025-06-05 11:00:16,565 - __main__ - INFO - Waiting... (65s elapsed, order status: submitted)
2025-06-05 11:00:21,579 - __main__ - INFO - Waiting... (70s elapsed, order status: submitted)
2025-06-05 11:00:26,587 - __main__ - INFO - Waiting... (75s elapsed, order status: submitted)
2025-06-05 11:00:31,595 - __main__ - INFO - Waiting... (80s elapsed, order status: submitted)
2025-06-05 11:00:36,605 - __main__ - INFO - Waiting... (85s elapsed, order status: submitted)
2025-06-05 11:00:41,614 - __main__ - INFO - Waiting... (90s elapsed, order status: submitted)
2025-06-05 11:00:45,565 - src.order.base - INFO - Order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe status changed: submitted -> filled (Order fully filled)
2025-06-05 11:00:45,565 - src.tws_connection - INFO - Open Order - ID: 169, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:00:45,566 - src.order.base - INFO - Order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe filled: 100.0 @ 310.36 (100.0/100)
2025-06-05 11:00:45,566 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - target order ce9f4d11-6bac-4946-a8c7-dda3a7c260fe filled at $310.36
2025-06-05 11:00:45,567 - src.order.base - INFO - Order 9d1840d4-e813-49cd-b643-182927d4ad4d status changed: accepted -> pending_cancel (Position concluded via target fill)
2025-06-05 11:00:45,568 - src.order.manager - INFO - Cancelling order 9d1840d4-e813-49cd-b643-182927d4ad4d with broker ID 168
2025-06-05 11:00:45,568 - src.rule.linked_order_actions - INFO - Cancelled remaining order 9d1840d4-e813-49cd-b643-182927d4ad4d for GLD
2025-06-05 11:00:45,569 - src.order.manager - WARNING - Cannot cancel inactive order 204a0449-27ce-43cf-aa72-009c87803710 with status filled
2025-06-05 11:00:45,569 - src.rule.linked_order_actions - INFO - Cancelled remaining order 204a0449-27ce-43cf-aa72-009c87803710 for GLD
2025-06-05 11:00:45,569 - src.order.base - INFO - Order 0059f239-60cd-43b8-ab49-69fd07344b85 status changed: submitted -> pending_cancel (Position concluded via target fill)
2025-06-05 11:00:45,570 - src.order.manager - INFO - Cancelling order 0059f239-60cd-43b8-ab49-69fd07344b85 with broker ID 170
2025-06-05 11:00:45,570 - src.rule.linked_order_actions - INFO - Cancelled remaining order 0059f239-60cd-43b8-ab49-69fd07344b85 for GLD
2025-06-05 11:00:45,570 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 11:00:45,570 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 11:00:45,570 - src.tws_connection - INFO - Open Order - ID: 169, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:00:45,623 - src.order.base - INFO - Order 9d1840d4-e813-49cd-b643-182927d4ad4d status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:00:45,623 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 168)
2025-06-05 11:00:45,751 - src.order.base - INFO - Order 0059f239-60cd-43b8-ab49-69fd07344b85 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:00:45,751 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 170)
2025-06-05 11:00:46,619 - __main__ - INFO - Waiting... (95s elapsed, order status: cancelled)
2025-06-05 11:00:51,624 - __main__ - INFO - Waiting... (100s elapsed, order status: cancelled)
2025-06-05 11:00:56,635 - __main__ - INFO - Waiting... (105s elapsed, order status: cancelled)
2025-06-05 11:01:01,637 - __main__ - INFO - Waiting... (110s elapsed, order status: cancelled)
2025-06-05 11:01:06,647 - __main__ - INFO - Waiting... (115s elapsed, order status: cancelled)
2025-06-05 11:01:11,662 - __main__ - INFO - Waiting... (120s elapsed, order status: cancelled)
2025-06-05 11:01:16,672 - __main__ - INFO - Waiting... (125s elapsed, order status: cancelled)
2025-06-05 11:01:21,681 - __main__ - INFO - Waiting... (130s elapsed, order status: cancelled)
2025-06-05 11:02:06,759 - __main__ - INFO - ================================================================================
2025-06-05 11:02:06,760 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:02:06,760 - __main__ - INFO - ================================================================================
2025-06-05 11:02:06,761 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:02:06,762 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:02:06,764 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:02:08,135 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:02:08,136 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:02:08,142 - src.tws_connection - INFO - ✅ Next valid order ID received: 171
2025-06-05 11:02:08,142 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:02:08,142 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:02:08,144 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:02:08,144 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:02:08,144 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:02:08,145 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:02:08,145 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:02:08,146 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:02:08,146 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:02:08,147 - __main__ - INFO - 
============================================================
2025-06-05 11:02:08,147 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:02:08,147 - __main__ - INFO - ============================================================
2025-06-05 11:02:08,148 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:02:08,148 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:02:08,148 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:02:08,149 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:02:08,149 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:02:08,149 - src.order.base - INFO - Order 86556e1a-7bee-4711-8ddb-f8de56d15519 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:02:08,150 - src.order.manager - INFO - Submitting order 86556e1a-7bee-4711-8ddb-f8de56d15519 to TWS
2025-06-05 11:02:08,150 - src.order.manager - INFO - Got broker order ID 171 for order 86556e1a-7bee-4711-8ddb-f8de56d15519
2025-06-05 11:02:08,151 - src.order.manager - INFO - Calling placeOrder with ID 171, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:02:08,151 - src.order.manager - INFO - placeOrder called successfully for order 86556e1a-7bee-4711-8ddb-f8de56d15519
2025-06-05 11:02:08,152 - src.order.base - INFO - Order 86556e1a-7bee-4711-8ddb-f8de56d15519 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:02:08,152 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:02:08,152 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:02:08,238 - src.tws_connection - INFO - ✅ Next valid order ID received: 171
2025-06-05 11:02:08,337 - src.tws_connection - INFO - ✅ Next valid order ID received: 171
2025-06-05 11:02:08,568 - src.tws_connection - INFO - Open Order - ID: 171, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:02:08,577 - src.order.base - INFO - Order 86556e1a-7bee-4711-8ddb-f8de56d15519 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:02:08,581 - src.order.base - INFO - Order 86556e1a-7bee-4711-8ddb-f8de56d15519 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:02:08,581 - src.order.base - INFO - Order 86556e1a-7bee-4711-8ddb-f8de56d15519 filled: 100.0 @ 310.43 (100.0/100)
2025-06-05 11:02:08,575 - src.tws_connection - INFO - Open Order - ID: 171, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:02:08,585 - src.tws_connection - INFO - Open Order - ID: 171, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:02:08,593 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:02:08,593 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.14 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 11:02:08,597 - src.order.base - INFO - Order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:02:08,598 - src.order.manager - INFO - Submitting order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8 to TWS
2025-06-05 11:02:08,598 - src.order.manager - INFO - Got broker order ID 171 for order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8
2025-06-05 11:02:08,600 - src.order.manager - INFO - Calling placeOrder with ID 171, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:02:08,600 - src.order.manager - INFO - placeOrder called successfully for order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8
2025-06-05 11:02:08,601 - src.order.base - INFO - Order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:02:08,601 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8 at $310.14
2025-06-05 11:02:08,602 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:02:08,602 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.31 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:02:08,603 - src.order.base - INFO - Order d1eca2c5-6a74-4258-8df7-0ba840f95b6c status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:02:08,604 - src.order.manager - INFO - Submitting order d1eca2c5-6a74-4258-8df7-0ba840f95b6c to TWS
2025-06-05 11:02:08,604 - src.order.manager - INFO - Got broker order ID 172 for order d1eca2c5-6a74-4258-8df7-0ba840f95b6c
2025-06-05 11:02:08,604 - src.order.manager - INFO - Calling placeOrder with ID 172, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.310000 DAY
2025-06-05 11:02:08,605 - src.order.manager - INFO - placeOrder called successfully for order d1eca2c5-6a74-4258-8df7-0ba840f95b6c
2025-06-05 11:02:08,606 - src.order.base - INFO - Order d1eca2c5-6a74-4258-8df7-0ba840f95b6c status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:02:08,607 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit d1eca2c5-6a74-4258-8df7-0ba840f95b6c at $311.31
2025-06-05 11:02:08,606 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 171)
2025-06-05 11:02:08,607 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:02:08,607 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:02:08,608 - src.order.base - INFO - Order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8 status changed: submitted -> filled (IB status: Filled)
2025-06-05 11:02:08,709 - src.tws_connection - INFO - Open Order - ID: 172, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:02:09,108 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['318e99f8-1ea4-4e18-8eb1-ca862ca72ea8']
2025-06-05 11:02:09,109 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:02:09,169 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:02:09,169 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.41, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.28, original_qty=100, dd_qty=100
2025-06-05 11:02:09,170 - src.order.base - INFO - Order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:02:09,170 - src.order.manager - INFO - Submitting order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91 to TWS
2025-06-05 11:02:09,171 - src.order.manager - INFO - Got broker order ID 173 for order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91
2025-06-05 11:02:09,171 - src.order.manager - INFO - Calling placeOrder with ID 173, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.280000 DAY
2025-06-05 11:02:09,171 - src.order.manager - INFO - placeOrder called successfully for order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91
2025-06-05 11:02:09,173 - src.order.base - INFO - Order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:02:09,174 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:02:09,174 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.28
2025-06-05 11:02:09,176 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:02:09,176 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 86556e1a-7bee-4711-8ddb-f8de56d15519 for GLD
2025-06-05 11:02:09,299 - src.tws_connection - INFO - Open Order - ID: 173, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:02:18,154 - __main__ - INFO - 
============================================================
2025-06-05 11:02:18,154 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:02:18,155 - __main__ - INFO - ============================================================
2025-06-05 11:02:18,155 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:02:18,155 - __main__ - INFO - Order 318e99f8-1ea4-4e18-8eb1-ca862ca72ea8: stop sell -100 @ 310.14 - Status: filled
2025-06-05 11:02:18,155 - __main__ - INFO - Order 86556e1a-7bee-4711-8ddb-f8de56d15519: market buy 100 @ MARKET - Status: filled
2025-06-05 11:02:18,156 - __main__ - INFO - Order d1eca2c5-6a74-4258-8df7-0ba840f95b6c: limit sell -100 @ 311.31 - Status: submitted
2025-06-05 11:02:18,156 - __main__ - INFO - Order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91: limit buy 100 @ 310.28 - Status: submitted
2025-06-05 11:02:18,156 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:02:18,156 - __main__ - INFO - Stop orders: 1
2025-06-05 11:02:18,157 - __main__ - INFO - Target orders: 1
2025-06-05 11:02:18,157 - __main__ - INFO - Double down orders: 1
2025-06-05 11:02:18,157 - __main__ - INFO - 
Double down order details:
2025-06-05 11:02:18,157 - __main__ - INFO -   ID: 9674b43b-b8fa-4443-a4a8-d3b50f7ade91
2025-06-05 11:02:18,158 - __main__ - INFO -   Status: submitted
2025-06-05 11:02:18,158 - __main__ - INFO -   Limit price: 310.28
2025-06-05 11:02:18,158 - __main__ - INFO -   Quantity: 100
2025-06-05 11:02:18,158 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:02:18,158 - __main__ - INFO -   Stop: -100 @ $310.14
2025-06-05 11:02:18,158 - __main__ - INFO -   Target: -100 @ $311.31
2025-06-05 11:02:18,158 - __main__ - INFO - 
============================================================
2025-06-05 11:02:18,159 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:02:18,159 - __main__ - INFO - ============================================================
2025-06-05 11:02:18,159 - __main__ - INFO - Waiting for double down order 9674b43b-b8fa-4443-a4a8-d3b50f7ade91 to fill at $310.28...
2025-06-05 11:02:18,159 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:02:23,171 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:02:28,178 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:02:33,185 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:02:38,195 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:02:43,201 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:02:48,216 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:02:53,222 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:02:58,224 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:03:48,171 - __main__ - INFO - ================================================================================
2025-06-05 11:03:48,171 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:03:48,172 - __main__ - INFO - ================================================================================
2025-06-05 11:03:48,174 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:03:48,174 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:03:48,175 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:03:49,958 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:03:49,959 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:03:49,976 - src.tws_connection - INFO - ✅ Next valid order ID received: 174
2025-06-05 11:03:49,977 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:03:49,977 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:03:49,979 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:03:49,979 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:03:49,980 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:03:49,980 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:03:49,980 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:03:49,980 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:03:49,981 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:03:49,981 - __main__ - INFO - 
============================================================
2025-06-05 11:03:49,981 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:03:49,981 - __main__ - INFO - ============================================================
2025-06-05 11:03:49,982 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:03:49,983 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:03:49,983 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:03:49,984 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:03:49,984 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:03:49,984 - src.order.base - INFO - Order 37751c03-25b7-4924-bd5b-35cdf57b73f8 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:03:49,984 - src.order.manager - INFO - Submitting order 37751c03-25b7-4924-bd5b-35cdf57b73f8 to TWS
2025-06-05 11:03:49,984 - src.order.manager - INFO - Got broker order ID 174 for order 37751c03-25b7-4924-bd5b-35cdf57b73f8
2025-06-05 11:03:49,985 - src.order.manager - INFO - Calling placeOrder with ID 174, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:03:49,985 - src.order.manager - INFO - placeOrder called successfully for order 37751c03-25b7-4924-bd5b-35cdf57b73f8
2025-06-05 11:03:49,985 - src.order.base - INFO - Order 37751c03-25b7-4924-bd5b-35cdf57b73f8 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:03:49,986 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:03:49,986 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:03:50,058 - src.tws_connection - INFO - ✅ Next valid order ID received: 174
2025-06-05 11:03:50,159 - src.tws_connection - INFO - ✅ Next valid order ID received: 174
2025-06-05 11:03:50,437 - src.tws_connection - INFO - Open Order - ID: 174, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:03:50,442 - src.order.base - INFO - Order 37751c03-25b7-4924-bd5b-35cdf57b73f8 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:03:50,444 - src.order.base - INFO - Order 37751c03-25b7-4924-bd5b-35cdf57b73f8 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:03:50,444 - src.order.base - INFO - Order 37751c03-25b7-4924-bd5b-35cdf57b73f8 filled: 100.0 @ 310.38 (100.0/100)
2025-06-05 11:03:50,443 - src.tws_connection - INFO - Open Order - ID: 174, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:03:50,446 - src.tws_connection - INFO - Open Order - ID: 174, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:03:50,543 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:03:50,544 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.10 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 11:03:50,544 - src.order.base - INFO - Order f0938b69-1683-47d9-bcb6-38159ed0f61e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:03:50,545 - src.order.manager - INFO - Submitting order f0938b69-1683-47d9-bcb6-38159ed0f61e to TWS
2025-06-05 11:03:50,545 - src.order.manager - INFO - Got broker order ID 174 for order f0938b69-1683-47d9-bcb6-38159ed0f61e
2025-06-05 11:03:50,546 - src.order.manager - INFO - Calling placeOrder with ID 174, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:03:50,553 - src.order.manager - INFO - placeOrder called successfully for order f0938b69-1683-47d9-bcb6-38159ed0f61e
2025-06-05 11:03:50,556 - src.order.base - INFO - Order f0938b69-1683-47d9-bcb6-38159ed0f61e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:03:50,554 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 174)
2025-06-05 11:03:50,557 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss f0938b69-1683-47d9-bcb6-38159ed0f61e at $310.10
2025-06-05 11:03:50,557 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:03:50,557 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.27 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:03:50,558 - src.order.base - INFO - Order 74e235e9-1cf0-41ac-8064-7f713291853d status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:03:50,558 - src.order.manager - INFO - Submitting order 74e235e9-1cf0-41ac-8064-7f713291853d to TWS
2025-06-05 11:03:50,559 - src.order.manager - INFO - Got broker order ID 175 for order 74e235e9-1cf0-41ac-8064-7f713291853d
2025-06-05 11:03:50,559 - src.order.manager - INFO - Calling placeOrder with ID 175, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.270000 DAY
2025-06-05 11:03:50,560 - src.order.manager - INFO - placeOrder called successfully for order 74e235e9-1cf0-41ac-8064-7f713291853d
2025-06-05 11:03:50,562 - src.order.base - INFO - Order 74e235e9-1cf0-41ac-8064-7f713291853d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:03:50,562 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 74e235e9-1cf0-41ac-8064-7f713291853d at $311.27
2025-06-05 11:03:50,563 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:03:50,563 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:03:50,564 - src.order.base - INFO - Order f0938b69-1683-47d9-bcb6-38159ed0f61e status changed: submitted -> filled (IB status: Filled)
2025-06-05 11:03:50,671 - src.tws_connection - INFO - Open Order - ID: 175, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:03:51,067 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['f0938b69-1683-47d9-bcb6-38159ed0f61e']
2025-06-05 11:03:51,068 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:03:56,079 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:03:56,080 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.35, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.22, original_qty=100, dd_qty=100
2025-06-05 11:03:56,081 - src.order.base - INFO - Order a9870750-02e6-4040-8496-740d4d659883 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:03:56,081 - src.order.manager - INFO - Submitting order a9870750-02e6-4040-8496-740d4d659883 to TWS
2025-06-05 11:03:56,084 - src.order.manager - INFO - Got broker order ID 176 for order a9870750-02e6-4040-8496-740d4d659883
2025-06-05 11:03:56,084 - src.order.manager - INFO - Calling placeOrder with ID 176, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.220000 DAY
2025-06-05 11:03:56,085 - src.order.manager - INFO - placeOrder called successfully for order a9870750-02e6-4040-8496-740d4d659883
2025-06-05 11:03:56,086 - src.order.base - INFO - Order a9870750-02e6-4040-8496-740d4d659883 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:03:56,087 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:03:56,089 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.22
2025-06-05 11:03:56,089 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:03:56,090 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 37751c03-25b7-4924-bd5b-35cdf57b73f8 for GLD
2025-06-05 11:03:56,186 - src.tws_connection - INFO - Open Order - ID: 176, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:03:59,985 - __main__ - INFO - 
============================================================
2025-06-05 11:03:59,986 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:03:59,986 - __main__ - INFO - ============================================================
2025-06-05 11:03:59,987 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:03:59,988 - __main__ - INFO - Order a9870750-02e6-4040-8496-740d4d659883: limit buy 100 @ 310.22 - Status: submitted
2025-06-05 11:03:59,988 - __main__ - INFO - Order 74e235e9-1cf0-41ac-8064-7f713291853d: limit sell -100 @ 311.27 - Status: submitted
2025-06-05 11:03:59,988 - __main__ - INFO - Order f0938b69-1683-47d9-bcb6-38159ed0f61e: stop sell -100 @ 310.1 - Status: filled
2025-06-05 11:03:59,989 - __main__ - INFO - Order 37751c03-25b7-4924-bd5b-35cdf57b73f8: market buy 100 @ MARKET - Status: filled
2025-06-05 11:03:59,989 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:03:59,990 - __main__ - INFO - Stop orders: 1
2025-06-05 11:03:59,990 - __main__ - INFO - Target orders: 1
2025-06-05 11:03:59,990 - __main__ - INFO - Double down orders: 1
2025-06-05 11:03:59,991 - __main__ - INFO - 
Double down order details:
2025-06-05 11:03:59,991 - __main__ - INFO -   ID: a9870750-02e6-4040-8496-740d4d659883
2025-06-05 11:03:59,992 - __main__ - INFO -   Status: submitted
2025-06-05 11:03:59,994 - __main__ - INFO -   Limit price: 310.22
2025-06-05 11:03:59,995 - __main__ - INFO -   Quantity: 100
2025-06-05 11:03:59,996 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:03:59,998 - __main__ - INFO -   Stop: -100 @ $310.1
2025-06-05 11:03:59,999 - __main__ - INFO -   Target: -100 @ $311.27
2025-06-05 11:04:00,011 - __main__ - INFO - 
============================================================
2025-06-05 11:04:00,020 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:04:00,021 - __main__ - INFO - ============================================================
2025-06-05 11:04:00,026 - __main__ - INFO - Waiting for double down order a9870750-02e6-4040-8496-740d4d659883 to fill at $310.22...
2025-06-05 11:04:00,043 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:04:05,080 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:04:10,091 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:04:15,094 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:04:20,108 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:04:25,121 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:04:30,138 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:04:35,155 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:04:40,169 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:04:45,180 - __main__ - INFO - Waiting... (45s elapsed, order status: submitted)
2025-06-05 11:04:50,189 - __main__ - INFO - Waiting... (50s elapsed, order status: submitted)
2025-06-05 11:04:55,197 - __main__ - INFO - Waiting... (55s elapsed, order status: submitted)
2025-06-05 11:05:00,213 - __main__ - INFO - Waiting... (60s elapsed, order status: submitted)
2025-06-05 11:05:05,215 - __main__ - INFO - Waiting... (65s elapsed, order status: submitted)
2025-06-05 11:05:10,227 - __main__ - INFO - Waiting... (70s elapsed, order status: submitted)
2025-06-05 11:05:15,243 - __main__ - INFO - Waiting... (75s elapsed, order status: submitted)
2025-06-05 11:05:18,452 - src.order.base - INFO - Order 74e235e9-1cf0-41ac-8064-7f713291853d status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:05:18,452 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 175)
2025-06-05 11:05:18,845 - src.order.base - INFO - Order a9870750-02e6-4040-8496-740d4d659883 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:05:18,844 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 176)
2025-06-05 11:05:20,259 - __main__ - INFO - Waiting... (80s elapsed, order status: cancelled)
2025-06-05 11:05:39,172 - __main__ - INFO - ================================================================================
2025-06-05 11:05:39,172 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:05:39,172 - __main__ - INFO - ================================================================================
2025-06-05 11:05:39,173 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:05:39,174 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:05:39,175 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:05:40,498 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:05:40,498 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:05:40,545 - src.tws_connection - INFO - ✅ Next valid order ID received: 177
2025-06-05 11:05:40,545 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:05:40,546 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:05:40,547 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:05:40,547 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:05:40,548 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:05:40,548 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:05:40,549 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:05:40,549 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:05:40,549 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:05:40,550 - __main__ - INFO - 
============================================================
2025-06-05 11:05:40,550 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:05:40,550 - __main__ - INFO - ============================================================
2025-06-05 11:05:40,551 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:05:40,551 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:05:40,551 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:05:40,551 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:05:40,552 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:05:40,552 - src.order.base - INFO - Order bebb2ee1-b916-40f5-9afb-c04997b8c7fd status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:05:40,553 - src.order.manager - INFO - Submitting order bebb2ee1-b916-40f5-9afb-c04997b8c7fd to TWS
2025-06-05 11:05:40,553 - src.order.manager - INFO - Got broker order ID 177 for order bebb2ee1-b916-40f5-9afb-c04997b8c7fd
2025-06-05 11:05:40,553 - src.order.manager - INFO - Calling placeOrder with ID 177, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:05:40,554 - src.order.manager - INFO - placeOrder called successfully for order bebb2ee1-b916-40f5-9afb-c04997b8c7fd
2025-06-05 11:05:40,554 - src.order.base - INFO - Order bebb2ee1-b916-40f5-9afb-c04997b8c7fd status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:05:40,554 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:05:40,555 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:05:40,598 - src.tws_connection - INFO - ✅ Next valid order ID received: 177
2025-06-05 11:05:40,699 - src.tws_connection - INFO - ✅ Next valid order ID received: 177
2025-06-05 11:05:40,897 - src.tws_connection - INFO - Open Order - ID: 177, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:05:40,898 - src.order.base - INFO - Order bebb2ee1-b916-40f5-9afb-c04997b8c7fd status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:05:40,937 - src.order.base - INFO - Order bebb2ee1-b916-40f5-9afb-c04997b8c7fd status changed: accepted -> filled (Order fully filled)
2025-06-05 11:05:40,937 - src.tws_connection - INFO - Open Order - ID: 177, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:05:40,940 - src.order.base - INFO - Order bebb2ee1-b916-40f5-9afb-c04997b8c7fd filled: 100.0 @ 310.51 (100.0/100)
2025-06-05 11:05:40,942 - src.tws_connection - INFO - Open Order - ID: 177, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:05:41,558 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:05:41,558 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.31 (ATR: 0.0450 * 4.0 = 0.1800)
2025-06-05 11:05:41,559 - src.order.base - INFO - Order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:05:41,559 - src.order.manager - INFO - Submitting order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439 to TWS
2025-06-05 11:05:41,559 - src.order.manager - INFO - Got broker order ID 177 for order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439
2025-06-05 11:05:41,559 - src.order.manager - INFO - Calling placeOrder with ID 177, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:05:41,560 - src.order.manager - INFO - placeOrder called successfully for order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439
2025-06-05 11:05:41,560 - src.order.base - INFO - Order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:05:41,560 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9a116b9b-3f1c-47f9-868d-d3c3a2aff439 at $310.31
2025-06-05 11:05:41,561 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:05:41,561 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.39 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:05:41,561 - src.order.base - INFO - Order 975e1fa5-991d-408f-bc15-ab0a00d2e328 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:05:41,561 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 177)
2025-06-05 11:05:41,562 - src.order.manager - INFO - Submitting order 975e1fa5-991d-408f-bc15-ab0a00d2e328 to TWS
2025-06-05 11:05:41,562 - src.order.manager - INFO - Got broker order ID 178 for order 975e1fa5-991d-408f-bc15-ab0a00d2e328
2025-06-05 11:05:41,562 - src.order.manager - INFO - Calling placeOrder with ID 178, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.390000 DAY
2025-06-05 11:05:41,562 - src.order.manager - INFO - placeOrder called successfully for order 975e1fa5-991d-408f-bc15-ab0a00d2e328
2025-06-05 11:05:41,563 - src.order.base - INFO - Order 975e1fa5-991d-408f-bc15-ab0a00d2e328 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:05:41,563 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 975e1fa5-991d-408f-bc15-ab0a00d2e328 at $311.39
2025-06-05 11:05:41,563 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:05:41,563 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:05:41,663 - src.tws_connection - INFO - Open Order - ID: 178, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:05:42,068 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9a116b9b-3f1c-47f9-868d-d3c3a2aff439']
2025-06-05 11:05:42,069 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:05:47,086 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:05:47,087 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.52, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.38, original_qty=100, dd_qty=100
2025-06-05 11:05:47,088 - src.order.base - INFO - Order 8535208f-1882-4900-a9fe-ec78c85255d3 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:05:47,088 - src.order.manager - INFO - Submitting order 8535208f-1882-4900-a9fe-ec78c85255d3 to TWS
2025-06-05 11:05:47,089 - src.order.manager - INFO - Got broker order ID 179 for order 8535208f-1882-4900-a9fe-ec78c85255d3
2025-06-05 11:05:47,089 - src.order.manager - INFO - Calling placeOrder with ID 179, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.380000 DAY
2025-06-05 11:05:47,090 - src.order.manager - INFO - placeOrder called successfully for order 8535208f-1882-4900-a9fe-ec78c85255d3
2025-06-05 11:05:47,090 - src.order.base - INFO - Order 8535208f-1882-4900-a9fe-ec78c85255d3 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:05:47,090 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:05:47,091 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.38
2025-06-05 11:05:47,092 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:05:47,093 - src.rule.linked_order_actions - INFO - Created and linked BUY main order bebb2ee1-b916-40f5-9afb-c04997b8c7fd for GLD
2025-06-05 11:05:47,267 - src.tws_connection - INFO - Open Order - ID: 179, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:05:50,565 - __main__ - INFO - 
============================================================
2025-06-05 11:05:50,567 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:05:50,567 - __main__ - INFO - ============================================================
2025-06-05 11:05:50,568 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:05:50,568 - __main__ - INFO - Order 975e1fa5-991d-408f-bc15-ab0a00d2e328: limit sell -100 @ 311.39 - Status: submitted
2025-06-05 11:05:50,569 - __main__ - INFO - Order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439: stop sell -100 @ 310.31 - Status: submitted
2025-06-05 11:05:50,569 - __main__ - INFO - Order bebb2ee1-b916-40f5-9afb-c04997b8c7fd: market buy 100 @ MARKET - Status: filled
2025-06-05 11:05:50,569 - __main__ - INFO - Order 8535208f-1882-4900-a9fe-ec78c85255d3: limit buy 100 @ 310.38 - Status: submitted
2025-06-05 11:05:50,569 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:05:50,571 - __main__ - INFO - Stop orders: 1
2025-06-05 11:05:50,572 - __main__ - INFO - Target orders: 1
2025-06-05 11:05:50,573 - __main__ - INFO - Double down orders: 1
2025-06-05 11:05:50,573 - __main__ - INFO - 
Double down order details:
2025-06-05 11:05:50,573 - __main__ - INFO -   ID: 8535208f-1882-4900-a9fe-ec78c85255d3
2025-06-05 11:05:50,574 - __main__ - INFO -   Status: submitted
2025-06-05 11:05:50,574 - __main__ - INFO -   Limit price: 310.38
2025-06-05 11:05:50,574 - __main__ - INFO -   Quantity: 100
2025-06-05 11:05:50,575 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:05:50,575 - __main__ - INFO -   Stop: -100 @ $310.31
2025-06-05 11:05:50,575 - __main__ - INFO -   Target: -100 @ $311.39
2025-06-05 11:05:50,576 - __main__ - INFO - 
============================================================
2025-06-05 11:05:50,576 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:05:50,576 - __main__ - INFO - ============================================================
2025-06-05 11:05:50,577 - __main__ - INFO - Waiting for double down order 8535208f-1882-4900-a9fe-ec78c85255d3 to fill at $310.38...
2025-06-05 11:05:50,577 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:05:55,579 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:05:56,478 - src.order.base - INFO - Order 8535208f-1882-4900-a9fe-ec78c85255d3 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:05:56,493 - src.order.base - INFO - Order 8535208f-1882-4900-a9fe-ec78c85255d3 filled: 100.0 @ 310.38 (100.0/100)
2025-06-05 11:05:56,494 - LinkedDoubleDownFillManager - INFO - Double down order 8535208f-1882-4900-a9fe-ec78c85255d3 filled for GLD - updating protective orders
2025-06-05 11:05:56,494 - LinkedDoubleDownFillManager - ERROR - No position found for GLD
2025-06-05 11:05:56,479 - src.tws_connection - INFO - Open Order - ID: 179, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:05:56,496 - src.tws_connection - INFO - Open Order - ID: 179, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:06:00,588 - __main__ - INFO - ✅ Double down order filled at $310.38!
2025-06-05 11:06:10,606 - __main__ - INFO - 
============================================================
2025-06-05 11:06:10,607 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:06:10,607 - __main__ - INFO - ============================================================
2025-06-05 11:06:10,608 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:06:10,608 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:06:10,608 - __main__ - INFO - 
New stop order:
2025-06-05 11:06:10,609 - __main__ - INFO -   ID: 9a116b9b-3f1c-47f9-868d-d3c3a2aff439
2025-06-05 11:06:10,609 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:06:10,609 - __main__ - INFO -   Stop price: $310.31 (was $310.31)
2025-06-05 11:06:10,610 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 11:06:10,610 - __main__ - INFO - 
New target order:
2025-06-05 11:06:10,610 - __main__ - INFO -   ID: 975e1fa5-991d-408f-bc15-ab0a00d2e328
2025-06-05 11:06:10,611 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:06:10,611 - __main__ - INFO -   Limit price: $311.39 (was $311.39)
2025-06-05 11:06:10,611 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 11:06:10,611 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:06:10,612 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:06:10,613 - __main__ - INFO -   Side: BUY
2025-06-05 11:06:10,613 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:06:10,614 - __main__ - INFO -   Target orders: 1
2025-06-05 11:06:10,614 - __main__ - INFO -   All orders: {'975e1fa5-991d-408f-bc15-ab0a00d2e328', '9a116b9b-3f1c-47f9-868d-d3c3a2aff439', 'bebb2ee1-b916-40f5-9afb-c04997b8c7fd', '8535208f-1882-4900-a9fe-ec78c85255d3'}
2025-06-05 11:06:10,614 - __main__ - INFO - 
============================================================
2025-06-05 11:06:10,615 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:06:10,615 - __main__ - INFO - ============================================================
2025-06-05 11:06:10,615 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:06:10,615 - src.order.base - INFO - Order 975e1fa5-991d-408f-bc15-ab0a00d2e328 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:06:10,616 - src.order.manager - INFO - Cancelling order 975e1fa5-991d-408f-bc15-ab0a00d2e328 with broker ID 178
2025-06-05 11:06:10,616 - src.order.base - INFO - Order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:06:10,617 - src.order.manager - INFO - Cancelling order 9a116b9b-3f1c-47f9-868d-d3c3a2aff439 with broker ID 177
2025-06-05 11:06:10,617 - src.order.manager - WARNING - Cannot cancel inactive order bebb2ee1-b916-40f5-9afb-c04997b8c7fd with status filled
2025-06-05 11:06:10,618 - src.order.manager - WARNING - Cannot cancel inactive order 8535208f-1882-4900-a9fe-ec78c85255d3 with status filled
2025-06-05 11:06:10,619 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:06:10,619 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:06:10,619 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:06:10,631 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:06:10,635 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:06:10,643 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:06:10,644 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:06:59,296 - __main__ - INFO - ================================================================================
2025-06-05 11:06:59,296 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:06:59,296 - __main__ - INFO - ================================================================================
2025-06-05 11:06:59,297 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:06:59,298 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:06:59,298 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:07:00,621 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:07:00,622 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:07:00,661 - src.tws_connection - INFO - ✅ Next valid order ID received: 180
2025-06-05 11:07:00,662 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:07:00,662 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:07:00,663 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:07:00,664 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:07:00,664 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:07:00,664 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:07:00,665 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:07:00,665 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:07:00,665 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:07:00,665 - __main__ - INFO - 
============================================================
2025-06-05 11:07:00,666 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:07:00,666 - __main__ - INFO - ============================================================
2025-06-05 11:07:00,667 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:07:00,667 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:07:00,667 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:07:00,667 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:07:00,668 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:07:00,669 - src.order.base - INFO - Order ac1580b5-7ddb-477d-85b7-7c4325da040b status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:07:00,669 - src.order.manager - INFO - Submitting order ac1580b5-7ddb-477d-85b7-7c4325da040b to TWS
2025-06-05 11:07:00,669 - src.order.manager - INFO - Got broker order ID 180 for order ac1580b5-7ddb-477d-85b7-7c4325da040b
2025-06-05 11:07:00,670 - src.order.manager - INFO - Calling placeOrder with ID 180, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:07:00,670 - src.order.manager - INFO - placeOrder called successfully for order ac1580b5-7ddb-477d-85b7-7c4325da040b
2025-06-05 11:07:00,670 - src.order.base - INFO - Order ac1580b5-7ddb-477d-85b7-7c4325da040b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:07:00,671 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:07:00,671 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:07:00,730 - src.tws_connection - INFO - ✅ Next valid order ID received: 180
2025-06-05 11:07:00,821 - src.tws_connection - INFO - ✅ Next valid order ID received: 180
2025-06-05 11:07:01,021 - src.tws_connection - INFO - Open Order - ID: 180, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:07:01,022 - src.order.base - INFO - Order ac1580b5-7ddb-477d-85b7-7c4325da040b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:07:01,058 - src.order.base - INFO - Order ac1580b5-7ddb-477d-85b7-7c4325da040b status changed: accepted -> filled (Order fully filled)
2025-06-05 11:07:01,058 - src.tws_connection - INFO - Open Order - ID: 180, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:07:01,059 - src.order.base - INFO - Order ac1580b5-7ddb-477d-85b7-7c4325da040b filled: 100.0 @ 310.54 (100.0/100)
2025-06-05 11:07:01,061 - src.tws_connection - INFO - Open Order - ID: 180, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:07:01,696 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:07:01,698 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.35 (ATR: 0.0450 * 4.0 = 0.1800)
2025-06-05 11:07:01,704 - src.order.base - INFO - Order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:07:01,712 - src.order.manager - INFO - Submitting order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686 to TWS
2025-06-05 11:07:01,714 - src.order.manager - INFO - Got broker order ID 180 for order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686
2025-06-05 11:07:01,714 - src.order.manager - INFO - Calling placeOrder with ID 180, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:07:01,717 - src.order.manager - INFO - placeOrder called successfully for order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686
2025-06-05 11:07:01,719 - src.order.base - INFO - Order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:07:01,719 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 180)
2025-06-05 11:07:01,720 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 7e48a2f5-78f8-4fa1-8cb9-b8611c335686 at $310.35
2025-06-05 11:07:01,721 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:07:01,722 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.43 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:07:01,724 - src.order.base - INFO - Order b7d39428-b78f-4875-8b8d-987552b817f7 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:07:01,725 - src.order.manager - INFO - Submitting order b7d39428-b78f-4875-8b8d-987552b817f7 to TWS
2025-06-05 11:07:01,725 - src.order.manager - INFO - Got broker order ID 181 for order b7d39428-b78f-4875-8b8d-987552b817f7
2025-06-05 11:07:01,725 - src.order.manager - INFO - Calling placeOrder with ID 181, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.430000 DAY
2025-06-05 11:07:01,726 - src.order.manager - INFO - placeOrder called successfully for order b7d39428-b78f-4875-8b8d-987552b817f7
2025-06-05 11:07:01,727 - src.order.base - INFO - Order b7d39428-b78f-4875-8b8d-987552b817f7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:07:01,730 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit b7d39428-b78f-4875-8b8d-987552b817f7 at $311.43
2025-06-05 11:07:01,730 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:07:01,731 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:07:01,835 - src.tws_connection - INFO - Open Order - ID: 181, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:07:02,247 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['7e48a2f5-78f8-4fa1-8cb9-b8611c335686']
2025-06-05 11:07:02,248 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:07:07,267 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:07:07,267 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.48, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.35, original_qty=100, dd_qty=100
2025-06-05 11:07:07,271 - src.order.base - INFO - Order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:07:07,274 - src.order.manager - INFO - Submitting order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 to TWS
2025-06-05 11:07:07,276 - src.order.manager - INFO - Got broker order ID 182 for order 8c178f76-ae79-449f-9c1c-72d0e5f02be8
2025-06-05 11:07:07,279 - src.order.manager - INFO - Calling placeOrder with ID 182, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.350000 DAY
2025-06-05 11:07:07,284 - src.order.manager - INFO - placeOrder called successfully for order 8c178f76-ae79-449f-9c1c-72d0e5f02be8
2025-06-05 11:07:07,285 - src.order.base - INFO - Order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:07:07,285 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:07:07,286 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.35
2025-06-05 11:07:07,286 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:07:07,287 - src.rule.linked_order_actions - INFO - Created and linked BUY main order ac1580b5-7ddb-477d-85b7-7c4325da040b for GLD
2025-06-05 11:07:07,378 - src.tws_connection - INFO - Open Order - ID: 182, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:07:10,681 - __main__ - INFO - 
============================================================
2025-06-05 11:07:10,682 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:07:10,682 - __main__ - INFO - ============================================================
2025-06-05 11:07:10,683 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:07:10,683 - __main__ - INFO - Order ac1580b5-7ddb-477d-85b7-7c4325da040b: market buy 100 @ MARKET - Status: filled
2025-06-05 11:07:10,684 - __main__ - INFO - Order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686: stop sell -100 @ 310.35 - Status: submitted
2025-06-05 11:07:10,684 - __main__ - INFO - Order b7d39428-b78f-4875-8b8d-987552b817f7: limit sell -100 @ 311.43 - Status: submitted
2025-06-05 11:07:10,685 - __main__ - INFO - Order 8c178f76-ae79-449f-9c1c-72d0e5f02be8: limit buy 100 @ 310.35 - Status: submitted
2025-06-05 11:07:10,685 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:07:10,686 - __main__ - INFO - Stop orders: 1
2025-06-05 11:07:10,686 - __main__ - INFO - Target orders: 1
2025-06-05 11:07:10,687 - __main__ - INFO - Double down orders: 1
2025-06-05 11:07:10,687 - __main__ - INFO - 
Double down order details:
2025-06-05 11:07:10,688 - __main__ - INFO -   ID: 8c178f76-ae79-449f-9c1c-72d0e5f02be8
2025-06-05 11:07:10,688 - __main__ - INFO -   Status: submitted
2025-06-05 11:07:10,689 - __main__ - INFO -   Limit price: 310.35
2025-06-05 11:07:10,693 - __main__ - INFO -   Quantity: 100
2025-06-05 11:07:10,693 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:07:10,694 - __main__ - INFO -   Stop: -100 @ $310.35
2025-06-05 11:07:10,694 - __main__ - INFO -   Target: -100 @ $311.43
2025-06-05 11:07:10,695 - __main__ - INFO - 
============================================================
2025-06-05 11:07:10,695 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:07:10,695 - __main__ - INFO - ============================================================
2025-06-05 11:07:10,698 - __main__ - INFO - Waiting for double down order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 to fill at $310.35...
2025-06-05 11:07:10,699 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:07:15,704 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:07:20,706 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:07:25,718 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:07:30,732 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:07:35,747 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:07:40,753 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:07:45,756 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:07:50,769 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:07:55,787 - __main__ - INFO - Waiting... (45s elapsed, order status: submitted)
2025-06-05 11:07:56,860 - src.order.base - INFO - Order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:07:56,861 - src.order.base - INFO - Order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 filled: 100.0 @ 310.35 (100.0/100)
2025-06-05 11:07:56,861 - LinkedDoubleDownFillManager - INFO - Double down order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 filled for GLD - updating protective orders
2025-06-05 11:07:56,860 - src.tws_connection - INFO - Open Order - ID: 182, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:07:56,863 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:07:56,867 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:07:56,868 - LinkedDoubleDownFillManager - ERROR - Error handling double down fill: 'PositionManager' object has no attribute 'remove_orders_from_position'
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\src\rule\linked_order_actions.py", line 1165, in on_order_fill
    await self._update_protective_orders(
    ...<5 lines>...
    )
  File "C:\Users\panga\Documents\IBKR\src\rule\linked_order_actions.py", line 1230, in _update_protective_orders
    position_manager.remove_orders_from_position(symbol, "stop")
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PositionManager' object has no attribute 'remove_orders_from_position'
2025-06-05 11:07:56,868 - src.tws_connection - INFO - Open Order - ID: 182, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:08:00,789 - __main__ - INFO - ✅ Double down order filled at $310.35!
2025-06-05 11:08:10,818 - __main__ - INFO - 
============================================================
2025-06-05 11:08:10,832 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:08:10,832 - __main__ - INFO - ============================================================
2025-06-05 11:08:10,833 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:08:10,833 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:08:10,834 - __main__ - INFO - 
New stop order:
2025-06-05 11:08:10,834 - __main__ - INFO -   ID: 7e48a2f5-78f8-4fa1-8cb9-b8611c335686
2025-06-05 11:08:10,834 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:08:10,834 - __main__ - INFO -   Stop price: $310.35 (was $310.35)
2025-06-05 11:08:10,835 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 11:08:10,835 - __main__ - INFO - 
New target order:
2025-06-05 11:08:10,835 - __main__ - INFO -   ID: b7d39428-b78f-4875-8b8d-987552b817f7
2025-06-05 11:08:10,835 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:08:10,835 - __main__ - INFO -   Limit price: $311.43 (was $311.43)
2025-06-05 11:08:10,836 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 11:08:10,836 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:08:10,836 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:08:10,836 - __main__ - INFO -   Side: BUY
2025-06-05 11:08:10,837 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:08:10,837 - __main__ - INFO -   Target orders: 1
2025-06-05 11:08:10,837 - __main__ - INFO -   All orders: {'ac1580b5-7ddb-477d-85b7-7c4325da040b', '7e48a2f5-78f8-4fa1-8cb9-b8611c335686', 'b7d39428-b78f-4875-8b8d-987552b817f7', '8c178f76-ae79-449f-9c1c-72d0e5f02be8'}
2025-06-05 11:08:10,838 - __main__ - INFO - 
============================================================
2025-06-05 11:08:10,838 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:08:10,838 - __main__ - INFO - ============================================================
2025-06-05 11:08:10,838 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:08:10,839 - src.order.manager - WARNING - Cannot cancel inactive order ac1580b5-7ddb-477d-85b7-7c4325da040b with status filled
2025-06-05 11:08:10,839 - src.order.base - INFO - Order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:08:10,839 - src.order.manager - INFO - Cancelling order 7e48a2f5-78f8-4fa1-8cb9-b8611c335686 with broker ID 180
2025-06-05 11:08:10,840 - src.order.base - INFO - Order b7d39428-b78f-4875-8b8d-987552b817f7 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:08:10,841 - src.order.manager - INFO - Cancelling order b7d39428-b78f-4875-8b8d-987552b817f7 with broker ID 181
2025-06-05 11:08:10,841 - src.order.manager - WARNING - Cannot cancel inactive order 8c178f76-ae79-449f-9c1c-72d0e5f02be8 with status filled
2025-06-05 11:08:10,843 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:08:10,847 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:08:10,848 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:08:10,848 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:08:10,851 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:08:10,871 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:08:10,872 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:08:10,873 - src.tws_connection - WARNING - ⚠️ TWS Error 10147: OrderId 180 that needs to be cancelled is not found. (reqId: 180)
2025-06-05 11:08:10,875 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 11:08:10,877 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:08:58,281 - __main__ - INFO - ================================================================================
2025-06-05 11:08:58,281 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:08:58,282 - __main__ - INFO - ================================================================================
2025-06-05 11:08:58,282 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:08:58,283 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:08:58,284 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:09:03,443 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:09:03,444 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:09:03,507 - src.tws_connection - INFO - ✅ Next valid order ID received: 183
2025-06-05 11:09:03,508 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:09:03,508 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:09:03,509 - src.tws_connection - INFO - ✅ Next valid order ID received: 183
2025-06-05 11:09:03,509 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:09:03,510 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:09:03,510 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:09:03,510 - src.tws_connection - INFO - ✅ Next valid order ID received: 183
2025-06-05 11:09:03,511 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:09:03,512 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:09:03,512 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:09:03,512 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:09:03,513 - __main__ - INFO - 
============================================================
2025-06-05 11:09:03,513 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:09:03,513 - __main__ - INFO - ============================================================
2025-06-05 11:09:03,514 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:09:03,514 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:09:03,515 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:09:03,515 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:09:03,516 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:09:03,516 - src.order.base - INFO - Order 0ffe6777-105e-4721-b65f-340fb1999688 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:09:03,516 - src.order.manager - INFO - Submitting order 0ffe6777-105e-4721-b65f-340fb1999688 to TWS
2025-06-05 11:09:03,517 - src.order.manager - INFO - Got broker order ID 183 for order 0ffe6777-105e-4721-b65f-340fb1999688
2025-06-05 11:09:03,517 - src.order.manager - INFO - Calling placeOrder with ID 183, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:09:03,518 - src.order.manager - INFO - placeOrder called successfully for order 0ffe6777-105e-4721-b65f-340fb1999688
2025-06-05 11:09:03,518 - src.order.base - INFO - Order 0ffe6777-105e-4721-b65f-340fb1999688 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:09:03,518 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:09:03,519 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:09:03,643 - src.tws_connection - INFO - Open Order - ID: 183, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:09:03,644 - src.order.base - INFO - Order 0ffe6777-105e-4721-b65f-340fb1999688 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:09:03,648 - src.order.base - INFO - Order 0ffe6777-105e-4721-b65f-340fb1999688 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:09:03,649 - src.order.base - INFO - Order 0ffe6777-105e-4721-b65f-340fb1999688 filled: 100.0 @ 310.58 (100.0/100)
2025-06-05 11:09:03,649 - src.tws_connection - INFO - Open Order - ID: 183, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:09:03,650 - src.tws_connection - INFO - Open Order - ID: 183, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:09:04,536 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:09:04,537 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.38 (ATR: 0.0450 * 4.0 = 0.1800)
2025-06-05 11:09:04,538 - src.order.base - INFO - Order 82c331e6-8cb2-4264-b2a8-f786c533b805 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:09:04,538 - src.order.manager - INFO - Submitting order 82c331e6-8cb2-4264-b2a8-f786c533b805 to TWS
2025-06-05 11:09:04,538 - src.order.manager - INFO - Got broker order ID 184 for order 82c331e6-8cb2-4264-b2a8-f786c533b805
2025-06-05 11:09:04,539 - src.order.manager - INFO - Calling placeOrder with ID 184, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:09:04,539 - src.order.manager - INFO - placeOrder called successfully for order 82c331e6-8cb2-4264-b2a8-f786c533b805
2025-06-05 11:09:04,540 - src.order.base - INFO - Order 82c331e6-8cb2-4264-b2a8-f786c533b805 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:09:04,540 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 82c331e6-8cb2-4264-b2a8-f786c533b805 at $310.38
2025-06-05 11:09:04,541 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:09:04,541 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.46 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:09:04,541 - src.order.base - INFO - Order 61a18b6c-daad-45de-8b64-1777476aba07 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:09:04,543 - src.order.manager - INFO - Submitting order 61a18b6c-daad-45de-8b64-1777476aba07 to TWS
2025-06-05 11:09:04,546 - src.order.manager - INFO - Got broker order ID 185 for order 61a18b6c-daad-45de-8b64-1777476aba07
2025-06-05 11:09:04,547 - src.order.manager - INFO - Calling placeOrder with ID 185, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.460000 DAY
2025-06-05 11:09:04,548 - src.order.manager - INFO - placeOrder called successfully for order 61a18b6c-daad-45de-8b64-1777476aba07
2025-06-05 11:09:04,548 - src.order.base - INFO - Order 61a18b6c-daad-45de-8b64-1777476aba07 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:09:04,548 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 61a18b6c-daad-45de-8b64-1777476aba07 at $311.46
2025-06-05 11:09:04,549 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:09:04,549 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:09:04,622 - src.tws_connection - INFO - Open Order - ID: 184, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:09:04,623 - src.order.base - INFO - Order 82c331e6-8cb2-4264-b2a8-f786c533b805 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:09:04,747 - src.tws_connection - INFO - Open Order - ID: 185, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:09:05,054 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['82c331e6-8cb2-4264-b2a8-f786c533b805']
2025-06-05 11:09:05,054 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:09:10,071 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:09:10,072 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.59, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.45, original_qty=100, dd_qty=100
2025-06-05 11:09:10,072 - src.order.base - INFO - Order d7c329f3-3704-4798-8b3e-a69359f9e80e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:09:10,073 - src.order.manager - INFO - Submitting order d7c329f3-3704-4798-8b3e-a69359f9e80e to TWS
2025-06-05 11:09:10,073 - src.order.manager - INFO - Got broker order ID 186 for order d7c329f3-3704-4798-8b3e-a69359f9e80e
2025-06-05 11:09:10,074 - src.order.manager - INFO - Calling placeOrder with ID 186, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.450000 DAY
2025-06-05 11:09:10,074 - src.order.manager - INFO - placeOrder called successfully for order d7c329f3-3704-4798-8b3e-a69359f9e80e
2025-06-05 11:09:10,074 - src.order.base - INFO - Order d7c329f3-3704-4798-8b3e-a69359f9e80e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:09:10,075 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:09:10,075 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.45
2025-06-05 11:09:10,075 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:09:10,075 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 0ffe6777-105e-4721-b65f-340fb1999688 for GLD
2025-06-05 11:09:10,177 - src.tws_connection - INFO - Open Order - ID: 186, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:09:13,516 - __main__ - INFO - 
============================================================
2025-06-05 11:09:13,518 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:09:13,523 - __main__ - INFO - ============================================================
2025-06-05 11:09:13,524 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:09:13,524 - __main__ - INFO - Order d7c329f3-3704-4798-8b3e-a69359f9e80e: limit buy 100 @ 310.45 - Status: submitted
2025-06-05 11:09:13,525 - __main__ - INFO - Order 61a18b6c-daad-45de-8b64-1777476aba07: limit sell -100 @ 311.46 - Status: submitted
2025-06-05 11:09:13,526 - __main__ - INFO - Order 0ffe6777-105e-4721-b65f-340fb1999688: market buy 100 @ MARKET - Status: filled
2025-06-05 11:09:13,526 - __main__ - INFO - Order 82c331e6-8cb2-4264-b2a8-f786c533b805: stop sell -100 @ 310.38 - Status: accepted
2025-06-05 11:09:13,527 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:09:13,527 - __main__ - INFO - Stop orders: 1
2025-06-05 11:09:13,530 - __main__ - INFO - Target orders: 1
2025-06-05 11:09:13,530 - __main__ - INFO - Double down orders: 1
2025-06-05 11:09:13,531 - __main__ - INFO - 
Double down order details:
2025-06-05 11:09:13,531 - __main__ - INFO -   ID: d7c329f3-3704-4798-8b3e-a69359f9e80e
2025-06-05 11:09:13,532 - __main__ - INFO -   Status: submitted
2025-06-05 11:09:13,533 - __main__ - INFO -   Limit price: 310.45
2025-06-05 11:09:13,533 - __main__ - INFO -   Quantity: 100
2025-06-05 11:09:13,533 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:09:13,534 - __main__ - INFO -   Stop: -100 @ $310.38
2025-06-05 11:09:13,534 - __main__ - INFO -   Target: -100 @ $311.46
2025-06-05 11:09:13,535 - __main__ - INFO - 
============================================================
2025-06-05 11:09:13,535 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:09:13,535 - __main__ - INFO - ============================================================
2025-06-05 11:09:13,536 - __main__ - INFO - Waiting for double down order d7c329f3-3704-4798-8b3e-a69359f9e80e to fill at $310.45...
2025-06-05 11:09:13,536 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:09:18,570 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:09:23,591 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:09:28,594 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:09:33,611 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:09:38,632 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:09:43,642 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:09:48,656 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:09:53,668 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:09:58,682 - __main__ - INFO - Waiting... (45s elapsed, order status: submitted)
2025-06-05 11:10:03,689 - __main__ - INFO - Waiting... (50s elapsed, order status: submitted)
2025-06-05 11:10:08,692 - __main__ - INFO - Waiting... (55s elapsed, order status: submitted)
2025-06-05 11:10:13,700 - __main__ - INFO - Waiting... (60s elapsed, order status: submitted)
2025-06-05 11:10:18,714 - __main__ - INFO - Waiting... (65s elapsed, order status: submitted)
2025-06-05 11:10:23,721 - __main__ - INFO - Waiting... (70s elapsed, order status: submitted)
2025-06-05 11:10:28,728 - __main__ - INFO - Waiting... (75s elapsed, order status: submitted)
2025-06-05 11:10:33,740 - __main__ - INFO - Waiting... (80s elapsed, order status: submitted)
2025-06-05 11:10:38,752 - __main__ - INFO - Waiting... (85s elapsed, order status: submitted)
2025-06-05 11:10:43,757 - __main__ - INFO - Waiting... (90s elapsed, order status: submitted)
2025-06-05 11:10:48,763 - __main__ - INFO - Waiting... (95s elapsed, order status: submitted)
2025-06-05 11:10:53,775 - __main__ - INFO - Waiting... (100s elapsed, order status: submitted)
2025-06-05 11:10:58,785 - __main__ - INFO - Waiting... (105s elapsed, order status: submitted)
2025-06-05 11:11:03,792 - __main__ - INFO - Waiting... (110s elapsed, order status: submitted)
2025-06-05 11:11:08,809 - __main__ - INFO - Waiting... (115s elapsed, order status: submitted)
2025-06-05 11:11:13,819 - __main__ - INFO - Waiting... (120s elapsed, order status: submitted)
2025-06-05 11:11:18,829 - __main__ - INFO - Waiting... (125s elapsed, order status: submitted)
2025-06-05 11:11:23,843 - __main__ - INFO - Waiting... (130s elapsed, order status: submitted)
2025-06-05 11:11:28,858 - __main__ - INFO - Waiting... (135s elapsed, order status: submitted)
2025-06-05 11:11:33,863 - __main__ - INFO - Waiting... (140s elapsed, order status: submitted)
2025-06-05 11:11:38,864 - __main__ - INFO - Waiting... (145s elapsed, order status: submitted)
2025-06-05 11:11:43,869 - __main__ - INFO - Waiting... (150s elapsed, order status: submitted)
2025-06-05 11:11:48,890 - __main__ - INFO - Waiting... (155s elapsed, order status: submitted)
2025-06-05 11:11:53,904 - __main__ - INFO - Waiting... (160s elapsed, order status: submitted)
2025-06-05 11:11:58,914 - __main__ - INFO - Waiting... (165s elapsed, order status: submitted)
2025-06-05 11:12:03,928 - __main__ - INFO - Waiting... (170s elapsed, order status: submitted)
2025-06-05 11:12:08,941 - __main__ - INFO - Waiting... (175s elapsed, order status: submitted)
2025-06-05 11:12:13,953 - __main__ - INFO - Waiting... (180s elapsed, order status: submitted)
2025-06-05 11:12:18,967 - __main__ - INFO - Waiting... (185s elapsed, order status: submitted)
2025-06-05 11:12:23,976 - __main__ - INFO - Waiting... (190s elapsed, order status: submitted)
2025-06-05 11:12:28,993 - __main__ - INFO - Waiting... (195s elapsed, order status: submitted)
2025-06-05 11:12:34,007 - __main__ - INFO - Waiting... (200s elapsed, order status: submitted)
2025-06-05 11:12:39,017 - __main__ - INFO - Waiting... (205s elapsed, order status: submitted)
2025-06-05 11:12:44,033 - __main__ - INFO - Waiting... (210s elapsed, order status: submitted)
2025-06-05 11:12:49,040 - __main__ - INFO - Waiting... (215s elapsed, order status: submitted)
2025-06-05 11:12:54,046 - __main__ - INFO - Waiting... (220s elapsed, order status: submitted)
2025-06-05 11:12:59,056 - __main__ - INFO - Waiting... (225s elapsed, order status: submitted)
2025-06-05 11:13:04,064 - __main__ - INFO - Waiting... (230s elapsed, order status: submitted)
2025-06-05 11:13:09,077 - __main__ - INFO - Waiting... (235s elapsed, order status: submitted)
2025-06-05 11:13:14,089 - __main__ - INFO - Waiting... (240s elapsed, order status: submitted)
2025-06-05 11:13:19,110 - __main__ - INFO - Waiting... (245s elapsed, order status: submitted)
2025-06-05 11:13:24,127 - __main__ - INFO - Waiting... (250s elapsed, order status: submitted)
2025-06-05 11:13:29,136 - __main__ - INFO - Waiting... (255s elapsed, order status: submitted)
2025-06-05 11:13:34,151 - __main__ - INFO - Waiting... (260s elapsed, order status: submitted)
2025-06-05 11:13:39,153 - __main__ - INFO - Waiting... (265s elapsed, order status: submitted)
2025-06-05 11:13:44,161 - __main__ - INFO - Waiting... (270s elapsed, order status: submitted)
2025-06-05 11:13:49,180 - __main__ - INFO - Waiting... (275s elapsed, order status: submitted)
2025-06-05 11:13:54,194 - __main__ - INFO - Waiting... (280s elapsed, order status: submitted)
2025-06-05 11:13:59,204 - __main__ - INFO - Waiting... (285s elapsed, order status: submitted)
2025-06-05 11:14:01,488 - src.order.base - INFO - Order d7c329f3-3704-4798-8b3e-a69359f9e80e status changed: submitted -> filled (Order fully filled)
2025-06-05 11:14:01,494 - src.order.base - INFO - Order d7c329f3-3704-4798-8b3e-a69359f9e80e filled: 100.0 @ 310.45 (100.0/100)
2025-06-05 11:14:01,495 - LinkedDoubleDownFillManager - INFO - Double down order d7c329f3-3704-4798-8b3e-a69359f9e80e filled for GLD - updating protective orders
2025-06-05 11:14:01,496 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:14:01,487 - src.tws_connection - INFO - Open Order - ID: 186, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:14:01,497 - src.tws_connection - INFO - Open Order - ID: 186, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:14:01,527 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:14:01,544 - src.order.base - INFO - Order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:14:01,545 - src.order.manager - INFO - Submitting order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 to TWS
2025-06-05 11:14:01,545 - src.order.manager - INFO - Got broker order ID 187 for order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0
2025-06-05 11:14:01,546 - src.order.manager - INFO - Calling placeOrder with ID 187, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:14:01,546 - src.order.manager - INFO - placeOrder called successfully for order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0
2025-06-05 11:14:01,546 - src.order.base - INFO - Order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:14:01,546 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:14:01,547 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:14:01,547 - LinkedDoubleDownFillManager - INFO - Created updated stop order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 for GLD at $310.18 for -100.0 shares
2025-06-05 11:14:01,547 - src.order.base - INFO - Order fc8ed932-d4d7-4960-9d1a-1d32942e80ea status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:14:01,547 - src.order.manager - INFO - Submitting order fc8ed932-d4d7-4960-9d1a-1d32942e80ea to TWS
2025-06-05 11:14:01,548 - src.order.manager - INFO - Got broker order ID 188 for order fc8ed932-d4d7-4960-9d1a-1d32942e80ea
2025-06-05 11:14:01,548 - src.order.manager - INFO - Calling placeOrder with ID 188, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.810000 DAY
2025-06-05 11:14:01,548 - src.order.manager - INFO - placeOrder called successfully for order fc8ed932-d4d7-4960-9d1a-1d32942e80ea
2025-06-05 11:14:01,548 - src.order.base - INFO - Order fc8ed932-d4d7-4960-9d1a-1d32942e80ea status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:14:01,548 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:14:01,549 - LinkedDoubleDownFillManager - INFO - Created updated target order fc8ed932-d4d7-4960-9d1a-1d32942e80ea for GLD at $310.81 for -100.0 shares
2025-06-05 11:14:01,549 - LinkedDoubleDownFillManager - INFO - Updated protective orders for GLD: New quantity=100.0, New avg=$310.45
2025-06-05 11:14:01,627 - src.tws_connection - INFO - Open Order - ID: 187, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:14:01,628 - src.order.base - INFO - Order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:14:01,677 - src.tws_connection - INFO - Open Order - ID: 188, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:14:04,230 - __main__ - INFO - ✅ Double down order filled at $310.45!
2025-06-05 11:14:08,111 - src.tws_connection - INFO - Open Order - ID: 184, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:14:08,130 - src.order.base - INFO - Order 82c331e6-8cb2-4264-b2a8-f786c533b805 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:14:08,131 - src.order.base - INFO - Order 82c331e6-8cb2-4264-b2a8-f786c533b805 filled: 100.0 @ 310.34 (100.0/100)
2025-06-05 11:14:08,131 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - stop order 82c331e6-8cb2-4264-b2a8-f786c533b805 filled at $310.34
2025-06-05 11:14:08,132 - src.order.manager - WARNING - Cannot cancel inactive order 0ffe6777-105e-4721-b65f-340fb1999688 with status filled
2025-06-05 11:14:08,132 - src.rule.linked_order_actions - INFO - Cancelled remaining order 0ffe6777-105e-4721-b65f-340fb1999688 for GLD
2025-06-05 11:14:08,132 - src.order.base - INFO - Order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 status changed: accepted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:14:08,133 - src.order.manager - INFO - Cancelling order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 with broker ID 187
2025-06-05 11:14:08,133 - src.rule.linked_order_actions - INFO - Cancelled remaining order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 for GLD
2025-06-05 11:14:08,133 - src.order.base - INFO - Order fc8ed932-d4d7-4960-9d1a-1d32942e80ea status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:14:08,134 - src.order.manager - INFO - Cancelling order fc8ed932-d4d7-4960-9d1a-1d32942e80ea with broker ID 188
2025-06-05 11:14:08,134 - src.rule.linked_order_actions - INFO - Cancelled remaining order fc8ed932-d4d7-4960-9d1a-1d32942e80ea for GLD
2025-06-05 11:14:08,135 - src.order.manager - WARNING - Cannot cancel inactive order d7c329f3-3704-4798-8b3e-a69359f9e80e with status filled
2025-06-05 11:14:08,135 - src.rule.linked_order_actions - INFO - Cancelled remaining order d7c329f3-3704-4798-8b3e-a69359f9e80e for GLD
2025-06-05 11:14:08,135 - src.order.base - INFO - Order 61a18b6c-daad-45de-8b64-1777476aba07 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:14:08,136 - src.order.manager - INFO - Cancelling order 61a18b6c-daad-45de-8b64-1777476aba07 with broker ID 185
2025-06-05 11:14:08,138 - src.rule.linked_order_actions - INFO - Cancelled remaining order 61a18b6c-daad-45de-8b64-1777476aba07 for GLD
2025-06-05 11:14:08,143 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 11:14:08,143 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 11:14:08,143 - src.rule.linked_order_actions - INFO - Context cleared for GLD after position conclusion
2025-06-05 11:14:08,130 - src.tws_connection - INFO - Open Order - ID: 184, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:14:08,144 - src.tws_connection - INFO - Open Order - ID: 184, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:14:08,169 - src.order.base - INFO - Order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:14:08,169 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 187)
2025-06-05 11:14:08,301 - src.order.base - INFO - Order fc8ed932-d4d7-4960-9d1a-1d32942e80ea status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:14:08,300 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 188)
2025-06-05 11:14:08,385 - src.order.base - INFO - Order 61a18b6c-daad-45de-8b64-1777476aba07 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:14:08,385 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 185)
2025-06-05 11:14:14,251 - __main__ - INFO - 
============================================================
2025-06-05 11:14:14,252 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:14:14,253 - __main__ - INFO - ============================================================
2025-06-05 11:14:14,254 - __main__ - INFO - Active stop orders after double down: 0
2025-06-05 11:14:14,254 - __main__ - INFO - Active target orders after double down: 0
2025-06-05 11:14:14,255 - __main__ - ERROR - ❌ No active stop orders found after double down fill
2025-06-05 11:14:14,255 - __main__ - ERROR - ❌ No active target orders found after double down fill
2025-06-05 11:14:14,258 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:14:14,260 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:14:14,261 - __main__ - INFO -   Side: BUY
2025-06-05 11:14:14,261 - __main__ - INFO -   Stop orders: 2
2025-06-05 11:14:14,262 - __main__ - INFO -   Target orders: 2
2025-06-05 11:14:14,262 - __main__ - INFO -   All orders: {'0ffe6777-105e-4721-b65f-340fb1999688', '1b2d8af3-e308-4386-9f43-d67ad8fd87a0', 'fc8ed932-d4d7-4960-9d1a-1d32942e80ea', 'd7c329f3-3704-4798-8b3e-a69359f9e80e', '61a18b6c-daad-45de-8b64-1777476aba07', '82c331e6-8cb2-4264-b2a8-f786c533b805'}
2025-06-05 11:14:14,263 - __main__ - INFO - 
============================================================
2025-06-05 11:14:14,263 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:14:14,264 - __main__ - INFO - ============================================================
2025-06-05 11:14:14,264 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:14:14,265 - src.order.manager - WARNING - Cannot cancel inactive order 0ffe6777-105e-4721-b65f-340fb1999688 with status filled
2025-06-05 11:14:14,265 - src.order.manager - WARNING - Cannot cancel inactive order 61a18b6c-daad-45de-8b64-1777476aba07 with status cancelled
2025-06-05 11:14:14,266 - src.order.manager - WARNING - Cannot cancel inactive order 82c331e6-8cb2-4264-b2a8-f786c533b805 with status filled
2025-06-05 11:14:14,267 - src.order.manager - WARNING - Cannot cancel inactive order 1b2d8af3-e308-4386-9f43-d67ad8fd87a0 with status cancelled
2025-06-05 11:14:14,267 - src.order.manager - WARNING - Cannot cancel inactive order fc8ed932-d4d7-4960-9d1a-1d32942e80ea with status cancelled
2025-06-05 11:14:14,267 - src.order.manager - WARNING - Cannot cancel inactive order d7c329f3-3704-4798-8b3e-a69359f9e80e with status filled
2025-06-05 11:14:14,268 - __main__ - INFO - Cancelled 0 orders
2025-06-05 11:14:14,268 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:14:14,275 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:14:14,275 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:14:14,276 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:14:14,277 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:14:14,278 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:15:00,770 - __main__ - INFO - ================================================================================
2025-06-05 11:15:00,770 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:15:00,770 - __main__ - INFO - ================================================================================
2025-06-05 11:15:00,771 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:15:00,772 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:15:00,772 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:15:10,779 - src.tws_connection - ERROR - ❌ Connection failed or timed out
2025-06-05 11:15:10,780 - src.tws_connection - ERROR - Connected: False, Next ID: None
2025-06-05 11:15:10,780 - src.tws_connection - INFO - Forcing connection cleanup
2025-06-05 11:15:10,780 - ibapi.client - WARNING - Disconnected; resetting connection
2025-06-05 11:15:10,780 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:15:10,781 - __main__ - ERROR - Failed to connect to TWS
2025-06-05 11:15:10,781 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:15:10,782 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 11:15:10,783 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:15:22,066 - __main__ - INFO - ================================================================================
2025-06-05 11:15:22,067 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:15:22,067 - __main__ - INFO - ================================================================================
2025-06-05 11:15:22,068 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:15:22,068 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:15:22,069 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:15:27,153 - ibapi.client - WARNING - Disconnected; resetting connection
2025-06-05 11:15:27,153 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:15:27,154 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 11:15:27,154 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:15:32,082 - src.tws_connection - ERROR - ❌ Connection failed or timed out
2025-06-05 11:15:32,083 - src.tws_connection - ERROR - Connected: False, Next ID: None
2025-06-05 11:15:32,083 - src.tws_connection - INFO - Forcing connection cleanup
2025-06-05 11:15:32,083 - __main__ - ERROR - Failed to connect to TWS
2025-06-05 11:24:15,985 - __main__ - INFO - ================================================================================
2025-06-05 11:24:15,985 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:24:15,986 - __main__ - INFO - ================================================================================
2025-06-05 11:24:15,988 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:24:15,988 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:24:15,989 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:24:17,386 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:24:17,387 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:24:17,453 - src.tws_connection - INFO - ✅ Next valid order ID received: 189
2025-06-05 11:24:17,454 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:24:17,455 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:24:17,457 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:24:17,458 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:24:17,458 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:24:17,459 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:24:17,460 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:24:17,460 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:24:17,461 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:24:17,461 - __main__ - INFO - 
============================================================
2025-06-05 11:24:17,462 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:24:17,464 - __main__ - INFO - ============================================================
2025-06-05 11:24:17,465 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:24:17,465 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:24:17,466 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:24:17,466 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:24:17,467 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:24:17,468 - src.order.base - INFO - Order 47bf4c7a-99f7-4649-87b0-628bef407694 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:24:17,468 - src.order.manager - INFO - Submitting order 47bf4c7a-99f7-4649-87b0-628bef407694 to TWS
2025-06-05 11:24:17,469 - src.order.manager - INFO - Got broker order ID 189 for order 47bf4c7a-99f7-4649-87b0-628bef407694
2025-06-05 11:24:17,469 - src.order.manager - INFO - Calling placeOrder with ID 189, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:24:17,470 - src.order.manager - INFO - placeOrder called successfully for order 47bf4c7a-99f7-4649-87b0-628bef407694
2025-06-05 11:24:17,470 - src.order.base - INFO - Order 47bf4c7a-99f7-4649-87b0-628bef407694 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:24:17,470 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:24:17,471 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:24:17,488 - src.tws_connection - INFO - ✅ Next valid order ID received: 189
2025-06-05 11:24:17,588 - src.tws_connection - INFO - ✅ Next valid order ID received: 189
2025-06-05 11:24:17,955 - src.tws_connection - INFO - Open Order - ID: 189, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:24:17,961 - src.order.base - INFO - Order 47bf4c7a-99f7-4649-87b0-628bef407694 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:24:17,961 - src.order.base - INFO - Order 47bf4c7a-99f7-4649-87b0-628bef407694 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:24:17,961 - src.order.base - INFO - Order 47bf4c7a-99f7-4649-87b0-628bef407694 filled: 100.0 @ 310.06 (100.0/100)
2025-06-05 11:24:17,967 - src.tws_connection - INFO - Open Order - ID: 189, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:24:17,969 - src.tws_connection - INFO - Open Order - ID: 189, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:24:18,489 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:24:18,489 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $309.63 (ATR: 0.0450 * 10.0 = 0.4500)
2025-06-05 11:24:18,490 - src.order.base - INFO - Order 2accc686-f769-4f95-b669-2687bd4de254 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:24:18,490 - src.order.manager - INFO - Submitting order 2accc686-f769-4f95-b669-2687bd4de254 to TWS
2025-06-05 11:24:18,490 - src.order.manager - INFO - Got broker order ID 189 for order 2accc686-f769-4f95-b669-2687bd4de254
2025-06-05 11:24:18,491 - src.order.manager - INFO - Calling placeOrder with ID 189, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:24:18,491 - src.order.manager - INFO - placeOrder called successfully for order 2accc686-f769-4f95-b669-2687bd4de254
2025-06-05 11:24:18,491 - src.order.base - INFO - Order 2accc686-f769-4f95-b669-2687bd4de254 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:24:18,492 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 2accc686-f769-4f95-b669-2687bd4de254 at $309.63
2025-06-05 11:24:18,492 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:24:18,492 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.98 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:24:18,492 - src.order.base - INFO - Order d83de804-745a-4a17-8e0d-85421df28684 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:24:18,493 - src.order.manager - INFO - Submitting order d83de804-745a-4a17-8e0d-85421df28684 to TWS
2025-06-05 11:24:18,493 - src.order.manager - INFO - Got broker order ID 190 for order d83de804-745a-4a17-8e0d-85421df28684
2025-06-05 11:24:18,493 - src.order.manager - INFO - Calling placeOrder with ID 190, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.980000 DAY
2025-06-05 11:24:18,493 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 189)
2025-06-05 11:24:18,494 - src.order.manager - INFO - placeOrder called successfully for order d83de804-745a-4a17-8e0d-85421df28684
2025-06-05 11:24:18,494 - src.order.base - INFO - Order d83de804-745a-4a17-8e0d-85421df28684 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:24:18,495 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit d83de804-745a-4a17-8e0d-85421df28684 at $310.98
2025-06-05 11:24:18,503 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:24:18,505 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:24:18,617 - src.tws_connection - INFO - Open Order - ID: 190, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:24:19,017 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['2accc686-f769-4f95-b669-2687bd4de254']
2025-06-05 11:24:19,024 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:24:24,033 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:24:24,033 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.09, stop_distance=$0.27, dd_distance=$0.03, dd_price=$310.06, original_qty=100, dd_qty=100
2025-06-05 11:24:24,034 - src.order.base - INFO - Order b27da1ac-0ee1-4527-9241-f784eb48a847 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:24:24,034 - src.order.manager - INFO - Submitting order b27da1ac-0ee1-4527-9241-f784eb48a847 to TWS
2025-06-05 11:24:24,035 - src.order.manager - INFO - Got broker order ID 191 for order b27da1ac-0ee1-4527-9241-f784eb48a847
2025-06-05 11:24:24,035 - src.order.manager - INFO - Calling placeOrder with ID 191, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.060000 DAY
2025-06-05 11:24:24,036 - src.order.manager - INFO - placeOrder called successfully for order b27da1ac-0ee1-4527-9241-f784eb48a847
2025-06-05 11:24:24,036 - src.order.base - INFO - Order b27da1ac-0ee1-4527-9241-f784eb48a847 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:24:24,037 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:24:24,037 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.06
2025-06-05 11:24:24,037 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:24:24,037 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 47bf4c7a-99f7-4649-87b0-628bef407694 for GLD
2025-06-05 11:24:24,138 - src.tws_connection - INFO - Open Order - ID: 191, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:24:27,478 - __main__ - INFO - 
============================================================
2025-06-05 11:24:27,479 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:24:27,480 - __main__ - INFO - ============================================================
2025-06-05 11:24:27,481 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:24:27,481 - __main__ - INFO - Order d83de804-745a-4a17-8e0d-85421df28684: limit sell -100 @ 310.98 - Status: submitted
2025-06-05 11:24:27,481 - __main__ - INFO - Order 2accc686-f769-4f95-b669-2687bd4de254: stop sell -100 @ 309.63 - Status: submitted
2025-06-05 11:24:27,481 - __main__ - INFO - Order 47bf4c7a-99f7-4649-87b0-628bef407694: market buy 100 @ MARKET - Status: filled
2025-06-05 11:24:27,482 - __main__ - INFO - Order b27da1ac-0ee1-4527-9241-f784eb48a847: limit buy 100 @ 310.06 - Status: submitted
2025-06-05 11:24:27,482 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:24:27,482 - __main__ - INFO - Stop orders: 1
2025-06-05 11:24:27,483 - __main__ - INFO - Target orders: 1
2025-06-05 11:24:27,483 - __main__ - INFO - Double down orders: 1
2025-06-05 11:24:27,483 - __main__ - INFO - 
Double down order details:
2025-06-05 11:24:27,483 - __main__ - INFO -   ID: b27da1ac-0ee1-4527-9241-f784eb48a847
2025-06-05 11:24:27,483 - __main__ - INFO -   Status: submitted
2025-06-05 11:24:27,483 - __main__ - INFO -   Limit price: 310.06
2025-06-05 11:24:27,484 - __main__ - INFO -   Quantity: 100
2025-06-05 11:24:27,484 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:24:27,484 - __main__ - INFO -   Stop: -100 @ $309.63
2025-06-05 11:24:27,484 - __main__ - INFO -   Target: -100 @ $310.98
2025-06-05 11:24:27,484 - __main__ - INFO - 
============================================================
2025-06-05 11:24:27,485 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:24:27,485 - __main__ - INFO - ============================================================
2025-06-05 11:24:27,485 - __main__ - INFO - Waiting for double down order b27da1ac-0ee1-4527-9241-f784eb48a847 to fill at $310.06...
2025-06-05 11:24:27,485 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:24:32,492 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:24:37,499 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:24:37,893 - src.order.base - INFO - Order b27da1ac-0ee1-4527-9241-f784eb48a847 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:24:37,892 - src.tws_connection - INFO - Open Order - ID: 191, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:24:37,896 - src.order.base - INFO - Order b27da1ac-0ee1-4527-9241-f784eb48a847 filled: 100.0 @ 310.06 (100.0/100)
2025-06-05 11:24:37,896 - src.tws_connection - INFO - Open Order - ID: 191, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:24:37,898 - LinkedDoubleDownFillManager - INFO - Double down order b27da1ac-0ee1-4527-9241-f784eb48a847 filled for GLD - updating protective orders
2025-06-05 11:24:37,899 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:24:37,899 - LinkedDoubleDownFillManager - ERROR - Error handling double down fill: float division by zero
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\src\rule\linked_order_actions.py", line 1150, in on_order_fill
    new_avg_price = (old_value + dd_value) / abs(new_quantity)
                    ~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~
ZeroDivisionError: float division by zero
2025-06-05 11:24:42,512 - __main__ - INFO - ✅ Double down order filled at $310.06!
2025-06-05 11:24:52,528 - __main__ - INFO - 
============================================================
2025-06-05 11:24:52,528 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:24:52,529 - __main__ - INFO - ============================================================
2025-06-05 11:24:52,529 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:24:52,530 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:24:52,530 - __main__ - INFO - 
New stop order:
2025-06-05 11:24:52,530 - __main__ - INFO -   ID: 2accc686-f769-4f95-b669-2687bd4de254
2025-06-05 11:24:52,530 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:24:52,531 - __main__ - INFO -   Stop price: $309.63 (was $309.63)
2025-06-05 11:24:52,531 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 11:24:52,531 - __main__ - INFO - 
New target order:
2025-06-05 11:24:52,531 - __main__ - INFO -   ID: d83de804-745a-4a17-8e0d-85421df28684
2025-06-05 11:24:52,531 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:24:52,531 - __main__ - INFO -   Limit price: $310.98 (was $310.98)
2025-06-05 11:24:52,531 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 11:24:52,531 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:24:52,532 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:24:52,532 - __main__ - INFO -   Side: BUY
2025-06-05 11:24:52,532 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:24:52,532 - __main__ - INFO -   Target orders: 1
2025-06-05 11:24:52,532 - __main__ - INFO -   All orders: {'d83de804-745a-4a17-8e0d-85421df28684', '2accc686-f769-4f95-b669-2687bd4de254', '47bf4c7a-99f7-4649-87b0-628bef407694', 'b27da1ac-0ee1-4527-9241-f784eb48a847'}
2025-06-05 11:24:52,532 - __main__ - INFO - 
============================================================
2025-06-05 11:24:52,532 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:24:52,532 - __main__ - INFO - ============================================================
2025-06-05 11:24:52,532 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:24:52,532 - src.order.base - INFO - Order d83de804-745a-4a17-8e0d-85421df28684 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:24:52,533 - src.order.manager - INFO - Cancelling order d83de804-745a-4a17-8e0d-85421df28684 with broker ID 190
2025-06-05 11:24:52,537 - src.order.base - INFO - Order 2accc686-f769-4f95-b669-2687bd4de254 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:24:52,538 - src.order.manager - INFO - Cancelling order 2accc686-f769-4f95-b669-2687bd4de254 with broker ID 189
2025-06-05 11:24:52,540 - src.order.manager - WARNING - Cannot cancel inactive order 47bf4c7a-99f7-4649-87b0-628bef407694 with status filled
2025-06-05 11:24:52,540 - src.order.manager - WARNING - Cannot cancel inactive order b27da1ac-0ee1-4527-9241-f784eb48a847 with status filled
2025-06-05 11:24:52,540 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:24:52,540 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:24:52,546 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:24:52,546 - src.tws_connection - WARNING - ⚠️ TWS Error 10147: OrderId 189 that needs to be cancelled is not found. (reqId: 189)
2025-06-05 11:24:52,546 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:24:52,549 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:24:52,551 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:24:52,552 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:25:43,118 - __main__ - INFO - ================================================================================
2025-06-05 11:25:43,119 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:25:43,119 - __main__ - INFO - ================================================================================
2025-06-05 11:25:43,121 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:25:43,122 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:25:43,125 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:25:44,712 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:25:44,713 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:25:44,750 - src.tws_connection - INFO - ✅ Next valid order ID received: 192
2025-06-05 11:25:44,751 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:25:44,752 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:25:44,753 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:25:44,753 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:25:44,753 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:25:44,754 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:25:44,754 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:25:44,754 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:25:44,754 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:25:44,755 - __main__ - INFO - 
============================================================
2025-06-05 11:25:44,755 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:25:44,755 - __main__ - INFO - ============================================================
2025-06-05 11:25:44,756 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:25:44,756 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:25:44,756 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:25:44,756 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:25:44,757 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:25:44,757 - src.order.base - INFO - Order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:25:44,757 - src.order.manager - INFO - Submitting order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 to TWS
2025-06-05 11:25:44,758 - src.order.manager - INFO - Got broker order ID 192 for order f90f24a5-e9fb-46ca-8fc7-8135e88796f7
2025-06-05 11:25:44,758 - src.order.manager - INFO - Calling placeOrder with ID 192, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:25:44,758 - src.order.manager - INFO - placeOrder called successfully for order f90f24a5-e9fb-46ca-8fc7-8135e88796f7
2025-06-05 11:25:44,758 - src.order.base - INFO - Order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:25:44,759 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:25:44,759 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:25:44,813 - src.tws_connection - INFO - ✅ Next valid order ID received: 192
2025-06-05 11:25:44,912 - src.tws_connection - INFO - ✅ Next valid order ID received: 192
2025-06-05 11:25:45,113 - src.tws_connection - INFO - Open Order - ID: 192, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:25:45,272 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:25:45,273 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $309.66 (ATR: 0.0450 * 10.0 = 0.4500)
2025-06-05 11:25:45,273 - src.order.base - INFO - Order 64713b32-828f-4665-a4b3-333b88b2bfce status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:25:45,273 - src.order.manager - INFO - Submitting order 64713b32-828f-4665-a4b3-333b88b2bfce to TWS
2025-06-05 11:25:45,274 - src.order.manager - INFO - Got broker order ID 192 for order 64713b32-828f-4665-a4b3-333b88b2bfce
2025-06-05 11:25:45,274 - src.order.manager - INFO - Calling placeOrder with ID 192, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:25:45,274 - src.order.manager - INFO - placeOrder called successfully for order 64713b32-828f-4665-a4b3-333b88b2bfce
2025-06-05 11:25:45,275 - src.order.base - INFO - Order 64713b32-828f-4665-a4b3-333b88b2bfce status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:25:45,275 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 64713b32-828f-4665-a4b3-333b88b2bfce at $309.66
2025-06-05 11:25:45,275 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:25:45,276 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.01 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:25:45,276 - src.order.base - INFO - Order b926679b-f591-498b-9249-3f50de6b4b59 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:25:45,276 - src.order.manager - INFO - Submitting order b926679b-f591-498b-9249-3f50de6b4b59 to TWS
2025-06-05 11:25:45,276 - src.order.manager - INFO - Got broker order ID 193 for order b926679b-f591-498b-9249-3f50de6b4b59
2025-06-05 11:25:45,276 - src.order.manager - INFO - Calling placeOrder with ID 193, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.010000 DAY
2025-06-05 11:25:45,277 - src.order.manager - INFO - placeOrder called successfully for order b926679b-f591-498b-9249-3f50de6b4b59
2025-06-05 11:25:45,278 - src.order.base - INFO - Order b926679b-f591-498b-9249-3f50de6b4b59 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:25:45,278 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit b926679b-f591-498b-9249-3f50de6b4b59 at $311.01
2025-06-05 11:25:45,278 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:25:45,279 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:25:45,279 - src.order.base - INFO - Order 64713b32-828f-4665-a4b3-333b88b2bfce status changed: submitted -> filled (Order fully filled)
2025-06-05 11:25:45,279 - src.order.base - INFO - Order 64713b32-828f-4665-a4b3-333b88b2bfce filled: 100.0 @ 310.11 (100.0/100)
2025-06-05 11:25:45,280 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - stop order 64713b32-828f-4665-a4b3-333b88b2bfce filled at $310.11
2025-06-05 11:25:45,280 - src.order.base - INFO - Order b926679b-f591-498b-9249-3f50de6b4b59 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:25:45,281 - src.order.manager - INFO - Cancelling order b926679b-f591-498b-9249-3f50de6b4b59 with broker ID 193
2025-06-05 11:25:45,273 - src.tws_connection - INFO - Open Order - ID: 192, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:25:45,281 - src.rule.linked_order_actions - INFO - Cancelled remaining order b926679b-f591-498b-9249-3f50de6b4b59 for GLD
2025-06-05 11:25:45,281 - src.order.base - INFO - Order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:25:45,281 - src.order.manager - INFO - Cancelling order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 with broker ID 192
2025-06-05 11:25:45,282 - src.rule.linked_order_actions - INFO - Cancelled remaining order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 for GLD
2025-06-05 11:25:45,283 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 11:25:45,283 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 11:25:45,283 - src.tws_connection - INFO - Open Order - ID: 192, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:25:45,284 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 192)
2025-06-05 11:25:45,286 - src.order.manager - WARNING - Unknown IB order status: ApiCancelled for order b926679b-f591-498b-9249-3f50de6b4b59
2025-06-05 11:25:45,382 - src.tws_connection - WARNING - ⚠️ TWS Error 10148: OrderId 192 that needs to be cancelled cannot be cancelled, state: Filled. (reqId: 192)
2025-06-05 11:25:45,788 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['64713b32-828f-4665-a4b3-333b88b2bfce']
2025-06-05 11:25:45,788 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:25:50,804 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:25:50,804 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.16, stop_distance=$0.27, dd_distance=$0.03, dd_price=$310.13, original_qty=100, dd_qty=100
2025-06-05 11:25:50,805 - src.order.base - INFO - Order 5b317db8-0a24-45a9-9baf-ab24edf47b0a status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:25:50,805 - src.order.manager - INFO - Submitting order 5b317db8-0a24-45a9-9baf-ab24edf47b0a to TWS
2025-06-05 11:25:50,806 - src.order.manager - INFO - Got broker order ID 194 for order 5b317db8-0a24-45a9-9baf-ab24edf47b0a
2025-06-05 11:25:50,806 - src.order.manager - INFO - Calling placeOrder with ID 194, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.130000 DAY
2025-06-05 11:25:50,806 - src.order.manager - INFO - placeOrder called successfully for order 5b317db8-0a24-45a9-9baf-ab24edf47b0a
2025-06-05 11:25:50,807 - src.order.base - INFO - Order 5b317db8-0a24-45a9-9baf-ab24edf47b0a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:25:50,807 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:25:50,808 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.13
2025-06-05 11:25:50,809 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:25:50,810 - src.rule.linked_order_actions - INFO - Created and linked BUY main order f90f24a5-e9fb-46ca-8fc7-8135e88796f7 for GLD
2025-06-05 11:25:50,921 - src.tws_connection - INFO - Open Order - ID: 194, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:25:54,763 - __main__ - INFO - 
============================================================
2025-06-05 11:25:54,763 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:25:54,764 - __main__ - INFO - ============================================================
2025-06-05 11:25:54,764 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:25:54,765 - __main__ - INFO - Order 5b317db8-0a24-45a9-9baf-ab24edf47b0a: limit buy 100 @ 310.13 - Status: submitted
2025-06-05 11:25:54,765 - __main__ - INFO - Order b926679b-f591-498b-9249-3f50de6b4b59: limit sell -100 @ 311.01 - Status: pending_cancel
2025-06-05 11:25:54,765 - __main__ - INFO - Order f90f24a5-e9fb-46ca-8fc7-8135e88796f7: market buy 100 @ MARKET - Status: pending_cancel
2025-06-05 11:25:54,767 - __main__ - INFO - Order 64713b32-828f-4665-a4b3-333b88b2bfce: stop sell -100 @ 309.66 - Status: filled
2025-06-05 11:25:54,768 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:25:54,768 - __main__ - INFO - Stop orders: 1
2025-06-05 11:25:54,768 - __main__ - INFO - Target orders: 1
2025-06-05 11:25:54,769 - __main__ - INFO - Double down orders: 1
2025-06-05 11:25:54,769 - __main__ - INFO - 
Double down order details:
2025-06-05 11:25:54,769 - __main__ - INFO -   ID: 5b317db8-0a24-45a9-9baf-ab24edf47b0a
2025-06-05 11:25:54,770 - __main__ - INFO -   Status: submitted
2025-06-05 11:25:54,770 - __main__ - INFO -   Limit price: 310.13
2025-06-05 11:25:54,770 - __main__ - INFO -   Quantity: 100
2025-06-05 11:25:54,771 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:25:54,771 - __main__ - INFO -   Stop: -100 @ $309.66
2025-06-05 11:25:54,771 - __main__ - INFO -   Target: -100 @ $311.01
2025-06-05 11:25:54,771 - __main__ - INFO - 
============================================================
2025-06-05 11:25:54,772 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:25:54,772 - __main__ - INFO - ============================================================
2025-06-05 11:25:54,772 - __main__ - INFO - Waiting for double down order 5b317db8-0a24-45a9-9baf-ab24edf47b0a to fill at $310.13...
2025-06-05 11:25:54,772 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:25:59,780 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:26:04,795 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:26:09,803 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:26:14,808 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:26:19,814 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:26:24,819 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:26:29,833 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:26:34,836 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:26:39,205 - src.order.base - INFO - Order 5b317db8-0a24-45a9-9baf-ab24edf47b0a status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:26:39,206 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 194)
2025-06-05 11:26:39,846 - __main__ - INFO - Waiting... (45s elapsed, order status: cancelled)
2025-06-05 11:26:44,853 - __main__ - INFO - Waiting... (50s elapsed, order status: cancelled)
2025-06-05 11:26:49,861 - __main__ - INFO - Waiting... (55s elapsed, order status: cancelled)
2025-06-05 11:26:54,871 - __main__ - INFO - Waiting... (60s elapsed, order status: cancelled)
2025-06-05 11:26:59,890 - __main__ - INFO - Waiting... (65s elapsed, order status: cancelled)
2025-06-05 11:27:04,084 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:27:04,097 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:27:04,098 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:27:04,099 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:27:04,891 - __main__ - INFO - Waiting... (70s elapsed, order status: cancelled)
2025-06-05 11:27:09,906 - __main__ - INFO - Waiting... (75s elapsed, order status: cancelled)
2025-06-05 11:27:14,921 - __main__ - INFO - Waiting... (80s elapsed, order status: cancelled)
2025-06-05 11:27:19,937 - __main__ - INFO - Waiting... (85s elapsed, order status: cancelled)
2025-06-05 11:27:24,946 - __main__ - INFO - Waiting... (90s elapsed, order status: cancelled)
2025-06-05 11:27:29,960 - __main__ - INFO - Waiting... (95s elapsed, order status: cancelled)
2025-06-05 11:27:34,966 - __main__ - INFO - Waiting... (100s elapsed, order status: cancelled)
2025-06-05 11:27:39,982 - __main__ - INFO - Waiting... (105s elapsed, order status: cancelled)
2025-06-05 11:27:44,991 - __main__ - INFO - Waiting... (110s elapsed, order status: cancelled)
2025-06-05 11:27:50,005 - __main__ - INFO - Waiting... (115s elapsed, order status: cancelled)
2025-06-05 11:27:55,015 - __main__ - INFO - Waiting... (120s elapsed, order status: cancelled)
2025-06-05 11:28:00,033 - __main__ - INFO - Waiting... (125s elapsed, order status: cancelled)
2025-06-05 11:28:05,038 - __main__ - INFO - Waiting... (130s elapsed, order status: cancelled)
2025-06-05 11:28:10,039 - __main__ - INFO - Waiting... (135s elapsed, order status: cancelled)
2025-06-05 11:28:15,042 - __main__ - INFO - Waiting... (140s elapsed, order status: cancelled)
2025-06-05 11:28:20,049 - __main__ - INFO - Waiting... (145s elapsed, order status: cancelled)
2025-06-05 11:28:25,071 - __main__ - INFO - Waiting... (150s elapsed, order status: cancelled)
2025-06-05 11:28:30,090 - __main__ - INFO - Waiting... (155s elapsed, order status: cancelled)
2025-06-05 11:28:35,109 - __main__ - INFO - Waiting... (160s elapsed, order status: cancelled)
2025-06-05 11:28:40,115 - __main__ - INFO - Waiting... (165s elapsed, order status: cancelled)
2025-06-05 11:28:45,125 - __main__ - INFO - Waiting... (170s elapsed, order status: cancelled)
2025-06-05 11:28:50,130 - __main__ - INFO - Waiting... (175s elapsed, order status: cancelled)
2025-06-05 11:28:55,147 - __main__ - INFO - Waiting... (180s elapsed, order status: cancelled)
2025-06-05 11:29:00,149 - __main__ - INFO - Waiting... (185s elapsed, order status: cancelled)
2025-06-05 11:29:05,156 - __main__ - INFO - Waiting... (190s elapsed, order status: cancelled)
2025-06-05 11:30:51,638 - __main__ - INFO - ================================================================================
2025-06-05 11:30:51,638 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:30:51,639 - __main__ - INFO - ================================================================================
2025-06-05 11:30:51,641 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:30:51,641 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:30:51,643 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:30:54,643 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:30:54,643 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:30:54,685 - src.tws_connection - INFO - ✅ Next valid order ID received: 198
2025-06-05 11:30:54,685 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:30:54,686 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:30:54,687 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:30:54,688 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:30:54,688 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:30:54,689 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:30:54,689 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:30:54,689 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:30:54,690 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:30:54,690 - __main__ - INFO - 
============================================================
2025-06-05 11:30:54,691 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:30:54,691 - __main__ - INFO - ============================================================
2025-06-05 11:30:54,691 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:30:54,692 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:30:54,692 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:30:54,692 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:30:54,692 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:30:54,693 - src.order.base - INFO - Order 6ba417c4-101c-4d68-903a-e2535e8473a9 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:30:54,693 - src.order.manager - INFO - Submitting order 6ba417c4-101c-4d68-903a-e2535e8473a9 to TWS
2025-06-05 11:30:54,694 - src.order.manager - INFO - Got broker order ID 198 for order 6ba417c4-101c-4d68-903a-e2535e8473a9
2025-06-05 11:30:54,694 - src.order.manager - INFO - Calling placeOrder with ID 198, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:30:54,695 - src.order.manager - INFO - placeOrder called successfully for order 6ba417c4-101c-4d68-903a-e2535e8473a9
2025-06-05 11:30:54,695 - src.order.base - INFO - Order 6ba417c4-101c-4d68-903a-e2535e8473a9 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:30:54,696 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:30:54,696 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:30:54,761 - src.tws_connection - INFO - ✅ Next valid order ID received: 198
2025-06-05 11:30:54,844 - src.tws_connection - INFO - ✅ Next valid order ID received: 198
2025-06-05 11:30:55,088 - src.tws_connection - INFO - Open Order - ID: 198, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:30:55,093 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:30:55,093 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $309.30 (ATR: 0.0450 * 10.0 = 0.4500)
2025-06-05 11:30:55,094 - src.order.base - INFO - Order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:30:55,094 - src.order.manager - INFO - Submitting order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 to TWS
2025-06-05 11:30:55,094 - src.order.manager - INFO - Got broker order ID 198 for order c4e4a59c-1c11-46df-ac65-0c18ed3bd715
2025-06-05 11:30:55,094 - src.order.manager - INFO - Calling placeOrder with ID 198, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:30:55,095 - src.order.manager - INFO - placeOrder called successfully for order c4e4a59c-1c11-46df-ac65-0c18ed3bd715
2025-06-05 11:30:55,096 - src.order.base - INFO - Order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:30:55,097 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss c4e4a59c-1c11-46df-ac65-0c18ed3bd715 at $309.30
2025-06-05 11:30:55,097 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:30:55,098 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.65 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:30:55,099 - src.order.base - INFO - Order b8630e0e-c14f-46da-af8e-5f5ce3c5359e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:30:55,099 - src.order.manager - INFO - Submitting order b8630e0e-c14f-46da-af8e-5f5ce3c5359e to TWS
2025-06-05 11:30:55,100 - src.order.manager - INFO - Got broker order ID 199 for order b8630e0e-c14f-46da-af8e-5f5ce3c5359e
2025-06-05 11:30:55,100 - src.order.manager - INFO - Calling placeOrder with ID 199, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.650000 DAY
2025-06-05 11:30:55,100 - src.order.manager - INFO - placeOrder called successfully for order b8630e0e-c14f-46da-af8e-5f5ce3c5359e
2025-06-05 11:30:55,101 - src.order.base - INFO - Order b8630e0e-c14f-46da-af8e-5f5ce3c5359e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:30:55,101 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit b8630e0e-c14f-46da-af8e-5f5ce3c5359e at $310.65
2025-06-05 11:30:55,101 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:30:55,101 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:30:55,104 - src.tws_connection - WARNING - ⚠️ TWS Error 105: Order being modified does not match original order. (reqId: 198)
2025-06-05 11:30:55,214 - src.tws_connection - INFO - Open Order - ID: 199, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:30:55,606 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['c4e4a59c-1c11-46df-ac65-0c18ed3bd715']
2025-06-05 11:30:55,606 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:30:55,652 - src.tws_connection - INFO - Open Order - ID: 198, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:30:55,658 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:30:55,659 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$309.75, stop_distance=$0.27, dd_distance=$0.03, dd_price=$309.72, original_qty=100, dd_qty=100
2025-06-05 11:30:55,660 - src.order.base - INFO - Order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:30:55,662 - src.order.manager - INFO - Submitting order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 to TWS
2025-06-05 11:30:55,663 - src.order.manager - INFO - Got broker order ID 200 for order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558
2025-06-05 11:30:55,663 - src.order.manager - INFO - Calling placeOrder with ID 200, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@309.720000 DAY
2025-06-05 11:30:55,663 - src.order.manager - INFO - placeOrder called successfully for order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558
2025-06-05 11:30:55,664 - src.order.base - INFO - Order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:30:55,665 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:30:55,665 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $309.72
2025-06-05 11:30:55,665 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:30:55,665 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 6ba417c4-101c-4d68-903a-e2535e8473a9 for GLD
2025-06-05 11:30:55,762 - src.tws_connection - INFO - Open Order - ID: 200, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:30:55,830 - src.order.base - INFO - Order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:30:55,830 - src.tws_connection - INFO - Open Order - ID: 198, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:30:55,831 - src.order.base - INFO - Order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 filled: 100.0 @ 309.77 (100.0/100)
2025-06-05 11:30:55,831 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - stop order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 filled at $309.77
2025-06-05 11:30:55,831 - src.order.base - INFO - Order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:30:55,832 - src.order.manager - INFO - Cancelling order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 with broker ID 200
2025-06-05 11:30:55,832 - src.rule.linked_order_actions - INFO - Cancelled remaining order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 for GLD
2025-06-05 11:30:55,832 - src.order.base - INFO - Order 6ba417c4-101c-4d68-903a-e2535e8473a9 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:30:55,832 - src.order.manager - INFO - Cancelling order 6ba417c4-101c-4d68-903a-e2535e8473a9 with broker ID 198
2025-06-05 11:30:55,832 - src.rule.linked_order_actions - INFO - Cancelled remaining order 6ba417c4-101c-4d68-903a-e2535e8473a9 for GLD
2025-06-05 11:30:55,832 - src.order.base - INFO - Order b8630e0e-c14f-46da-af8e-5f5ce3c5359e status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:30:55,832 - src.order.manager - INFO - Cancelling order b8630e0e-c14f-46da-af8e-5f5ce3c5359e with broker ID 199
2025-06-05 11:30:55,833 - src.rule.linked_order_actions - INFO - Cancelled remaining order b8630e0e-c14f-46da-af8e-5f5ce3c5359e for GLD
2025-06-05 11:30:55,833 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 11:30:55,833 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 11:30:55,872 - src.tws_connection - INFO - Open Order - ID: 198, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:30:55,873 - src.tws_connection - WARNING - ⚠️ TWS Error 10148: OrderId 198 that needs to be cancelled cannot be cancelled, state: Filled. (reqId: 198)
2025-06-05 11:30:55,955 - src.order.base - INFO - Order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:30:55,955 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 200)
2025-06-05 11:30:56,014 - src.order.base - INFO - Order b8630e0e-c14f-46da-af8e-5f5ce3c5359e status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:30:56,014 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 199)
2025-06-05 11:31:04,706 - __main__ - INFO - 
============================================================
2025-06-05 11:31:04,707 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:31:04,707 - __main__ - INFO - ============================================================
2025-06-05 11:31:04,707 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:31:04,708 - __main__ - INFO - Order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558: limit buy 100 @ 309.72 - Status: cancelled
2025-06-05 11:31:04,708 - __main__ - INFO - Order c4e4a59c-1c11-46df-ac65-0c18ed3bd715: stop sell -100 @ 309.3 - Status: filled
2025-06-05 11:31:04,708 - __main__ - INFO - Order 6ba417c4-101c-4d68-903a-e2535e8473a9: market buy 100 @ MARKET - Status: pending_cancel
2025-06-05 11:31:04,709 - __main__ - INFO - Order b8630e0e-c14f-46da-af8e-5f5ce3c5359e: limit sell -100 @ 310.65 - Status: cancelled
2025-06-05 11:31:04,710 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:31:04,710 - __main__ - INFO - Stop orders: 1
2025-06-05 11:31:04,710 - __main__ - INFO - Target orders: 1
2025-06-05 11:31:04,712 - __main__ - INFO - Double down orders: 0
2025-06-05 11:31:04,713 - __main__ - ERROR - ❌ No double down orders found!
2025-06-05 11:31:04,714 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:31:04,714 - src.order.manager - WARNING - Cannot cancel inactive order e02151ae-6eb6-4c1a-b2aa-e2aa4d55f558 with status cancelled
2025-06-05 11:31:04,714 - src.order.manager - WARNING - Cannot cancel inactive order c4e4a59c-1c11-46df-ac65-0c18ed3bd715 with status filled
2025-06-05 11:31:04,714 - src.order.manager - WARNING - Cannot cancel inactive order 6ba417c4-101c-4d68-903a-e2535e8473a9 with status pending_cancel
2025-06-05 11:31:04,715 - src.order.manager - WARNING - Cannot cancel inactive order b8630e0e-c14f-46da-af8e-5f5ce3c5359e with status cancelled
2025-06-05 11:31:04,715 - __main__ - INFO - Cancelled 0 orders
2025-06-05 11:31:04,715 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:31:04,716 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:31:04,716 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:31:04,717 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:31:04,717 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:31:04,718 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:31:43,391 - __main__ - INFO - ================================================================================
2025-06-05 11:31:43,392 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:31:43,392 - __main__ - INFO - ================================================================================
2025-06-05 11:31:43,393 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:31:43,393 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:31:43,394 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:31:53,407 - src.tws_connection - ERROR - ❌ Connection failed or timed out
2025-06-05 11:31:53,408 - src.tws_connection - ERROR - Connected: False, Next ID: None
2025-06-05 11:31:53,409 - src.tws_connection - INFO - Forcing connection cleanup
2025-06-05 11:31:53,410 - ibapi.client - WARNING - Disconnected; resetting connection
2025-06-05 11:31:53,409 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:31:53,410 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:31:53,411 - __main__ - ERROR - Failed to connect to TWS
2025-06-05 11:31:53,411 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 11:31:53,412 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:32:28,648 - __main__ - INFO - ================================================================================
2025-06-05 11:32:28,648 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:32:28,648 - __main__ - INFO - ================================================================================
2025-06-05 11:32:28,650 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:32:28,651 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:32:28,651 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:32:30,307 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:32:30,310 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:32:30,338 - src.tws_connection - INFO - ✅ Next valid order ID received: 201
2025-06-05 11:32:30,339 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:32:30,339 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:32:30,341 - src.tws_connection - INFO - ✅ Next valid order ID received: 201
2025-06-05 11:32:30,342 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:32:30,342 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:32:30,342 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:32:30,342 - src.tws_connection - INFO - ✅ Next valid order ID received: 201
2025-06-05 11:32:30,343 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:32:30,343 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:32:30,343 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:32:30,343 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:32:30,344 - __main__ - INFO - 
============================================================
2025-06-05 11:32:30,344 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:32:30,344 - __main__ - INFO - ============================================================
2025-06-05 11:32:30,344 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:32:30,344 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:32:30,345 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:32:30,345 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:32:30,345 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:32:30,345 - src.order.base - INFO - Order df1f88c6-e8c3-4220-a22b-68c326f05a86 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:32:30,346 - src.order.manager - INFO - Submitting order df1f88c6-e8c3-4220-a22b-68c326f05a86 to TWS
2025-06-05 11:32:30,346 - src.order.manager - INFO - Got broker order ID 201 for order df1f88c6-e8c3-4220-a22b-68c326f05a86
2025-06-05 11:32:30,346 - src.order.manager - INFO - Calling placeOrder with ID 201, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:32:30,348 - src.order.manager - INFO - placeOrder called successfully for order df1f88c6-e8c3-4220-a22b-68c326f05a86
2025-06-05 11:32:30,349 - src.order.base - INFO - Order df1f88c6-e8c3-4220-a22b-68c326f05a86 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:32:30,350 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:32:30,350 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:32:30,598 - src.tws_connection - INFO - Open Order - ID: 201, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:32:30,614 - src.order.base - INFO - Order df1f88c6-e8c3-4220-a22b-68c326f05a86 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:32:30,616 - src.order.base - INFO - Order df1f88c6-e8c3-4220-a22b-68c326f05a86 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:32:30,617 - src.order.base - INFO - Order df1f88c6-e8c3-4220-a22b-68c326f05a86 filled: 100.0 @ 309.33 (100.0/100)
2025-06-05 11:32:30,617 - src.tws_connection - INFO - Open Order - ID: 201, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:32:30,619 - src.tws_connection - INFO - Open Order - ID: 201, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:32:31,368 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:32:31,368 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $307.09 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:32:31,368 - src.order.base - INFO - Order 9a489e88-d51e-47cf-b58d-55f6e5327b1a status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:32:31,369 - src.order.manager - INFO - Submitting order 9a489e88-d51e-47cf-b58d-55f6e5327b1a to TWS
2025-06-05 11:32:31,369 - src.order.manager - INFO - Got broker order ID 202 for order 9a489e88-d51e-47cf-b58d-55f6e5327b1a
2025-06-05 11:32:31,369 - src.order.manager - INFO - Calling placeOrder with ID 202, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:32:31,370 - src.order.manager - INFO - placeOrder called successfully for order 9a489e88-d51e-47cf-b58d-55f6e5327b1a
2025-06-05 11:32:31,370 - src.order.base - INFO - Order 9a489e88-d51e-47cf-b58d-55f6e5327b1a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:32:31,370 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9a489e88-d51e-47cf-b58d-55f6e5327b1a at $307.09
2025-06-05 11:32:31,370 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:32:31,371 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.24 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:32:31,371 - src.order.base - INFO - Order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:32:31,371 - src.order.manager - INFO - Submitting order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749 to TWS
2025-06-05 11:32:31,371 - src.order.manager - INFO - Got broker order ID 203 for order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749
2025-06-05 11:32:31,372 - src.order.manager - INFO - Calling placeOrder with ID 203, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.240000 DAY
2025-06-05 11:32:31,373 - src.order.manager - INFO - placeOrder called successfully for order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749
2025-06-05 11:32:31,374 - src.order.base - INFO - Order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:32:31,374 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 15fa5672-1fdf-4ab5-8278-a8e2d8f40749 at $310.24
2025-06-05 11:32:31,374 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:32:31,374 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:32:31,450 - src.tws_connection - INFO - Open Order - ID: 202, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:32:31,452 - src.order.base - INFO - Order 9a489e88-d51e-47cf-b58d-55f6e5327b1a status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:32:31,499 - src.tws_connection - INFO - Open Order - ID: 203, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:32:31,881 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9a489e88-d51e-47cf-b58d-55f6e5327b1a']
2025-06-05 11:32:31,882 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:32:36,888 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:32:36,890 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$309.34, stop_distance=$0.27, dd_distance=$0.03, dd_price=$309.31, original_qty=100, dd_qty=100
2025-06-05 11:32:36,890 - src.order.base - INFO - Order 4373c112-5c08-495b-9cfa-847ff1f821db status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:32:36,890 - src.order.manager - INFO - Submitting order 4373c112-5c08-495b-9cfa-847ff1f821db to TWS
2025-06-05 11:32:36,891 - src.order.manager - INFO - Got broker order ID 204 for order 4373c112-5c08-495b-9cfa-847ff1f821db
2025-06-05 11:32:36,891 - src.order.manager - INFO - Calling placeOrder with ID 204, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@309.310000 DAY
2025-06-05 11:32:36,891 - src.order.manager - INFO - placeOrder called successfully for order 4373c112-5c08-495b-9cfa-847ff1f821db
2025-06-05 11:32:36,892 - src.order.base - INFO - Order 4373c112-5c08-495b-9cfa-847ff1f821db status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:32:36,892 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:32:36,892 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $309.31
2025-06-05 11:32:36,892 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:32:36,892 - src.rule.linked_order_actions - INFO - Created and linked BUY main order df1f88c6-e8c3-4220-a22b-68c326f05a86 for GLD
2025-06-05 11:32:36,997 - src.tws_connection - INFO - Open Order - ID: 204, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:32:40,352 - __main__ - INFO - 
============================================================
2025-06-05 11:32:40,353 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:32:40,353 - __main__ - INFO - ============================================================
2025-06-05 11:32:40,354 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:32:40,354 - __main__ - INFO - Order 9a489e88-d51e-47cf-b58d-55f6e5327b1a: stop sell -100 @ 307.09 - Status: accepted
2025-06-05 11:32:40,354 - __main__ - INFO - Order df1f88c6-e8c3-4220-a22b-68c326f05a86: market buy 100 @ MARKET - Status: filled
2025-06-05 11:32:40,354 - __main__ - INFO - Order 4373c112-5c08-495b-9cfa-847ff1f821db: limit buy 100 @ 309.31 - Status: submitted
2025-06-05 11:32:40,354 - __main__ - INFO - Order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749: limit sell -100 @ 310.24 - Status: submitted
2025-06-05 11:32:40,354 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:32:40,354 - __main__ - INFO - Stop orders: 1
2025-06-05 11:32:40,354 - __main__ - INFO - Target orders: 1
2025-06-05 11:32:40,354 - __main__ - INFO - Double down orders: 1
2025-06-05 11:32:40,355 - __main__ - INFO - 
Double down order details:
2025-06-05 11:32:40,355 - __main__ - INFO -   ID: 4373c112-5c08-495b-9cfa-847ff1f821db
2025-06-05 11:32:40,355 - __main__ - INFO -   Status: submitted
2025-06-05 11:32:40,355 - __main__ - INFO -   Limit price: 309.31
2025-06-05 11:32:40,355 - __main__ - INFO -   Quantity: 100
2025-06-05 11:32:40,355 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:32:40,355 - __main__ - INFO -   Stop: -100 @ $307.09
2025-06-05 11:32:40,355 - __main__ - INFO -   Target: -100 @ $310.24
2025-06-05 11:32:40,355 - __main__ - INFO - 
============================================================
2025-06-05 11:32:40,355 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:32:40,356 - __main__ - INFO - ============================================================
2025-06-05 11:32:40,356 - __main__ - INFO - Waiting for double down order 4373c112-5c08-495b-9cfa-847ff1f821db to fill at $309.31...
2025-06-05 11:32:40,356 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:32:40,512 - src.order.base - INFO - Order 4373c112-5c08-495b-9cfa-847ff1f821db status changed: submitted -> filled (Order fully filled)
2025-06-05 11:32:40,513 - src.order.base - INFO - Order 4373c112-5c08-495b-9cfa-847ff1f821db filled: 100.0 @ 309.31 (100.0/100)
2025-06-05 11:32:40,511 - src.tws_connection - INFO - Open Order - ID: 204, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:32:40,513 - LinkedDoubleDownFillManager - INFO - Double down order 4373c112-5c08-495b-9cfa-847ff1f821db filled for GLD - updating protective orders
2025-06-05 11:32:40,514 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:32:40,515 - LinkedDoubleDownFillManager - ERROR - Error handling double down fill: float division by zero
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\src\rule\linked_order_actions.py", line 1150, in on_order_fill
    new_avg_price = (old_value + dd_value) / abs(new_quantity)
                    ~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~
ZeroDivisionError: float division by zero
2025-06-05 11:32:40,514 - src.tws_connection - INFO - Open Order - ID: 204, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:32:45,358 - __main__ - INFO - ✅ Double down order filled at $309.31!
2025-06-05 11:32:55,373 - __main__ - INFO - 
============================================================
2025-06-05 11:32:55,374 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:32:55,375 - __main__ - INFO - ============================================================
2025-06-05 11:32:55,375 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:32:55,376 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:32:55,376 - __main__ - INFO - 
New stop order:
2025-06-05 11:32:55,377 - __main__ - INFO -   ID: 9a489e88-d51e-47cf-b58d-55f6e5327b1a
2025-06-05 11:32:55,377 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:32:55,377 - __main__ - INFO -   Stop price: $307.09 (was $307.09)
2025-06-05 11:32:55,378 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 11:32:55,378 - __main__ - INFO - 
New target order:
2025-06-05 11:32:55,378 - __main__ - INFO -   ID: 15fa5672-1fdf-4ab5-8278-a8e2d8f40749
2025-06-05 11:32:55,379 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:32:55,379 - __main__ - INFO -   Limit price: $310.24 (was $310.24)
2025-06-05 11:32:55,380 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 11:32:55,380 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:32:55,380 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:32:55,382 - __main__ - INFO -   Side: BUY
2025-06-05 11:32:55,383 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:32:55,384 - __main__ - INFO -   Target orders: 1
2025-06-05 11:32:55,384 - __main__ - INFO -   All orders: {'9a489e88-d51e-47cf-b58d-55f6e5327b1a', 'df1f88c6-e8c3-4220-a22b-68c326f05a86', '4373c112-5c08-495b-9cfa-847ff1f821db', '15fa5672-1fdf-4ab5-8278-a8e2d8f40749'}
2025-06-05 11:32:55,385 - __main__ - INFO - 
============================================================
2025-06-05 11:32:55,385 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:32:55,386 - __main__ - INFO - ============================================================
2025-06-05 11:32:55,386 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:32:55,386 - src.order.base - INFO - Order 9a489e88-d51e-47cf-b58d-55f6e5327b1a status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:32:55,388 - src.order.manager - INFO - Cancelling order 9a489e88-d51e-47cf-b58d-55f6e5327b1a with broker ID 202
2025-06-05 11:32:55,393 - src.order.manager - WARNING - Cannot cancel inactive order df1f88c6-e8c3-4220-a22b-68c326f05a86 with status filled
2025-06-05 11:32:55,393 - src.order.manager - WARNING - Cannot cancel inactive order 4373c112-5c08-495b-9cfa-847ff1f821db with status filled
2025-06-05 11:32:55,394 - src.order.base - INFO - Order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:32:55,394 - src.order.manager - INFO - Cancelling order 15fa5672-1fdf-4ab5-8278-a8e2d8f40749 with broker ID 203
2025-06-05 11:32:55,395 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:32:55,395 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:32:55,406 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:32:55,407 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:32:55,408 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:32:55,410 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:32:55,411 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:35:04,316 - __main__ - INFO - ================================================================================
2025-06-05 11:35:04,316 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:35:04,316 - __main__ - INFO - ================================================================================
2025-06-05 11:35:04,317 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:35:04,317 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:35:04,319 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:35:05,781 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:35:05,792 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:35:05,835 - src.tws_connection - INFO - ✅ Next valid order ID received: 205
2025-06-05 11:35:05,842 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:35:05,843 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:35:05,843 - src.tws_connection - INFO - ✅ Next valid order ID received: 205
2025-06-05 11:35:05,845 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:35:05,852 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:35:05,852 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:35:05,852 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:35:05,852 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:35:05,853 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:35:05,854 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:35:05,846 - src.tws_connection - INFO - ✅ Next valid order ID received: 205
2025-06-05 11:35:05,855 - __main__ - INFO - 
============================================================
2025-06-05 11:35:05,856 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:35:05,856 - __main__ - INFO - ============================================================
2025-06-05 11:35:05,856 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:35:05,856 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:35:05,856 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:35:05,856 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:35:05,856 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:35:05,857 - src.order.base - INFO - Order 401cf831-417b-44af-8dbf-902c50833f5f status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:35:05,857 - src.order.manager - INFO - Submitting order 401cf831-417b-44af-8dbf-902c50833f5f to TWS
2025-06-05 11:35:05,857 - src.order.manager - INFO - Got broker order ID 205 for order 401cf831-417b-44af-8dbf-902c50833f5f
2025-06-05 11:35:05,857 - src.order.manager - INFO - Calling placeOrder with ID 205, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:35:05,857 - src.order.manager - INFO - placeOrder called successfully for order 401cf831-417b-44af-8dbf-902c50833f5f
2025-06-05 11:35:05,857 - src.order.base - INFO - Order 401cf831-417b-44af-8dbf-902c50833f5f status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:35:05,857 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:35:05,857 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:35:05,960 - src.tws_connection - INFO - Open Order - ID: 205, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:35:05,960 - src.order.base - INFO - Order 401cf831-417b-44af-8dbf-902c50833f5f status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:35:05,993 - src.tws_connection - INFO - Open Order - ID: 205, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:35:05,994 - src.order.base - INFO - Order 401cf831-417b-44af-8dbf-902c50833f5f status changed: accepted -> filled (Order fully filled)
2025-06-05 11:35:05,994 - src.order.base - INFO - Order 401cf831-417b-44af-8dbf-902c50833f5f filled: 100.0 @ 308.98 (100.0/100)
2025-06-05 11:35:05,995 - src.tws_connection - INFO - Open Order - ID: 205, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:35:06,891 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:35:06,891 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $306.70 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:35:06,891 - src.order.base - INFO - Order 774ada82-42db-4c4c-bf03-79815418ca9e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:35:06,892 - src.order.manager - INFO - Submitting order 774ada82-42db-4c4c-bf03-79815418ca9e to TWS
2025-06-05 11:35:06,893 - src.order.manager - INFO - Got broker order ID 206 for order 774ada82-42db-4c4c-bf03-79815418ca9e
2025-06-05 11:35:06,893 - src.order.manager - INFO - Calling placeOrder with ID 206, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:35:06,894 - src.order.manager - INFO - placeOrder called successfully for order 774ada82-42db-4c4c-bf03-79815418ca9e
2025-06-05 11:35:06,894 - src.order.base - INFO - Order 774ada82-42db-4c4c-bf03-79815418ca9e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:35:06,895 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 774ada82-42db-4c4c-bf03-79815418ca9e at $306.70
2025-06-05 11:35:06,895 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:35:06,895 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $309.85 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:35:06,896 - src.order.base - INFO - Order faf19569-ba77-4231-8ea3-aa57f97566f3 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:35:06,896 - src.order.manager - INFO - Submitting order faf19569-ba77-4231-8ea3-aa57f97566f3 to TWS
2025-06-05 11:35:06,896 - src.order.manager - INFO - Got broker order ID 207 for order faf19569-ba77-4231-8ea3-aa57f97566f3
2025-06-05 11:35:06,896 - src.order.manager - INFO - Calling placeOrder with ID 207, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@309.850000 DAY
2025-06-05 11:35:06,897 - src.order.manager - INFO - placeOrder called successfully for order faf19569-ba77-4231-8ea3-aa57f97566f3
2025-06-05 11:35:06,897 - src.order.base - INFO - Order faf19569-ba77-4231-8ea3-aa57f97566f3 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:35:06,897 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit faf19569-ba77-4231-8ea3-aa57f97566f3 at $309.85
2025-06-05 11:35:06,897 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:35:06,898 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:35:06,977 - src.tws_connection - INFO - Open Order - ID: 206, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:35:06,978 - src.order.base - INFO - Order 774ada82-42db-4c4c-bf03-79815418ca9e status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:35:07,080 - src.tws_connection - INFO - Open Order - ID: 207, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:35:07,412 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['774ada82-42db-4c4c-bf03-79815418ca9e']
2025-06-05 11:35:07,412 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:35:12,432 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:35:12,432 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$309.03, stop_distance=$0.27, dd_distance=$0.03, dd_price=$309.00, original_qty=100, dd_qty=100
2025-06-05 11:35:12,433 - src.order.base - INFO - Order 8fe47b08-007f-40ca-ae10-cb16d943e534 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:35:12,433 - src.order.manager - INFO - Submitting order 8fe47b08-007f-40ca-ae10-cb16d943e534 to TWS
2025-06-05 11:35:12,433 - src.order.manager - INFO - Got broker order ID 208 for order 8fe47b08-007f-40ca-ae10-cb16d943e534
2025-06-05 11:35:12,433 - src.order.manager - INFO - Calling placeOrder with ID 208, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@309.000000 DAY
2025-06-05 11:35:12,433 - src.order.manager - INFO - placeOrder called successfully for order 8fe47b08-007f-40ca-ae10-cb16d943e534
2025-06-05 11:35:12,434 - src.order.base - INFO - Order 8fe47b08-007f-40ca-ae10-cb16d943e534 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:35:12,434 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:35:12,434 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $309.00
2025-06-05 11:35:12,434 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:35:12,434 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 401cf831-417b-44af-8dbf-902c50833f5f for GLD
2025-06-05 11:35:12,557 - src.tws_connection - INFO - Open Order - ID: 208, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:35:15,867 - __main__ - INFO - 
============================================================
2025-06-05 11:35:15,867 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:35:15,867 - __main__ - INFO - ============================================================
2025-06-05 11:35:15,867 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:35:15,867 - __main__ - INFO - Order faf19569-ba77-4231-8ea3-aa57f97566f3: limit sell -100 @ 309.85 - Status: submitted
2025-06-05 11:35:15,867 - __main__ - INFO - Order 774ada82-42db-4c4c-bf03-79815418ca9e: stop sell -100 @ 306.7 - Status: accepted
2025-06-05 11:35:15,867 - __main__ - INFO - Order 8fe47b08-007f-40ca-ae10-cb16d943e534: limit buy 100 @ 309.0 - Status: submitted
2025-06-05 11:35:15,867 - __main__ - INFO - Order 401cf831-417b-44af-8dbf-902c50833f5f: market buy 100 @ MARKET - Status: filled
2025-06-05 11:35:15,867 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:35:15,867 - __main__ - INFO - Stop orders: 1
2025-06-05 11:35:15,868 - __main__ - INFO - Target orders: 1
2025-06-05 11:35:15,868 - __main__ - INFO - Double down orders: 1
2025-06-05 11:35:15,868 - __main__ - INFO - 
Double down order details:
2025-06-05 11:35:15,868 - __main__ - INFO -   ID: 8fe47b08-007f-40ca-ae10-cb16d943e534
2025-06-05 11:35:15,868 - __main__ - INFO -   Status: submitted
2025-06-05 11:35:15,868 - __main__ - INFO -   Limit price: 309.0
2025-06-05 11:35:15,868 - __main__ - INFO -   Quantity: 100
2025-06-05 11:35:15,868 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:35:15,868 - __main__ - INFO -   Stop: -100 @ $306.7
2025-06-05 11:35:15,868 - __main__ - INFO -   Target: -100 @ $309.85
2025-06-05 11:35:15,868 - __main__ - INFO - 
============================================================
2025-06-05 11:35:15,868 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:35:15,868 - __main__ - INFO - ============================================================
2025-06-05 11:35:15,868 - __main__ - INFO - Waiting for double down order 8fe47b08-007f-40ca-ae10-cb16d943e534 to fill at $309.0...
2025-06-05 11:35:15,868 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:35:20,879 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:35:25,883 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:35:30,890 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:35:35,896 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:35:40,901 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:35:46,063 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:35:51,070 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:35:56,084 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:36:01,096 - __main__ - INFO - Waiting... (45s elapsed, order status: submitted)
2025-06-05 11:36:06,114 - __main__ - INFO - Waiting... (50s elapsed, order status: submitted)
2025-06-05 11:36:11,122 - __main__ - INFO - Waiting... (55s elapsed, order status: submitted)
2025-06-05 11:36:16,230 - __main__ - INFO - Waiting... (60s elapsed, order status: submitted)
2025-06-05 11:36:21,239 - __main__ - INFO - Waiting... (65s elapsed, order status: submitted)
2025-06-05 11:36:23,996 - src.order.base - INFO - Order 8fe47b08-007f-40ca-ae10-cb16d943e534 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:36:23,996 - src.order.base - INFO - Order 8fe47b08-007f-40ca-ae10-cb16d943e534 filled: 100.0 @ 309.0 (100.0/100)
2025-06-05 11:36:23,997 - LinkedDoubleDownFillManager - INFO - Double down order 8fe47b08-007f-40ca-ae10-cb16d943e534 filled for GLD - updating protective orders
2025-06-05 11:36:23,997 - src.tws_connection - INFO - Open Order - ID: 208, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:36:23,998 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:36:23,998 - LinkedDoubleDownFillManager - INFO - [DD FILL DEBUG] old_quantity=0.0, dd_quantity=0.0, new_quantity=0.0
2025-06-05 11:36:23,998 - LinkedDoubleDownFillManager - ERROR - Error handling double down fill: float division by zero
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\src\rule\linked_order_actions.py", line 1152, in on_order_fill
    new_avg_price = (old_value + dd_value) / abs(new_quantity)
                    ~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~
ZeroDivisionError: float division by zero
2025-06-05 11:36:24,001 - src.tws_connection - INFO - Open Order - ID: 208, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:36:26,264 - __main__ - INFO - ✅ Double down order filled at $309.0!
2025-06-05 11:36:36,391 - __main__ - INFO - 
============================================================
2025-06-05 11:36:36,391 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:36:36,391 - __main__ - INFO - ============================================================
2025-06-05 11:36:36,391 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:36:36,391 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:36:36,391 - __main__ - INFO - 
New stop order:
2025-06-05 11:36:36,391 - __main__ - INFO -   ID: 774ada82-42db-4c4c-bf03-79815418ca9e
2025-06-05 11:36:36,391 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:36:36,391 - __main__ - INFO -   Stop price: $306.7 (was $306.7)
2025-06-05 11:36:36,391 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 11:36:36,391 - __main__ - INFO - 
New target order:
2025-06-05 11:36:36,392 - __main__ - INFO -   ID: faf19569-ba77-4231-8ea3-aa57f97566f3
2025-06-05 11:36:36,392 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:36:36,392 - __main__ - INFO -   Limit price: $309.85 (was $309.85)
2025-06-05 11:36:36,392 - __main__ - ERROR - ❌ Target order quantity not updated correctly: expected -200, got -100
2025-06-05 11:36:36,392 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:36:36,392 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:36:36,392 - __main__ - INFO -   Side: BUY
2025-06-05 11:36:36,392 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:36:36,392 - __main__ - INFO -   Target orders: 1
2025-06-05 11:36:36,393 - __main__ - INFO -   All orders: {'faf19569-ba77-4231-8ea3-aa57f97566f3', '774ada82-42db-4c4c-bf03-79815418ca9e', '8fe47b08-007f-40ca-ae10-cb16d943e534', '401cf831-417b-44af-8dbf-902c50833f5f'}
2025-06-05 11:36:36,393 - __main__ - INFO - 
============================================================
2025-06-05 11:36:36,393 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:36:36,393 - __main__ - INFO - ============================================================
2025-06-05 11:36:36,393 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:36:36,393 - src.order.base - INFO - Order faf19569-ba77-4231-8ea3-aa57f97566f3 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:36:36,393 - src.order.manager - INFO - Cancelling order faf19569-ba77-4231-8ea3-aa57f97566f3 with broker ID 207
2025-06-05 11:36:36,394 - src.order.base - INFO - Order 774ada82-42db-4c4c-bf03-79815418ca9e status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:36:36,394 - src.order.manager - INFO - Cancelling order 774ada82-42db-4c4c-bf03-79815418ca9e with broker ID 206
2025-06-05 11:36:36,394 - src.order.manager - WARNING - Cannot cancel inactive order 8fe47b08-007f-40ca-ae10-cb16d943e534 with status filled
2025-06-05 11:36:36,394 - src.order.manager - WARNING - Cannot cancel inactive order 401cf831-417b-44af-8dbf-902c50833f5f with status filled
2025-06-05 11:36:36,394 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:36:36,394 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:36:36,432 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:36:36,433 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:36:36,433 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:36:36,469 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:36:36,800 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:36:36,873 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 11:36:36,873 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:37:30,782 - __main__ - INFO - ================================================================================
2025-06-05 11:37:30,782 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:37:30,782 - __main__ - INFO - ================================================================================
2025-06-05 11:37:30,783 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:37:30,783 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:37:30,784 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:37:32,395 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:37:32,395 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:37:32,478 - src.tws_connection - INFO - ✅ Next valid order ID received: 209
2025-06-05 11:37:32,481 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:37:32,482 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:37:32,483 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:37:32,484 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:37:32,485 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:37:32,485 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:37:32,485 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:37:32,486 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:37:32,486 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:37:32,486 - __main__ - INFO - 
============================================================
2025-06-05 11:37:32,486 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:37:32,487 - __main__ - INFO - ============================================================
2025-06-05 11:37:32,487 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:37:32,488 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:37:32,488 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:37:32,488 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:37:32,488 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:37:32,489 - src.order.base - INFO - Order f22f4410-7acd-4f50-9225-6ae67eb1c021 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:37:32,489 - src.order.manager - INFO - Submitting order f22f4410-7acd-4f50-9225-6ae67eb1c021 to TWS
2025-06-05 11:37:32,489 - src.order.manager - INFO - Got broker order ID 209 for order f22f4410-7acd-4f50-9225-6ae67eb1c021
2025-06-05 11:37:32,489 - src.order.manager - INFO - Calling placeOrder with ID 209, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:37:32,490 - src.order.manager - INFO - placeOrder called successfully for order f22f4410-7acd-4f50-9225-6ae67eb1c021
2025-06-05 11:37:32,490 - src.order.base - INFO - Order f22f4410-7acd-4f50-9225-6ae67eb1c021 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:37:32,490 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:37:32,491 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:37:32,596 - src.tws_connection - INFO - ✅ Next valid order ID received: 209
2025-06-05 11:37:32,615 - src.tws_connection - INFO - ✅ Next valid order ID received: 209
2025-06-05 11:37:32,804 - src.tws_connection - INFO - Open Order - ID: 209, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:37:32,806 - src.order.base - INFO - Order f22f4410-7acd-4f50-9225-6ae67eb1c021 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:37:32,808 - src.order.base - INFO - Order f22f4410-7acd-4f50-9225-6ae67eb1c021 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:37:32,808 - src.tws_connection - INFO - Open Order - ID: 209, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:37:32,809 - src.order.base - INFO - Order f22f4410-7acd-4f50-9225-6ae67eb1c021 filled: 100.0 @ 309.09 (100.0/100)
2025-06-05 11:37:32,810 - src.tws_connection - INFO - Open Order - ID: 209, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:37:33,544 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:37:33,545 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $306.77 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:37:33,545 - src.order.base - INFO - Order dcd878e5-7137-409d-9220-47e227bb1ed6 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:37:33,545 - src.order.manager - INFO - Submitting order dcd878e5-7137-409d-9220-47e227bb1ed6 to TWS
2025-06-05 11:37:33,546 - src.order.manager - INFO - Got broker order ID 209 for order dcd878e5-7137-409d-9220-47e227bb1ed6
2025-06-05 11:37:33,546 - src.order.manager - INFO - Calling placeOrder with ID 209, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:37:33,547 - src.order.manager - INFO - placeOrder called successfully for order dcd878e5-7137-409d-9220-47e227bb1ed6
2025-06-05 11:37:33,548 - src.order.base - INFO - Order dcd878e5-7137-409d-9220-47e227bb1ed6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:37:33,549 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss dcd878e5-7137-409d-9220-47e227bb1ed6 at $306.77
2025-06-05 11:37:33,549 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:37:33,549 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 209)
2025-06-05 11:37:33,550 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $309.92 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:37:33,550 - src.order.base - INFO - Order 810712e7-16b6-4248-a47c-416136bd4a84 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:37:33,551 - src.order.manager - INFO - Submitting order 810712e7-16b6-4248-a47c-416136bd4a84 to TWS
2025-06-05 11:37:33,551 - src.order.manager - INFO - Got broker order ID 210 for order 810712e7-16b6-4248-a47c-416136bd4a84
2025-06-05 11:37:33,551 - src.order.manager - INFO - Calling placeOrder with ID 210, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@309.920000 DAY
2025-06-05 11:37:33,552 - src.order.manager - INFO - placeOrder called successfully for order 810712e7-16b6-4248-a47c-416136bd4a84
2025-06-05 11:37:33,552 - src.order.base - INFO - Order 810712e7-16b6-4248-a47c-416136bd4a84 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:37:33,552 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 810712e7-16b6-4248-a47c-416136bd4a84 at $309.92
2025-06-05 11:37:33,553 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:37:33,553 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:37:33,892 - src.tws_connection - INFO - Open Order - ID: 210, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:37:34,067 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['dcd878e5-7137-409d-9220-47e227bb1ed6']
2025-06-05 11:37:34,067 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:37:39,086 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:37:39,087 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$308.87, stop_distance=$0.27, dd_distance=$0.03, dd_price=$308.84, original_qty=100, dd_qty=100
2025-06-05 11:37:39,087 - src.order.base - INFO - Order be717b4f-24fe-4e86-b949-2321b8a62443 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:37:39,088 - src.order.manager - INFO - Submitting order be717b4f-24fe-4e86-b949-2321b8a62443 to TWS
2025-06-05 11:37:39,088 - src.order.manager - INFO - Got broker order ID 211 for order be717b4f-24fe-4e86-b949-2321b8a62443
2025-06-05 11:37:39,088 - src.order.manager - INFO - Calling placeOrder with ID 211, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@308.840000 DAY
2025-06-05 11:37:39,090 - src.order.manager - INFO - placeOrder called successfully for order be717b4f-24fe-4e86-b949-2321b8a62443
2025-06-05 11:37:39,092 - src.order.base - INFO - Order be717b4f-24fe-4e86-b949-2321b8a62443 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:37:39,095 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:37:39,095 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $308.84
2025-06-05 11:37:39,096 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:37:39,096 - src.rule.linked_order_actions - INFO - Created and linked BUY main order f22f4410-7acd-4f50-9225-6ae67eb1c021 for GLD
2025-06-05 11:37:39,240 - src.tws_connection - INFO - Open Order - ID: 211, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:37:42,502 - __main__ - INFO - 
============================================================
2025-06-05 11:37:42,503 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:37:42,503 - __main__ - INFO - ============================================================
2025-06-05 11:37:42,504 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:37:42,504 - __main__ - INFO - Order dcd878e5-7137-409d-9220-47e227bb1ed6: stop sell -100 @ 306.77 - Status: submitted
2025-06-05 11:37:42,504 - __main__ - INFO - Order f22f4410-7acd-4f50-9225-6ae67eb1c021: market buy 100 @ MARKET - Status: filled
2025-06-05 11:37:42,505 - __main__ - INFO - Order be717b4f-24fe-4e86-b949-2321b8a62443: limit buy 100 @ 308.84 - Status: submitted
2025-06-05 11:37:42,505 - __main__ - INFO - Order 810712e7-16b6-4248-a47c-416136bd4a84: limit sell -100 @ 309.92 - Status: submitted
2025-06-05 11:37:42,505 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:37:42,506 - __main__ - INFO - Stop orders: 1
2025-06-05 11:37:42,506 - __main__ - INFO - Target orders: 1
2025-06-05 11:37:42,506 - __main__ - INFO - Double down orders: 1
2025-06-05 11:37:42,506 - __main__ - INFO - 
Double down order details:
2025-06-05 11:37:42,506 - __main__ - INFO -   ID: be717b4f-24fe-4e86-b949-2321b8a62443
2025-06-05 11:37:42,507 - __main__ - INFO -   Status: submitted
2025-06-05 11:37:42,507 - __main__ - INFO -   Limit price: 308.84
2025-06-05 11:37:42,507 - __main__ - INFO -   Quantity: 100
2025-06-05 11:37:42,507 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:37:42,508 - __main__ - INFO -   Stop: -100 @ $306.77
2025-06-05 11:37:42,508 - __main__ - INFO -   Target: -100 @ $309.92
2025-06-05 11:37:42,508 - __main__ - INFO - 
============================================================
2025-06-05 11:37:42,508 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:37:42,509 - __main__ - INFO - ============================================================
2025-06-05 11:37:42,547 - __main__ - INFO - Waiting for double down order be717b4f-24fe-4e86-b949-2321b8a62443 to fill at $308.84...
2025-06-05 11:37:42,547 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:37:47,559 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:37:52,574 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:37:57,590 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:38:02,599 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:38:07,608 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:38:12,623 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:38:17,630 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:38:22,596 - src.order.base - INFO - Order be717b4f-24fe-4e86-b949-2321b8a62443 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:38:22,596 - src.tws_connection - INFO - Open Order - ID: 211, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:38:22,597 - src.order.base - INFO - Order be717b4f-24fe-4e86-b949-2321b8a62443 filled: 100.0 @ 308.84 (100.0/100)
2025-06-05 11:38:22,598 - LinkedDoubleDownFillManager - INFO - Double down order be717b4f-24fe-4e86-b949-2321b8a62443 filled for GLD - updating protective orders
2025-06-05 11:38:22,598 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:38:22,598 - LinkedDoubleDownFillManager - INFO - [DD FILL DEBUG] old_quantity=100.0, dd_quantity=100.0, new_quantity=200.0
2025-06-05 11:38:22,602 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:38:22,602 - src.order.base - INFO - Order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:38:22,603 - src.order.manager - INFO - Submitting order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 to TWS
2025-06-05 11:38:22,603 - src.order.manager - INFO - Got broker order ID 212 for order 16bc8bb2-56da-4e32-aa41-43ee7618ce02
2025-06-05 11:38:22,603 - src.order.manager - INFO - Calling placeOrder with ID 212, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 200@0.000000 DAY
2025-06-05 11:38:22,603 - src.order.manager - INFO - placeOrder called successfully for order 16bc8bb2-56da-4e32-aa41-43ee7618ce02
2025-06-05 11:38:22,609 - src.order.base - INFO - Order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:38:22,610 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:38:22,610 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:38:22,610 - LinkedDoubleDownFillManager - INFO - Created updated stop order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 for GLD at $308.57 for -200.0 shares
2025-06-05 11:38:22,613 - src.order.base - INFO - Order 34093ff2-653a-4296-88ca-8e57aad50d75 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:38:22,613 - src.order.manager - INFO - Submitting order 34093ff2-653a-4296-88ca-8e57aad50d75 to TWS
2025-06-05 11:38:22,615 - src.order.manager - INFO - Got broker order ID 213 for order 34093ff2-653a-4296-88ca-8e57aad50d75
2025-06-05 11:38:22,615 - src.order.manager - INFO - Calling placeOrder with ID 213, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 200@309.740000 DAY
2025-06-05 11:38:22,616 - src.order.manager - INFO - placeOrder called successfully for order 34093ff2-653a-4296-88ca-8e57aad50d75
2025-06-05 11:38:22,616 - src.order.base - INFO - Order 34093ff2-653a-4296-88ca-8e57aad50d75 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:38:22,616 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:38:22,616 - LinkedDoubleDownFillManager - INFO - Created updated target order 34093ff2-653a-4296-88ca-8e57aad50d75 for GLD at $309.74 for -200.0 shares
2025-06-05 11:38:22,616 - LinkedDoubleDownFillManager - INFO - Updated protective orders for GLD: New quantity=200.0, New avg=$308.84
2025-06-05 11:38:22,624 - src.tws_connection - INFO - Open Order - ID: 211, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:38:22,646 - __main__ - INFO - ✅ Double down order filled at $308.84!
2025-06-05 11:38:22,692 - src.tws_connection - INFO - Open Order - ID: 212, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:38:22,692 - src.order.base - INFO - Order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:38:22,817 - src.tws_connection - INFO - Open Order - ID: 213, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:38:32,655 - __main__ - INFO - 
============================================================
2025-06-05 11:38:32,657 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:38:32,658 - __main__ - INFO - ============================================================
2025-06-05 11:38:32,658 - __main__ - INFO - Active stop orders after double down: 2
2025-06-05 11:38:32,659 - __main__ - INFO - Active target orders after double down: 2
2025-06-05 11:38:32,659 - __main__ - INFO - 
New stop order:
2025-06-05 11:38:32,659 - __main__ - INFO -   ID: dcd878e5-7137-409d-9220-47e227bb1ed6
2025-06-05 11:38:32,660 - __main__ - INFO -   Quantity: -100 (was -100)
2025-06-05 11:38:32,660 - __main__ - INFO -   Stop price: $306.77 (was $306.77)
2025-06-05 11:38:32,661 - __main__ - ERROR - ❌ Stop order quantity not updated correctly: expected -200, got -100
2025-06-05 11:38:32,661 - __main__ - INFO - 
New target order:
2025-06-05 11:38:32,664 - __main__ - INFO -   ID: 34093ff2-653a-4296-88ca-8e57aad50d75
2025-06-05 11:38:32,665 - __main__ - INFO -   Quantity: -200.0 (was -100)
2025-06-05 11:38:32,667 - __main__ - INFO -   Limit price: $309.74 (was $309.92)
2025-06-05 11:38:32,673 - __main__ - INFO - ✅ Target order quantity correctly updated!
2025-06-05 11:38:32,673 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:38:32,674 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:38:32,674 - __main__ - INFO -   Side: BUY
2025-06-05 11:38:32,674 - __main__ - INFO -   Stop orders: 2
2025-06-05 11:38:32,675 - __main__ - INFO -   Target orders: 2
2025-06-05 11:38:32,675 - __main__ - INFO -   All orders: {'dcd878e5-7137-409d-9220-47e227bb1ed6', 'f22f4410-7acd-4f50-9225-6ae67eb1c021', '16bc8bb2-56da-4e32-aa41-43ee7618ce02', '34093ff2-653a-4296-88ca-8e57aad50d75', 'be717b4f-24fe-4e86-b949-2321b8a62443', '810712e7-16b6-4248-a47c-416136bd4a84'}
2025-06-05 11:38:32,676 - __main__ - INFO - 
============================================================
2025-06-05 11:38:32,676 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:38:32,677 - __main__ - INFO - ============================================================
2025-06-05 11:38:32,677 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:38:32,678 - src.order.manager - WARNING - Cannot cancel inactive order f22f4410-7acd-4f50-9225-6ae67eb1c021 with status filled
2025-06-05 11:38:32,680 - src.order.manager - WARNING - Cannot cancel inactive order be717b4f-24fe-4e86-b949-2321b8a62443 with status filled
2025-06-05 11:38:32,680 - src.order.base - INFO - Order 34093ff2-653a-4296-88ca-8e57aad50d75 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:38:32,680 - src.order.manager - INFO - Cancelling order 34093ff2-653a-4296-88ca-8e57aad50d75 with broker ID 213
2025-06-05 11:38:32,681 - src.order.base - INFO - Order dcd878e5-7137-409d-9220-47e227bb1ed6 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:38:32,681 - src.order.manager - INFO - Cancelling order dcd878e5-7137-409d-9220-47e227bb1ed6 with broker ID 209
2025-06-05 11:38:32,681 - src.order.base - INFO - Order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:38:32,682 - src.order.manager - INFO - Cancelling order 16bc8bb2-56da-4e32-aa41-43ee7618ce02 with broker ID 212
2025-06-05 11:38:32,682 - src.order.base - INFO - Order 810712e7-16b6-4248-a47c-416136bd4a84 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:38:32,682 - src.order.manager - INFO - Cancelling order 810712e7-16b6-4248-a47c-416136bd4a84 with broker ID 210
2025-06-05 11:38:32,683 - __main__ - INFO - Cancelled 4 orders
2025-06-05 11:38:32,684 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:38:32,684 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:38:32,685 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:38:32,691 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:38:32,693 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:38:32,694 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:39:14,624 - __main__ - INFO - ================================================================================
2025-06-05 11:39:14,690 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:39:14,691 - __main__ - INFO - ================================================================================
2025-06-05 11:39:14,693 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:39:14,693 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:39:14,694 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:39:15,857 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:39:15,858 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:39:15,920 - src.tws_connection - INFO - ✅ Next valid order ID received: 214
2025-06-05 11:39:15,921 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:39:15,921 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:39:15,921 - src.tws_connection - INFO - ✅ Next valid order ID received: 214
2025-06-05 11:39:15,923 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:39:15,923 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:39:15,923 - src.tws_connection - INFO - ✅ Next valid order ID received: 214
2025-06-05 11:39:15,924 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:39:15,924 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:39:15,925 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:39:15,925 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:39:15,926 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:39:15,926 - __main__ - INFO - 
============================================================
2025-06-05 11:39:15,926 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:39:15,926 - __main__ - INFO - ============================================================
2025-06-05 11:39:15,927 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:39:15,927 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:39:15,928 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:39:15,928 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:39:15,928 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:39:15,928 - src.order.base - INFO - Order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:39:15,928 - src.order.manager - INFO - Submitting order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 to TWS
2025-06-05 11:39:15,929 - src.order.manager - INFO - Got broker order ID 214 for order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2
2025-06-05 11:39:15,929 - src.order.manager - INFO - Calling placeOrder with ID 214, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:39:15,929 - src.order.manager - INFO - placeOrder called successfully for order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2
2025-06-05 11:39:15,929 - src.order.base - INFO - Order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:39:15,930 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:39:15,930 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:39:16,039 - src.tws_connection - INFO - Open Order - ID: 214, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:39:16,040 - src.order.base - INFO - Order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:39:16,066 - src.order.base - INFO - Order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:39:16,065 - src.tws_connection - INFO - Open Order - ID: 214, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:39:16,066 - src.order.base - INFO - Order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 filled: 100.0 @ 308.89 (100.0/100)
2025-06-05 11:39:16,067 - src.tws_connection - INFO - Open Order - ID: 214, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:39:16,941 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:39:16,941 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $306.65 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:39:16,941 - src.order.base - INFO - Order f79ba8a5-9700-44c1-9394-dea7c349c464 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:39:16,942 - src.order.manager - INFO - Submitting order f79ba8a5-9700-44c1-9394-dea7c349c464 to TWS
2025-06-05 11:39:16,942 - src.order.manager - INFO - Got broker order ID 215 for order f79ba8a5-9700-44c1-9394-dea7c349c464
2025-06-05 11:39:16,942 - src.order.manager - INFO - Calling placeOrder with ID 215, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:39:16,943 - src.order.manager - INFO - placeOrder called successfully for order f79ba8a5-9700-44c1-9394-dea7c349c464
2025-06-05 11:39:16,943 - src.order.base - INFO - Order f79ba8a5-9700-44c1-9394-dea7c349c464 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:39:16,943 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss f79ba8a5-9700-44c1-9394-dea7c349c464 at $306.65
2025-06-05 11:39:16,943 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:39:16,945 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $309.80 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:39:16,945 - src.order.base - INFO - Order d605414b-3dc4-46fe-9c76-eb1107fd82a6 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:39:16,946 - src.order.manager - INFO - Submitting order d605414b-3dc4-46fe-9c76-eb1107fd82a6 to TWS
2025-06-05 11:39:16,946 - src.order.manager - INFO - Got broker order ID 216 for order d605414b-3dc4-46fe-9c76-eb1107fd82a6
2025-06-05 11:39:16,960 - src.order.manager - INFO - Calling placeOrder with ID 216, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@309.800000 DAY
2025-06-05 11:39:16,966 - src.order.manager - INFO - placeOrder called successfully for order d605414b-3dc4-46fe-9c76-eb1107fd82a6
2025-06-05 11:39:16,967 - src.order.base - INFO - Order d605414b-3dc4-46fe-9c76-eb1107fd82a6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:39:16,967 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit d605414b-3dc4-46fe-9c76-eb1107fd82a6 at $309.80
2025-06-05 11:39:16,968 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:39:16,968 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:39:17,021 - src.tws_connection - INFO - Open Order - ID: 215, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:39:17,023 - src.order.base - INFO - Order f79ba8a5-9700-44c1-9394-dea7c349c464 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:39:17,071 - src.tws_connection - INFO - Open Order - ID: 216, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:39:17,477 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['f79ba8a5-9700-44c1-9394-dea7c349c464']
2025-06-05 11:39:17,478 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:39:22,521 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:39:22,522 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$308.94, stop_distance=$0.27, dd_distance=$0.03, dd_price=$308.91, original_qty=100, dd_qty=100
2025-06-05 11:39:22,522 - src.order.base - INFO - Order 35b7f161-3e77-49f8-a145-30c8be724fae status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:39:22,523 - src.order.manager - INFO - Submitting order 35b7f161-3e77-49f8-a145-30c8be724fae to TWS
2025-06-05 11:39:22,523 - src.order.manager - INFO - Got broker order ID 217 for order 35b7f161-3e77-49f8-a145-30c8be724fae
2025-06-05 11:39:22,524 - src.order.manager - INFO - Calling placeOrder with ID 217, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@308.910000 DAY
2025-06-05 11:39:22,525 - src.order.manager - INFO - placeOrder called successfully for order 35b7f161-3e77-49f8-a145-30c8be724fae
2025-06-05 11:39:22,526 - src.order.base - INFO - Order 35b7f161-3e77-49f8-a145-30c8be724fae status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:39:22,528 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:39:22,528 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $308.91
2025-06-05 11:39:22,529 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:39:22,529 - src.rule.linked_order_actions - INFO - Created and linked BUY main order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 for GLD
2025-06-05 11:39:22,613 - src.tws_connection - INFO - Open Order - ID: 217, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:39:24,516 - src.order.base - INFO - Order 35b7f161-3e77-49f8-a145-30c8be724fae status changed: submitted -> filled (Order fully filled)
2025-06-05 11:39:24,516 - src.tws_connection - INFO - Open Order - ID: 217, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:39:24,526 - src.order.base - INFO - Order 35b7f161-3e77-49f8-a145-30c8be724fae filled: 100.0 @ 308.91 (100.0/100)
2025-06-05 11:39:24,527 - LinkedDoubleDownFillManager - INFO - Double down order 35b7f161-3e77-49f8-a145-30c8be724fae filled for GLD - updating protective orders
2025-06-05 11:39:24,528 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:39:24,528 - LinkedDoubleDownFillManager - INFO - [DD FILL DEBUG] old_quantity=100.0, dd_quantity=100.0, new_quantity=200.0
2025-06-05 11:39:24,533 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:39:24,536 - src.order.base - INFO - Order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:39:24,537 - src.order.manager - INFO - Submitting order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 to TWS
2025-06-05 11:39:24,538 - src.order.manager - INFO - Got broker order ID 218 for order 920aa4c3-fe6a-411f-b0e1-f87a48265b13
2025-06-05 11:39:24,538 - src.order.manager - INFO - Calling placeOrder with ID 218, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 200@0.000000 DAY
2025-06-05 11:39:24,538 - src.order.manager - INFO - placeOrder called successfully for order 920aa4c3-fe6a-411f-b0e1-f87a48265b13
2025-06-05 11:39:24,539 - src.order.base - INFO - Order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:39:24,539 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:39:24,541 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:39:24,542 - LinkedDoubleDownFillManager - INFO - Created updated stop order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 for GLD at $308.64 for -200.0 shares
2025-06-05 11:39:24,544 - src.order.base - INFO - Order 197ef69d-89ed-4503-844c-022075f367ad status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:39:24,544 - src.order.manager - INFO - Submitting order 197ef69d-89ed-4503-844c-022075f367ad to TWS
2025-06-05 11:39:24,545 - src.order.manager - INFO - Got broker order ID 219 for order 197ef69d-89ed-4503-844c-022075f367ad
2025-06-05 11:39:24,545 - src.order.manager - INFO - Calling placeOrder with ID 219, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 200@309.810000 DAY
2025-06-05 11:39:24,545 - src.order.manager - INFO - placeOrder called successfully for order 197ef69d-89ed-4503-844c-022075f367ad
2025-06-05 11:39:24,549 - src.order.base - INFO - Order 197ef69d-89ed-4503-844c-022075f367ad status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:39:24,550 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:39:24,550 - LinkedDoubleDownFillManager - INFO - Created updated target order 197ef69d-89ed-4503-844c-022075f367ad for GLD at $309.81 for -200.0 shares
2025-06-05 11:39:24,551 - LinkedDoubleDownFillManager - INFO - Updated protective orders for GLD: New quantity=200.0, New avg=$308.91
2025-06-05 11:39:24,556 - src.tws_connection - INFO - Open Order - ID: 217, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:39:24,622 - src.tws_connection - INFO - Open Order - ID: 218, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:39:24,624 - src.order.base - INFO - Order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:39:24,671 - src.tws_connection - INFO - Open Order - ID: 219, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:39:25,928 - __main__ - INFO - 
============================================================
2025-06-05 11:39:25,929 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:39:25,937 - __main__ - INFO - ============================================================
2025-06-05 11:39:25,938 - __main__ - INFO - Found 6 orders for GLD
2025-06-05 11:39:25,938 - __main__ - INFO - Order 35b7f161-3e77-49f8-a145-30c8be724fae: limit buy 100 @ 308.91 - Status: filled
2025-06-05 11:39:25,939 - __main__ - INFO - Order f79ba8a5-9700-44c1-9394-dea7c349c464: stop sell -100 @ 306.65 - Status: accepted
2025-06-05 11:39:25,939 - __main__ - INFO - Order d605414b-3dc4-46fe-9c76-eb1107fd82a6: limit sell -100 @ 309.8 - Status: submitted
2025-06-05 11:39:25,940 - __main__ - INFO - Order 197ef69d-89ed-4503-844c-022075f367ad: limit sell -200.0 @ 309.81 - Status: submitted
2025-06-05 11:39:26,007 - __main__ - INFO - Order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2: market buy 100 @ MARKET - Status: filled
2025-06-05 11:39:26,008 - __main__ - INFO - Order 920aa4c3-fe6a-411f-b0e1-f87a48265b13: stop sell -200.0 @ 308.64 - Status: accepted
2025-06-05 11:39:26,008 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:39:26,009 - __main__ - INFO - Stop orders: 2
2025-06-05 11:39:26,009 - __main__ - INFO - Target orders: 2
2025-06-05 11:39:26,010 - __main__ - INFO - Double down orders: 0
2025-06-05 11:39:26,010 - __main__ - ERROR - ❌ No double down orders found!
2025-06-05 11:39:26,010 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:39:26,011 - src.order.manager - WARNING - Cannot cancel inactive order 35b7f161-3e77-49f8-a145-30c8be724fae with status filled
2025-06-05 11:39:26,011 - src.order.base - INFO - Order f79ba8a5-9700-44c1-9394-dea7c349c464 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:39:26,012 - src.order.manager - INFO - Cancelling order f79ba8a5-9700-44c1-9394-dea7c349c464 with broker ID 215
2025-06-05 11:39:26,017 - src.order.base - INFO - Order d605414b-3dc4-46fe-9c76-eb1107fd82a6 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:39:26,017 - src.order.manager - INFO - Cancelling order d605414b-3dc4-46fe-9c76-eb1107fd82a6 with broker ID 216
2025-06-05 11:39:26,020 - src.order.base - INFO - Order 197ef69d-89ed-4503-844c-022075f367ad status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:39:26,027 - src.order.manager - INFO - Cancelling order 197ef69d-89ed-4503-844c-022075f367ad with broker ID 219
2025-06-05 11:39:26,029 - src.order.manager - WARNING - Cannot cancel inactive order ea7c1789-54d9-4f9a-96ca-cb2e406f0af2 with status filled
2025-06-05 11:39:26,029 - src.order.base - INFO - Order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:39:26,055 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 215)
2025-06-05 11:39:26,060 - src.order.manager - INFO - Cancelling order 920aa4c3-fe6a-411f-b0e1-f87a48265b13 with broker ID 218
2025-06-05 11:39:26,060 - __main__ - INFO - Cancelled 4 orders
2025-06-05 11:39:26,061 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:39:26,062 - src.order.base - INFO - Order f79ba8a5-9700-44c1-9394-dea7c349c464 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:39:26,062 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:39:26,062 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:39:26,068 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:39:26,074 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:39:26,077 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:40:16,185 - __main__ - INFO - ================================================================================
2025-06-05 11:40:16,185 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:40:16,185 - __main__ - INFO - ================================================================================
2025-06-05 11:40:16,186 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:40:16,186 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:40:16,187 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:40:18,291 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:40:18,292 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:40:18,327 - src.tws_connection - INFO - ✅ Next valid order ID received: 220
2025-06-05 11:40:18,328 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:40:18,329 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:40:18,330 - src.tws_connection - INFO - ✅ Next valid order ID received: 220
2025-06-05 11:40:18,331 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:40:18,331 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:40:18,331 - src.tws_connection - INFO - ✅ Next valid order ID received: 220
2025-06-05 11:40:18,332 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:40:18,332 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:40:18,333 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:40:18,333 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:40:18,334 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:40:18,334 - __main__ - INFO - 
============================================================
2025-06-05 11:40:18,335 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:40:18,335 - __main__ - INFO - ============================================================
2025-06-05 11:40:18,336 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:40:18,336 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:40:18,336 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:40:18,337 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:40:18,337 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:40:18,337 - src.order.base - INFO - Order 76229754-3cdf-41df-9500-2c034ccc294d status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:40:18,338 - src.order.manager - INFO - Submitting order 76229754-3cdf-41df-9500-2c034ccc294d to TWS
2025-06-05 11:40:18,338 - src.order.manager - INFO - Got broker order ID 220 for order 76229754-3cdf-41df-9500-2c034ccc294d
2025-06-05 11:40:18,338 - src.order.manager - INFO - Calling placeOrder with ID 220, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:40:18,339 - src.order.manager - INFO - placeOrder called successfully for order 76229754-3cdf-41df-9500-2c034ccc294d
2025-06-05 11:40:18,339 - src.order.base - INFO - Order 76229754-3cdf-41df-9500-2c034ccc294d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:40:18,339 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:40:18,340 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:40:18,501 - src.tws_connection - INFO - Open Order - ID: 220, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:40:18,502 - src.order.base - INFO - Order 76229754-3cdf-41df-9500-2c034ccc294d status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:40:18,506 - src.order.base - INFO - Order 76229754-3cdf-41df-9500-2c034ccc294d status changed: accepted -> filled (Order fully filled)
2025-06-05 11:40:18,506 - src.tws_connection - INFO - Open Order - ID: 220, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:40:18,507 - src.order.base - INFO - Order 76229754-3cdf-41df-9500-2c034ccc294d filled: 100.0 @ 308.6 (100.0/100)
2025-06-05 11:40:18,508 - src.tws_connection - INFO - Open Order - ID: 220, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:40:19,354 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:40:19,354 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $306.39 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:40:19,355 - src.order.base - INFO - Order c2213619-dbda-4f38-aafe-0acf4da1f6a9 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:40:19,356 - src.order.manager - INFO - Submitting order c2213619-dbda-4f38-aafe-0acf4da1f6a9 to TWS
2025-06-05 11:40:19,356 - src.order.manager - INFO - Got broker order ID 221 for order c2213619-dbda-4f38-aafe-0acf4da1f6a9
2025-06-05 11:40:19,356 - src.order.manager - INFO - Calling placeOrder with ID 221, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:40:19,357 - src.order.manager - INFO - placeOrder called successfully for order c2213619-dbda-4f38-aafe-0acf4da1f6a9
2025-06-05 11:40:19,358 - src.order.base - INFO - Order c2213619-dbda-4f38-aafe-0acf4da1f6a9 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:40:19,361 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss c2213619-dbda-4f38-aafe-0acf4da1f6a9 at $306.39
2025-06-05 11:40:19,362 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:40:19,363 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $309.54 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:40:19,363 - src.order.base - INFO - Order 79c51330-e2d1-4219-b8f2-2ad23c059f25 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:40:19,363 - src.order.manager - INFO - Submitting order 79c51330-e2d1-4219-b8f2-2ad23c059f25 to TWS
2025-06-05 11:40:19,364 - src.order.manager - INFO - Got broker order ID 222 for order 79c51330-e2d1-4219-b8f2-2ad23c059f25
2025-06-05 11:40:19,364 - src.order.manager - INFO - Calling placeOrder with ID 222, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@309.540000 DAY
2025-06-05 11:40:19,365 - src.order.manager - INFO - placeOrder called successfully for order 79c51330-e2d1-4219-b8f2-2ad23c059f25
2025-06-05 11:40:19,369 - src.order.base - INFO - Order 79c51330-e2d1-4219-b8f2-2ad23c059f25 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:40:19,370 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 79c51330-e2d1-4219-b8f2-2ad23c059f25 at $309.54
2025-06-05 11:40:19,370 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:40:19,370 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:40:19,456 - src.tws_connection - INFO - Open Order - ID: 221, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:40:19,457 - src.order.base - INFO - Order c2213619-dbda-4f38-aafe-0acf4da1f6a9 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:40:19,529 - src.tws_connection - INFO - Open Order - ID: 222, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:40:19,878 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['c2213619-dbda-4f38-aafe-0acf4da1f6a9']
2025-06-05 11:40:19,879 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:40:24,898 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:40:24,900 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$308.56, stop_distance=$0.27, dd_distance=$0.03, dd_price=$308.53, original_qty=100, dd_qty=100
2025-06-05 11:40:24,902 - src.order.base - INFO - Order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:40:24,903 - src.order.manager - INFO - Submitting order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 to TWS
2025-06-05 11:40:24,904 - src.order.manager - INFO - Got broker order ID 223 for order 156fe02f-5fc5-4441-b7a1-7ef3f631d973
2025-06-05 11:40:24,904 - src.order.manager - INFO - Calling placeOrder with ID 223, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@308.530000 DAY
2025-06-05 11:40:24,908 - src.order.manager - INFO - placeOrder called successfully for order 156fe02f-5fc5-4441-b7a1-7ef3f631d973
2025-06-05 11:40:24,909 - src.order.base - INFO - Order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:40:24,910 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:40:24,910 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $308.53
2025-06-05 11:40:24,911 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:40:24,912 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 76229754-3cdf-41df-9500-2c034ccc294d for GLD
2025-06-05 11:40:25,008 - src.tws_connection - INFO - Open Order - ID: 223, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:40:28,341 - __main__ - INFO - 
============================================================
2025-06-05 11:40:28,341 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:40:28,342 - __main__ - INFO - ============================================================
2025-06-05 11:40:28,342 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:40:28,342 - __main__ - INFO - Order c2213619-dbda-4f38-aafe-0acf4da1f6a9: stop sell -100 @ 306.39 - Status: accepted
2025-06-05 11:40:28,342 - __main__ - INFO - Order 156fe02f-5fc5-4441-b7a1-7ef3f631d973: limit buy 100 @ 308.53 - Status: submitted
2025-06-05 11:40:28,342 - __main__ - INFO - Order 76229754-3cdf-41df-9500-2c034ccc294d: market buy 100 @ MARKET - Status: filled
2025-06-05 11:40:28,342 - __main__ - INFO - Order 79c51330-e2d1-4219-b8f2-2ad23c059f25: limit sell -100 @ 309.54 - Status: submitted
2025-06-05 11:40:28,343 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:40:28,343 - __main__ - INFO - Stop orders: 1
2025-06-05 11:40:28,343 - __main__ - INFO - Target orders: 1
2025-06-05 11:40:28,343 - __main__ - INFO - Double down orders: 1
2025-06-05 11:40:28,344 - __main__ - INFO - 
Double down order details:
2025-06-05 11:40:28,344 - __main__ - INFO -   ID: 156fe02f-5fc5-4441-b7a1-7ef3f631d973
2025-06-05 11:40:28,345 - __main__ - INFO -   Status: submitted
2025-06-05 11:40:28,345 - __main__ - INFO -   Limit price: 308.53
2025-06-05 11:40:28,346 - __main__ - INFO -   Quantity: 100
2025-06-05 11:40:28,346 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:40:28,346 - __main__ - INFO -   Stop: -100 @ $306.39
2025-06-05 11:40:28,346 - __main__ - INFO -   Target: -100 @ $309.54
2025-06-05 11:40:28,346 - __main__ - INFO - 
============================================================
2025-06-05 11:40:28,347 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:40:28,347 - __main__ - INFO - ============================================================
2025-06-05 11:40:28,347 - __main__ - INFO - Waiting for double down order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 to fill at $308.53...
2025-06-05 11:40:28,347 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:40:33,354 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:40:38,369 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:40:43,371 - __main__ - INFO - Waiting... (15s elapsed, order status: submitted)
2025-06-05 11:40:48,379 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 11:40:53,389 - __main__ - INFO - Waiting... (25s elapsed, order status: submitted)
2025-06-05 11:40:58,395 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 11:41:03,404 - __main__ - INFO - Waiting... (35s elapsed, order status: submitted)
2025-06-05 11:41:08,410 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 11:41:13,419 - __main__ - INFO - Waiting... (45s elapsed, order status: submitted)
2025-06-05 11:41:18,433 - __main__ - INFO - Waiting... (50s elapsed, order status: submitted)
2025-06-05 11:41:23,439 - __main__ - INFO - Waiting... (55s elapsed, order status: submitted)
2025-06-05 11:41:28,456 - __main__ - INFO - Waiting... (60s elapsed, order status: submitted)
2025-06-05 11:41:33,460 - __main__ - INFO - Waiting... (65s elapsed, order status: submitted)
2025-06-05 11:41:38,473 - __main__ - INFO - Waiting... (70s elapsed, order status: submitted)
2025-06-05 11:41:43,491 - __main__ - INFO - Waiting... (75s elapsed, order status: submitted)
2025-06-05 11:41:48,499 - __main__ - INFO - Waiting... (80s elapsed, order status: submitted)
2025-06-05 11:41:53,516 - __main__ - INFO - Waiting... (85s elapsed, order status: submitted)
2025-06-05 11:41:58,525 - __main__ - INFO - Waiting... (90s elapsed, order status: submitted)
2025-06-05 11:42:03,542 - __main__ - INFO - Waiting... (95s elapsed, order status: submitted)
2025-06-05 11:42:08,558 - __main__ - INFO - Waiting... (100s elapsed, order status: submitted)
2025-06-05 11:42:13,574 - __main__ - INFO - Waiting... (105s elapsed, order status: submitted)
2025-06-05 11:42:18,583 - __main__ - INFO - Waiting... (110s elapsed, order status: submitted)
2025-06-05 11:42:23,591 - __main__ - INFO - Waiting... (115s elapsed, order status: submitted)
2025-06-05 11:42:28,612 - __main__ - INFO - Waiting... (120s elapsed, order status: submitted)
2025-06-05 11:42:29,927 - src.order.base - INFO - Order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:42:29,918 - src.tws_connection - INFO - Open Order - ID: 223, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:42:29,949 - src.order.base - INFO - Order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 filled: 100.0 @ 308.53 (100.0/100)
2025-06-05 11:42:29,951 - src.tws_connection - INFO - Open Order - ID: 223, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:42:29,952 - LinkedDoubleDownFillManager - INFO - Double down order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 filled for GLD - updating protective orders
2025-06-05 11:42:29,952 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:42:29,952 - LinkedDoubleDownFillManager - INFO - [DD FILL DEBUG] old_quantity=100.0, dd_quantity=100.0, new_quantity=200.0
2025-06-05 11:42:29,956 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:42:29,957 - src.order.base - INFO - Order c2213619-dbda-4f38-aafe-0acf4da1f6a9 status changed: accepted -> pending_cancel (Double down fill - updating protective orders)
2025-06-05 11:42:29,957 - src.order.manager - INFO - Cancelling order c2213619-dbda-4f38-aafe-0acf4da1f6a9 with broker ID 221
2025-06-05 11:42:29,958 - LinkedDoubleDownFillManager - INFO - Cancelled old stop order c2213619-dbda-4f38-aafe-0acf4da1f6a9
2025-06-05 11:42:29,958 - src.order.base - INFO - Order 79c51330-e2d1-4219-b8f2-2ad23c059f25 status changed: submitted -> pending_cancel (Double down fill - updating protective orders)
2025-06-05 11:42:29,958 - src.order.manager - INFO - Cancelling order 79c51330-e2d1-4219-b8f2-2ad23c059f25 with broker ID 222
2025-06-05 11:42:29,959 - LinkedDoubleDownFillManager - INFO - Cancelled old target order 79c51330-e2d1-4219-b8f2-2ad23c059f25
2025-06-05 11:42:29,959 - src.order.base - INFO - Order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:42:29,959 - src.order.manager - INFO - Submitting order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b to TWS
2025-06-05 11:42:29,960 - src.order.manager - INFO - Got broker order ID 224 for order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b
2025-06-05 11:42:29,960 - src.order.manager - INFO - Calling placeOrder with ID 224, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 200@0.000000 DAY
2025-06-05 11:42:29,961 - src.order.manager - INFO - placeOrder called successfully for order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b
2025-06-05 11:42:29,961 - src.order.base - INFO - Order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:42:29,962 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:42:29,962 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:42:29,965 - LinkedDoubleDownFillManager - INFO - Created updated stop order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b for GLD at $306.28 for -200.0 shares
2025-06-05 11:42:29,966 - src.order.base - INFO - Order 4ef1daff-f6b3-494e-8daa-060df6b92aeb status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:42:29,966 - src.order.manager - INFO - Submitting order 4ef1daff-f6b3-494e-8daa-060df6b92aeb to TWS
2025-06-05 11:42:29,967 - src.order.manager - INFO - Got broker order ID 225 for order 4ef1daff-f6b3-494e-8daa-060df6b92aeb
2025-06-05 11:42:29,967 - src.order.manager - INFO - Calling placeOrder with ID 225, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 200@309.430000 DAY
2025-06-05 11:42:29,967 - src.order.manager - INFO - placeOrder called successfully for order 4ef1daff-f6b3-494e-8daa-060df6b92aeb
2025-06-05 11:42:29,967 - src.order.base - INFO - Order 4ef1daff-f6b3-494e-8daa-060df6b92aeb status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:42:29,968 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:42:29,968 - LinkedDoubleDownFillManager - INFO - Created updated target order 4ef1daff-f6b3-494e-8daa-060df6b92aeb for GLD at $309.43 for -200.0 shares
2025-06-05 11:42:29,968 - LinkedDoubleDownFillManager - INFO - Updated protective orders for GLD: New quantity=200.0, New avg=$308.53
2025-06-05 11:42:29,999 - src.order.base - INFO - Order c2213619-dbda-4f38-aafe-0acf4da1f6a9 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:42:29,999 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 221)
2025-06-05 11:42:30,042 - src.order.base - INFO - Order 79c51330-e2d1-4219-b8f2-2ad23c059f25 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:42:30,042 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 222)
2025-06-05 11:42:30,145 - src.tws_connection - INFO - Open Order - ID: 224, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:42:30,147 - src.order.base - INFO - Order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:42:30,298 - src.tws_connection - INFO - Open Order - ID: 225, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:42:33,619 - __main__ - INFO - ✅ Double down order filled at $308.53!
2025-06-05 11:42:43,627 - __main__ - INFO - 
============================================================
2025-06-05 11:42:43,628 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:42:43,628 - __main__ - INFO - ============================================================
2025-06-05 11:42:43,629 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:42:43,629 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:42:43,629 - __main__ - INFO - 
New stop order:
2025-06-05 11:42:43,630 - __main__ - INFO -   ID: cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b
2025-06-05 11:42:43,630 - __main__ - INFO -   Quantity: -200.0 (was -100)
2025-06-05 11:42:43,631 - __main__ - INFO -   Stop price: $306.28 (was $306.39)
2025-06-05 11:42:43,631 - __main__ - INFO - ✅ Stop order quantity correctly updated!
2025-06-05 11:42:43,631 - __main__ - INFO - 
New target order:
2025-06-05 11:42:43,631 - __main__ - INFO -   ID: 4ef1daff-f6b3-494e-8daa-060df6b92aeb
2025-06-05 11:42:43,632 - __main__ - INFO -   Quantity: -200.0 (was -100)
2025-06-05 11:42:43,632 - __main__ - INFO -   Limit price: $309.43 (was $309.54)
2025-06-05 11:42:43,632 - __main__ - INFO - ✅ Target order quantity correctly updated!
2025-06-05 11:42:43,632 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:42:43,633 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:42:43,633 - __main__ - INFO -   Side: BUY
2025-06-05 11:42:43,633 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:42:43,634 - __main__ - INFO -   Target orders: 1
2025-06-05 11:42:43,634 - __main__ - INFO -   All orders: {'156fe02f-5fc5-4441-b7a1-7ef3f631d973', 'cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b', '76229754-3cdf-41df-9500-2c034ccc294d', '4ef1daff-f6b3-494e-8daa-060df6b92aeb'}
2025-06-05 11:42:43,634 - __main__ - INFO - 
============================================================
2025-06-05 11:42:43,634 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:42:43,634 - __main__ - INFO - ============================================================
2025-06-05 11:42:43,635 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:42:43,636 - src.order.manager - WARNING - Cannot cancel inactive order c2213619-dbda-4f38-aafe-0acf4da1f6a9 with status cancelled
2025-06-05 11:42:43,636 - src.order.manager - WARNING - Cannot cancel inactive order 79c51330-e2d1-4219-b8f2-2ad23c059f25 with status cancelled
2025-06-05 11:42:43,636 - src.order.base - INFO - Order 4ef1daff-f6b3-494e-8daa-060df6b92aeb status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:42:43,637 - src.order.manager - INFO - Cancelling order 4ef1daff-f6b3-494e-8daa-060df6b92aeb with broker ID 225
2025-06-05 11:42:43,637 - src.order.manager - WARNING - Cannot cancel inactive order 76229754-3cdf-41df-9500-2c034ccc294d with status filled
2025-06-05 11:42:43,639 - src.order.base - INFO - Order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:42:43,639 - src.order.manager - INFO - Cancelling order cc7e4d6f-ccf9-4ff9-9c35-a8ef8106012b with broker ID 224
2025-06-05 11:42:43,640 - src.order.manager - WARNING - Cannot cancel inactive order 156fe02f-5fc5-4441-b7a1-7ef3f631d973 with status filled
2025-06-05 11:42:43,640 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:42:43,640 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:42:43,641 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:42:43,641 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:42:43,642 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:42:43,643 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:42:43,643 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:52:12,142 - __main__ - INFO - ================================================================================
2025-06-05 11:52:12,144 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:52:12,144 - __main__ - INFO - ================================================================================
2025-06-05 11:52:12,147 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:52:12,147 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:52:12,148 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:52:14,058 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:52:14,059 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:52:14,095 - src.tws_connection - INFO - ✅ Next valid order ID received: 226
2025-06-05 11:52:14,096 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:52:14,097 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:52:14,098 - src.tws_connection - INFO - ✅ Next valid order ID received: 226
2025-06-05 11:52:14,099 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:52:14,100 - src.tws_connection - INFO - ✅ Next valid order ID received: 226
2025-06-05 11:52:14,101 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:52:14,102 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:52:14,102 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:52:14,103 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:52:14,103 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:52:14,104 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:52:14,104 - __main__ - INFO - 
============================================================
2025-06-05 11:52:14,104 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:52:14,104 - __main__ - INFO - ============================================================
2025-06-05 11:52:14,105 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:52:14,105 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:52:14,105 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:52:14,106 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:52:14,106 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:52:14,106 - src.order.base - INFO - Order 349b99c1-221a-4754-8a4c-ccd0fd07a266 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:52:14,106 - src.order.manager - INFO - Submitting order 349b99c1-221a-4754-8a4c-ccd0fd07a266 to TWS
2025-06-05 11:52:14,107 - src.order.manager - INFO - Got broker order ID 226 for order 349b99c1-221a-4754-8a4c-ccd0fd07a266
2025-06-05 11:52:14,107 - src.order.manager - INFO - Calling placeOrder with ID 226, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:52:14,107 - src.order.manager - INFO - placeOrder called successfully for order 349b99c1-221a-4754-8a4c-ccd0fd07a266
2025-06-05 11:52:14,108 - src.order.base - INFO - Order 349b99c1-221a-4754-8a4c-ccd0fd07a266 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:52:14,108 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:52:14,108 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:52:14,217 - src.tws_connection - INFO - Open Order - ID: 226, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:52:14,597 - src.tws_connection - INFO - Open Order - ID: 226, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:52:14,600 - src.tws_connection - INFO - Open Order - ID: 226, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:52:14,604 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:52:14,605 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $305.98 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:52:14,606 - src.order.base - INFO - Order 9a7467ef-fb89-42c9-907d-eabe213259b2 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:52:14,607 - src.order.manager - INFO - Submitting order 9a7467ef-fb89-42c9-907d-eabe213259b2 to TWS
2025-06-05 11:52:14,607 - src.order.manager - INFO - Got broker order ID 227 for order 9a7467ef-fb89-42c9-907d-eabe213259b2
2025-06-05 11:52:14,607 - src.order.manager - INFO - Calling placeOrder with ID 227, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:52:14,608 - src.order.manager - INFO - placeOrder called successfully for order 9a7467ef-fb89-42c9-907d-eabe213259b2
2025-06-05 11:52:14,608 - src.order.base - INFO - Order 9a7467ef-fb89-42c9-907d-eabe213259b2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:52:14,609 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9a7467ef-fb89-42c9-907d-eabe213259b2 at $305.98
2025-06-05 11:52:14,609 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:52:14,611 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $309.13 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:52:14,612 - src.order.base - INFO - Order e8f60fe3-947e-45f0-88fd-d32515275abf status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:52:14,612 - src.order.manager - INFO - Submitting order e8f60fe3-947e-45f0-88fd-d32515275abf to TWS
2025-06-05 11:52:14,612 - src.order.manager - INFO - Got broker order ID 228 for order e8f60fe3-947e-45f0-88fd-d32515275abf
2025-06-05 11:52:14,612 - src.order.manager - INFO - Calling placeOrder with ID 228, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@309.130000 DAY
2025-06-05 11:52:14,613 - src.order.manager - INFO - placeOrder called successfully for order e8f60fe3-947e-45f0-88fd-d32515275abf
2025-06-05 11:52:14,613 - src.order.base - INFO - Order e8f60fe3-947e-45f0-88fd-d32515275abf status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:52:14,613 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e8f60fe3-947e-45f0-88fd-d32515275abf at $309.13
2025-06-05 11:52:14,613 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:52:14,614 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:52:14,614 - src.order.base - INFO - Order 349b99c1-221a-4754-8a4c-ccd0fd07a266 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:52:14,614 - src.order.base - INFO - Order 349b99c1-221a-4754-8a4c-ccd0fd07a266 filled: 100.0 @ 308.23 (100.0/100)
2025-06-05 11:52:14,680 - src.tws_connection - INFO - Open Order - ID: 227, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:52:14,681 - src.order.base - INFO - Order 9a7467ef-fb89-42c9-907d-eabe213259b2 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:52:14,728 - src.tws_connection - INFO - Open Order - ID: 228, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:52:15,126 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9a7467ef-fb89-42c9-907d-eabe213259b2']
2025-06-05 11:52:15,127 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:52:20,144 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:52:20,145 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$308.22, stop_distance=$0.27, dd_distance=$0.03, dd_price=$308.19, original_qty=100, dd_qty=100
2025-06-05 11:52:20,146 - src.order.base - INFO - Order 461708a4-30d3-4654-a962-03c91f973330 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:52:20,147 - src.order.manager - INFO - Submitting order 461708a4-30d3-4654-a962-03c91f973330 to TWS
2025-06-05 11:52:20,148 - src.order.manager - INFO - Got broker order ID 229 for order 461708a4-30d3-4654-a962-03c91f973330
2025-06-05 11:52:20,148 - src.order.manager - INFO - Calling placeOrder with ID 229, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@308.190000 DAY
2025-06-05 11:52:20,149 - src.order.manager - INFO - placeOrder called successfully for order 461708a4-30d3-4654-a962-03c91f973330
2025-06-05 11:52:20,150 - src.order.base - INFO - Order 461708a4-30d3-4654-a962-03c91f973330 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:52:20,151 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:52:20,153 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $308.19
2025-06-05 11:52:20,153 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:52:20,154 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 349b99c1-221a-4754-8a4c-ccd0fd07a266 for GLD
2025-06-05 11:52:20,248 - src.tws_connection - INFO - Open Order - ID: 229, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:52:24,112 - __main__ - INFO - 
============================================================
2025-06-05 11:52:24,113 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:52:24,113 - __main__ - INFO - ============================================================
2025-06-05 11:52:24,114 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:52:24,114 - __main__ - INFO - Order 349b99c1-221a-4754-8a4c-ccd0fd07a266: market buy 100 @ MARKET - Status: filled
2025-06-05 11:52:24,114 - __main__ - INFO - Order e8f60fe3-947e-45f0-88fd-d32515275abf: limit sell -100 @ 309.13 - Status: submitted
2025-06-05 11:52:24,115 - __main__ - INFO - Order 461708a4-30d3-4654-a962-03c91f973330: limit buy 100 @ 308.19 - Status: submitted
2025-06-05 11:52:24,115 - __main__ - INFO - Order 9a7467ef-fb89-42c9-907d-eabe213259b2: stop sell -100 @ 305.98 - Status: accepted
2025-06-05 11:52:24,115 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:52:24,115 - __main__ - INFO - Stop orders: 1
2025-06-05 11:52:24,116 - __main__ - INFO - Target orders: 1
2025-06-05 11:52:24,116 - __main__ - INFO - Double down orders: 1
2025-06-05 11:52:24,116 - __main__ - INFO - 
Double down order details:
2025-06-05 11:52:24,116 - __main__ - INFO -   ID: 461708a4-30d3-4654-a962-03c91f973330
2025-06-05 11:52:24,117 - __main__ - INFO -   Status: submitted
2025-06-05 11:52:24,117 - __main__ - INFO -   Limit price: 308.19
2025-06-05 11:52:24,117 - __main__ - INFO -   Quantity: 100
2025-06-05 11:52:24,117 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:52:24,118 - __main__ - INFO -   Stop: -100 @ $305.98
2025-06-05 11:52:24,118 - __main__ - INFO -   Target: -100 @ $309.13
2025-06-05 11:52:24,118 - __main__ - INFO - 
============================================================
2025-06-05 11:52:24,119 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:52:24,119 - __main__ - INFO - ============================================================
2025-06-05 11:52:24,119 - __main__ - INFO - Waiting for double down order 461708a4-30d3-4654-a962-03c91f973330 to fill at $308.19...
2025-06-05 11:52:24,120 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:52:25,838 - src.order.base - INFO - Order 461708a4-30d3-4654-a962-03c91f973330 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:52:25,838 - src.order.base - INFO - Order 461708a4-30d3-4654-a962-03c91f973330 filled: 100.0 @ 308.19 (100.0/100)
2025-06-05 11:52:25,839 - LinkedDoubleDownFillManager - INFO - Double down order 461708a4-30d3-4654-a962-03c91f973330 filled for GLD - updating protective orders
2025-06-05 11:52:25,839 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:52:25,840 - LinkedDoubleDownFillManager - INFO - [DD FILL DEBUG] old_quantity=100.0, dd_quantity=100.0, new_quantity=200.0
2025-06-05 11:52:25,838 - src.tws_connection - INFO - Open Order - ID: 229, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:52:25,843 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:52:25,843 - src.order.base - INFO - Order 9a7467ef-fb89-42c9-907d-eabe213259b2 status changed: accepted -> pending_cancel (Double down fill - updating protective orders)
2025-06-05 11:52:25,843 - src.order.manager - INFO - Cancelling order 9a7467ef-fb89-42c9-907d-eabe213259b2 with broker ID 227
2025-06-05 11:52:25,843 - LinkedDoubleDownFillManager - INFO - Cancelled old stop order 9a7467ef-fb89-42c9-907d-eabe213259b2
2025-06-05 11:52:25,844 - src.order.base - INFO - Order e8f60fe3-947e-45f0-88fd-d32515275abf status changed: submitted -> pending_cancel (Double down fill - updating protective orders)
2025-06-05 11:52:25,844 - src.order.manager - INFO - Cancelling order e8f60fe3-947e-45f0-88fd-d32515275abf with broker ID 228
2025-06-05 11:52:25,845 - LinkedDoubleDownFillManager - INFO - Cancelled old target order e8f60fe3-947e-45f0-88fd-d32515275abf
2025-06-05 11:52:25,845 - src.order.base - INFO - Order 02a10486-0542-4d96-86ef-3ee22c0f5d3c status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:52:25,845 - src.order.manager - INFO - Submitting order 02a10486-0542-4d96-86ef-3ee22c0f5d3c to TWS
2025-06-05 11:52:25,845 - src.order.manager - INFO - Got broker order ID 230 for order 02a10486-0542-4d96-86ef-3ee22c0f5d3c
2025-06-05 11:52:25,845 - src.order.manager - INFO - Calling placeOrder with ID 230, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 200@0.000000 DAY
2025-06-05 11:52:25,846 - src.order.manager - INFO - placeOrder called successfully for order 02a10486-0542-4d96-86ef-3ee22c0f5d3c
2025-06-05 11:52:25,846 - src.order.base - INFO - Order 02a10486-0542-4d96-86ef-3ee22c0f5d3c status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:52:25,846 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:52:25,846 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:52:25,847 - LinkedDoubleDownFillManager - INFO - Created updated stop order 02a10486-0542-4d96-86ef-3ee22c0f5d3c for GLD at $305.94 for -200.0 shares
2025-06-05 11:52:25,847 - src.order.base - INFO - Order 2df9d872-bc48-4f67-ad85-232f76c0447f status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:52:25,844 - src.tws_connection - INFO - Open Order - ID: 229, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:52:25,847 - src.order.manager - INFO - Submitting order 2df9d872-bc48-4f67-ad85-232f76c0447f to TWS
2025-06-05 11:52:25,847 - src.order.manager - INFO - Got broker order ID 231 for order 2df9d872-bc48-4f67-ad85-232f76c0447f
2025-06-05 11:52:25,847 - src.order.manager - INFO - Calling placeOrder with ID 231, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 200@309.090000 DAY
2025-06-05 11:52:25,848 - src.order.manager - INFO - placeOrder called successfully for order 2df9d872-bc48-4f67-ad85-232f76c0447f
2025-06-05 11:52:25,848 - src.order.base - INFO - Order 2df9d872-bc48-4f67-ad85-232f76c0447f status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:52:25,848 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:52:25,848 - LinkedDoubleDownFillManager - INFO - Created updated target order 2df9d872-bc48-4f67-ad85-232f76c0447f for GLD at $309.09 for -200.0 shares
2025-06-05 11:52:25,848 - LinkedDoubleDownFillManager - INFO - Updated protective orders for GLD: New quantity=200.0, New avg=$308.19
2025-06-05 11:52:25,917 - src.order.base - INFO - Order 9a7467ef-fb89-42c9-907d-eabe213259b2 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:52:25,892 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 227)
2025-06-05 11:52:25,986 - src.order.base - INFO - Order e8f60fe3-947e-45f0-88fd-d32515275abf status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:52:25,986 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 228)
2025-06-05 11:52:26,057 - src.tws_connection - INFO - Open Order - ID: 230, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:52:26,058 - src.order.base - INFO - Order 02a10486-0542-4d96-86ef-3ee22c0f5d3c status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:52:26,140 - src.tws_connection - INFO - Open Order - ID: 231, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:52:29,125 - __main__ - INFO - ✅ Double down order filled at $308.19!
2025-06-05 11:52:39,134 - __main__ - INFO - 
============================================================
2025-06-05 11:52:39,135 - __main__ - INFO - STEP 4: Checking if stop and target orders were updated
2025-06-05 11:52:39,135 - __main__ - INFO - ============================================================
2025-06-05 11:52:39,136 - __main__ - INFO - Active stop orders after double down: 1
2025-06-05 11:52:39,136 - __main__ - INFO - Active target orders after double down: 1
2025-06-05 11:52:39,137 - __main__ - INFO - 
New stop order:
2025-06-05 11:52:39,137 - __main__ - INFO -   ID: 02a10486-0542-4d96-86ef-3ee22c0f5d3c
2025-06-05 11:52:39,138 - __main__ - INFO -   Quantity: -200.0 (was -100)
2025-06-05 11:52:39,138 - __main__ - INFO -   Stop price: $305.94 (was $305.98)
2025-06-05 11:52:39,138 - __main__ - INFO - ✅ Stop order quantity correctly updated!
2025-06-05 11:52:39,139 - __main__ - INFO - 
New target order:
2025-06-05 11:52:39,139 - __main__ - INFO -   ID: 2df9d872-bc48-4f67-ad85-232f76c0447f
2025-06-05 11:52:39,139 - __main__ - INFO -   Quantity: -200.0 (was -100)
2025-06-05 11:52:39,140 - __main__ - INFO -   Limit price: $309.09 (was $309.13)
2025-06-05 11:52:39,140 - __main__ - INFO - ✅ Target order quantity correctly updated!
2025-06-05 11:52:39,141 - __main__ - INFO - 
PositionManager state:
2025-06-05 11:52:39,141 - __main__ - INFO -   Symbol: GLD
2025-06-05 11:52:39,141 - __main__ - INFO -   Side: BUY
2025-06-05 11:52:39,141 - __main__ - INFO -   Stop orders: 1
2025-06-05 11:52:39,142 - __main__ - INFO -   Target orders: 1
2025-06-05 11:52:39,142 - __main__ - INFO -   All orders: {'02a10486-0542-4d96-86ef-3ee22c0f5d3c', '349b99c1-221a-4754-8a4c-ccd0fd07a266', '2df9d872-bc48-4f67-ad85-232f76c0447f', '461708a4-30d3-4654-a962-03c91f973330'}
2025-06-05 11:52:39,142 - __main__ - INFO - 
============================================================
2025-06-05 11:52:39,142 - __main__ - INFO - TEST COMPLETE
2025-06-05 11:52:39,142 - __main__ - INFO - ============================================================
2025-06-05 11:52:39,143 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:52:39,143 - src.order.manager - WARNING - Cannot cancel inactive order 461708a4-30d3-4654-a962-03c91f973330 with status filled
2025-06-05 11:52:39,143 - src.order.manager - WARNING - Cannot cancel inactive order 349b99c1-221a-4754-8a4c-ccd0fd07a266 with status filled
2025-06-05 11:52:39,147 - src.order.manager - WARNING - Cannot cancel inactive order e8f60fe3-947e-45f0-88fd-d32515275abf with status cancelled
2025-06-05 11:52:39,148 - src.order.manager - WARNING - Cannot cancel inactive order 9a7467ef-fb89-42c9-907d-eabe213259b2 with status cancelled
2025-06-05 11:52:39,148 - src.order.base - INFO - Order 02a10486-0542-4d96-86ef-3ee22c0f5d3c status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:52:39,148 - src.order.manager - INFO - Cancelling order 02a10486-0542-4d96-86ef-3ee22c0f5d3c with broker ID 230
2025-06-05 11:52:39,149 - src.order.base - INFO - Order 2df9d872-bc48-4f67-ad85-232f76c0447f status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:52:39,149 - src.order.manager - INFO - Cancelling order 2df9d872-bc48-4f67-ad85-232f76c0447f with broker ID 231
2025-06-05 11:52:39,149 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:52:39,150 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:52:39,153 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:52:39,153 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:52:39,186 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:52:39,192 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 11:52:39,195 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:52:39,196 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:52:39,196 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 11:55:41,395 - __main__ - INFO - ================================================================================
2025-06-05 11:55:41,395 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:55:41,396 - __main__ - INFO - ================================================================================
2025-06-05 11:55:41,398 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:55:41,398 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:55:41,399 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:55:43,116 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:55:43,117 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:55:43,156 - src.tws_connection - INFO - ✅ Next valid order ID received: 232
2025-06-05 11:55:43,157 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:55:43,157 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:55:43,159 - src.tws_connection - INFO - ✅ Next valid order ID received: 232
2025-06-05 11:55:43,161 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:55:43,163 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:55:43,162 - src.tws_connection - INFO - ✅ Next valid order ID received: 232
2025-06-05 11:55:43,163 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:55:43,164 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:55:43,164 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:55:43,165 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:55:43,165 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:55:43,165 - __main__ - INFO - 
============================================================
2025-06-05 11:55:43,165 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:55:43,166 - __main__ - INFO - ============================================================
2025-06-05 11:55:43,167 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:55:43,167 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:55:43,168 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:55:43,168 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:55:43,168 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:55:43,169 - src.order.base - INFO - Order 851919f4-67cf-4534-bb81-f5a8f2e24593 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:55:43,169 - src.order.manager - INFO - Submitting order 851919f4-67cf-4534-bb81-f5a8f2e24593 to TWS
2025-06-05 11:55:43,169 - src.order.manager - INFO - Got broker order ID 232 for order 851919f4-67cf-4534-bb81-f5a8f2e24593
2025-06-05 11:55:43,169 - src.order.manager - INFO - Calling placeOrder with ID 232, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:55:43,170 - src.order.manager - INFO - placeOrder called successfully for order 851919f4-67cf-4534-bb81-f5a8f2e24593
2025-06-05 11:55:43,170 - src.order.base - INFO - Order 851919f4-67cf-4534-bb81-f5a8f2e24593 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:55:43,170 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:55:43,171 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:55:43,267 - src.tws_connection - INFO - Open Order - ID: 232, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:55:43,269 - src.order.base - INFO - Order 851919f4-67cf-4534-bb81-f5a8f2e24593 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:55:43,306 - src.order.base - INFO - Order 851919f4-67cf-4534-bb81-f5a8f2e24593 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:55:43,314 - src.order.base - INFO - Order 851919f4-67cf-4534-bb81-f5a8f2e24593 filled: 100.0 @ 308.02 (100.0/100)
2025-06-05 11:55:43,307 - src.tws_connection - INFO - Open Order - ID: 232, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:55:43,316 - src.tws_connection - INFO - Open Order - ID: 232, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:55:44,177 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:55:44,178 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $305.73 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:55:44,178 - src.order.base - INFO - Order a94125e1-aa10-42aa-b2e7-617a83a287c8 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:55:44,179 - src.order.manager - INFO - Submitting order a94125e1-aa10-42aa-b2e7-617a83a287c8 to TWS
2025-06-05 11:55:44,179 - src.order.manager - INFO - Got broker order ID 233 for order a94125e1-aa10-42aa-b2e7-617a83a287c8
2025-06-05 11:55:44,179 - src.order.manager - INFO - Calling placeOrder with ID 233, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:55:44,180 - src.order.manager - INFO - placeOrder called successfully for order a94125e1-aa10-42aa-b2e7-617a83a287c8
2025-06-05 11:55:44,180 - src.order.base - INFO - Order a94125e1-aa10-42aa-b2e7-617a83a287c8 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:55:44,180 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss a94125e1-aa10-42aa-b2e7-617a83a287c8 at $305.73
2025-06-05 11:55:44,180 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:55:44,181 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $308.88 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:55:44,181 - src.order.base - INFO - Order 2ab96c62-c84b-4890-82e5-8a14dbadc752 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:55:44,182 - src.order.manager - INFO - Submitting order 2ab96c62-c84b-4890-82e5-8a14dbadc752 to TWS
2025-06-05 11:55:44,186 - src.order.manager - INFO - Got broker order ID 234 for order 2ab96c62-c84b-4890-82e5-8a14dbadc752
2025-06-05 11:55:44,186 - src.order.manager - INFO - Calling placeOrder with ID 234, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@308.880000 DAY
2025-06-05 11:55:44,186 - src.order.manager - INFO - placeOrder called successfully for order 2ab96c62-c84b-4890-82e5-8a14dbadc752
2025-06-05 11:55:44,189 - src.order.base - INFO - Order 2ab96c62-c84b-4890-82e5-8a14dbadc752 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:55:44,189 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 2ab96c62-c84b-4890-82e5-8a14dbadc752 at $308.88
2025-06-05 11:55:44,190 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:55:44,190 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:55:44,279 - src.tws_connection - INFO - Open Order - ID: 233, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:55:44,280 - src.order.base - INFO - Order a94125e1-aa10-42aa-b2e7-617a83a287c8 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:55:44,317 - src.tws_connection - INFO - Open Order - ID: 234, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:55:44,692 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['a94125e1-aa10-42aa-b2e7-617a83a287c8']
2025-06-05 11:55:44,693 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:55:49,712 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:55:49,713 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$308.00, stop_distance=$0.27, dd_distance=$0.03, dd_price=$307.97, original_qty=100, dd_qty=100
2025-06-05 11:55:49,713 - src.order.base - INFO - Order c1e8d708-76bf-4a16-af25-d0182238c3a7 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:55:49,714 - src.order.manager - INFO - Submitting order c1e8d708-76bf-4a16-af25-d0182238c3a7 to TWS
2025-06-05 11:55:49,714 - src.order.manager - INFO - Got broker order ID 235 for order c1e8d708-76bf-4a16-af25-d0182238c3a7
2025-06-05 11:55:49,714 - src.order.manager - INFO - Calling placeOrder with ID 235, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@307.970000 DAY
2025-06-05 11:55:49,715 - src.order.manager - INFO - placeOrder called successfully for order c1e8d708-76bf-4a16-af25-d0182238c3a7
2025-06-05 11:55:49,715 - src.order.base - INFO - Order c1e8d708-76bf-4a16-af25-d0182238c3a7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:55:49,717 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:55:49,717 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $307.97
2025-06-05 11:55:49,719 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:55:49,720 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 851919f4-67cf-4534-bb81-f5a8f2e24593 for GLD
2025-06-05 11:55:49,814 - src.tws_connection - INFO - Open Order - ID: 235, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:55:52,148 - src.order.base - INFO - Order c1e8d708-76bf-4a16-af25-d0182238c3a7 status changed: submitted -> filled (Order fully filled)
2025-06-05 11:55:52,147 - src.tws_connection - INFO - Open Order - ID: 235, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:55:52,149 - src.order.base - INFO - Order c1e8d708-76bf-4a16-af25-d0182238c3a7 filled: 100.0 @ 307.97 (100.0/100)
2025-06-05 11:55:52,153 - LinkedDoubleDownFillManager - INFO - Double down order c1e8d708-76bf-4a16-af25-d0182238c3a7 filled for GLD - updating protective orders
2025-06-05 11:55:52,153 - LinkedDoubleDownFillManager - WARNING - No position found in PositionTracker for GLD, using order data
2025-06-05 11:55:52,153 - LinkedDoubleDownFillManager - INFO - [DD FILL DEBUG] old_quantity=100.0, dd_quantity=100.0, new_quantity=200.0
2025-06-05 11:55:52,153 - src.tws_connection - INFO - Open Order - ID: 235, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:55:52,157 - LinkedDoubleDownFillManager - INFO - ATR for GLD: 0.0450
2025-06-05 11:55:52,157 - src.order.base - INFO - Order a94125e1-aa10-42aa-b2e7-617a83a287c8 status changed: accepted -> pending_cancel (Double down fill - updating protective orders)
2025-06-05 11:55:52,157 - src.order.manager - INFO - Cancelling order a94125e1-aa10-42aa-b2e7-617a83a287c8 with broker ID 233
2025-06-05 11:55:52,158 - LinkedDoubleDownFillManager - INFO - Cancelled old stop order a94125e1-aa10-42aa-b2e7-617a83a287c8
2025-06-05 11:55:52,158 - src.order.base - INFO - Order 2ab96c62-c84b-4890-82e5-8a14dbadc752 status changed: submitted -> pending_cancel (Double down fill - updating protective orders)
2025-06-05 11:55:52,158 - src.order.manager - INFO - Cancelling order 2ab96c62-c84b-4890-82e5-8a14dbadc752 with broker ID 234
2025-06-05 11:55:52,158 - LinkedDoubleDownFillManager - INFO - Cancelled old target order 2ab96c62-c84b-4890-82e5-8a14dbadc752
2025-06-05 11:55:52,159 - src.order.base - INFO - Order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:55:52,159 - src.order.manager - INFO - Submitting order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 to TWS
2025-06-05 11:55:52,160 - src.order.manager - INFO - Got broker order ID 236 for order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120
2025-06-05 11:55:52,160 - src.order.manager - INFO - Calling placeOrder with ID 236, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 200@0.000000 DAY
2025-06-05 11:55:52,160 - src.order.manager - INFO - placeOrder called successfully for order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120
2025-06-05 11:55:52,161 - src.order.base - INFO - Order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:55:52,161 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:55:52,161 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:55:52,161 - LinkedDoubleDownFillManager - INFO - Created updated stop order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 for GLD at $305.72 for -200.0 shares
2025-06-05 11:55:52,162 - src.order.base - INFO - Order 454d2070-e6c4-4f83-a784-d7d7375cf09e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:55:52,162 - src.order.manager - INFO - Submitting order 454d2070-e6c4-4f83-a784-d7d7375cf09e to TWS
2025-06-05 11:55:52,162 - src.order.manager - INFO - Got broker order ID 237 for order 454d2070-e6c4-4f83-a784-d7d7375cf09e
2025-06-05 11:55:52,162 - src.order.manager - INFO - Calling placeOrder with ID 237, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 200@308.870000 DAY
2025-06-05 11:55:52,163 - src.order.manager - INFO - placeOrder called successfully for order 454d2070-e6c4-4f83-a784-d7d7375cf09e
2025-06-05 11:55:52,163 - src.order.base - INFO - Order 454d2070-e6c4-4f83-a784-d7d7375cf09e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:55:52,163 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:55:52,163 - LinkedDoubleDownFillManager - INFO - Created updated target order 454d2070-e6c4-4f83-a784-d7d7375cf09e for GLD at $308.87 for -200.0 shares
2025-06-05 11:55:52,163 - LinkedDoubleDownFillManager - INFO - Updated protective orders for GLD: New quantity=200.0, New avg=$307.97
2025-06-05 11:55:52,196 - src.order.base - INFO - Order a94125e1-aa10-42aa-b2e7-617a83a287c8 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:55:52,195 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 233)
2025-06-05 11:55:52,307 - src.order.base - INFO - Order 2ab96c62-c84b-4890-82e5-8a14dbadc752 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 11:55:52,306 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 234)
2025-06-05 11:55:52,429 - src.tws_connection - INFO - Open Order - ID: 236, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:55:52,430 - src.order.base - INFO - Order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:55:52,624 - src.tws_connection - INFO - Open Order - ID: 237, Symbol: GLD, Action: SELL, Quantity: 200.0
2025-06-05 11:55:53,178 - __main__ - INFO - 
============================================================
2025-06-05 11:55:53,179 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:55:53,179 - __main__ - INFO - ============================================================
2025-06-05 11:55:53,179 - __main__ - INFO - Found 6 orders for GLD
2025-06-05 11:55:53,179 - __main__ - INFO - Order 454d2070-e6c4-4f83-a784-d7d7375cf09e: limit sell -200.0 @ 308.87 - Status: submitted
2025-06-05 11:55:53,179 - __main__ - INFO - Order c1e8d708-76bf-4a16-af25-d0182238c3a7: limit buy 100 @ 307.97 - Status: filled
2025-06-05 11:55:53,180 - __main__ - INFO - Order 2ab96c62-c84b-4890-82e5-8a14dbadc752: limit sell -100 @ 308.88 - Status: cancelled
2025-06-05 11:55:53,180 - __main__ - INFO - Order 851919f4-67cf-4534-bb81-f5a8f2e24593: market buy 100 @ MARKET - Status: filled
2025-06-05 11:55:53,180 - __main__ - INFO - Order a94125e1-aa10-42aa-b2e7-617a83a287c8: stop sell -100 @ 305.73 - Status: cancelled
2025-06-05 11:55:53,180 - __main__ - INFO - Order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120: stop sell -200.0 @ 305.72 - Status: accepted
2025-06-05 11:55:53,180 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:55:53,180 - __main__ - INFO - Stop orders: 2
2025-06-05 11:55:53,180 - __main__ - INFO - Target orders: 2
2025-06-05 11:55:53,180 - __main__ - INFO - Double down orders: 0
2025-06-05 11:55:53,180 - __main__ - ERROR - ❌ No double down orders found!
2025-06-05 11:55:53,181 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 11:55:53,181 - src.order.base - INFO - Order 454d2070-e6c4-4f83-a784-d7d7375cf09e status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 11:55:53,181 - src.order.manager - INFO - Cancelling order 454d2070-e6c4-4f83-a784-d7d7375cf09e with broker ID 237
2025-06-05 11:55:53,181 - src.order.manager - WARNING - Cannot cancel inactive order c1e8d708-76bf-4a16-af25-d0182238c3a7 with status filled
2025-06-05 11:55:53,182 - src.order.manager - WARNING - Cannot cancel inactive order 2ab96c62-c84b-4890-82e5-8a14dbadc752 with status cancelled
2025-06-05 11:55:53,182 - src.order.manager - WARNING - Cannot cancel inactive order 851919f4-67cf-4534-bb81-f5a8f2e24593 with status filled
2025-06-05 11:55:53,183 - src.order.manager - WARNING - Cannot cancel inactive order a94125e1-aa10-42aa-b2e7-617a83a287c8 with status cancelled
2025-06-05 11:55:53,183 - src.order.base - INFO - Order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-05 11:55:53,184 - src.order.manager - INFO - Cancelling order b0dd7e0e-d5cf-4e05-9159-55ef5e9ae120 with broker ID 236
2025-06-05 11:55:53,186 - __main__ - INFO - Cancelled 2 orders
2025-06-05 11:55:53,187 - __main__ - INFO - 
Cleaning up...
2025-06-05 11:55:53,188 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 11:55:53,188 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 11:55:53,189 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 11:55:53,190 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 11:55:53,196 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:56:45,490 - __main__ - INFO - ================================================================================
2025-06-05 11:56:45,490 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 11:56:45,490 - __main__ - INFO - ================================================================================
2025-06-05 11:56:45,491 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:56:45,492 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:56:45,492 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:56:47,306 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:56:47,308 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:56:47,347 - src.tws_connection - INFO - ✅ Next valid order ID received: 238
2025-06-05 11:56:47,348 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:56:47,348 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:56:47,349 - src.tws_connection - INFO - ✅ Next valid order ID received: 238
2025-06-05 11:56:47,350 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:56:47,351 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:56:47,350 - src.tws_connection - INFO - ✅ Next valid order ID received: 238
2025-06-05 11:56:47,351 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:56:47,352 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:56:47,352 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:56:47,352 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 11:56:47,353 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:56:47,353 - __main__ - INFO - 
============================================================
2025-06-05 11:56:47,353 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:56:47,353 - __main__ - INFO - ============================================================
2025-06-05 11:56:47,354 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:56:47,354 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:56:47,355 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:56:47,355 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:56:47,355 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:56:47,356 - src.order.base - INFO - Order aa929bc7-8949-42bb-b431-644728c8367b status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:56:47,356 - src.order.manager - INFO - Submitting order aa929bc7-8949-42bb-b431-644728c8367b to TWS
2025-06-05 11:56:47,357 - src.order.manager - INFO - Got broker order ID 238 for order aa929bc7-8949-42bb-b431-644728c8367b
2025-06-05 11:56:47,357 - src.order.manager - INFO - Calling placeOrder with ID 238, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:56:47,358 - src.order.manager - INFO - placeOrder called successfully for order aa929bc7-8949-42bb-b431-644728c8367b
2025-06-05 11:56:47,358 - src.order.base - INFO - Order aa929bc7-8949-42bb-b431-644728c8367b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:56:47,358 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:56:47,359 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:56:47,449 - src.tws_connection - INFO - Open Order - ID: 238, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:56:47,450 - src.order.base - INFO - Order aa929bc7-8949-42bb-b431-644728c8367b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:56:47,494 - src.order.base - INFO - Order aa929bc7-8949-42bb-b431-644728c8367b status changed: accepted -> filled (Order fully filled)
2025-06-05 11:56:47,495 - src.order.base - INFO - Order aa929bc7-8949-42bb-b431-644728c8367b filled: 100.0 @ 307.91 (100.0/100)
2025-06-05 11:56:47,495 - src.tws_connection - INFO - Open Order - ID: 238, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:56:47,496 - src.tws_connection - INFO - Open Order - ID: 238, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:56:48,373 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:56:48,380 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $305.71 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 11:56:48,390 - src.order.base - INFO - Order 8c11eac1-4acc-412f-8579-8bb5f34746c2 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:56:48,392 - src.order.manager - INFO - Submitting order 8c11eac1-4acc-412f-8579-8bb5f34746c2 to TWS
2025-06-05 11:56:48,392 - src.order.manager - INFO - Got broker order ID 239 for order 8c11eac1-4acc-412f-8579-8bb5f34746c2
2025-06-05 11:56:48,393 - src.order.manager - INFO - Calling placeOrder with ID 239, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:56:48,393 - src.order.manager - INFO - placeOrder called successfully for order 8c11eac1-4acc-412f-8579-8bb5f34746c2
2025-06-05 11:56:48,394 - src.order.base - INFO - Order 8c11eac1-4acc-412f-8579-8bb5f34746c2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:56:48,394 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 8c11eac1-4acc-412f-8579-8bb5f34746c2 at $305.71
2025-06-05 11:56:48,394 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:56:48,395 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $308.86 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 11:56:48,395 - src.order.base - INFO - Order e776903f-1875-4e8e-8937-a21bf9447a80 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:56:48,395 - src.order.manager - INFO - Submitting order e776903f-1875-4e8e-8937-a21bf9447a80 to TWS
2025-06-05 11:56:48,395 - src.order.manager - INFO - Got broker order ID 240 for order e776903f-1875-4e8e-8937-a21bf9447a80
2025-06-05 11:56:48,396 - src.order.manager - INFO - Calling placeOrder with ID 240, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@308.860000 DAY
2025-06-05 11:56:48,396 - src.order.manager - INFO - placeOrder called successfully for order e776903f-1875-4e8e-8937-a21bf9447a80
2025-06-05 11:56:48,397 - src.order.base - INFO - Order e776903f-1875-4e8e-8937-a21bf9447a80 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:56:48,398 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e776903f-1875-4e8e-8937-a21bf9447a80 at $308.86
2025-06-05 11:56:48,398 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:56:48,399 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:56:48,464 - src.tws_connection - INFO - Open Order - ID: 239, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:56:48,465 - src.order.base - INFO - Order 8c11eac1-4acc-412f-8579-8bb5f34746c2 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:56:48,515 - src.tws_connection - INFO - Open Order - ID: 240, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:56:48,912 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['8c11eac1-4acc-412f-8579-8bb5f34746c2']
2025-06-05 11:56:48,913 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:56:53,926 - src.rule.linked_order_actions - INFO - Using hardcoded ATR stop distance for GLD: 2.2500
2025-06-05 11:56:53,928 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$307.97, stop_distance=$2.25, dd_distance=$0.23, dd_price=$307.75, original_qty=100, dd_qty=100
2025-06-05 11:56:53,929 - src.order.base - INFO - Order 22c794e8-d378-4e8b-bc3f-188cee3d1055 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:56:53,940 - src.order.manager - INFO - Submitting order 22c794e8-d378-4e8b-bc3f-188cee3d1055 to TWS
2025-06-05 11:56:53,940 - src.order.manager - INFO - Got broker order ID 241 for order 22c794e8-d378-4e8b-bc3f-188cee3d1055
2025-06-05 11:56:53,941 - src.order.manager - INFO - Calling placeOrder with ID 241, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@307.750000 DAY
2025-06-05 11:56:53,942 - src.order.manager - INFO - placeOrder called successfully for order 22c794e8-d378-4e8b-bc3f-188cee3d1055
2025-06-05 11:56:53,943 - src.order.base - INFO - Order 22c794e8-d378-4e8b-bc3f-188cee3d1055 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:56:53,944 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:56:53,945 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $307.75
2025-06-05 11:56:53,946 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:56:53,946 - src.rule.linked_order_actions - INFO - Created and linked BUY main order aa929bc7-8949-42bb-b431-644728c8367b for GLD
2025-06-05 11:56:54,047 - src.tws_connection - INFO - Open Order - ID: 241, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:56:57,358 - __main__ - INFO - 
============================================================
2025-06-05 11:56:57,358 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:56:57,359 - __main__ - INFO - ============================================================
2025-06-05 11:56:57,359 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:56:57,359 - __main__ - INFO - Order e776903f-1875-4e8e-8937-a21bf9447a80: limit sell -100 @ 308.86 - Status: submitted
2025-06-05 11:56:57,360 - __main__ - INFO - Order 22c794e8-d378-4e8b-bc3f-188cee3d1055: limit buy 100 @ 307.75 - Status: submitted
2025-06-05 11:56:57,360 - __main__ - INFO - Order aa929bc7-8949-42bb-b431-644728c8367b: market buy 100 @ MARKET - Status: filled
2025-06-05 11:56:57,360 - __main__ - INFO - Order 8c11eac1-4acc-412f-8579-8bb5f34746c2: stop sell -100 @ 305.71 - Status: accepted
2025-06-05 11:56:57,361 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:56:57,361 - __main__ - INFO - Stop orders: 1
2025-06-05 11:56:57,362 - __main__ - INFO - Target orders: 1
2025-06-05 11:56:57,362 - __main__ - INFO - Double down orders: 1
2025-06-05 11:56:57,363 - __main__ - INFO - 
Double down order details:
2025-06-05 11:56:57,363 - __main__ - INFO -   ID: 22c794e8-d378-4e8b-bc3f-188cee3d1055
2025-06-05 11:56:57,363 - __main__ - INFO -   Status: submitted
2025-06-05 11:56:57,363 - __main__ - INFO -   Limit price: 307.75
2025-06-05 11:56:57,363 - __main__ - INFO -   Quantity: 100
2025-06-05 11:56:57,364 - __main__ - INFO - 
Original protective orders:
2025-06-05 11:56:57,364 - __main__ - INFO -   Stop: -100 @ $305.71
2025-06-05 11:56:57,364 - __main__ - INFO -   Target: -100 @ $308.86
2025-06-05 11:56:57,364 - __main__ - INFO - 
============================================================
2025-06-05 11:56:57,364 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 11:56:57,365 - __main__ - INFO - ============================================================
2025-06-05 11:56:57,365 - __main__ - INFO - Waiting for double down order 22c794e8-d378-4e8b-bc3f-188cee3d1055 to fill at $307.75...
2025-06-05 11:56:57,365 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 11:57:02,384 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 11:57:07,402 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 11:57:09,343 - src.order.base - INFO - Order e776903f-1875-4e8e-8937-a21bf9447a80 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:57:09,343 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 240)
2025-06-05 11:57:09,755 - src.order.base - INFO - Order 8c11eac1-4acc-412f-8579-8bb5f34746c2 status changed: accepted -> cancelled (IB status: Cancelled)
2025-06-05 11:57:09,754 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 239)
2025-06-05 11:57:10,060 - src.order.base - INFO - Order 22c794e8-d378-4e8b-bc3f-188cee3d1055 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:57:10,060 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 241)
2025-06-05 11:57:12,408 - __main__ - INFO - Waiting... (15s elapsed, order status: cancelled)
2025-06-05 11:57:17,419 - __main__ - INFO - Waiting... (20s elapsed, order status: cancelled)
2025-06-05 11:57:22,446 - __main__ - INFO - Waiting... (25s elapsed, order status: cancelled)
2025-06-05 11:57:27,456 - __main__ - INFO - Waiting... (30s elapsed, order status: cancelled)
2025-06-05 11:57:32,467 - __main__ - INFO - Waiting... (35s elapsed, order status: cancelled)
2025-06-05 11:57:37,474 - __main__ - INFO - Waiting... (40s elapsed, order status: cancelled)
2025-06-05 11:57:42,485 - __main__ - INFO - Waiting... (45s elapsed, order status: cancelled)
2025-06-05 11:57:47,497 - __main__ - INFO - Waiting... (50s elapsed, order status: cancelled)
2025-06-05 11:57:52,504 - __main__ - INFO - Waiting... (55s elapsed, order status: cancelled)
2025-06-05 11:57:57,520 - __main__ - INFO - Waiting... (60s elapsed, order status: cancelled)
2025-06-05 11:58:02,524 - __main__ - INFO - Waiting... (65s elapsed, order status: cancelled)
2025-06-05 11:58:07,534 - __main__ - INFO - Waiting... (70s elapsed, order status: cancelled)
2025-06-05 11:58:12,552 - __main__ - INFO - Waiting... (75s elapsed, order status: cancelled)
2025-06-05 11:58:17,564 - __main__ - INFO - Waiting... (80s elapsed, order status: cancelled)
2025-06-05 11:58:22,582 - __main__ - INFO - Waiting... (85s elapsed, order status: cancelled)
2025-06-05 11:58:27,589 - __main__ - INFO - Waiting... (90s elapsed, order status: cancelled)
2025-06-05 11:58:32,606 - __main__ - INFO - Waiting... (95s elapsed, order status: cancelled)
2025-06-05 11:58:37,617 - __main__ - INFO - Waiting... (100s elapsed, order status: cancelled)
2025-06-05 11:58:42,622 - __main__ - INFO - Waiting... (105s elapsed, order status: cancelled)
2025-06-05 11:58:47,637 - __main__ - INFO - Waiting... (110s elapsed, order status: cancelled)
2025-06-05 11:58:52,653 - __main__ - INFO - Waiting... (115s elapsed, order status: cancelled)
2025-06-05 11:58:57,679 - __main__ - INFO - Waiting... (120s elapsed, order status: cancelled)
2025-06-05 11:59:02,691 - __main__ - INFO - Waiting... (125s elapsed, order status: cancelled)
2025-06-05 11:59:07,700 - __main__ - INFO - Waiting... (130s elapsed, order status: cancelled)
2025-06-05 11:59:12,705 - __main__ - INFO - Waiting... (135s elapsed, order status: cancelled)
2025-06-05 11:59:17,727 - __main__ - INFO - Waiting... (140s elapsed, order status: cancelled)
2025-06-05 11:59:22,750 - __main__ - INFO - Waiting... (145s elapsed, order status: cancelled)
2025-06-05 11:59:27,772 - __main__ - INFO - Waiting... (150s elapsed, order status: cancelled)
2025-06-05 11:59:32,784 - __main__ - INFO - Waiting... (155s elapsed, order status: cancelled)
2025-06-05 11:59:37,801 - __main__ - INFO - Waiting... (160s elapsed, order status: cancelled)
2025-06-05 11:59:42,813 - __main__ - INFO - Waiting... (165s elapsed, order status: cancelled)
2025-06-05 11:59:47,831 - __main__ - INFO - Waiting... (170s elapsed, order status: cancelled)
2025-06-05 11:59:52,839 - __main__ - INFO - Waiting... (175s elapsed, order status: cancelled)
2025-06-05 11:59:57,841 - __main__ - INFO - Waiting... (180s elapsed, order status: cancelled)
2025-06-05 12:00:02,857 - __main__ - INFO - Waiting... (185s elapsed, order status: cancelled)
2025-06-05 12:00:07,872 - __main__ - INFO - Waiting... (190s elapsed, order status: cancelled)
2025-06-05 12:00:12,886 - __main__ - INFO - Waiting... (195s elapsed, order status: cancelled)
2025-06-05 12:00:17,889 - __main__ - INFO - Waiting... (200s elapsed, order status: cancelled)
2025-06-05 12:00:22,903 - __main__ - INFO - Waiting... (205s elapsed, order status: cancelled)
2025-06-05 12:00:27,925 - __main__ - INFO - Waiting... (210s elapsed, order status: cancelled)
2025-06-05 12:00:32,940 - __main__ - INFO - Waiting... (215s elapsed, order status: cancelled)
2025-06-05 12:00:37,951 - __main__ - INFO - Waiting... (220s elapsed, order status: cancelled)
2025-06-05 12:00:42,958 - __main__ - INFO - Waiting... (225s elapsed, order status: cancelled)
2025-06-05 12:00:47,975 - __main__ - INFO - Waiting... (230s elapsed, order status: cancelled)
2025-06-05 12:00:52,978 - __main__ - INFO - Waiting... (235s elapsed, order status: cancelled)
2025-06-05 12:00:57,985 - __main__ - INFO - Waiting... (240s elapsed, order status: cancelled)
2025-06-05 12:01:03,000 - __main__ - INFO - Waiting... (245s elapsed, order status: cancelled)
2025-06-05 12:01:08,014 - __main__ - INFO - Waiting... (250s elapsed, order status: cancelled)
2025-06-05 12:01:13,020 - __main__ - INFO - Waiting... (255s elapsed, order status: cancelled)
2025-06-05 12:01:18,034 - __main__ - INFO - Waiting... (260s elapsed, order status: cancelled)
2025-06-05 12:01:23,042 - __main__ - INFO - Waiting... (265s elapsed, order status: cancelled)
2025-06-05 12:01:28,050 - __main__ - INFO - Waiting... (270s elapsed, order status: cancelled)
2025-06-05 12:01:33,060 - __main__ - INFO - Waiting... (275s elapsed, order status: cancelled)
2025-06-05 12:01:38,061 - __main__ - INFO - Waiting... (280s elapsed, order status: cancelled)
2025-06-05 12:01:43,071 - __main__ - INFO - Waiting... (285s elapsed, order status: cancelled)
2025-06-05 12:01:48,078 - __main__ - INFO - Waiting... (290s elapsed, order status: cancelled)
2025-06-05 12:01:53,081 - __main__ - INFO - Waiting... (295s elapsed, order status: cancelled)
2025-06-05 12:01:58,098 - __main__ - WARNING - ⚠️ Double down order did not fill within 300 seconds
2025-06-05 12:01:58,103 - __main__ - INFO - Test incomplete - double down order did not fill naturally
2025-06-05 12:01:58,103 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 12:01:58,105 - src.order.manager - WARNING - Cannot cancel inactive order e776903f-1875-4e8e-8937-a21bf9447a80 with status cancelled
2025-06-05 12:01:58,105 - src.order.manager - WARNING - Cannot cancel inactive order 22c794e8-d378-4e8b-bc3f-188cee3d1055 with status cancelled
2025-06-05 12:01:58,105 - src.order.manager - WARNING - Cannot cancel inactive order aa929bc7-8949-42bb-b431-644728c8367b with status filled
2025-06-05 12:01:58,105 - src.order.manager - WARNING - Cannot cancel inactive order 8c11eac1-4acc-412f-8579-8bb5f34746c2 with status cancelled
2025-06-05 12:01:58,106 - __main__ - INFO - Cancelled 0 orders
2025-06-05 12:01:58,106 - __main__ - INFO - 
Cleaning up...
2025-06-05 12:01:58,108 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 12:01:58,109 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 12:01:58,111 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 12:01:58,113 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 12:01:58,114 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 12:01:59,782 - __main__ - INFO - ================================================================================
2025-06-05 12:01:59,782 - __main__ - INFO - DOUBLE DOWN FILL UPDATE TEST
2025-06-05 12:01:59,782 - __main__ - INFO - ================================================================================
2025-06-05 12:01:59,783 - __main__ - INFO - Connecting to TWS...
2025-06-05 12:01:59,783 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 12:01:59,784 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 12:02:01,762 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 12:02:01,771 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 12:02:01,797 - src.tws_connection - INFO - ✅ Next valid order ID received: 242
2025-06-05 12:02:01,800 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 12:02:01,802 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 12:02:01,802 - src.tws_connection - INFO - ✅ Next valid order ID received: 242
2025-06-05 12:02:01,804 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 12:02:01,809 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 12:02:01,810 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 12:02:01,810 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 12:02:01,805 - src.tws_connection - INFO - ✅ Next valid order ID received: 242
2025-06-05 12:02:06,811 - __main__ - INFO - Current GLD price: $307.84
2025-06-05 12:02:06,812 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 12:02:06,812 - LinkedDoubleDownFillManager - INFO - LinkedDoubleDownFillManager initialized
2025-06-05 12:02:06,812 - src.rule.engine - INFO - Rule engine started
2025-06-05 12:02:06,812 - __main__ - INFO - 
============================================================
2025-06-05 12:02:06,812 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 12:02:06,812 - __main__ - INFO - ============================================================
2025-06-05 12:02:06,813 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 12:02:06,813 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 12:02:06,813 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 12:02:06,813 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 12:02:06,813 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 12:02:06,814 - src.order.base - INFO - Order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:02:06,814 - src.order.manager - INFO - Submitting order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d to TWS
2025-06-05 12:02:06,814 - src.order.manager - INFO - Got broker order ID 242 for order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d
2025-06-05 12:02:06,814 - src.order.manager - INFO - Calling placeOrder with ID 242, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 12:02:06,815 - src.order.manager - INFO - placeOrder called successfully for order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d
2025-06-05 12:02:06,815 - src.order.base - INFO - Order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:02:06,816 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 12:02:06,816 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 12:02:06,823 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 12:02:06,824 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $305.59 (ATR: 0.0450 * 50.0 = 2.2500)
2025-06-05 12:02:06,824 - src.order.base - INFO - Order 3a7a9134-f05c-4be0-82fe-b65c9a016b99 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:02:06,824 - src.order.manager - INFO - Submitting order 3a7a9134-f05c-4be0-82fe-b65c9a016b99 to TWS
2025-06-05 12:02:06,824 - src.order.manager - INFO - Got broker order ID 243 for order 3a7a9134-f05c-4be0-82fe-b65c9a016b99
2025-06-05 12:02:06,824 - src.order.manager - INFO - Calling placeOrder with ID 243, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 12:02:06,824 - src.order.manager - INFO - placeOrder called successfully for order 3a7a9134-f05c-4be0-82fe-b65c9a016b99
2025-06-05 12:02:06,824 - src.order.base - INFO - Order 3a7a9134-f05c-4be0-82fe-b65c9a016b99 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:02:06,824 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 3a7a9134-f05c-4be0-82fe-b65c9a016b99 at $305.59
2025-06-05 12:02:06,824 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 12:02:06,824 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $308.74 (ATR: 0.0450 * 20.0 = 0.9000)
2025-06-05 12:02:06,825 - src.order.base - INFO - Order 5b88a0ff-d63a-4722-8027-97da8c2f79e1 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:02:06,826 - src.order.manager - INFO - Submitting order 5b88a0ff-d63a-4722-8027-97da8c2f79e1 to TWS
2025-06-05 12:02:06,826 - src.order.manager - INFO - Got broker order ID 244 for order 5b88a0ff-d63a-4722-8027-97da8c2f79e1
2025-06-05 12:02:06,827 - src.order.manager - INFO - Calling placeOrder with ID 244, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@308.740000 DAY
2025-06-05 12:02:06,828 - src.order.manager - INFO - placeOrder called successfully for order 5b88a0ff-d63a-4722-8027-97da8c2f79e1
2025-06-05 12:02:06,828 - src.order.base - INFO - Order 5b88a0ff-d63a-4722-8027-97da8c2f79e1 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:02:06,828 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 5b88a0ff-d63a-4722-8027-97da8c2f79e1 at $308.74
2025-06-05 12:02:06,829 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 12:02:06,829 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 12:02:06,938 - src.tws_connection - INFO - Open Order - ID: 242, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:02:06,944 - src.tws_connection - INFO - Open Order - ID: 243, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 12:02:06,945 - src.order.base - INFO - Order 3a7a9134-f05c-4be0-82fe-b65c9a016b99 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 12:02:06,973 - src.tws_connection - INFO - Open Order - ID: 244, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 12:02:07,040 - src.order.base - INFO - Order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d status changed: submitted -> filled (Order fully filled)
2025-06-05 12:02:07,040 - src.order.base - INFO - Order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d filled: 100.0 @ 307.82 (100.0/100)
2025-06-05 12:02:07,041 - src.tws_connection - INFO - Open Order - ID: 242, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:02:07,041 - src.tws_connection - INFO - Open Order - ID: 242, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:02:07,338 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['3a7a9134-f05c-4be0-82fe-b65c9a016b99']
2025-06-05 12:02:07,338 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 12:02:07,338 - src.rule.linked_order_actions - INFO - Using context price for GLD: $307.84
2025-06-05 12:02:07,338 - src.rule.linked_order_actions - INFO - Using hardcoded ATR stop distance for GLD: 2.2500
2025-06-05 12:02:07,339 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$307.84, stop_distance=$2.25, dd_distance=$0.23, dd_price=$307.61, original_qty=100, dd_qty=100
2025-06-05 12:02:07,339 - src.order.base - INFO - Order 62c47da0-38fd-4560-94f2-d70817da3277 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:02:07,339 - src.order.manager - INFO - Submitting order 62c47da0-38fd-4560-94f2-d70817da3277 to TWS
2025-06-05 12:02:07,339 - src.order.manager - INFO - Got broker order ID 245 for order 62c47da0-38fd-4560-94f2-d70817da3277
2025-06-05 12:02:07,340 - src.order.manager - INFO - Calling placeOrder with ID 245, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@307.610000 DAY
2025-06-05 12:02:07,340 - src.order.manager - INFO - placeOrder called successfully for order 62c47da0-38fd-4560-94f2-d70817da3277
2025-06-05 12:02:07,340 - src.order.base - INFO - Order 62c47da0-38fd-4560-94f2-d70817da3277 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:02:07,340 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 12:02:07,340 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $307.61
2025-06-05 12:02:07,340 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 12:02:07,341 - src.rule.linked_order_actions - INFO - Created and linked BUY main order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d for GLD
2025-06-05 12:02:07,498 - src.tws_connection - INFO - Open Order - ID: 245, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:02:16,827 - __main__ - INFO - 
============================================================
2025-06-05 12:02:16,827 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 12:02:16,827 - __main__ - INFO - ============================================================
2025-06-05 12:02:16,827 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 12:02:16,827 - __main__ - INFO - Order 5b88a0ff-d63a-4722-8027-97da8c2f79e1: limit sell -100 @ 308.74 - Status: submitted
2025-06-05 12:02:16,827 - __main__ - INFO - Order cacd2245-90ff-4c7c-8b9e-f7f1b0c95d2d: market buy 100 @ MARKET - Status: filled
2025-06-05 12:02:16,827 - __main__ - INFO - Order 3a7a9134-f05c-4be0-82fe-b65c9a016b99: stop sell -100 @ 305.59 - Status: accepted
2025-06-05 12:02:16,827 - __main__ - INFO - Order 62c47da0-38fd-4560-94f2-d70817da3277: limit buy 100 @ 307.61 - Status: submitted
2025-06-05 12:02:16,828 - __main__ - INFO - 
Main orders: 1
2025-06-05 12:02:16,828 - __main__ - INFO - Stop orders: 1
2025-06-05 12:02:16,828 - __main__ - INFO - Target orders: 1
2025-06-05 12:02:16,828 - __main__ - INFO - Double down orders: 1
2025-06-05 12:02:16,828 - __main__ - INFO - 
Double down order details:
2025-06-05 12:02:16,828 - __main__ - INFO -   ID: 62c47da0-38fd-4560-94f2-d70817da3277
2025-06-05 12:02:16,828 - __main__ - INFO -   Status: submitted
2025-06-05 12:02:16,828 - __main__ - INFO -   Limit price: 307.61
2025-06-05 12:02:16,828 - __main__ - INFO -   Quantity: 100
2025-06-05 12:02:16,828 - __main__ - INFO - 
Original protective orders:
2025-06-05 12:02:16,828 - __main__ - INFO -   Stop: -100 @ $305.59
2025-06-05 12:02:16,828 - __main__ - INFO -   Target: -100 @ $308.74
2025-06-05 12:02:16,829 - __main__ - INFO - 
============================================================
2025-06-05 12:02:16,829 - __main__ - INFO - STEP 3: Waiting for double down order to fill
2025-06-05 12:02:16,829 - __main__ - INFO - ============================================================
2025-06-05 12:02:16,829 - __main__ - INFO - Waiting for double down order 62c47da0-38fd-4560-94f2-d70817da3277 to fill at $307.61...
2025-06-05 12:02:16,829 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 12:02:21,844 - __main__ - INFO - Waiting... (5s elapsed, order status: submitted)
2025-06-05 12:02:26,858 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 12:02:30,830 - src.order.base - INFO - Order 62c47da0-38fd-4560-94f2-d70817da3277 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 12:02:30,829 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 245)
2025-06-05 12:02:31,106 - src.order.base - INFO - Order 5b88a0ff-d63a-4722-8027-97da8c2f79e1 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 12:02:31,106 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 244)
2025-06-05 12:02:31,375 - src.order.base - INFO - Order 3a7a9134-f05c-4be0-82fe-b65c9a016b99 status changed: accepted -> cancelled (IB status: Cancelled)
2025-06-05 12:02:31,374 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 243)
2025-06-05 12:02:31,869 - __main__ - INFO - Waiting... (15s elapsed, order status: cancelled)
2025-06-05 12:02:36,874 - __main__ - INFO - Waiting... (20s elapsed, order status: cancelled)
2025-06-05 12:02:41,888 - __main__ - INFO - Waiting... (25s elapsed, order status: cancelled)
2025-06-05 12:02:46,898 - __main__ - INFO - Waiting... (30s elapsed, order status: cancelled)
2025-06-05 12:02:51,909 - __main__ - INFO - Waiting... (35s elapsed, order status: cancelled)
2025-06-05 12:02:56,915 - __main__ - INFO - Waiting... (40s elapsed, order status: cancelled)
2025-06-05 12:03:01,925 - __main__ - INFO - Waiting... (45s elapsed, order status: cancelled)
2025-06-05 12:03:06,927 - __main__ - INFO - Waiting... (50s elapsed, order status: cancelled)
2025-06-05 12:03:11,931 - __main__ - INFO - Waiting... (55s elapsed, order status: cancelled)
2025-06-05 12:03:16,944 - __main__ - INFO - Waiting... (60s elapsed, order status: cancelled)
2025-06-05 12:03:21,959 - __main__ - INFO - Waiting... (65s elapsed, order status: cancelled)
2025-06-05 12:03:26,968 - __main__ - INFO - Waiting... (70s elapsed, order status: cancelled)
2025-06-05 12:03:31,971 - __main__ - INFO - Waiting... (75s elapsed, order status: cancelled)
2025-06-05 12:03:36,985 - __main__ - INFO - Waiting... (80s elapsed, order status: cancelled)
2025-06-05 12:03:42,027 - __main__ - INFO - Waiting... (85s elapsed, order status: cancelled)
2025-06-05 12:03:47,297 - __main__ - INFO - Waiting... (90s elapsed, order status: cancelled)
2025-06-05 12:03:52,328 - __main__ - INFO - Waiting... (95s elapsed, order status: cancelled)
2025-06-05 12:03:57,339 - __main__ - INFO - Waiting... (100s elapsed, order status: cancelled)
2025-06-05 12:04:02,357 - __main__ - INFO - Waiting... (105s elapsed, order status: cancelled)
2025-06-05 12:04:07,362 - __main__ - INFO - Waiting... (110s elapsed, order status: cancelled)
2025-06-05 12:04:12,377 - __main__ - INFO - Waiting... (115s elapsed, order status: cancelled)
2025-06-05 12:04:17,393 - __main__ - INFO - Waiting... (120s elapsed, order status: cancelled)
2025-06-05 12:04:22,402 - __main__ - INFO - Waiting... (125s elapsed, order status: cancelled)
2025-06-05 12:04:27,417 - __main__ - INFO - Waiting... (130s elapsed, order status: cancelled)
2025-06-05 12:04:32,430 - __main__ - INFO - Waiting... (135s elapsed, order status: cancelled)
2025-06-05 12:04:37,444 - __main__ - INFO - Waiting... (140s elapsed, order status: cancelled)
2025-06-05 12:04:42,450 - __main__ - INFO - Waiting... (145s elapsed, order status: cancelled)
2025-06-05 12:04:47,461 - __main__ - INFO - Waiting... (150s elapsed, order status: cancelled)
