2025-06-12 12:35:22,255 - __main__ - INFO - ================================================================================
2025-06-12 12:35:22,255 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 12:35:22,255 - __main__ - INFO - ================================================================================
2025-06-12 12:35:22,256 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 12:35:22,256 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 12:35:22,256 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 12:35:22,258 - __main__ - INFO - Connecting to TWS...
2025-06-12 12:35:22,258 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 12:35:22,260 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 12:35:24,827 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 12:35:24,828 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 12:35:24,838 - src.tws_connection - INFO - ✅ Next valid order ID received: 2084
2025-06-12 12:35:24,838 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 12:35:24,839 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 12:35:24,840 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 12:35:24,840 - __main__ - INFO - Connected to TWS successfully
2025-06-12 12:35:24,840 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 12:35:24,841 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 12:35:24,841 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 12:35:24,841 - __main__ - INFO - Rule engine context configured
2025-06-12 12:35:24,842 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 12:35:24,842 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 12:35:24,842 - __main__ - INFO - 
================================================================================
2025-06-12 12:35:24,842 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 12:35:24,842 - __main__ - INFO - ================================================================================
2025-06-12 12:35:24,843 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 12:35:24,843 - __main__ - INFO - Created BUY action ($10K allocation, 3% stop, 6% target)
2025-06-12 12:35:24,843 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 12:35:24,844 - __main__ - INFO - 
================================================================================
2025-06-12 12:35:24,844 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 12:35:24,844 - __main__ - INFO - ================================================================================
2025-06-12 12:35:24,944 - src.tws_connection - INFO - ✅ Next valid order ID received: 2084
2025-06-12 12:35:25,028 - src.tws_connection - INFO - ✅ Next valid order ID received: 2084
2025-06-12 12:35:29,848 - __main__ - INFO - Current SLV price: $32.97
2025-06-12 12:35:29,849 - __main__ - INFO - Created prediction event:
2025-06-12 12:35:29,849 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:29,849 - __main__ - INFO -    Signal: BUY
2025-06-12 12:35:29,850 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 12:35:29,851 - __main__ - INFO -    Price: $32.97
2025-06-12 12:35:29,851 - src.rule.engine - INFO - Rule engine started
2025-06-12 12:35:29,852 - __main__ - INFO - Rule engine started
2025-06-12 12:35:29,852 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 12:35:29,852 - __main__ - INFO - Prediction event emitted
2025-06-12 12:35:29,853 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 12:35:29,853 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 12:35:29,854 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 12:35:29,854 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 12:35:29,854 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 12:35:30,864 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.97 = $9989.91 (99.9% of $10000.00 allocation)
2025-06-12 12:35:30,865 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:35:30,866 - src.order.manager - INFO - Submitting order e858840e-4d2e-4eb7-b5fa-44ca51534e26 to TWS
2025-06-12 12:35:30,867 - src.order.manager - INFO - Got broker order ID 2084 for order e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,867 - src.order.manager - INFO - Calling placeOrder with ID 2084, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 12:35:30,868 - src.order.manager - INFO - placeOrder called successfully for order e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,868 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:35:30,870 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 12:35:30,870 - src.rule.linked_order_actions - INFO - Percentage-based stop: SLV stop at $31.98 (3.0%)
2025-06-12 12:35:30,871 - src.order.base - INFO - Order a0de0e4c-193b-400a-8e14-c5e5aae5435b status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:35:30,871 - src.order.manager - INFO - Submitting order a0de0e4c-193b-400a-8e14-c5e5aae5435b to TWS
2025-06-12 12:35:30,871 - src.order.manager - INFO - Got broker order ID 2085 for order a0de0e4c-193b-400a-8e14-c5e5aae5435b
2025-06-12 12:35:30,872 - src.order.manager - INFO - Calling placeOrder with ID 2085, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 12:35:30,872 - src.order.manager - INFO - placeOrder called successfully for order a0de0e4c-193b-400a-8e14-c5e5aae5435b
2025-06-12 12:35:30,872 - src.order.base - INFO - Order a0de0e4c-193b-400a-8e14-c5e5aae5435b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:35:30,873 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 12:35:30,873 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss a0de0e4c-193b-400a-8e14-c5e5aae5435b at $31.98
2025-06-12 12:35:30,873 - src.rule.linked_order_actions - INFO - Percentage-based target: SLV target at $34.95 (6.0%)
2025-06-12 12:35:30,874 - src.order.base - INFO - Order 7dba0715-0ef1-42e4-aa79-c1a34c289841 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:35:30,875 - src.order.manager - INFO - Submitting order 7dba0715-0ef1-42e4-aa79-c1a34c289841 to TWS
2025-06-12 12:35:30,876 - src.order.manager - INFO - Got broker order ID 2086 for order 7dba0715-0ef1-42e4-aa79-c1a34c289841
2025-06-12 12:35:30,876 - src.order.manager - INFO - Calling placeOrder with ID 2086, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@34.950000 DAY
2025-06-12 12:35:30,877 - src.order.manager - INFO - placeOrder called successfully for order 7dba0715-0ef1-42e4-aa79-c1a34c289841
2025-06-12 12:35:30,877 - src.order.base - INFO - Order 7dba0715-0ef1-42e4-aa79-c1a34c289841 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:35:30,877 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 12:35:30,878 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 7dba0715-0ef1-42e4-aa79-c1a34c289841 at $34.95
2025-06-12 12:35:30,878 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 12:35:30,878 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:35:30,879 - __main__ - INFO -    Order ID: e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,879 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:30,879 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 12:35:30,879 - __main__ - INFO -    Quantity: 303
2025-06-12 12:35:30,880 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:30,880 - __main__ - INFO -    Order ID: e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,880 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:35:30,880 - __main__ - INFO -    Previous: created
2025-06-12 12:35:30,880 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:30,881 - __main__ - INFO -    Order ID: e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,881 - __main__ - INFO -    Status: submitted
2025-06-12 12:35:30,881 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:35:30,881 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:35:30,882 - __main__ - INFO -    Order ID: a0de0e4c-193b-400a-8e14-c5e5aae5435b
2025-06-12 12:35:30,882 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:30,882 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 12:35:30,883 - __main__ - INFO -    Quantity: -303
2025-06-12 12:35:30,883 - __main__ - INFO -    Stop Price: $31.98
2025-06-12 12:35:30,884 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:30,884 - __main__ - INFO -    Order ID: a0de0e4c-193b-400a-8e14-c5e5aae5435b
2025-06-12 12:35:30,884 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:35:30,885 - __main__ - INFO -    Previous: created
2025-06-12 12:35:30,887 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:30,888 - __main__ - INFO -    Order ID: a0de0e4c-193b-400a-8e14-c5e5aae5435b
2025-06-12 12:35:30,888 - __main__ - INFO -    Status: submitted
2025-06-12 12:35:30,888 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:35:30,889 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:35:30,889 - __main__ - INFO -    Order ID: 7dba0715-0ef1-42e4-aa79-c1a34c289841
2025-06-12 12:35:30,889 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:30,890 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:35:30,890 - __main__ - INFO -    Quantity: -303
2025-06-12 12:35:30,892 - __main__ - INFO -    Limit Price: $34.95
2025-06-12 12:35:30,893 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:30,894 - __main__ - INFO -    Order ID: 7dba0715-0ef1-42e4-aa79-c1a34c289841
2025-06-12 12:35:30,894 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:35:30,894 - __main__ - INFO -    Previous: created
2025-06-12 12:35:30,895 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:30,895 - __main__ - INFO -    Order ID: 7dba0715-0ef1-42e4-aa79-c1a34c289841
2025-06-12 12:35:30,895 - __main__ - INFO -    Status: submitted
2025-06-12 12:35:30,896 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:35:30,973 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:30,975 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:35:30,979 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 12:35:30,980 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 filled: 200.0 @ 32.98 (200.0/303)
2025-06-12 12:35:30,981 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:35:30,980 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:30,981 - __main__ - INFO -    Order ID: e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,982 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:30,982 - __main__ - INFO -    Fill Price: $32.98
2025-06-12 12:35:30,982 - __main__ - INFO -    Fill Quantity: 200.0
2025-06-12 12:35:30,982 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:35:30,983 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:35:30,983 - UnifiedFillManager - INFO - Processing fill for SLV: 200.0 shares on order e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,983 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:35:30,984 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:35:30,984 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 12:35:30,986 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 12:35:30,987 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 filled: 100.0 @ 32.98 (300.0/303)
2025-06-12 12:35:30,987 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:30,988 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:35:30,988 - __main__ - INFO -    Order ID: e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,989 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:30,989 - __main__ - INFO -    Fill Price: $32.98
2025-06-12 12:35:30,989 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 12:35:30,989 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:35:30,990 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:35:30,990 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,990 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:35:30,991 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:35:30,993 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 12:35:30,992 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:30,993 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 status changed: accepted -> filled (Order fully filled)
2025-06-12 12:35:30,994 - src.order.base - INFO - Order e858840e-4d2e-4eb7-b5fa-44ca51534e26 filled: 3.0 @ 32.98 (303.0/303)
2025-06-12 12:35:30,994 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:35:30,995 - __main__ - INFO -    Order ID: e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,995 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:30,995 - __main__ - INFO -    Fill Price: $32.98
2025-06-12 12:35:30,996 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 12:35:30,996 - __main__ - INFO -    Status: filled
2025-06-12 12:35:30,996 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:35:30,996 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:35:30,997 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:35:30,997 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:35:31,018 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:31,023 - src.tws_connection - INFO - Open Order - ID: 2085, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:35:31,024 - src.order.base - INFO - Order a0de0e4c-193b-400a-8e14-c5e5aae5435b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:35:31,024 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:31,026 - src.tws_connection - INFO - Open Order - ID: 2084, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:31,029 - src.tws_connection - INFO - Open Order - ID: 2086, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:35:31,389 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['a0de0e4c-193b-400a-8e14-c5e5aae5435b']
2025-06-12 12:35:31,390 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 12:35:31,390 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.97
2025-06-12 12:35:31,391 - src.rule.linked_order_actions - INFO - Using percentage-based stop distance for SLV: 0.9891
2025-06-12 12:35:31,391 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.97, stop_distance=$0.99, dd_distance=$0.49, dd_price=$32.48, original_qty=303, dd_qty=303
2025-06-12 12:35:31,392 - src.order.base - INFO - Order 60ba4790-551d-4315-8c18-8da2d67bde51 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:35:31,392 - src.order.manager - INFO - Submitting order 60ba4790-551d-4315-8c18-8da2d67bde51 to TWS
2025-06-12 12:35:31,392 - src.order.manager - INFO - Got broker order ID 2087 for order 60ba4790-551d-4315-8c18-8da2d67bde51
2025-06-12 12:35:31,393 - src.order.manager - INFO - Calling placeOrder with ID 2087, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.480000 DAY
2025-06-12 12:35:31,393 - src.order.manager - INFO - placeOrder called successfully for order 60ba4790-551d-4315-8c18-8da2d67bde51
2025-06-12 12:35:31,393 - src.order.base - INFO - Order 60ba4790-551d-4315-8c18-8da2d67bde51 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:35:31,394 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 12:35:31,394 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.48
2025-06-12 12:35:31,394 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 12:35:31,394 - src.rule.linked_order_actions - INFO - Created and linked BUY main order e858840e-4d2e-4eb7-b5fa-44ca51534e26 for SLV
2025-06-12 12:35:31,394 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:35:31,395 - __main__ - INFO -    Order ID: 60ba4790-551d-4315-8c18-8da2d67bde51
2025-06-12 12:35:31,395 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:35:31,395 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:35:31,395 - __main__ - INFO -    Quantity: 303
2025-06-12 12:35:31,396 - __main__ - INFO -    Limit Price: $32.48
2025-06-12 12:35:31,396 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:31,396 - __main__ - INFO -    Order ID: 60ba4790-551d-4315-8c18-8da2d67bde51
2025-06-12 12:35:31,396 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:35:31,396 - __main__ - INFO -    Previous: created
2025-06-12 12:35:31,397 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:35:31,397 - __main__ - INFO -    Order ID: 60ba4790-551d-4315-8c18-8da2d67bde51
2025-06-12 12:35:31,397 - __main__ - INFO -    Status: submitted
2025-06-12 12:35:31,397 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:35:31,493 - src.tws_connection - INFO - Open Order - ID: 2087, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:35:32,868 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 12:36:07,413 - __main__ - ERROR - 
❌ Test failed with error: 
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\tests\tws_order_management\test_live_slv_buy_flow_unified.py", line 447, in main
    response = input("\nSimulate partial fill to test UnifiedFillManager? (y/n): ")
EOFError
2025-06-12 12:36:07,416 - __main__ - INFO - 
================================================================================
2025-06-12 12:36:07,416 - __main__ - INFO - CLEANING UP TEST
2025-06-12 12:36:07,416 - __main__ - INFO - ================================================================================
2025-06-12 12:36:07,417 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 12:36:07,417 - src.order.manager - WARNING - Cannot cancel inactive order e858840e-4d2e-4eb7-b5fa-44ca51534e26 with status filled
2025-06-12 12:36:07,417 - __main__ - INFO -    Cancelled order e858840e-4d2e-4eb7-b5fa-44ca51534e26
2025-06-12 12:36:07,417 - src.order.base - INFO - Order a0de0e4c-193b-400a-8e14-c5e5aae5435b status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 12:36:07,417 - src.order.manager - INFO - Cancelling order a0de0e4c-193b-400a-8e14-c5e5aae5435b with broker ID 2085
2025-06-12 12:36:07,418 - __main__ - INFO -    Cancelled order a0de0e4c-193b-400a-8e14-c5e5aae5435b
2025-06-12 12:36:07,418 - src.order.base - INFO - Order 7dba0715-0ef1-42e4-aa79-c1a34c289841 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:36:07,418 - src.order.manager - INFO - Cancelling order 7dba0715-0ef1-42e4-aa79-c1a34c289841 with broker ID 2086
2025-06-12 12:36:07,418 - __main__ - INFO -    Cancelled order 7dba0715-0ef1-42e4-aa79-c1a34c289841
2025-06-12 12:36:07,418 - src.order.base - INFO - Order 60ba4790-551d-4315-8c18-8da2d67bde51 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:36:07,418 - src.order.manager - INFO - Cancelling order 60ba4790-551d-4315-8c18-8da2d67bde51 with broker ID 2087
2025-06-12 12:36:07,419 - __main__ - INFO -    Cancelled order 60ba4790-551d-4315-8c18-8da2d67bde51
2025-06-12 12:36:07,419 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 12:36:07,419 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 12:36:07,419 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 12:36:07,419 - __main__ - INFO - Rule engine stopped
2025-06-12 12:36:07,419 - __main__ - INFO - 
Test cleanup complete
2025-06-12 12:36:07,420 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 12:36:07,420 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 12:36:07,421 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 12:36:07,422 - __main__ - INFO - Disconnected from TWS
2025-06-12 12:36:07,422 - __main__ - INFO - 
================================================================================
2025-06-12 12:36:07,422 - __main__ - INFO - TEST COMPLETE
2025-06-12 12:36:07,422 - __main__ - INFO - ================================================================================
2025-06-12 12:40:43,700 - __main__ - INFO - ================================================================================
2025-06-12 12:40:43,700 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 12:40:43,701 - __main__ - INFO - ================================================================================
2025-06-12 12:40:43,701 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 12:40:43,701 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 12:40:43,702 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 12:40:43,704 - __main__ - INFO - Connecting to TWS...
2025-06-12 12:40:43,704 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 12:40:43,706 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 12:40:45,452 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 12:40:45,453 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 12:40:45,466 - src.tws_connection - INFO - ✅ Next valid order ID received: 2088
2025-06-12 12:40:45,466 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 12:40:45,467 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 12:40:45,467 - src.tws_connection - INFO - ✅ Next valid order ID received: 2088
2025-06-12 12:40:45,468 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 12:40:45,469 - __main__ - INFO - Connected to TWS successfully
2025-06-12 12:40:45,468 - src.tws_connection - INFO - ✅ Next valid order ID received: 2088
2025-06-12 12:40:45,470 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 12:40:45,471 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 12:40:45,471 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 12:40:45,472 - __main__ - INFO - Rule engine context configured
2025-06-12 12:40:45,472 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 12:40:45,473 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 12:40:45,473 - __main__ - INFO - 
================================================================================
2025-06-12 12:40:45,473 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 12:40:45,473 - __main__ - INFO - ================================================================================
2025-06-12 12:40:45,474 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 12:40:45,474 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 12:40:45,474 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 12:40:45,475 - __main__ - INFO - 
================================================================================
2025-06-12 12:40:45,475 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 12:40:45,475 - __main__ - INFO - ================================================================================
2025-06-12 12:40:50,482 - __main__ - INFO - Current SLV price: $32.95
2025-06-12 12:40:50,483 - __main__ - INFO - Created prediction event:
2025-06-12 12:40:50,483 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:50,483 - __main__ - INFO -    Signal: BUY
2025-06-12 12:40:50,484 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 12:40:50,484 - __main__ - INFO -    Price: $32.95
2025-06-12 12:40:50,484 - src.rule.engine - INFO - Rule engine started
2025-06-12 12:40:50,484 - __main__ - INFO - Rule engine started
2025-06-12 12:40:50,484 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 12:40:50,485 - __main__ - INFO - Prediction event emitted
2025-06-12 12:40:50,485 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 12:40:50,485 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 12:40:50,485 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 12:40:50,486 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 12:40:50,486 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 12:40:51,496 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.96 = $9986.88 (99.9% of $10000.00 allocation)
2025-06-12 12:40:51,497 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:40:51,498 - src.order.manager - INFO - Submitting order 241e7691-f840-4723-bfaa-4eb63547c916 to TWS
2025-06-12 12:40:51,498 - src.order.manager - INFO - Got broker order ID 2088 for order 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,498 - src.order.manager - INFO - Calling placeOrder with ID 2088, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 12:40:51,499 - src.order.manager - INFO - placeOrder called successfully for order 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,499 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:40:51,500 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 12:40:51,524 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:40:51,525 - __main__ - INFO -    Order ID: 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,526 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:51,526 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 12:40:51,527 - __main__ - INFO -    Quantity: 303
2025-06-12 12:40:51,527 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:51,528 - __main__ - INFO -    Order ID: 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,528 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:40:51,529 - __main__ - INFO -    Previous: created
2025-06-12 12:40:51,530 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:51,531 - __main__ - INFO -    Order ID: 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,531 - __main__ - INFO -    Status: submitted
2025-06-12 12:40:51,532 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:40:51,596 - src.tws_connection - INFO - Open Order - ID: 2088, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:40:51,598 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:40:51,601 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 12:40:51,601 - src.tws_connection - INFO - Open Order - ID: 2088, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:40:51,602 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 filled: 200.0 @ 32.96 (200.0/303)
2025-06-12 12:40:51,603 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:40:51,604 - __main__ - INFO -    Order ID: 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,606 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:51,606 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 12:40:51,606 - __main__ - INFO -    Fill Quantity: 200.0
2025-06-12 12:40:51,606 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:40:51,607 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:40:51,607 - UnifiedFillManager - INFO - Processing fill for SLV: 200.0 shares on order 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,608 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:40:51,608 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:40:51,608 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 12:40:51,609 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 status changed: accepted -> filled (Order fully filled)
2025-06-12 12:40:51,610 - src.order.base - INFO - Order 241e7691-f840-4723-bfaa-4eb63547c916 filled: 103.0 @ 32.96 (303.0/303)
2025-06-12 12:40:51,610 - src.tws_connection - INFO - Open Order - ID: 2088, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:40:51,611 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:40:51,612 - __main__ - INFO -    Order ID: 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,612 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:51,612 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 12:40:51,613 - __main__ - INFO -    Fill Quantity: 103.0
2025-06-12 12:40:51,613 - __main__ - INFO -    Status: filled
2025-06-12 12:40:51,614 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:40:51,614 - UnifiedFillManager - INFO - Processing fill for SLV: 103.0 shares on order 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:40:51,614 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:40:51,615 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:40:51,653 - src.tws_connection - INFO - Open Order - ID: 2088, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:40:51,655 - src.tws_connection - INFO - Open Order - ID: 2088, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:40:51,772 - src.tws_connection - WARNING - ⚠️ TWS Error 2176: Warning: Your API version does not support fractional share size rules. Please upgrade to a minimum version 163. Trimmed value 1845.91 to 1845 (reqId: 1000)
2025-06-12 12:40:53,494 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 12:40:53,495 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.93 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 12:40:53,495 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:40:53,496 - src.order.manager - INFO - Submitting order b4c32414-3355-4994-b6ab-920e141e9967 to TWS
2025-06-12 12:40:53,496 - src.order.manager - INFO - Got broker order ID 2089 for order b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:40:53,497 - src.order.manager - INFO - Calling placeOrder with ID 2089, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 12:40:53,497 - src.order.manager - INFO - placeOrder called successfully for order b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:40:53,497 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:40:53,498 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 12:40:53,498 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss b4c32414-3355-4994-b6ab-920e141e9967 at $32.93
2025-06-12 12:40:53,498 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.97 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 12:40:53,499 - src.order.base - INFO - Order 4300b1bb-f051-40d3-9fa1-13c399796f53 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:40:53,500 - src.order.manager - INFO - Submitting order 4300b1bb-f051-40d3-9fa1-13c399796f53 to TWS
2025-06-12 12:40:53,500 - src.order.manager - INFO - Got broker order ID 2090 for order 4300b1bb-f051-40d3-9fa1-13c399796f53
2025-06-12 12:40:53,501 - src.order.manager - INFO - Calling placeOrder with ID 2090, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.970000 DAY
2025-06-12 12:40:53,501 - src.order.manager - INFO - placeOrder called successfully for order 4300b1bb-f051-40d3-9fa1-13c399796f53
2025-06-12 12:40:53,502 - src.order.base - INFO - Order 4300b1bb-f051-40d3-9fa1-13c399796f53 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:40:53,502 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 12:40:53,503 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 4300b1bb-f051-40d3-9fa1-13c399796f53 at $32.97
2025-06-12 12:40:53,503 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 12:40:53,504 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:40:53,504 - __main__ - INFO -    Order ID: b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:40:53,504 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:53,504 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 12:40:53,504 - __main__ - INFO -    Quantity: -303
2025-06-12 12:40:53,505 - __main__ - INFO -    Stop Price: $32.93
2025-06-12 12:40:53,505 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:53,505 - __main__ - INFO -    Order ID: b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:40:53,505 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:40:53,505 - __main__ - INFO -    Previous: created
2025-06-12 12:40:53,505 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:53,506 - __main__ - INFO -    Order ID: b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:40:53,506 - __main__ - INFO -    Status: submitted
2025-06-12 12:40:53,506 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:40:53,506 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:40:53,506 - __main__ - INFO -    Order ID: 4300b1bb-f051-40d3-9fa1-13c399796f53
2025-06-12 12:40:53,506 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:53,506 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:40:53,506 - __main__ - INFO -    Quantity: -303
2025-06-12 12:40:53,507 - __main__ - INFO -    Limit Price: $32.97
2025-06-12 12:40:53,507 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:53,508 - __main__ - INFO -    Order ID: 4300b1bb-f051-40d3-9fa1-13c399796f53
2025-06-12 12:40:53,508 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:40:53,508 - __main__ - INFO -    Previous: created
2025-06-12 12:40:53,508 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:53,509 - __main__ - INFO -    Order ID: 4300b1bb-f051-40d3-9fa1-13c399796f53
2025-06-12 12:40:53,509 - __main__ - INFO -    Status: submitted
2025-06-12 12:40:53,509 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:40:53,509 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 12:40:53,578 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:40:53,579 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:40:53,622 - src.tws_connection - INFO - Open Order - ID: 2090, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:40:54,019 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['b4c32414-3355-4994-b6ab-920e141e9967']
2025-06-12 12:40:54,020 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 12:40:54,020 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.95
2025-06-12 12:40:54,064 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 12:40:54,065 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.95, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.94, original_qty=303, dd_qty=303
2025-06-12 12:40:54,065 - src.order.base - INFO - Order 29abe5bd-d6e6-422b-bb54-776856e64a14 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:40:54,065 - src.order.manager - INFO - Submitting order 29abe5bd-d6e6-422b-bb54-776856e64a14 to TWS
2025-06-12 12:40:54,065 - src.order.manager - INFO - Got broker order ID 2091 for order 29abe5bd-d6e6-422b-bb54-776856e64a14
2025-06-12 12:40:54,066 - src.order.manager - INFO - Calling placeOrder with ID 2091, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.940000 DAY
2025-06-12 12:40:54,066 - src.order.manager - INFO - placeOrder called successfully for order 29abe5bd-d6e6-422b-bb54-776856e64a14
2025-06-12 12:40:54,067 - src.order.base - INFO - Order 29abe5bd-d6e6-422b-bb54-776856e64a14 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:40:54,067 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 12:40:54,068 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.94
2025-06-12 12:40:54,068 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 12:40:54,068 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 241e7691-f840-4723-bfaa-4eb63547c916 for SLV
2025-06-12 12:40:54,068 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:40:54,068 - __main__ - INFO -    Order ID: 29abe5bd-d6e6-422b-bb54-776856e64a14
2025-06-12 12:40:54,068 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:40:54,068 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:40:54,068 - __main__ - INFO -    Quantity: 303
2025-06-12 12:40:54,068 - __main__ - INFO -    Limit Price: $32.94
2025-06-12 12:40:54,069 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:54,069 - __main__ - INFO -    Order ID: 29abe5bd-d6e6-422b-bb54-776856e64a14
2025-06-12 12:40:54,069 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:40:54,069 - __main__ - INFO -    Previous: created
2025-06-12 12:40:54,069 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:40:54,069 - __main__ - INFO -    Order ID: 29abe5bd-d6e6-422b-bb54-776856e64a14
2025-06-12 12:40:54,070 - __main__ - INFO -    Status: submitted
2025-06-12 12:40:54,071 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:40:54,171 - src.tws_connection - INFO - Open Order - ID: 2091, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:46:17,493 - src.tws_connection - INFO - Open Order - ID: 2091, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:46:17,530 - src.tws_connection - INFO - Open Order - ID: 2091, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:49:42,666 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:49:42,694 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:49:42,700 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:49:42,705 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:49:42,708 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:49:42,712 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:49:42,714 - src.tws_connection - INFO - Open Order - ID: 2089, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:51:16,388 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2090)
2025-06-12 12:51:20,620 - __main__ - ERROR - 
❌ Test failed with error: 
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\tests\tws_order_management\test_live_slv_buy_flow_unified.py", line 447, in main
    response = input("\nSimulate partial fill to test UnifiedFillManager? (y/n): ")
EOFError
2025-06-12 12:51:20,622 - __main__ - INFO - 
================================================================================
2025-06-12 12:51:20,623 - __main__ - INFO - CLEANING UP TEST
2025-06-12 12:51:20,624 - __main__ - INFO - ================================================================================
2025-06-12 12:51:20,624 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 12:51:20,626 - src.order.manager - WARNING - Cannot cancel inactive order 241e7691-f840-4723-bfaa-4eb63547c916 with status filled
2025-06-12 12:51:20,626 - __main__ - INFO -    Cancelled order 241e7691-f840-4723-bfaa-4eb63547c916
2025-06-12 12:51:20,626 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 12:51:20,626 - src.order.manager - INFO - Cancelling order b4c32414-3355-4994-b6ab-920e141e9967 with broker ID 2089
2025-06-12 12:51:20,627 - __main__ - INFO -    Cancelled order b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,628 - src.order.base - INFO - Order 4300b1bb-f051-40d3-9fa1-13c399796f53 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:51:20,628 - src.order.manager - INFO - Cancelling order 4300b1bb-f051-40d3-9fa1-13c399796f53 with broker ID 2090
2025-06-12 12:51:20,629 - __main__ - INFO -    Cancelled order 4300b1bb-f051-40d3-9fa1-13c399796f53
2025-06-12 12:51:20,629 - src.order.base - INFO - Order 29abe5bd-d6e6-422b-bb54-776856e64a14 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:51:20,629 - src.tws_connection - WARNING - ⚠️ TWS Error 10147: OrderId 2089 that needs to be cancelled is not found. (reqId: 2089)
2025-06-12 12:51:20,630 - src.order.manager - INFO - Cancelling order 29abe5bd-d6e6-422b-bb54-776856e64a14 with broker ID 2091
2025-06-12 12:51:20,631 - src.tws_connection - WARNING - ⚠️ TWS Error 10148: OrderId 2090 that needs to be cancelled cannot be cancelled, state: Cancelled. (reqId: 2090)
2025-06-12 12:51:20,631 - __main__ - INFO -    Cancelled order 29abe5bd-d6e6-422b-bb54-776856e64a14
2025-06-12 12:51:20,632 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 12:51:20,632 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 12:51:20,633 - src.order.manager - WARNING - Cannot process fill for inactive order 29abe5bd-d6e6-422b-bb54-776856e64a14 with status pending_cancel
2025-06-12 12:51:20,633 - src.tws_connection - WARNING - ⚠️ TWS Error 10147: OrderId 2091 that needs to be cancelled is not found. (reqId: 2091)
2025-06-12 12:51:20,633 - src.order.base - INFO - Order 29abe5bd-d6e6-422b-bb54-776856e64a14 status changed: pending_cancel -> filled (IB status: Filled)
2025-06-12 12:51:20,633 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: pending_cancel -> accepted (IB status: PreSubmitted)
2025-06-12 12:51:20,633 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 12:51:20,633 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 filled: 200.0 @ 32.93 (200.0/303)
2025-06-12 12:51:20,633 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 12:51:20,634 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 12:51:20,634 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 filled: 100.0 @ 32.93 (300.0/303)
2025-06-12 12:51:20,634 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 12:51:20,634 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 status changed: accepted -> filled (Order fully filled)
2025-06-12 12:51:20,634 - src.order.base - INFO - Order b4c32414-3355-4994-b6ab-920e141e9967 filled: 3.0 @ 32.93 (303.0/303)
2025-06-12 12:51:20,634 - src.order.base - INFO - Order 4300b1bb-f051-40d3-9fa1-13c399796f53 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 12:51:20,635 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 12:51:20,635 - __main__ - INFO - Rule engine stopped
2025-06-12 12:51:20,635 - __main__ - INFO - 
Test cleanup complete
2025-06-12 12:51:20,635 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 12:51:20,635 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 12:51:20,636 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 12:51:20,636 - __main__ - INFO - Disconnected from TWS
2025-06-12 12:51:20,636 - __main__ - INFO - 
================================================================================
2025-06-12 12:51:20,637 - __main__ - INFO - TEST COMPLETE
2025-06-12 12:51:20,637 - __main__ - INFO - ================================================================================
2025-06-12 12:51:20,637 - src.order.manager - WARNING - Cannot process fill for inactive order 29abe5bd-d6e6-422b-bb54-776856e64a14 with status filled
2025-06-12 12:51:20,638 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:51:20,638 - __main__ - INFO -    Order ID: b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,638 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:51:20,638 - __main__ - INFO -    Fill Price: $32.93
2025-06-12 12:51:20,638 - __main__ - INFO -    Fill Quantity: 200.0
2025-06-12 12:51:20,639 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:51:20,639 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:51:20,639 - UnifiedFillManager - INFO - Processing fill for SLV: 200.0 shares on order b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,639 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 12:51:20,639 - UnifiedFillManager - INFO - Closing position for SLV: Stop order fully filled
2025-06-12 12:51:20,639 - src.position.position_manager - INFO - Closed position for SLV
2025-06-12 12:51:20,639 - src.trade_tracker - INFO - Closed trade for SLV
2025-06-12 12:51:20,640 - UnifiedFillManager - INFO - Position closed for SLV: cancellation queued, trackers updated
2025-06-12 12:51:20,640 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:51:20,640 - __main__ - INFO -    Order ID: b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,640 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:51:20,641 - __main__ - INFO -    Fill Price: $32.93
2025-06-12 12:51:20,641 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 12:51:20,641 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:51:20,642 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:51:20,642 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,642 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 12:51:20,642 - UnifiedFillManager - INFO - Closing position for SLV: Stop order fully filled
2025-06-12 12:51:20,643 - src.position.position_manager - INFO - Closed position for SLV
2025-06-12 12:51:20,643 - UnifiedFillManager - INFO - Position closed for SLV: cancellation queued, trackers updated
2025-06-12 12:51:20,643 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:51:20,644 - __main__ - INFO -    Order ID: b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,644 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:51:20,644 - __main__ - INFO -    Fill Price: $32.93
2025-06-12 12:51:20,644 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 12:51:20,644 - __main__ - INFO -    Status: filled
2025-06-12 12:51:20,644 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:51:20,645 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order b4c32414-3355-4994-b6ab-920e141e9967
2025-06-12 12:51:20,645 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 12:51:20,645 - UnifiedFillManager - INFO - Closing position for SLV: Stop order fully filled
2025-06-12 12:51:20,645 - src.position.position_manager - INFO - Closed position for SLV
2025-06-12 12:51:20,645 - UnifiedFillManager - INFO - Position closed for SLV: cancellation queued, trackers updated
2025-06-12 12:54:42,826 - __main__ - INFO - ================================================================================
2025-06-12 12:54:42,827 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 12:54:42,828 - __main__ - INFO - ================================================================================
2025-06-12 12:54:42,828 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 12:54:42,829 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 12:54:42,829 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 12:54:42,831 - __main__ - INFO - Connecting to TWS...
2025-06-12 12:54:42,832 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 12:54:42,833 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 12:54:44,224 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 12:54:44,225 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 12:54:44,239 - src.tws_connection - INFO - ✅ Next valid order ID received: 2092
2025-06-12 12:54:44,239 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 12:54:44,240 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 12:54:44,240 - src.tws_connection - INFO - ✅ Next valid order ID received: 2092
2025-06-12 12:54:44,241 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 12:54:44,241 - src.tws_connection - INFO - ✅ Next valid order ID received: 2092
2025-06-12 12:54:44,242 - __main__ - INFO - Connected to TWS successfully
2025-06-12 12:54:44,243 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 12:54:44,243 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 12:54:44,244 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 12:54:44,244 - __main__ - INFO - Rule engine context configured
2025-06-12 12:54:44,244 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 12:54:44,244 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 12:54:44,245 - __main__ - INFO - 
================================================================================
2025-06-12 12:54:44,245 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 12:54:44,245 - __main__ - INFO - ================================================================================
2025-06-12 12:54:44,246 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 12:54:44,246 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 12:54:44,246 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 12:54:44,246 - __main__ - INFO - 
================================================================================
2025-06-12 12:54:44,247 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 12:54:44,247 - __main__ - INFO - ================================================================================
2025-06-12 12:54:49,259 - __main__ - INFO - Current SLV price: $32.92
2025-06-12 12:54:49,261 - __main__ - INFO - Created prediction event:
2025-06-12 12:54:49,261 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:49,263 - __main__ - INFO -    Signal: BUY
2025-06-12 12:54:49,263 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 12:54:49,264 - __main__ - INFO -    Price: $32.92
2025-06-12 12:54:49,264 - src.rule.engine - INFO - Rule engine started
2025-06-12 12:54:49,264 - __main__ - INFO - Rule engine started
2025-06-12 12:54:49,264 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 12:54:49,264 - __main__ - INFO - Prediction event emitted
2025-06-12 12:54:49,265 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 12:54:49,265 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 12:54:49,266 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 12:54:49,267 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 12:54:49,267 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 12:54:50,276 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.92 = $9974.76 (99.7% of $10000.00 allocation)
2025-06-12 12:54:50,277 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:54:50,277 - src.order.manager - INFO - Submitting order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd to TWS
2025-06-12 12:54:50,277 - src.order.manager - INFO - Got broker order ID 2092 for order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,278 - src.order.manager - INFO - Calling placeOrder with ID 2092, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 12:54:50,278 - src.order.manager - INFO - placeOrder called successfully for order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,278 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:54:50,278 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 12:54:50,293 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 12:54:50,293 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.90 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 12:54:50,294 - src.order.base - INFO - Order 8eda9cb8-521b-4582-993e-4e0b5618bd17 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:54:50,294 - src.order.manager - INFO - Submitting order 8eda9cb8-521b-4582-993e-4e0b5618bd17 to TWS
2025-06-12 12:54:50,294 - src.order.manager - INFO - Got broker order ID 2093 for order 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:50,294 - src.order.manager - INFO - Calling placeOrder with ID 2093, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 12:54:50,295 - src.order.manager - INFO - placeOrder called successfully for order 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:50,295 - src.order.base - INFO - Order 8eda9cb8-521b-4582-993e-4e0b5618bd17 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:54:50,296 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 12:54:50,296 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 8eda9cb8-521b-4582-993e-4e0b5618bd17 at $32.90
2025-06-12 12:54:50,296 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.94 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 12:54:50,296 - src.order.base - INFO - Order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:54:50,297 - src.order.manager - INFO - Submitting order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe to TWS
2025-06-12 12:54:50,297 - src.order.manager - INFO - Got broker order ID 2094 for order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:50,297 - src.order.manager - INFO - Calling placeOrder with ID 2094, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.940000 DAY
2025-06-12 12:54:50,298 - src.order.manager - INFO - placeOrder called successfully for order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:50,298 - src.order.base - INFO - Order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:54:50,298 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 12:54:50,298 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe at $32.94
2025-06-12 12:54:50,298 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 12:54:50,299 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:54:50,299 - __main__ - INFO -    Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,299 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:50,299 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 12:54:50,300 - __main__ - INFO -    Quantity: 303
2025-06-12 12:54:50,300 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,300 - __main__ - INFO -    Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,301 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:54:50,301 - __main__ - INFO -    Previous: created
2025-06-12 12:54:50,301 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,301 - __main__ - INFO -    Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,302 - __main__ - INFO -    Status: submitted
2025-06-12 12:54:50,302 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:54:50,302 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:54:50,302 - __main__ - INFO -    Order ID: 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:50,302 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:50,302 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 12:54:50,302 - __main__ - INFO -    Quantity: -303
2025-06-12 12:54:50,302 - __main__ - INFO -    Stop Price: $32.90
2025-06-12 12:54:50,302 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,302 - __main__ - INFO -    Order ID: 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:50,303 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:54:50,303 - __main__ - INFO -    Previous: created
2025-06-12 12:54:50,303 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,303 - __main__ - INFO -    Order ID: 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:50,303 - __main__ - INFO -    Status: submitted
2025-06-12 12:54:50,303 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:54:50,303 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:54:50,303 - __main__ - INFO -    Order ID: 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:50,304 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:50,304 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:54:50,304 - __main__ - INFO -    Quantity: -303
2025-06-12 12:54:50,304 - __main__ - INFO -    Limit Price: $32.94
2025-06-12 12:54:50,304 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,304 - __main__ - INFO -    Order ID: 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:50,304 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:54:50,304 - __main__ - INFO -    Previous: created
2025-06-12 12:54:50,304 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,304 - __main__ - INFO -    Order ID: 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:50,304 - __main__ - INFO -    Status: submitted
2025-06-12 12:54:50,305 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:54:50,378 - src.tws_connection - INFO - Open Order - ID: 2092, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:54:50,379 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:54:50,383 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 12:54:50,383 - src.tws_connection - INFO - Open Order - ID: 2092, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:54:50,384 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd filled: 300.0 @ 32.92 (300.0/303)
2025-06-12 12:54:50,384 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:54:50,384 - __main__ - INFO -    Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,385 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:50,385 - __main__ - INFO -    Fill Price: $32.92
2025-06-12 12:54:50,385 - __main__ - INFO -    Fill Quantity: 300.0
2025-06-12 12:54:50,385 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:54:50,386 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:54:50,387 - UnifiedFillManager - INFO - Processing fill for SLV: 300.0 shares on order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,387 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:54:50,387 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:54:50,388 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 12:54:50,390 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd status changed: accepted -> filled (Order fully filled)
2025-06-12 12:54:50,391 - src.order.base - INFO - Order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd filled: 3.0 @ 32.92 (303.0/303)
2025-06-12 12:54:50,391 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:54:50,391 - __main__ - INFO -    Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,391 - src.tws_connection - INFO - Open Order - ID: 2092, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:54:50,392 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:50,392 - __main__ - INFO -    Fill Price: $32.92
2025-06-12 12:54:50,393 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 12:54:50,393 - __main__ - INFO -    Status: filled
2025-06-12 12:54:50,393 - src.tws_connection - INFO - Open Order - ID: 2092, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:54:50,394 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:54:50,394 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:50,395 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:54:50,395 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:54:50,421 - src.tws_connection - INFO - Open Order - ID: 2093, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:54:50,422 - src.tws_connection - INFO - Open Order - ID: 2092, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:54:50,423 - src.order.base - INFO - Order 8eda9cb8-521b-4582-993e-4e0b5618bd17 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:54:50,429 - src.tws_connection - INFO - Open Order - ID: 2094, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:54:50,804 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['8eda9cb8-521b-4582-993e-4e0b5618bd17']
2025-06-12 12:54:50,805 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 12:54:50,805 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.92
2025-06-12 12:54:50,820 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 12:54:50,820 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.92, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.91, original_qty=303, dd_qty=303
2025-06-12 12:54:50,820 - src.order.base - INFO - Order 5a5ef7c9-861a-419b-a42f-fe1089f08961 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:54:50,821 - src.order.manager - INFO - Submitting order 5a5ef7c9-861a-419b-a42f-fe1089f08961 to TWS
2025-06-12 12:54:50,821 - src.order.manager - INFO - Got broker order ID 2095 for order 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:50,821 - src.order.manager - INFO - Calling placeOrder with ID 2095, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.910000 DAY
2025-06-12 12:54:50,822 - src.order.manager - INFO - placeOrder called successfully for order 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:50,822 - src.order.base - INFO - Order 5a5ef7c9-861a-419b-a42f-fe1089f08961 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:54:50,822 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 12:54:50,822 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.91
2025-06-12 12:54:50,822 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 12:54:50,823 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd for SLV
2025-06-12 12:54:50,824 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:54:50,825 - __main__ - INFO -    Order ID: 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:50,825 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:54:50,825 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:54:50,826 - __main__ - INFO -    Quantity: 303
2025-06-12 12:54:50,826 - __main__ - INFO -    Limit Price: $32.91
2025-06-12 12:54:50,826 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,826 - __main__ - INFO -    Order ID: 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:50,827 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:54:50,827 - __main__ - INFO -    Previous: created
2025-06-12 12:54:50,827 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:54:50,827 - __main__ - INFO -    Order ID: 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:50,827 - __main__ - INFO -    Status: submitted
2025-06-12 12:54:50,828 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:54:50,927 - src.tws_connection - INFO - Open Order - ID: 2095, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:54:52,269 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 12:54:57,278 - __main__ - INFO - 
================================================================================
2025-06-12 12:54:57,278 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 12:54:57,278 - __main__ - INFO - ================================================================================
2025-06-12 12:54:57,279 - __main__ - WARNING - No SLV context found!
2025-06-12 12:54:57,279 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 12:54:57,279 - __main__ - INFO -    Total orders created: 4
2025-06-12 12:54:57,279 - __main__ - INFO -    Market orders: 1
2025-06-12 12:54:57,280 - __main__ - INFO -    Stop orders: 1
2025-06-12 12:54:57,280 - __main__ - INFO -    Limit orders: 2
2025-06-12 12:54:57,281 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 12:54:57,281 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 12:54:57,281 - __main__ - INFO - 
   Order #1:
2025-06-12 12:54:57,281 - __main__ - INFO -      ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:57,281 - __main__ - INFO -      Type: market
2025-06-12 12:54:57,281 - __main__ - INFO -      Quantity: 303
2025-06-12 12:54:57,282 - __main__ - INFO - 
   Order #2:
2025-06-12 12:54:57,282 - __main__ - INFO -      ID: 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:57,282 - __main__ - INFO -      Type: stop
2025-06-12 12:54:57,282 - __main__ - INFO -      Quantity: -303
2025-06-12 12:54:57,282 - __main__ - INFO -      Stop: $32.90
2025-06-12 12:54:57,283 - __main__ - INFO - 
   Order #3:
2025-06-12 12:54:57,283 - __main__ - INFO -      ID: 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:57,283 - __main__ - INFO -      Type: limit
2025-06-12 12:54:57,283 - __main__ - INFO -      Quantity: -303
2025-06-12 12:54:57,283 - __main__ - INFO -      Limit: $32.94
2025-06-12 12:54:57,283 - __main__ - INFO - 
   Order #4:
2025-06-12 12:54:57,283 - __main__ - INFO -      ID: 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:57,284 - __main__ - INFO -      Type: limit
2025-06-12 12:54:57,284 - __main__ - INFO -      Quantity: 303
2025-06-12 12:54:57,284 - __main__ - INFO -      Limit: $32.91
2025-06-12 12:54:57,284 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 12:54:57,285 - __main__ - INFO -    Total fills received: 2
2025-06-12 12:54:57,285 - __main__ - INFO - 
   Fill #1:
2025-06-12 12:54:57,285 - __main__ - INFO -      Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:57,285 - __main__ - INFO -      Quantity: 300.0
2025-06-12 12:54:57,285 - __main__ - INFO -      Price: $32.92
2025-06-12 12:54:57,285 - __main__ - INFO -      Status: partially_filled
2025-06-12 12:54:57,285 - __main__ - INFO - 
   Fill #2:
2025-06-12 12:54:57,285 - __main__ - INFO -      Order ID: 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:57,285 - __main__ - INFO -      Quantity: 3.0
2025-06-12 12:54:57,286 - __main__ - INFO -      Price: $32.92
2025-06-12 12:54:57,286 - __main__ - INFO -      Status: filled
2025-06-12 12:54:57,286 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 12:54:57,342 - __main__ - INFO - 
================================================================================
2025-06-12 12:54:57,343 - __main__ - INFO - CLEANING UP TEST
2025-06-12 12:54:57,344 - __main__ - INFO - ================================================================================
2025-06-12 12:54:57,345 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 12:54:57,345 - src.order.manager - WARNING - Cannot cancel inactive order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd with status filled
2025-06-12 12:54:57,346 - __main__ - INFO -    Cancelled order 98cea4f9-088f-4f0e-a377-fb6927c4e8dd
2025-06-12 12:54:57,346 - src.order.base - INFO - Order 8eda9cb8-521b-4582-993e-4e0b5618bd17 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 12:54:57,347 - src.order.manager - INFO - Cancelling order 8eda9cb8-521b-4582-993e-4e0b5618bd17 with broker ID 2093
2025-06-12 12:54:57,347 - __main__ - INFO -    Cancelled order 8eda9cb8-521b-4582-993e-4e0b5618bd17
2025-06-12 12:54:57,348 - src.order.base - INFO - Order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:54:57,348 - src.order.manager - INFO - Cancelling order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe with broker ID 2094
2025-06-12 12:54:57,349 - __main__ - INFO -    Cancelled order 7254c3a2-fbbf-4f0d-ba8b-91c2874d67fe
2025-06-12 12:54:57,349 - src.order.base - INFO - Order 5a5ef7c9-861a-419b-a42f-fe1089f08961 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:54:57,350 - src.order.manager - INFO - Cancelling order 5a5ef7c9-861a-419b-a42f-fe1089f08961 with broker ID 2095
2025-06-12 12:54:57,351 - __main__ - INFO -    Cancelled order 5a5ef7c9-861a-419b-a42f-fe1089f08961
2025-06-12 12:54:57,352 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 12:54:57,352 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 12:54:57,353 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 12:54:57,354 - __main__ - INFO - Rule engine stopped
2025-06-12 12:54:57,355 - __main__ - INFO - 
Test cleanup complete
2025-06-12 12:54:57,356 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 12:54:57,357 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 12:54:57,358 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 12:54:57,360 - __main__ - INFO - Disconnected from TWS
2025-06-12 12:54:57,361 - __main__ - INFO - 
================================================================================
2025-06-12 12:54:57,361 - __main__ - INFO - TEST COMPLETE
2025-06-12 12:54:57,361 - __main__ - INFO - ================================================================================
2025-06-12 12:57:26,369 - __main__ - INFO - ================================================================================
2025-06-12 12:57:26,370 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 12:57:26,370 - __main__ - INFO - ================================================================================
2025-06-12 12:57:26,370 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 12:57:26,370 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 12:57:26,370 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 12:57:26,371 - __main__ - INFO - Connecting to TWS...
2025-06-12 12:57:26,371 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 12:57:26,372 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 12:57:29,406 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 12:57:29,406 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 12:57:29,420 - src.tws_connection - INFO - ✅ Next valid order ID received: 2096
2025-06-12 12:57:29,420 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 12:57:29,420 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 12:57:29,421 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 12:57:29,422 - __main__ - INFO - Connected to TWS successfully
2025-06-12 12:57:29,422 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 12:57:29,422 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 12:57:29,423 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 12:57:29,423 - __main__ - INFO - Rule engine context configured
2025-06-12 12:57:29,423 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 12:57:29,423 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 12:57:29,424 - __main__ - INFO - 
================================================================================
2025-06-12 12:57:29,424 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 12:57:29,424 - __main__ - INFO - ================================================================================
2025-06-12 12:57:29,425 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 12:57:29,425 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 12:57:29,425 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 12:57:29,426 - __main__ - INFO - 
================================================================================
2025-06-12 12:57:29,426 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 12:57:29,426 - __main__ - INFO - ================================================================================
2025-06-12 12:57:29,506 - src.tws_connection - INFO - ✅ Next valid order ID received: 2096
2025-06-12 12:57:29,606 - src.tws_connection - INFO - ✅ Next valid order ID received: 2096
2025-06-12 12:57:34,437 - __main__ - INFO - Current SLV price: $32.93
2025-06-12 12:57:34,437 - __main__ - INFO - Created prediction event:
2025-06-12 12:57:34,438 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:34,438 - __main__ - INFO -    Signal: BUY
2025-06-12 12:57:34,438 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 12:57:34,439 - __main__ - INFO -    Price: $32.93
2025-06-12 12:57:34,439 - src.rule.engine - INFO - Rule engine started
2025-06-12 12:57:34,439 - __main__ - INFO - Rule engine started
2025-06-12 12:57:34,440 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 12:57:34,441 - __main__ - INFO - Prediction event emitted
2025-06-12 12:57:34,442 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 12:57:34,443 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 12:57:34,443 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 12:57:34,444 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 12:57:34,444 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 12:57:35,448 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.93 = $9977.79 (99.8% of $10000.00 allocation)
2025-06-12 12:57:35,450 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:57:35,450 - src.order.manager - INFO - Submitting order 074e6b32-0f0b-451a-a64d-fc91b84690ff to TWS
2025-06-12 12:57:35,451 - src.order.manager - INFO - Got broker order ID 2096 for order 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,452 - src.order.manager - INFO - Calling placeOrder with ID 2096, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 12:57:35,453 - src.order.manager - INFO - placeOrder called successfully for order 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,455 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:57:35,455 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 12:57:35,472 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 12:57:35,472 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.91 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 12:57:35,473 - src.order.base - INFO - Order a643a502-0c2a-4c25-8d13-76377dfb6c2a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:57:35,473 - src.order.manager - INFO - Submitting order a643a502-0c2a-4c25-8d13-76377dfb6c2a to TWS
2025-06-12 12:57:35,474 - src.order.manager - INFO - Got broker order ID 2097 for order a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:57:35,475 - src.order.manager - INFO - Calling placeOrder with ID 2097, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 12:57:35,476 - src.order.manager - INFO - placeOrder called successfully for order a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:57:35,476 - src.order.base - INFO - Order a643a502-0c2a-4c25-8d13-76377dfb6c2a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:57:35,477 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 12:57:35,478 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss a643a502-0c2a-4c25-8d13-76377dfb6c2a at $32.91
2025-06-12 12:57:35,478 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.95 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 12:57:35,478 - src.order.base - INFO - Order 75d27ae1-e802-4224-9780-592d7aa4647a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:57:35,479 - src.order.manager - INFO - Submitting order 75d27ae1-e802-4224-9780-592d7aa4647a to TWS
2025-06-12 12:57:35,479 - src.order.manager - INFO - Got broker order ID 2098 for order 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:57:35,479 - src.order.manager - INFO - Calling placeOrder with ID 2098, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.950000 DAY
2025-06-12 12:57:35,480 - src.order.manager - INFO - placeOrder called successfully for order 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:57:35,480 - src.order.base - INFO - Order 75d27ae1-e802-4224-9780-592d7aa4647a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:57:35,480 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 12:57:35,480 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 75d27ae1-e802-4224-9780-592d7aa4647a at $32.95
2025-06-12 12:57:35,481 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 12:57:35,481 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:57:35,481 - __main__ - INFO -    Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,481 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:35,481 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 12:57:35,482 - __main__ - INFO -    Quantity: 303
2025-06-12 12:57:35,482 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:35,482 - __main__ - INFO -    Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,482 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:57:35,482 - __main__ - INFO -    Previous: created
2025-06-12 12:57:35,483 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:35,483 - __main__ - INFO -    Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,483 - __main__ - INFO -    Status: submitted
2025-06-12 12:57:35,483 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:57:35,483 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:57:35,484 - __main__ - INFO -    Order ID: a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:57:35,484 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:35,484 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 12:57:35,484 - __main__ - INFO -    Quantity: -303
2025-06-12 12:57:35,485 - __main__ - INFO -    Stop Price: $32.91
2025-06-12 12:57:35,485 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:35,485 - __main__ - INFO -    Order ID: a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:57:35,485 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:57:35,485 - __main__ - INFO -    Previous: created
2025-06-12 12:57:35,485 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:35,485 - __main__ - INFO -    Order ID: a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:57:35,486 - __main__ - INFO -    Status: submitted
2025-06-12 12:57:35,486 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:57:35,486 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:57:35,486 - __main__ - INFO -    Order ID: 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:57:35,486 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:35,487 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:57:35,487 - __main__ - INFO -    Quantity: -303
2025-06-12 12:57:35,487 - __main__ - INFO -    Limit Price: $32.95
2025-06-12 12:57:35,487 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:35,487 - __main__ - INFO -    Order ID: 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:57:35,488 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:57:35,488 - __main__ - INFO -    Previous: created
2025-06-12 12:57:35,488 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:35,488 - __main__ - INFO -    Order ID: 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:57:35,488 - __main__ - INFO -    Status: submitted
2025-06-12 12:57:35,489 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:57:35,553 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,559 - src.tws_connection - INFO - Open Order - ID: 2097, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:57:35,560 - src.order.base - INFO - Order a643a502-0c2a-4c25-8d13-76377dfb6c2a status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 12:57:35,582 - src.tws_connection - INFO - Open Order - ID: 2098, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 12:57:35,900 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: submitted -> partially_filled (Order partially filled)
2025-06-12 12:57:35,900 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff filled: 200.0 @ 32.94 (200.0/303)
2025-06-12 12:57:35,899 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,902 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:57:35,903 - __main__ - INFO -    Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,903 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:35,903 - __main__ - INFO -    Fill Price: $32.94
2025-06-12 12:57:35,905 - __main__ - INFO -    Fill Quantity: 200.0
2025-06-12 12:57:35,905 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,906 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:57:35,907 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:57:35,908 - UnifiedFillManager - INFO - Processing fill for SLV: 200.0 shares on order 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,908 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:57:35,909 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:57:35,910 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: partially_filled -> submitted (IB status: Submitted)
2025-06-12 12:57:35,910 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: submitted -> partially_filled (Order partially filled)
2025-06-12 12:57:35,910 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff filled: 100.0 @ 32.94 (300.0/303)
2025-06-12 12:57:35,911 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: partially_filled -> submitted (IB status: Submitted)
2025-06-12 12:57:35,912 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:57:35,912 - __main__ - INFO -    Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,913 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:35,913 - __main__ - INFO -    Fill Price: $32.94
2025-06-12 12:57:35,913 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 12:57:35,914 - __main__ - INFO -    Status: partially_filled
2025-06-12 12:57:35,914 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,915 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:57:35,915 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,917 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,919 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:57:35,918 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,920 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:57:35,921 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff status changed: submitted -> filled (Order fully filled)
2025-06-12 12:57:35,921 - src.order.base - INFO - Order 074e6b32-0f0b-451a-a64d-fc91b84690ff filled: 3.0 @ 32.94 (303.0/303)
2025-06-12 12:57:35,921 - src.tws_connection - INFO - Open Order - ID: 2096, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:35,923 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 12:57:35,924 - __main__ - INFO -    Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,924 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:35,925 - __main__ - INFO -    Fill Price: $32.94
2025-06-12 12:57:35,925 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 12:57:35,925 - __main__ - INFO -    Status: filled
2025-06-12 12:57:35,925 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 12:57:35,925 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:35,926 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 12:57:35,926 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 12:57:35,988 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['a643a502-0c2a-4c25-8d13-76377dfb6c2a']
2025-06-12 12:57:35,988 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 12:57:35,989 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.93
2025-06-12 12:57:36,003 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 12:57:36,004 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.93, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.92, original_qty=303, dd_qty=303
2025-06-12 12:57:36,004 - src.order.base - INFO - Order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb status changed: created -> pending_submit (Submitting to broker)
2025-06-12 12:57:36,004 - src.order.manager - INFO - Submitting order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb to TWS
2025-06-12 12:57:36,005 - src.order.manager - INFO - Got broker order ID 2099 for order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:57:36,005 - src.order.manager - INFO - Calling placeOrder with ID 2099, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.920000 DAY
2025-06-12 12:57:36,006 - src.order.manager - INFO - placeOrder called successfully for order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:57:36,006 - src.order.base - INFO - Order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 12:57:36,007 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 12:57:36,007 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.92
2025-06-12 12:57:36,007 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 12:57:36,007 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 074e6b32-0f0b-451a-a64d-fc91b84690ff for SLV
2025-06-12 12:57:36,008 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 12:57:36,008 - __main__ - INFO -    Order ID: 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:57:36,008 - __main__ - INFO -    Symbol: SLV
2025-06-12 12:57:36,009 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 12:57:36,009 - __main__ - INFO -    Quantity: 303
2025-06-12 12:57:36,010 - __main__ - INFO -    Limit Price: $32.92
2025-06-12 12:57:36,010 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:36,010 - __main__ - INFO -    Order ID: 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:57:36,010 - __main__ - INFO -    Status: pending_submit
2025-06-12 12:57:36,010 - __main__ - INFO -    Previous: created
2025-06-12 12:57:36,011 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 12:57:36,011 - __main__ - INFO -    Order ID: 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:57:36,012 - __main__ - INFO -    Status: submitted
2025-06-12 12:57:36,012 - __main__ - INFO -    Previous: pending_submit
2025-06-12 12:57:36,099 - src.tws_connection - INFO - Open Order - ID: 2099, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 12:57:37,448 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 12:57:42,456 - __main__ - INFO - 
================================================================================
2025-06-12 12:57:42,458 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 12:57:42,459 - __main__ - INFO - ================================================================================
2025-06-12 12:57:42,459 - __main__ - WARNING - No SLV context found!
2025-06-12 12:57:42,460 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 12:57:42,460 - __main__ - INFO -    Total orders created: 4
2025-06-12 12:57:42,460 - __main__ - INFO -    Market orders: 1
2025-06-12 12:57:42,461 - __main__ - INFO -    Stop orders: 1
2025-06-12 12:57:42,461 - __main__ - INFO -    Limit orders: 2
2025-06-12 12:57:42,462 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 12:57:42,462 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 12:57:42,462 - __main__ - INFO - 
   Order #1:
2025-06-12 12:57:42,462 - __main__ - INFO -      ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:42,463 - __main__ - INFO -      Type: market
2025-06-12 12:57:42,463 - __main__ - INFO -      Quantity: 303
2025-06-12 12:57:42,463 - __main__ - INFO - 
   Order #2:
2025-06-12 12:57:42,463 - __main__ - INFO -      ID: a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:57:42,463 - __main__ - INFO -      Type: stop
2025-06-12 12:57:42,464 - __main__ - INFO -      Quantity: -303
2025-06-12 12:57:42,464 - __main__ - INFO -      Stop: $32.91
2025-06-12 12:57:42,464 - __main__ - INFO - 
   Order #3:
2025-06-12 12:57:42,464 - __main__ - INFO -      ID: 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:57:42,464 - __main__ - INFO -      Type: limit
2025-06-12 12:57:42,464 - __main__ - INFO -      Quantity: -303
2025-06-12 12:57:42,465 - __main__ - INFO -      Limit: $32.95
2025-06-12 12:57:42,465 - __main__ - INFO - 
   Order #4:
2025-06-12 12:57:42,465 - __main__ - INFO -      ID: 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:57:42,465 - __main__ - INFO -      Type: limit
2025-06-12 12:57:42,465 - __main__ - INFO -      Quantity: 303
2025-06-12 12:57:42,465 - __main__ - INFO -      Limit: $32.92
2025-06-12 12:57:42,465 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 12:57:42,466 - __main__ - INFO -    Total fills received: 3
2025-06-12 12:57:42,466 - __main__ - INFO - 
   Fill #1:
2025-06-12 12:57:42,466 - __main__ - INFO -      Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:42,466 - __main__ - INFO -      Quantity: 200.0
2025-06-12 12:57:42,466 - __main__ - INFO -      Price: $32.94
2025-06-12 12:57:42,466 - __main__ - INFO -      Status: partially_filled
2025-06-12 12:57:42,466 - __main__ - INFO - 
   Fill #2:
2025-06-12 12:57:42,467 - __main__ - INFO -      Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:42,467 - __main__ - INFO -      Quantity: 100.0
2025-06-12 12:57:42,467 - __main__ - INFO -      Price: $32.94
2025-06-12 12:57:42,467 - __main__ - INFO -      Status: partially_filled
2025-06-12 12:57:42,467 - __main__ - INFO - 
   Fill #3:
2025-06-12 12:57:42,467 - __main__ - INFO -      Order ID: 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:57:42,467 - __main__ - INFO -      Quantity: 3.0
2025-06-12 12:57:42,468 - __main__ - INFO -      Price: $32.94
2025-06-12 12:57:42,468 - __main__ - INFO -      Status: filled
2025-06-12 12:57:42,468 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 12:58:12,482 - __main__ - INFO - 
================================================================================
2025-06-12 12:58:12,482 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 12:58:12,483 - __main__ - INFO - ================================================================================
2025-06-12 12:58:12,483 - __main__ - INFO - 
Checking current order states...
2025-06-12 12:58:12,484 - __main__ - INFO - 
Order 074e6b32-0f0b-451a-a64d-fc91b84690ff:
2025-06-12 12:58:12,484 - __main__ - INFO -   Type: market
2025-06-12 12:58:12,484 - __main__ - INFO -   Status: filled
2025-06-12 12:58:12,484 - __main__ - INFO -   Quantity: 303
2025-06-12 12:58:12,484 - __main__ - INFO -   Broker ID: 2096
2025-06-12 12:58:12,484 - __main__ - INFO - 
Order a643a502-0c2a-4c25-8d13-76377dfb6c2a:
2025-06-12 12:58:12,485 - __main__ - INFO -   Type: stop
2025-06-12 12:58:12,485 - __main__ - INFO -   Status: accepted
2025-06-12 12:58:12,485 - __main__ - INFO -   Quantity: -303
2025-06-12 12:58:12,486 - __main__ - INFO -   Broker ID: 2097
2025-06-12 12:58:12,486 - __main__ - INFO - 
Order 75d27ae1-e802-4224-9780-592d7aa4647a:
2025-06-12 12:58:12,486 - __main__ - INFO -   Type: limit
2025-06-12 12:58:12,487 - __main__ - INFO -   Status: submitted
2025-06-12 12:58:12,487 - __main__ - INFO -   Quantity: -303
2025-06-12 12:58:12,487 - __main__ - INFO -   Broker ID: 2098
2025-06-12 12:58:12,488 - __main__ - INFO - 
Order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb:
2025-06-12 12:58:12,488 - __main__ - INFO -   Type: limit
2025-06-12 12:58:12,488 - __main__ - INFO -   Status: submitted
2025-06-12 12:58:12,488 - __main__ - INFO -   Quantity: 303
2025-06-12 12:58:12,489 - __main__ - INFO -   Broker ID: 2099
2025-06-12 12:58:12,489 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 12:58:42,501 - __main__ - INFO - 
================================================================================
2025-06-12 12:58:42,502 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 12:58:42,502 - __main__ - INFO - ================================================================================
2025-06-12 12:58:42,502 - __main__ - INFO - 
Checking current order states...
2025-06-12 12:58:42,502 - __main__ - INFO - 
Order 074e6b32-0f0b-451a-a64d-fc91b84690ff:
2025-06-12 12:58:42,503 - __main__ - INFO -   Type: market
2025-06-12 12:58:42,503 - __main__ - INFO -   Status: filled
2025-06-12 12:58:42,503 - __main__ - INFO -   Quantity: 303
2025-06-12 12:58:42,503 - __main__ - INFO -   Broker ID: 2096
2025-06-12 12:58:42,504 - __main__ - INFO - 
Order a643a502-0c2a-4c25-8d13-76377dfb6c2a:
2025-06-12 12:58:42,504 - __main__ - INFO -   Type: stop
2025-06-12 12:58:42,504 - __main__ - INFO -   Status: accepted
2025-06-12 12:58:42,504 - __main__ - INFO -   Quantity: -303
2025-06-12 12:58:42,505 - __main__ - INFO -   Broker ID: 2097
2025-06-12 12:58:42,505 - __main__ - INFO - 
Order 75d27ae1-e802-4224-9780-592d7aa4647a:
2025-06-12 12:58:42,505 - __main__ - INFO -   Type: limit
2025-06-12 12:58:42,506 - __main__ - INFO -   Status: submitted
2025-06-12 12:58:42,506 - __main__ - INFO -   Quantity: -303
2025-06-12 12:58:42,506 - __main__ - INFO -   Broker ID: 2098
2025-06-12 12:58:42,506 - __main__ - INFO - 
Order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb:
2025-06-12 12:58:42,506 - __main__ - INFO -   Type: limit
2025-06-12 12:58:42,507 - __main__ - INFO -   Status: submitted
2025-06-12 12:58:42,507 - __main__ - INFO -   Quantity: 303
2025-06-12 12:58:42,507 - __main__ - INFO -   Broker ID: 2099
2025-06-12 12:58:42,507 - __main__ - INFO - 
================================================================================
2025-06-12 12:58:42,507 - __main__ - INFO - CLEANING UP TEST
2025-06-12 12:58:42,508 - __main__ - INFO - ================================================================================
2025-06-12 12:58:42,508 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 12:58:42,508 - src.order.manager - WARNING - Cannot cancel inactive order 074e6b32-0f0b-451a-a64d-fc91b84690ff with status filled
2025-06-12 12:58:42,509 - __main__ - INFO -    Cancelled order 074e6b32-0f0b-451a-a64d-fc91b84690ff
2025-06-12 12:58:42,509 - src.order.base - INFO - Order a643a502-0c2a-4c25-8d13-76377dfb6c2a status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 12:58:42,509 - src.order.manager - INFO - Cancelling order a643a502-0c2a-4c25-8d13-76377dfb6c2a with broker ID 2097
2025-06-12 12:58:42,510 - __main__ - INFO -    Cancelled order a643a502-0c2a-4c25-8d13-76377dfb6c2a
2025-06-12 12:58:42,510 - src.order.base - INFO - Order 75d27ae1-e802-4224-9780-592d7aa4647a status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:58:42,510 - src.order.manager - INFO - Cancelling order 75d27ae1-e802-4224-9780-592d7aa4647a with broker ID 2098
2025-06-12 12:58:42,511 - __main__ - INFO -    Cancelled order 75d27ae1-e802-4224-9780-592d7aa4647a
2025-06-12 12:58:42,511 - src.order.base - INFO - Order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 12:58:42,511 - src.order.manager - INFO - Cancelling order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb with broker ID 2099
2025-06-12 12:58:42,511 - __main__ - INFO -    Cancelled order 16a27a55-42f1-4d91-87c3-fd7e7a416bcb
2025-06-12 12:58:42,512 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 12:58:42,512 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 12:58:42,512 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 12:58:42,512 - __main__ - INFO - Rule engine stopped
2025-06-12 12:58:42,512 - __main__ - INFO - 
Test cleanup complete
2025-06-12 12:58:42,512 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 12:58:42,513 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 12:58:42,514 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 12:58:42,515 - __main__ - INFO - Disconnected from TWS
2025-06-12 12:58:42,515 - __main__ - INFO - 
================================================================================
2025-06-12 12:58:42,515 - __main__ - INFO - TEST COMPLETE
2025-06-12 12:58:42,515 - __main__ - INFO - ================================================================================
2025-06-12 13:02:03,133 - __main__ - INFO - ================================================================================
2025-06-12 13:02:03,133 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:02:03,133 - __main__ - INFO - ================================================================================
2025-06-12 13:02:03,133 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:02:03,134 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:02:03,134 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:02:03,135 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:02:03,135 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:02:03,135 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:02:05,763 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:02:05,764 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:02:05,787 - src.tws_connection - INFO - ✅ Next valid order ID received: 2100
2025-06-12 13:02:05,788 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:02:05,788 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:02:05,788 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:02:05,790 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:02:05,790 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:02:05,791 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:02:05,791 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:02:05,791 - __main__ - INFO - Rule engine context configured
2025-06-12 13:02:05,792 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:02:05,792 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:02:05,793 - __main__ - INFO - 
================================================================================
2025-06-12 13:02:05,793 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 13:02:05,794 - __main__ - INFO - ================================================================================
2025-06-12 13:02:05,795 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:02:05,795 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:02:05,796 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 13:02:05,796 - __main__ - INFO - 
================================================================================
2025-06-12 13:02:05,796 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 13:02:05,796 - __main__ - INFO - ================================================================================
2025-06-12 13:02:05,863 - src.tws_connection - INFO - ✅ Next valid order ID received: 2100
2025-06-12 13:02:05,965 - src.tws_connection - INFO - ✅ Next valid order ID received: 2100
2025-06-12 13:02:10,811 - __main__ - INFO - Current SLV price: $32.94
2025-06-12 13:02:10,812 - __main__ - INFO - Created prediction event:
2025-06-12 13:02:10,813 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:10,813 - __main__ - INFO -    Signal: BUY
2025-06-12 13:02:10,814 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:02:10,814 - __main__ - INFO -    Price: $32.94
2025-06-12 13:02:10,815 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:02:10,815 - __main__ - INFO - Rule engine started
2025-06-12 13:02:10,815 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:02:10,816 - __main__ - INFO - Prediction event emitted
2025-06-12 13:02:10,816 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:02:10,816 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:02:10,816 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:02:10,817 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 13:02:10,817 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 13:02:11,829 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.94 = $9980.82 (99.8% of $10000.00 allocation)
2025-06-12 13:02:11,830 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:11,831 - src.order.manager - INFO - Submitting order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d to TWS
2025-06-12 13:02:11,831 - src.order.manager - INFO - Got broker order ID 2100 for order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,831 - src.order.manager - INFO - Calling placeOrder with ID 2100, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 13:02:11,832 - src.order.manager - INFO - placeOrder called successfully for order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,832 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:11,832 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 13:02:11,850 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 13:02:11,851 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.92 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:02:11,851 - src.order.base - INFO - Order faac0340-e161-468c-b3c5-78bfeb0cfd38 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:11,851 - src.order.manager - INFO - Submitting order faac0340-e161-468c-b3c5-78bfeb0cfd38 to TWS
2025-06-12 13:02:11,851 - src.order.manager - INFO - Got broker order ID 2101 for order faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:02:11,852 - src.order.manager - INFO - Calling placeOrder with ID 2101, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:02:11,852 - src.order.manager - INFO - placeOrder called successfully for order faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:02:11,852 - src.order.base - INFO - Order faac0340-e161-468c-b3c5-78bfeb0cfd38 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:11,852 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:02:11,852 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss faac0340-e161-468c-b3c5-78bfeb0cfd38 at $32.92
2025-06-12 13:02:11,853 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.96 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:02:11,853 - src.order.base - INFO - Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:11,853 - src.order.manager - INFO - Submitting order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a to TWS
2025-06-12 13:02:11,853 - src.order.manager - INFO - Got broker order ID 2102 for order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:02:11,853 - src.order.manager - INFO - Calling placeOrder with ID 2102, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.960000 DAY
2025-06-12 13:02:11,854 - src.order.manager - INFO - placeOrder called successfully for order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:02:11,854 - src.order.base - INFO - Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:11,854 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:02:11,854 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 844d8f1f-2bb5-4e20-a2ef-12409c0c294a at $32.96
2025-06-12 13:02:11,854 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 13:02:11,854 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:11,855 - __main__ - INFO -    Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,855 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:11,855 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:02:11,855 - __main__ - INFO -    Quantity: 303
2025-06-12 13:02:11,855 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:11,855 - __main__ - INFO -    Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,855 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:11,855 - __main__ - INFO -    Previous: created
2025-06-12 13:02:11,856 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:11,856 - __main__ - INFO -    Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,856 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:11,856 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:11,858 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:11,860 - __main__ - INFO -    Order ID: faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:02:11,860 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:11,860 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:02:11,861 - __main__ - INFO -    Quantity: -303
2025-06-12 13:02:11,861 - __main__ - INFO -    Stop Price: $32.92
2025-06-12 13:02:11,861 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:11,862 - __main__ - INFO -    Order ID: faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:02:11,862 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:11,862 - __main__ - INFO -    Previous: created
2025-06-12 13:02:11,862 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:11,863 - __main__ - INFO -    Order ID: faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:02:11,863 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:11,863 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:11,863 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:11,864 - __main__ - INFO -    Order ID: 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:02:11,864 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:11,864 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:02:11,864 - __main__ - INFO -    Quantity: -303
2025-06-12 13:02:11,865 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:02:11,865 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:11,865 - __main__ - INFO -    Order ID: 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:02:11,865 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:11,866 - __main__ - INFO -    Previous: created
2025-06-12 13:02:11,866 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:11,867 - __main__ - INFO -    Order ID: 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:02:11,867 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:11,867 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:11,924 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,926 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:02:11,928 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:02:11,929 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d filled: 200.0 @ 32.95 (200.0/303)
2025-06-12 13:02:11,930 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:02:11,928 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,932 - __main__ - INFO -    Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,933 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:11,933 - __main__ - INFO -    Fill Price: $32.95
2025-06-12 13:02:11,934 - __main__ - INFO -    Fill Quantity: 200.0
2025-06-12 13:02:11,934 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:02:11,934 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:02:11,934 - UnifiedFillManager - INFO - Processing fill for SLV: 200.0 shares on order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,935 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:02:11,935 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:02:11,935 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:02:11,935 - UnifiedFillManager - INFO -   Main orders: {'38407653-ebec-4f3d-b3ad-8bbe1b8e792d'}
2025-06-12 13:02:11,935 - UnifiedFillManager - INFO -   Stop orders: {'faac0340-e161-468c-b3c5-78bfeb0cfd38'}
2025-06-12 13:02:11,936 - UnifiedFillManager - INFO -   Target orders: {'844d8f1f-2bb5-4e20-a2ef-12409c0c294a'}
2025-06-12 13:02:11,936 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:02:11,937 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:02:11,937 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:02:11,937 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:02:11,937 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:02:11,937 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:02:11,938 - UnifiedFillManager - INFO - Queueing update for stop order faac0340-e161-468c-b3c5-78bfeb0cfd38: current qty=-303, new qty=-303.0
2025-06-12 13:02:11,938 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:02:11,938 - UnifiedFillManager - INFO - Queueing update for target order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a: current qty=-303, new qty=-303.0
2025-06-12 13:02:11,939 - UnifiedFillManager - INFO - Started order queue processor for SLV
2025-06-12 13:02:11,939 - UnifiedFillManager - INFO - Processing operation for SLV: replace_stop
2025-06-12 13:02:11,939 - src.order.base - INFO - Order faac0340-e161-468c-b3c5-78bfeb0cfd38 status changed: submitted -> pending_cancel (Updating quantity to -303.0)
2025-06-12 13:02:11,940 - src.order.manager - INFO - Cancelling order faac0340-e161-468c-b3c5-78bfeb0cfd38 with broker ID 2101
2025-06-12 13:02:11,941 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:02:11,979 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:02:11,979 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,980 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d filled: 100.0 @ 32.95 (300.0/303)
2025-06-12 13:02:11,981 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:02:11,981 - __main__ - INFO -    Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,982 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:11,982 - __main__ - INFO -    Fill Price: $32.95
2025-06-12 13:02:11,982 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 13:02:11,983 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,983 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:02:11,984 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:02:11,984 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,984 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:02:11,984 - src.tws_connection - INFO - Open Order - ID: 2101, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:02:11,985 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:02:11,985 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:02:11,985 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,986 - UnifiedFillManager - INFO -   Main orders: {'38407653-ebec-4f3d-b3ad-8bbe1b8e792d'}
2025-06-12 13:02:11,986 - UnifiedFillManager - INFO -   Stop orders: set()
2025-06-12 13:02:11,987 - UnifiedFillManager - INFO -   Target orders: {'844d8f1f-2bb5-4e20-a2ef-12409c0c294a'}
2025-06-12 13:02:11,987 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,987 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:02:11,988 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:02:11,988 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:02:11,988 - src.tws_connection - INFO - Open Order - ID: 2100, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:11,989 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:02:11,989 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:02:11,989 - UnifiedFillManager - INFO - Checking 0 stop orders
2025-06-12 13:02:11,990 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:02:11,990 - UnifiedFillManager - INFO - Queueing update for target order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a: current qty=-303, new qty=-303.0
2025-06-12 13:02:11,991 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:02:11,992 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d status changed: accepted -> filled (Order fully filled)
2025-06-12 13:02:11,992 - src.order.base - INFO - Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d filled: 3.0 @ 32.95 (303.0/303)
2025-06-12 13:02:11,993 - src.order.base - INFO - Order faac0340-e161-468c-b3c5-78bfeb0cfd38 status changed: pending_cancel -> accepted (IB status: PreSubmitted)
2025-06-12 13:02:11,993 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:02:11,993 - __main__ - INFO -    Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,994 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:11,994 - __main__ - INFO -    Fill Price: $32.95
2025-06-12 13:02:11,994 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 13:02:11,994 - __main__ - INFO -    Status: filled
2025-06-12 13:02:11,994 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:02:11,995 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:11,995 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:02:11,996 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:02:11,996 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:02:11,996 - UnifiedFillManager - INFO -   Main orders: {'38407653-ebec-4f3d-b3ad-8bbe1b8e792d'}
2025-06-12 13:02:11,997 - UnifiedFillManager - INFO -   Stop orders: set()
2025-06-12 13:02:11,997 - UnifiedFillManager - INFO -   Target orders: {'844d8f1f-2bb5-4e20-a2ef-12409c0c294a'}
2025-06-12 13:02:11,997 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:02:11,997 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:02:11,997 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:02:11,998 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:02:11,998 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:02:11,998 - UnifiedFillManager - INFO - Checking 0 stop orders
2025-06-12 13:02:11,999 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:02:12,000 - UnifiedFillManager - INFO - Queueing update for target order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a: current qty=-303, new qty=-303.0
2025-06-12 13:02:12,046 - src.order.base - INFO - Order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:12,046 - src.order.manager - INFO - Submitting order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 to TWS
2025-06-12 13:02:12,047 - src.order.manager - INFO - Got broker order ID 2103 for order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:02:12,047 - src.order.manager - INFO - Calling placeOrder with ID 2103, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:02:12,048 - src.order.manager - INFO - placeOrder called successfully for order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:02:12,048 - src.order.base - INFO - Order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:12,049 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:02:12,049 - UnifiedFillManager - INFO - Created updated stop order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 for SLV at $32.92 for -303.0 shares
2025-06-12 13:02:12,049 - UnifiedFillManager - INFO - Completed operation for SLV: replace_stop
2025-06-12 13:02:12,049 - UnifiedFillManager - INFO - Processing operation for SLV: replace_target
2025-06-12 13:02:12,049 - src.order.base - INFO - Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a status changed: submitted -> pending_cancel (Updating quantity to -303.0)
2025-06-12 13:02:12,050 - src.order.manager - INFO - Cancelling order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a with broker ID 2102
2025-06-12 13:02:12,050 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:12,050 - __main__ - INFO -    Order ID: fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:02:12,051 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:12,051 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:02:12,051 - __main__ - INFO -    Quantity: -303.0
2025-06-12 13:02:12,051 - __main__ - INFO -    Stop Price: $32.92
2025-06-12 13:02:12,051 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,052 - __main__ - INFO -    Order ID: fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:02:12,052 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:12,052 - __main__ - INFO -    Previous: created
2025-06-12 13:02:12,052 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,052 - __main__ - INFO -    Order ID: fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:02:12,053 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:12,053 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:12,062 - src.tws_connection - INFO - Open Order - ID: 2102, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:02:12,063 - src.order.base - INFO - Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a status changed: pending_cancel -> submitted (IB status: Submitted)
2025-06-12 13:02:12,093 - src.order.base - INFO - Order faac0340-e161-468c-b3c5-78bfeb0cfd38 status changed: accepted -> cancelled (IB status: Cancelled)
2025-06-12 13:02:12,093 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2101)
2025-06-12 13:02:12,154 - src.order.base - INFO - Order 72c9855f-a950-41cc-b133-fcd9329a7a17 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:12,155 - src.order.manager - INFO - Submitting order 72c9855f-a950-41cc-b133-fcd9329a7a17 to TWS
2025-06-12 13:02:12,156 - src.order.manager - INFO - Got broker order ID 2104 for order 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:02:12,157 - src.order.manager - INFO - Calling placeOrder with ID 2104, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.960000 DAY
2025-06-12 13:02:12,158 - src.order.manager - INFO - placeOrder called successfully for order 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:02:12,159 - src.order.base - INFO - Order 72c9855f-a950-41cc-b133-fcd9329a7a17 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:12,160 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:02:12,160 - UnifiedFillManager - INFO - Created updated target order 72c9855f-a950-41cc-b133-fcd9329a7a17 for SLV at $32.96 for -303.0 shares
2025-06-12 13:02:12,161 - UnifiedFillManager - INFO - Completed operation for SLV: replace_target
2025-06-12 13:02:12,161 - UnifiedFillManager - INFO - Processing operation for SLV: replace_target
2025-06-12 13:02:12,162 - src.order.base - INFO - Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a status changed: submitted -> pending_cancel (Updating quantity to -303.0)
2025-06-12 13:02:12,162 - src.order.manager - INFO - Cancelling order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a with broker ID 2102
2025-06-12 13:02:12,162 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:12,163 - __main__ - INFO -    Order ID: 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:02:12,163 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:12,163 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:02:12,163 - __main__ - INFO -    Quantity: -303.0
2025-06-12 13:02:12,163 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:02:12,164 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,164 - __main__ - INFO -    Order ID: 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:02:12,164 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:12,164 - __main__ - INFO -    Previous: created
2025-06-12 13:02:12,165 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,165 - __main__ - INFO -    Order ID: 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:02:12,165 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:12,165 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:12,238 - src.tws_connection - INFO - Open Order - ID: 2103, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:02:12,239 - src.order.base - INFO - Order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:02:12,263 - src.order.base - INFO - Order 602aaa0f-a388-44ae-9dae-39c6ef729bf6 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:12,263 - src.order.manager - INFO - Submitting order 602aaa0f-a388-44ae-9dae-39c6ef729bf6 to TWS
2025-06-12 13:02:12,264 - src.order.manager - INFO - Got broker order ID 2105 for order 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:02:12,264 - src.order.manager - INFO - Calling placeOrder with ID 2105, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.960000 DAY
2025-06-12 13:02:12,265 - src.order.manager - INFO - placeOrder called successfully for order 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:02:12,265 - src.order.base - INFO - Order 602aaa0f-a388-44ae-9dae-39c6ef729bf6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:12,265 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:02:12,265 - UnifiedFillManager - INFO - Created updated target order 602aaa0f-a388-44ae-9dae-39c6ef729bf6 for SLV at $32.96 for -303.0 shares
2025-06-12 13:02:12,265 - UnifiedFillManager - INFO - Completed operation for SLV: replace_target
2025-06-12 13:02:12,266 - UnifiedFillManager - INFO - Processing operation for SLV: replace_target
2025-06-12 13:02:12,266 - src.order.manager - WARNING - Cannot cancel inactive order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a with status pending_cancel
2025-06-12 13:02:12,266 - UnifiedFillManager - WARNING - Failed to cancel order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a on attempt 1
2025-06-12 13:02:12,266 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:12,266 - __main__ - INFO -    Order ID: 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:02:12,267 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:12,267 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:02:12,267 - __main__ - INFO -    Quantity: -303.0
2025-06-12 13:02:12,267 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:02:12,267 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,267 - __main__ - INFO -    Order ID: 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:02:12,268 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:12,268 - __main__ - INFO -    Previous: created
2025-06-12 13:02:12,268 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,268 - __main__ - INFO -    Order ID: 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:02:12,268 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:12,268 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:12,302 - src.order.base - INFO - Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:02:12,302 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2102)
2025-06-12 13:02:12,356 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019']
2025-06-12 13:02:12,357 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 13:02:12,358 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.94
2025-06-12 13:02:12,379 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 13:02:12,380 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.94, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.93, original_qty=303, dd_qty=303
2025-06-12 13:02:12,380 - src.order.base - INFO - Order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:12,381 - src.order.manager - INFO - Submitting order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a to TWS
2025-06-12 13:02:12,381 - src.order.manager - INFO - Got broker order ID 2106 for order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:02:12,382 - src.order.manager - INFO - Calling placeOrder with ID 2106, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.930000 DAY
2025-06-12 13:02:12,383 - src.order.manager - INFO - placeOrder called successfully for order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:02:12,383 - src.order.base - INFO - Order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:12,383 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 13:02:12,383 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.93
2025-06-12 13:02:12,384 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 13:02:12,384 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d for SLV
2025-06-12 13:02:12,384 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:12,384 - __main__ - INFO -    Order ID: 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:02:12,384 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:12,384 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:02:12,385 - __main__ - INFO -    Quantity: 303
2025-06-12 13:02:12,385 - __main__ - INFO -    Limit Price: $32.93
2025-06-12 13:02:12,385 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,385 - __main__ - INFO -    Order ID: 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:02:12,385 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:12,385 - __main__ - INFO -    Previous: created
2025-06-12 13:02:12,385 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:12,386 - __main__ - INFO -    Order ID: 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:02:12,386 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:12,386 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:12,454 - src.tws_connection - INFO - Open Order - ID: 2104, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:02:12,455 - src.tws_connection - WARNING - ⚠️ TWS Error 10148: OrderId 2102 that needs to be cancelled cannot be cancelled, state: Cancelled. (reqId: 2102)
2025-06-12 13:02:12,654 - src.tws_connection - INFO - Open Order - ID: 2105, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:02:12,757 - src.tws_connection - INFO - Open Order - ID: 2106, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:02:12,772 - src.order.manager - WARNING - Cannot cancel inactive order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a with status cancelled
2025-06-12 13:02:12,772 - UnifiedFillManager - WARNING - Failed to cancel order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a on attempt 2
2025-06-12 13:02:13,281 - src.order.manager - WARNING - Cannot cancel inactive order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a with status cancelled
2025-06-12 13:02:13,282 - UnifiedFillManager - WARNING - Failed to cancel order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a on attempt 3
2025-06-12 13:02:13,389 - src.order.base - INFO - Order b7a55bec-0d23-435e-944d-61ec28c3031c status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:02:13,390 - src.order.manager - INFO - Submitting order b7a55bec-0d23-435e-944d-61ec28c3031c to TWS
2025-06-12 13:02:13,391 - src.order.manager - INFO - Got broker order ID 2107 for order b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:02:13,391 - src.order.manager - INFO - Calling placeOrder with ID 2107, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.960000 DAY
2025-06-12 13:02:13,392 - src.order.manager - INFO - placeOrder called successfully for order b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:02:13,393 - src.order.base - INFO - Order b7a55bec-0d23-435e-944d-61ec28c3031c status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:02:13,393 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:02:13,393 - UnifiedFillManager - INFO - Created updated target order b7a55bec-0d23-435e-944d-61ec28c3031c for SLV at $32.96 for -303.0 shares
2025-06-12 13:02:13,394 - UnifiedFillManager - INFO - Completed operation for SLV: replace_target
2025-06-12 13:02:13,394 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:02:13,394 - __main__ - INFO -    Order ID: b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:02:13,394 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:02:13,395 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:02:13,395 - __main__ - INFO -    Quantity: -303.0
2025-06-12 13:02:13,395 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:02:13,395 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:13,396 - __main__ - INFO -    Order ID: b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:02:13,396 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:02:13,396 - __main__ - INFO -    Previous: created
2025-06-12 13:02:13,396 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:02:13,396 - __main__ - INFO -    Order ID: b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:02:13,396 - __main__ - INFO -    Status: submitted
2025-06-12 13:02:13,396 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:02:13,500 - src.tws_connection - INFO - Open Order - ID: 2107, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:02:13,822 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:02:18,825 - __main__ - INFO - 
================================================================================
2025-06-12 13:02:18,825 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:02:18,825 - __main__ - INFO - ================================================================================
2025-06-12 13:02:18,826 - __main__ - WARNING - No SLV context found!
2025-06-12 13:02:18,826 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:02:18,826 - __main__ - INFO -    Total orders created: 8
2025-06-12 13:02:18,826 - __main__ - INFO -    Market orders: 1
2025-06-12 13:02:18,826 - __main__ - INFO -    Stop orders: 2
2025-06-12 13:02:18,826 - __main__ - INFO -    Limit orders: 5
2025-06-12 13:02:18,826 - __main__ - WARNING - 
⚠️ WARNING: Expected 4 orders but got 8
2025-06-12 13:02:18,826 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:02:18,827 - __main__ - INFO - 
   Order #1:
2025-06-12 13:02:18,827 - __main__ - INFO -      ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:18,827 - __main__ - INFO -      Type: market
2025-06-12 13:02:18,827 - __main__ - INFO -      Quantity: 303
2025-06-12 13:02:18,827 - __main__ - INFO - 
   Order #2:
2025-06-12 13:02:18,827 - __main__ - INFO -      ID: faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:02:18,827 - __main__ - INFO -      Type: stop
2025-06-12 13:02:18,827 - __main__ - INFO -      Quantity: -303
2025-06-12 13:02:18,827 - __main__ - INFO -      Stop: $32.92
2025-06-12 13:02:18,827 - __main__ - INFO - 
   Order #3:
2025-06-12 13:02:18,828 - __main__ - INFO -      ID: 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:02:18,828 - __main__ - INFO -      Type: limit
2025-06-12 13:02:18,828 - __main__ - INFO -      Quantity: -303
2025-06-12 13:02:18,828 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:02:18,828 - __main__ - INFO - 
   Order #4:
2025-06-12 13:02:18,828 - __main__ - INFO -      ID: fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:02:18,828 - __main__ - INFO -      Type: stop
2025-06-12 13:02:18,828 - __main__ - INFO -      Quantity: -303.0
2025-06-12 13:02:18,828 - __main__ - INFO -      Stop: $32.92
2025-06-12 13:02:18,828 - __main__ - INFO - 
   Order #5:
2025-06-12 13:02:18,829 - __main__ - INFO -      ID: 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:02:18,829 - __main__ - INFO -      Type: limit
2025-06-12 13:02:18,829 - __main__ - INFO -      Quantity: -303.0
2025-06-12 13:02:18,829 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:02:18,829 - __main__ - INFO - 
   Order #6:
2025-06-12 13:02:18,829 - __main__ - INFO -      ID: 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:02:18,829 - __main__ - INFO -      Type: limit
2025-06-12 13:02:18,829 - __main__ - INFO -      Quantity: -303.0
2025-06-12 13:02:18,829 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:02:18,829 - __main__ - INFO - 
   Order #7:
2025-06-12 13:02:18,829 - __main__ - INFO -      ID: 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:02:18,830 - __main__ - INFO -      Type: limit
2025-06-12 13:02:18,830 - __main__ - INFO -      Quantity: 303
2025-06-12 13:02:18,830 - __main__ - INFO -      Limit: $32.93
2025-06-12 13:02:18,830 - __main__ - INFO - 
   Order #8:
2025-06-12 13:02:18,830 - __main__ - INFO -      ID: b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:02:18,830 - __main__ - INFO -      Type: limit
2025-06-12 13:02:18,830 - __main__ - INFO -      Quantity: -303.0
2025-06-12 13:02:18,831 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:02:18,831 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:02:18,831 - __main__ - INFO -    Total fills received: 3
2025-06-12 13:02:18,831 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:02:18,831 - __main__ - INFO -      Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:18,831 - __main__ - INFO -      Quantity: 200.0
2025-06-12 13:02:18,831 - __main__ - INFO -      Price: $32.95
2025-06-12 13:02:18,831 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:02:18,832 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:02:18,832 - __main__ - INFO -      Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:18,832 - __main__ - INFO -      Quantity: 100.0
2025-06-12 13:02:18,832 - __main__ - INFO -      Price: $32.95
2025-06-12 13:02:18,832 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:02:18,832 - __main__ - INFO - 
   Fill #3:
2025-06-12 13:02:18,832 - __main__ - INFO -      Order ID: 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:02:18,832 - __main__ - INFO -      Quantity: 3.0
2025-06-12 13:02:18,832 - __main__ - INFO -      Price: $32.95
2025-06-12 13:02:18,832 - __main__ - INFO -      Status: filled
2025-06-12 13:02:18,832 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:02:48,844 - __main__ - INFO - 
================================================================================
2025-06-12 13:02:48,844 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:02:48,845 - __main__ - INFO - ================================================================================
2025-06-12 13:02:48,845 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:02:48,846 - __main__ - INFO - 
Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d:
2025-06-12 13:02:48,846 - __main__ - INFO -   Type: market
2025-06-12 13:02:48,846 - __main__ - INFO -   Status: filled
2025-06-12 13:02:48,846 - __main__ - INFO -   Quantity: 303
2025-06-12 13:02:48,847 - __main__ - INFO -   Broker ID: 2100
2025-06-12 13:02:48,847 - __main__ - INFO - 
Order faac0340-e161-468c-b3c5-78bfeb0cfd38:
2025-06-12 13:02:48,847 - __main__ - INFO -   Type: stop
2025-06-12 13:02:48,847 - __main__ - INFO -   Status: cancelled
2025-06-12 13:02:48,847 - __main__ - INFO -   Quantity: -303
2025-06-12 13:02:48,847 - __main__ - INFO -   Broker ID: 2101
2025-06-12 13:02:48,848 - __main__ - INFO - 
Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a:
2025-06-12 13:02:48,848 - __main__ - INFO -   Type: limit
2025-06-12 13:02:48,848 - __main__ - INFO -   Status: cancelled
2025-06-12 13:02:48,848 - __main__ - INFO -   Quantity: -303
2025-06-12 13:02:48,848 - __main__ - INFO -   Broker ID: 2102
2025-06-12 13:02:48,848 - __main__ - INFO - 
Order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019:
2025-06-12 13:02:48,848 - __main__ - INFO -   Type: stop
2025-06-12 13:02:48,848 - __main__ - INFO -   Status: accepted
2025-06-12 13:02:48,849 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:02:48,849 - __main__ - INFO -   Broker ID: 2103
2025-06-12 13:02:48,849 - __main__ - INFO - 
Order 72c9855f-a950-41cc-b133-fcd9329a7a17:
2025-06-12 13:02:48,849 - __main__ - INFO -   Type: limit
2025-06-12 13:02:48,849 - __main__ - INFO -   Status: submitted
2025-06-12 13:02:48,849 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:02:48,849 - __main__ - INFO -   Broker ID: 2104
2025-06-12 13:02:48,850 - __main__ - INFO - 
Order 602aaa0f-a388-44ae-9dae-39c6ef729bf6:
2025-06-12 13:02:48,850 - __main__ - INFO -   Type: limit
2025-06-12 13:02:48,851 - __main__ - INFO -   Status: submitted
2025-06-12 13:02:48,851 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:02:48,851 - __main__ - INFO -   Broker ID: 2105
2025-06-12 13:02:48,851 - __main__ - INFO - 
Order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a:
2025-06-12 13:02:48,851 - __main__ - INFO -   Type: limit
2025-06-12 13:02:48,851 - __main__ - INFO -   Status: submitted
2025-06-12 13:02:48,851 - __main__ - INFO -   Quantity: 303
2025-06-12 13:02:48,852 - __main__ - INFO -   Broker ID: 2106
2025-06-12 13:02:48,852 - __main__ - INFO - 
Order b7a55bec-0d23-435e-944d-61ec28c3031c:
2025-06-12 13:02:48,852 - __main__ - INFO -   Type: limit
2025-06-12 13:02:48,852 - __main__ - INFO -   Status: submitted
2025-06-12 13:02:48,852 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:02:48,852 - __main__ - INFO -   Broker ID: 2107
2025-06-12 13:02:48,852 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:03:18,867 - __main__ - INFO - 
================================================================================
2025-06-12 13:03:18,868 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:03:18,869 - __main__ - INFO - ================================================================================
2025-06-12 13:03:18,870 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:03:18,871 - __main__ - INFO - 
Order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d:
2025-06-12 13:03:18,871 - __main__ - INFO -   Type: market
2025-06-12 13:03:18,872 - __main__ - INFO -   Status: filled
2025-06-12 13:03:18,873 - __main__ - INFO -   Quantity: 303
2025-06-12 13:03:18,874 - __main__ - INFO -   Broker ID: 2100
2025-06-12 13:03:18,874 - __main__ - INFO - 
Order faac0340-e161-468c-b3c5-78bfeb0cfd38:
2025-06-12 13:03:18,875 - __main__ - INFO -   Type: stop
2025-06-12 13:03:18,875 - __main__ - INFO -   Status: cancelled
2025-06-12 13:03:18,876 - __main__ - INFO -   Quantity: -303
2025-06-12 13:03:18,877 - __main__ - INFO -   Broker ID: 2101
2025-06-12 13:03:18,877 - __main__ - INFO - 
Order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a:
2025-06-12 13:03:18,877 - __main__ - INFO -   Type: limit
2025-06-12 13:03:18,877 - __main__ - INFO -   Status: cancelled
2025-06-12 13:03:18,878 - __main__ - INFO -   Quantity: -303
2025-06-12 13:03:18,878 - __main__ - INFO -   Broker ID: 2102
2025-06-12 13:03:18,878 - __main__ - INFO - 
Order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019:
2025-06-12 13:03:18,878 - __main__ - INFO -   Type: stop
2025-06-12 13:03:18,879 - __main__ - INFO -   Status: accepted
2025-06-12 13:03:18,879 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:03:18,879 - __main__ - INFO -   Broker ID: 2103
2025-06-12 13:03:18,879 - __main__ - INFO - 
Order 72c9855f-a950-41cc-b133-fcd9329a7a17:
2025-06-12 13:03:18,880 - __main__ - INFO -   Type: limit
2025-06-12 13:03:18,880 - __main__ - INFO -   Status: submitted
2025-06-12 13:03:18,880 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:03:18,880 - __main__ - INFO -   Broker ID: 2104
2025-06-12 13:03:18,881 - __main__ - INFO - 
Order 602aaa0f-a388-44ae-9dae-39c6ef729bf6:
2025-06-12 13:03:18,881 - __main__ - INFO -   Type: limit
2025-06-12 13:03:18,881 - __main__ - INFO -   Status: submitted
2025-06-12 13:03:18,881 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:03:18,881 - __main__ - INFO -   Broker ID: 2105
2025-06-12 13:03:18,882 - __main__ - INFO - 
Order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a:
2025-06-12 13:03:18,882 - __main__ - INFO -   Type: limit
2025-06-12 13:03:18,882 - __main__ - INFO -   Status: submitted
2025-06-12 13:03:18,882 - __main__ - INFO -   Quantity: 303
2025-06-12 13:03:18,882 - __main__ - INFO -   Broker ID: 2106
2025-06-12 13:03:18,882 - __main__ - INFO - 
Order b7a55bec-0d23-435e-944d-61ec28c3031c:
2025-06-12 13:03:18,882 - __main__ - INFO -   Type: limit
2025-06-12 13:03:18,883 - __main__ - INFO -   Status: submitted
2025-06-12 13:03:18,883 - __main__ - INFO -   Quantity: -303.0
2025-06-12 13:03:18,883 - __main__ - INFO -   Broker ID: 2107
2025-06-12 13:03:18,883 - __main__ - INFO - 
================================================================================
2025-06-12 13:03:18,883 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:03:18,884 - __main__ - INFO - ================================================================================
2025-06-12 13:03:18,884 - __main__ - INFO - Cancelling 8 test orders...
2025-06-12 13:03:18,884 - src.order.manager - WARNING - Cannot cancel inactive order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d with status filled
2025-06-12 13:03:18,884 - __main__ - INFO -    Cancelled order 38407653-ebec-4f3d-b3ad-8bbe1b8e792d
2025-06-12 13:03:18,884 - src.order.manager - WARNING - Cannot cancel inactive order faac0340-e161-468c-b3c5-78bfeb0cfd38 with status cancelled
2025-06-12 13:03:18,884 - __main__ - INFO -    Cancelled order faac0340-e161-468c-b3c5-78bfeb0cfd38
2025-06-12 13:03:18,885 - src.order.manager - WARNING - Cannot cancel inactive order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a with status cancelled
2025-06-12 13:03:18,885 - __main__ - INFO -    Cancelled order 844d8f1f-2bb5-4e20-a2ef-12409c0c294a
2025-06-12 13:03:18,885 - src.order.base - INFO - Order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 13:03:18,885 - src.order.manager - INFO - Cancelling order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019 with broker ID 2103
2025-06-12 13:03:18,886 - __main__ - INFO -    Cancelled order fbe924f6-88dd-4b7c-bac3-dd9fb3a7b019
2025-06-12 13:03:18,886 - src.order.base - INFO - Order 72c9855f-a950-41cc-b133-fcd9329a7a17 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:03:18,887 - src.order.manager - INFO - Cancelling order 72c9855f-a950-41cc-b133-fcd9329a7a17 with broker ID 2104
2025-06-12 13:03:18,887 - __main__ - INFO -    Cancelled order 72c9855f-a950-41cc-b133-fcd9329a7a17
2025-06-12 13:03:18,887 - src.order.base - INFO - Order 602aaa0f-a388-44ae-9dae-39c6ef729bf6 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:03:18,888 - src.order.manager - INFO - Cancelling order 602aaa0f-a388-44ae-9dae-39c6ef729bf6 with broker ID 2105
2025-06-12 13:03:18,888 - __main__ - INFO -    Cancelled order 602aaa0f-a388-44ae-9dae-39c6ef729bf6
2025-06-12 13:03:18,888 - src.order.base - INFO - Order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:03:18,889 - src.order.manager - INFO - Cancelling order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a with broker ID 2106
2025-06-12 13:03:18,889 - __main__ - INFO -    Cancelled order 4eae8698-ed63-4504-a77c-d7b0ee1b8e8a
2025-06-12 13:03:18,890 - src.order.base - INFO - Order b7a55bec-0d23-435e-944d-61ec28c3031c status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:03:18,891 - src.order.manager - INFO - Cancelling order b7a55bec-0d23-435e-944d-61ec28c3031c with broker ID 2107
2025-06-12 13:03:18,891 - __main__ - INFO -    Cancelled order b7a55bec-0d23-435e-944d-61ec28c3031c
2025-06-12 13:03:18,892 - UnifiedFillManager - INFO - Order queue processor for SLV cancelled
2025-06-12 13:03:18,893 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:03:18,893 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:03:18,894 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:03:18,894 - __main__ - INFO - Rule engine stopped
2025-06-12 13:03:18,895 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:03:18,895 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:03:18,897 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:03:18,897 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:03:18,898 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:03:18,899 - __main__ - INFO - 
================================================================================
2025-06-12 13:03:18,899 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:03:18,899 - __main__ - INFO - ================================================================================
2025-06-12 13:04:06,487 - __main__ - INFO - ================================================================================
2025-06-12 13:04:06,487 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:04:06,487 - __main__ - INFO - ================================================================================
2025-06-12 13:04:06,487 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:04:06,488 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:04:06,488 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:04:06,489 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:04:06,489 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:04:06,491 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:04:09,474 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:04:09,475 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:04:09,484 - src.tws_connection - INFO - ✅ Next valid order ID received: 2108
2025-06-12 13:04:09,485 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:04:09,485 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:04:09,486 - src.tws_connection - INFO - ✅ Next valid order ID received: 2108
2025-06-12 13:04:09,486 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:04:09,487 - src.tws_connection - INFO - ✅ Next valid order ID received: 2108
2025-06-12 13:04:09,487 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:04:09,488 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:04:09,488 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:04:09,488 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:04:09,488 - __main__ - INFO - Rule engine context configured
2025-06-12 13:04:09,489 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:04:09,489 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:04:09,489 - __main__ - INFO - 
================================================================================
2025-06-12 13:04:09,489 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 13:04:09,489 - __main__ - INFO - ================================================================================
2025-06-12 13:04:09,490 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:04:09,490 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:04:09,490 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 13:04:09,491 - __main__ - INFO - 
================================================================================
2025-06-12 13:04:09,491 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 13:04:09,491 - __main__ - INFO - ================================================================================
2025-06-12 13:04:14,494 - __main__ - INFO - Current SLV price: $32.95
2025-06-12 13:04:14,495 - __main__ - INFO - Created prediction event:
2025-06-12 13:04:14,496 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:04:14,497 - __main__ - INFO -    Signal: BUY
2025-06-12 13:04:14,497 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:04:14,497 - __main__ - INFO -    Price: $32.95
2025-06-12 13:04:14,498 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:04:14,498 - __main__ - INFO - Rule engine started
2025-06-12 13:04:14,498 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:04:14,499 - __main__ - INFO - Prediction event emitted
2025-06-12 13:04:14,499 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:04:14,499 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:04:14,500 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:04:14,500 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 13:04:14,500 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 13:04:15,515 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.95 = $9983.85 (99.8% of $10000.00 allocation)
2025-06-12 13:04:15,515 - src.order.base - INFO - Order 0455dd52-06df-40c3-86bb-e9111008feb4 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:04:15,516 - src.order.manager - INFO - Submitting order 0455dd52-06df-40c3-86bb-e9111008feb4 to TWS
2025-06-12 13:04:15,516 - src.order.manager - INFO - Got broker order ID 2108 for order 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,517 - src.order.manager - INFO - Calling placeOrder with ID 2108, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 13:04:15,518 - src.order.manager - INFO - placeOrder called successfully for order 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,518 - src.order.base - INFO - Order 0455dd52-06df-40c3-86bb-e9111008feb4 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:04:15,519 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 13:04:15,537 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 13:04:15,538 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.93 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:04:15,538 - src.order.base - INFO - Order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:04:15,538 - src.order.manager - INFO - Submitting order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 to TWS
2025-06-12 13:04:15,538 - src.order.manager - INFO - Got broker order ID 2109 for order 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:04:15,538 - src.order.manager - INFO - Calling placeOrder with ID 2109, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:04:15,538 - src.order.manager - INFO - placeOrder called successfully for order 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:04:15,539 - src.order.base - INFO - Order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:04:15,539 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:04:15,539 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 8f1c5438-da77-4b8c-a78f-bed49f4523b2 at $32.93
2025-06-12 13:04:15,540 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.97 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:04:15,540 - src.order.base - INFO - Order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:04:15,540 - src.order.manager - INFO - Submitting order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 to TWS
2025-06-12 13:04:15,541 - src.order.manager - INFO - Got broker order ID 2110 for order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:04:15,541 - src.order.manager - INFO - Calling placeOrder with ID 2110, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.970000 DAY
2025-06-12 13:04:15,542 - src.order.manager - INFO - placeOrder called successfully for order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:04:15,542 - src.order.base - INFO - Order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:04:15,542 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:04:15,543 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 at $32.97
2025-06-12 13:04:15,543 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 13:04:15,544 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:04:15,545 - __main__ - INFO -    Order ID: 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,545 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:04:15,545 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:04:15,545 - __main__ - INFO -    Quantity: 303
2025-06-12 13:04:15,545 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:15,546 - __main__ - INFO -    Order ID: 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,546 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:04:15,546 - __main__ - INFO -    Previous: created
2025-06-12 13:04:15,546 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:15,546 - __main__ - INFO -    Order ID: 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,546 - __main__ - INFO -    Status: submitted
2025-06-12 13:04:15,547 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:04:15,547 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:04:15,547 - __main__ - INFO -    Order ID: 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:04:15,547 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:04:15,547 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:04:15,547 - __main__ - INFO -    Quantity: -303
2025-06-12 13:04:15,547 - __main__ - INFO -    Stop Price: $32.93
2025-06-12 13:04:15,547 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:15,547 - __main__ - INFO -    Order ID: 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:04:15,547 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:04:15,548 - __main__ - INFO -    Previous: created
2025-06-12 13:04:15,548 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:15,548 - __main__ - INFO -    Order ID: 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:04:15,548 - __main__ - INFO -    Status: submitted
2025-06-12 13:04:15,548 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:04:15,548 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:04:15,549 - __main__ - INFO -    Order ID: 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:04:15,549 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:04:15,549 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:04:15,550 - __main__ - INFO -    Quantity: -303
2025-06-12 13:04:15,550 - __main__ - INFO -    Limit Price: $32.97
2025-06-12 13:04:15,550 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:15,550 - __main__ - INFO -    Order ID: 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:04:15,550 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:04:15,550 - __main__ - INFO -    Previous: created
2025-06-12 13:04:15,550 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:15,550 - __main__ - INFO -    Order ID: 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:04:15,550 - __main__ - INFO -    Status: submitted
2025-06-12 13:04:15,551 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:04:15,626 - src.tws_connection - INFO - Open Order - ID: 2108, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:04:15,629 - src.tws_connection - INFO - Open Order - ID: 2109, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:04:15,630 - src.order.base - INFO - Order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:04:15,658 - src.tws_connection - INFO - Open Order - ID: 2110, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:04:15,896 - src.order.base - INFO - Order 0455dd52-06df-40c3-86bb-e9111008feb4 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:04:15,897 - src.order.base - INFO - Order 0455dd52-06df-40c3-86bb-e9111008feb4 filled: 303.0 @ 32.96 (303.0/303)
2025-06-12 13:04:15,898 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:04:15,899 - __main__ - INFO -    Order ID: 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,899 - src.tws_connection - INFO - Open Order - ID: 2108, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:04:15,900 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:04:15,900 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:04:15,901 - __main__ - INFO -    Fill Quantity: 303.0
2025-06-12 13:04:15,901 - __main__ - INFO -    Status: filled
2025-06-12 13:04:15,903 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:04:15,903 - src.tws_connection - INFO - Open Order - ID: 2108, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:04:15,904 - UnifiedFillManager - INFO - Processing fill for SLV: 303.0 shares on order 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:15,905 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:04:15,905 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:04:15,905 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:04:15,906 - UnifiedFillManager - INFO -   Main orders: {'0455dd52-06df-40c3-86bb-e9111008feb4'}
2025-06-12 13:04:15,906 - UnifiedFillManager - INFO -   Stop orders: {'8f1c5438-da77-4b8c-a78f-bed49f4523b2'}
2025-06-12 13:04:15,907 - UnifiedFillManager - INFO -   Target orders: {'3f8a1974-2b4b-411c-99b3-0083dae9c9b6'}
2025-06-12 13:04:15,907 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:04:15,908 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:04:15,908 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:04:15,908 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:04:15,909 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:04:15,909 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:04:15,909 - UnifiedFillManager - INFO - Stop order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 already has correct quantity -303, no update needed
2025-06-12 13:04:15,910 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:04:15,910 - UnifiedFillManager - INFO - Target order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 already has correct quantity -303, no update needed
2025-06-12 13:04:15,910 - UnifiedFillManager - INFO - Started order queue processor for SLV
2025-06-12 13:04:16,059 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['8f1c5438-da77-4b8c-a78f-bed49f4523b2']
2025-06-12 13:04:16,060 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 13:04:16,060 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.95
2025-06-12 13:04:16,075 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 13:04:16,076 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.95, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.94, original_qty=303, dd_qty=303
2025-06-12 13:04:16,077 - src.order.base - INFO - Order 47b8ece0-fed3-4424-9658-bdd080180c1e status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:04:16,077 - src.order.manager - INFO - Submitting order 47b8ece0-fed3-4424-9658-bdd080180c1e to TWS
2025-06-12 13:04:16,078 - src.order.manager - INFO - Got broker order ID 2111 for order 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:04:16,078 - src.order.manager - INFO - Calling placeOrder with ID 2111, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.940000 DAY
2025-06-12 13:04:16,079 - src.order.manager - INFO - placeOrder called successfully for order 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:04:16,079 - src.order.base - INFO - Order 47b8ece0-fed3-4424-9658-bdd080180c1e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:04:16,079 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 13:04:16,080 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.94
2025-06-12 13:04:16,080 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 13:04:16,080 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 0455dd52-06df-40c3-86bb-e9111008feb4 for SLV
2025-06-12 13:04:16,080 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:04:16,080 - __main__ - INFO -    Order ID: 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:04:16,081 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:04:16,081 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:04:16,081 - __main__ - INFO -    Quantity: 303
2025-06-12 13:04:16,081 - __main__ - INFO -    Limit Price: $32.94
2025-06-12 13:04:16,082 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:16,082 - __main__ - INFO -    Order ID: 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:04:16,082 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:04:16,082 - __main__ - INFO -    Previous: created
2025-06-12 13:04:16,082 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:04:16,083 - __main__ - INFO -    Order ID: 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:04:16,083 - __main__ - INFO -    Status: submitted
2025-06-12 13:04:16,083 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:04:16,169 - src.tws_connection - INFO - Open Order - ID: 2111, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:04:17,500 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:04:22,508 - __main__ - INFO - 
================================================================================
2025-06-12 13:04:22,509 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:04:22,510 - __main__ - INFO - ================================================================================
2025-06-12 13:04:22,511 - __main__ - WARNING - No SLV context found!
2025-06-12 13:04:22,512 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:04:22,513 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:04:22,513 - __main__ - INFO -    Market orders: 1
2025-06-12 13:04:22,514 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:04:22,514 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:04:22,515 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:04:22,515 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:04:22,515 - __main__ - INFO - 
   Order #1:
2025-06-12 13:04:22,516 - __main__ - INFO -      ID: 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:22,516 - __main__ - INFO -      Type: market
2025-06-12 13:04:22,517 - __main__ - INFO -      Quantity: 303
2025-06-12 13:04:22,517 - __main__ - INFO - 
   Order #2:
2025-06-12 13:04:22,517 - __main__ - INFO -      ID: 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:04:22,517 - __main__ - INFO -      Type: stop
2025-06-12 13:04:22,517 - __main__ - INFO -      Quantity: -303
2025-06-12 13:04:22,517 - __main__ - INFO -      Stop: $32.93
2025-06-12 13:04:22,518 - __main__ - INFO - 
   Order #3:
2025-06-12 13:04:22,518 - __main__ - INFO -      ID: 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:04:22,518 - __main__ - INFO -      Type: limit
2025-06-12 13:04:22,518 - __main__ - INFO -      Quantity: -303
2025-06-12 13:04:22,519 - __main__ - INFO -      Limit: $32.97
2025-06-12 13:04:22,519 - __main__ - INFO - 
   Order #4:
2025-06-12 13:04:22,519 - __main__ - INFO -      ID: 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:04:22,519 - __main__ - INFO -      Type: limit
2025-06-12 13:04:22,519 - __main__ - INFO -      Quantity: 303
2025-06-12 13:04:22,520 - __main__ - INFO -      Limit: $32.94
2025-06-12 13:04:22,520 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:04:22,520 - __main__ - INFO -    Total fills received: 1
2025-06-12 13:04:22,520 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:04:22,520 - __main__ - INFO -      Order ID: 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:04:22,520 - __main__ - INFO -      Quantity: 303.0
2025-06-12 13:04:22,520 - __main__ - INFO -      Price: $32.96
2025-06-12 13:04:22,521 - __main__ - INFO -      Status: filled
2025-06-12 13:04:22,521 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:04:52,532 - __main__ - INFO - 
================================================================================
2025-06-12 13:04:52,533 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:04:52,533 - __main__ - INFO - ================================================================================
2025-06-12 13:04:52,534 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:04:52,534 - __main__ - INFO - 
Order 0455dd52-06df-40c3-86bb-e9111008feb4:
2025-06-12 13:04:52,535 - __main__ - INFO -   Type: market
2025-06-12 13:04:52,535 - __main__ - INFO -   Status: filled
2025-06-12 13:04:52,535 - __main__ - INFO -   Quantity: 303
2025-06-12 13:04:52,536 - __main__ - INFO -   Broker ID: 2108
2025-06-12 13:04:52,536 - __main__ - INFO - 
Order 8f1c5438-da77-4b8c-a78f-bed49f4523b2:
2025-06-12 13:04:52,536 - __main__ - INFO -   Type: stop
2025-06-12 13:04:52,536 - __main__ - INFO -   Status: accepted
2025-06-12 13:04:52,537 - __main__ - INFO -   Quantity: -303
2025-06-12 13:04:52,537 - __main__ - INFO -   Broker ID: 2109
2025-06-12 13:04:52,537 - __main__ - INFO - 
Order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6:
2025-06-12 13:04:52,537 - __main__ - INFO -   Type: limit
2025-06-12 13:04:52,537 - __main__ - INFO -   Status: submitted
2025-06-12 13:04:52,538 - __main__ - INFO -   Quantity: -303
2025-06-12 13:04:52,538 - __main__ - INFO -   Broker ID: 2110
2025-06-12 13:04:52,538 - __main__ - INFO - 
Order 47b8ece0-fed3-4424-9658-bdd080180c1e:
2025-06-12 13:04:52,538 - __main__ - INFO -   Type: limit
2025-06-12 13:04:52,539 - __main__ - INFO -   Status: submitted
2025-06-12 13:04:52,539 - __main__ - INFO -   Quantity: 303
2025-06-12 13:04:52,539 - __main__ - INFO -   Broker ID: 2111
2025-06-12 13:04:52,539 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:05:22,547 - __main__ - INFO - 
================================================================================
2025-06-12 13:05:22,548 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:05:22,548 - __main__ - INFO - ================================================================================
2025-06-12 13:05:22,548 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:05:22,548 - __main__ - INFO - 
Order 0455dd52-06df-40c3-86bb-e9111008feb4:
2025-06-12 13:05:22,549 - __main__ - INFO -   Type: market
2025-06-12 13:05:22,549 - __main__ - INFO -   Status: filled
2025-06-12 13:05:22,549 - __main__ - INFO -   Quantity: 303
2025-06-12 13:05:22,550 - __main__ - INFO -   Broker ID: 2108
2025-06-12 13:05:22,550 - __main__ - INFO - 
Order 8f1c5438-da77-4b8c-a78f-bed49f4523b2:
2025-06-12 13:05:22,550 - __main__ - INFO -   Type: stop
2025-06-12 13:05:22,550 - __main__ - INFO -   Status: accepted
2025-06-12 13:05:22,550 - __main__ - INFO -   Quantity: -303
2025-06-12 13:05:22,550 - __main__ - INFO -   Broker ID: 2109
2025-06-12 13:05:22,551 - __main__ - INFO - 
Order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6:
2025-06-12 13:05:22,551 - __main__ - INFO -   Type: limit
2025-06-12 13:05:22,551 - __main__ - INFO -   Status: submitted
2025-06-12 13:05:22,551 - __main__ - INFO -   Quantity: -303
2025-06-12 13:05:22,551 - __main__ - INFO -   Broker ID: 2110
2025-06-12 13:05:22,551 - __main__ - INFO - 
Order 47b8ece0-fed3-4424-9658-bdd080180c1e:
2025-06-12 13:05:22,551 - __main__ - INFO -   Type: limit
2025-06-12 13:05:22,551 - __main__ - INFO -   Status: submitted
2025-06-12 13:05:22,551 - __main__ - INFO -   Quantity: 303
2025-06-12 13:05:22,552 - __main__ - INFO -   Broker ID: 2111
2025-06-12 13:05:22,552 - __main__ - INFO - 
================================================================================
2025-06-12 13:05:22,552 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:05:22,552 - __main__ - INFO - ================================================================================
2025-06-12 13:05:22,553 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:05:22,553 - src.order.manager - WARNING - Cannot cancel inactive order 0455dd52-06df-40c3-86bb-e9111008feb4 with status filled
2025-06-12 13:05:22,553 - __main__ - INFO -    Cancelled order 0455dd52-06df-40c3-86bb-e9111008feb4
2025-06-12 13:05:22,553 - src.order.base - INFO - Order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 13:05:22,554 - src.order.manager - INFO - Cancelling order 8f1c5438-da77-4b8c-a78f-bed49f4523b2 with broker ID 2109
2025-06-12 13:05:22,554 - __main__ - INFO -    Cancelled order 8f1c5438-da77-4b8c-a78f-bed49f4523b2
2025-06-12 13:05:22,554 - src.order.base - INFO - Order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:05:22,555 - src.order.manager - INFO - Cancelling order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6 with broker ID 2110
2025-06-12 13:05:22,555 - __main__ - INFO -    Cancelled order 3f8a1974-2b4b-411c-99b3-0083dae9c9b6
2025-06-12 13:05:22,556 - src.order.base - INFO - Order 47b8ece0-fed3-4424-9658-bdd080180c1e status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:05:22,558 - src.order.manager - INFO - Cancelling order 47b8ece0-fed3-4424-9658-bdd080180c1e with broker ID 2111
2025-06-12 13:05:22,558 - __main__ - INFO -    Cancelled order 47b8ece0-fed3-4424-9658-bdd080180c1e
2025-06-12 13:05:22,559 - UnifiedFillManager - INFO - Order queue processor for SLV cancelled
2025-06-12 13:05:22,559 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:05:22,559 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:05:22,560 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:05:22,560 - __main__ - INFO - Rule engine stopped
2025-06-12 13:05:22,560 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:05:22,560 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:05:22,561 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:05:22,561 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:05:22,562 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:05:22,562 - __main__ - INFO - 
================================================================================
2025-06-12 13:05:22,562 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:05:22,563 - __main__ - INFO - ================================================================================
2025-06-12 13:08:31,104 - __main__ - INFO - ================================================================================
2025-06-12 13:08:31,104 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:08:31,105 - __main__ - INFO - ================================================================================
2025-06-12 13:08:31,105 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:08:31,105 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:08:31,105 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:08:31,106 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:08:31,107 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:08:31,109 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:08:38,579 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:08:38,579 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:08:38,602 - src.tws_connection - INFO - ✅ Next valid order ID received: 2112
2025-06-12 13:08:38,603 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:08:38,605 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:08:38,608 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:08:38,608 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:08:38,609 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:08:38,609 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:08:38,609 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:08:38,610 - __main__ - INFO - Rule engine context configured
2025-06-12 13:08:38,610 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:08:38,611 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:08:38,611 - __main__ - INFO - 
================================================================================
2025-06-12 13:08:38,611 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 13:08:38,611 - __main__ - INFO - ================================================================================
2025-06-12 13:08:38,612 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:08:38,612 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:08:38,612 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 13:08:38,612 - __main__ - INFO - 
================================================================================
2025-06-12 13:08:38,613 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 13:08:38,613 - __main__ - INFO - ================================================================================
2025-06-12 13:08:38,698 - src.tws_connection - INFO - ✅ Next valid order ID received: 2112
2025-06-12 13:08:38,780 - src.tws_connection - INFO - ✅ Next valid order ID received: 2112
2025-06-12 13:08:43,624 - __main__ - INFO - Current SLV price: $32.96
2025-06-12 13:08:43,626 - __main__ - INFO - Created prediction event:
2025-06-12 13:08:43,626 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:43,627 - __main__ - INFO -    Signal: BUY
2025-06-12 13:08:43,627 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:08:43,627 - __main__ - INFO -    Price: $32.96
2025-06-12 13:08:43,628 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:08:43,628 - __main__ - INFO - Rule engine started
2025-06-12 13:08:43,628 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:08:43,629 - __main__ - INFO - Prediction event emitted
2025-06-12 13:08:43,629 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:08:43,629 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:08:43,630 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:08:43,630 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 13:08:43,631 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 13:08:44,642 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.95 = $9983.85 (99.8% of $10000.00 allocation)
2025-06-12 13:08:44,643 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:08:44,644 - src.order.manager - INFO - Submitting order 1c36e258-ced1-4fc6-99d0-aaba6605be76 to TWS
2025-06-12 13:08:44,645 - src.order.manager - INFO - Got broker order ID 2112 for order 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,645 - src.order.manager - INFO - Calling placeOrder with ID 2112, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 13:08:44,645 - src.order.manager - INFO - placeOrder called successfully for order 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,646 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:08:44,646 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 13:08:44,666 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 13:08:44,666 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.94 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:08:44,667 - src.order.base - INFO - Order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:08:44,667 - src.order.manager - INFO - Submitting order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e to TWS
2025-06-12 13:08:44,667 - src.order.manager - INFO - Got broker order ID 2113 for order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:08:44,668 - src.order.manager - INFO - Calling placeOrder with ID 2113, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:08:44,668 - src.order.manager - INFO - placeOrder called successfully for order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:08:44,668 - src.order.base - INFO - Order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:08:44,668 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:08:44,669 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 03cd9764-c2c5-4aa1-bffc-5a959155ba1e at $32.94
2025-06-12 13:08:44,669 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.98 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:08:44,669 - src.order.base - INFO - Order a11067fb-b763-475a-b9cb-ccae01400035 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:08:44,669 - src.order.manager - INFO - Submitting order a11067fb-b763-475a-b9cb-ccae01400035 to TWS
2025-06-12 13:08:44,670 - src.order.manager - INFO - Got broker order ID 2114 for order a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:08:44,670 - src.order.manager - INFO - Calling placeOrder with ID 2114, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.980000 DAY
2025-06-12 13:08:44,670 - src.order.manager - INFO - placeOrder called successfully for order a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:08:44,670 - src.order.base - INFO - Order a11067fb-b763-475a-b9cb-ccae01400035 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:08:44,670 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:08:44,671 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit a11067fb-b763-475a-b9cb-ccae01400035 at $32.98
2025-06-12 13:08:44,671 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 13:08:44,671 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:08:44,671 - __main__ - INFO -    Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,671 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:44,671 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:08:44,672 - __main__ - INFO -    Quantity: 303
2025-06-12 13:08:44,672 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:44,672 - __main__ - INFO -    Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,672 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:08:44,673 - __main__ - INFO -    Previous: created
2025-06-12 13:08:44,673 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:44,673 - __main__ - INFO -    Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,673 - __main__ - INFO -    Status: submitted
2025-06-12 13:08:44,674 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:08:44,674 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:08:44,675 - __main__ - INFO -    Order ID: 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:08:44,675 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:44,675 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:08:44,675 - __main__ - INFO -    Quantity: -303
2025-06-12 13:08:44,675 - __main__ - INFO -    Stop Price: $32.94
2025-06-12 13:08:44,676 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:44,676 - __main__ - INFO -    Order ID: 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:08:44,676 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:08:44,676 - __main__ - INFO -    Previous: created
2025-06-12 13:08:44,677 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:44,677 - __main__ - INFO -    Order ID: 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:08:44,677 - __main__ - INFO -    Status: submitted
2025-06-12 13:08:44,677 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:08:44,678 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:08:44,678 - __main__ - INFO -    Order ID: a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:08:44,678 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:44,678 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:08:44,678 - __main__ - INFO -    Quantity: -303
2025-06-12 13:08:44,679 - __main__ - INFO -    Limit Price: $32.98
2025-06-12 13:08:44,679 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:44,679 - __main__ - INFO -    Order ID: a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:08:44,679 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:08:44,680 - __main__ - INFO -    Previous: created
2025-06-12 13:08:44,680 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:44,680 - __main__ - INFO -    Order ID: a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:08:44,680 - __main__ - INFO -    Status: submitted
2025-06-12 13:08:44,680 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:08:44,739 - src.tws_connection - INFO - Open Order - ID: 2112, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:08:44,742 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:08:44,745 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:08:44,746 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 filled: 300.0 @ 32.96 (300.0/303)
2025-06-12 13:08:44,745 - src.tws_connection - INFO - Open Order - ID: 2112, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:08:44,747 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:08:44,747 - __main__ - INFO -    Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,747 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:44,748 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:08:44,748 - __main__ - INFO -    Fill Quantity: 300.0
2025-06-12 13:08:44,748 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:08:44,748 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:08:44,748 - UnifiedFillManager - INFO - Processing fill for SLV: 300.0 shares on order 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,749 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:08:44,749 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:08:44,749 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:08:44,749 - UnifiedFillManager - INFO -   Main orders: {'1c36e258-ced1-4fc6-99d0-aaba6605be76'}
2025-06-12 13:08:44,750 - UnifiedFillManager - INFO -   Stop orders: {'03cd9764-c2c5-4aa1-bffc-5a959155ba1e'}
2025-06-12 13:08:44,750 - UnifiedFillManager - INFO -   Target orders: {'a11067fb-b763-475a-b9cb-ccae01400035'}
2025-06-12 13:08:44,750 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:08:44,750 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:08:44,751 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:08:44,752 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:08:44,752 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:08:44,752 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:08:44,753 - UnifiedFillManager - INFO - Stop order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e already has correct quantity -303, no update needed
2025-06-12 13:08:44,753 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:08:44,753 - UnifiedFillManager - INFO - Target order a11067fb-b763-475a-b9cb-ccae01400035 already has correct quantity -303, no update needed
2025-06-12 13:08:44,754 - UnifiedFillManager - INFO - Started order queue processor for SLV
2025-06-12 13:08:44,754 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:08:44,787 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:08:44,788 - src.order.base - INFO - Order 1c36e258-ced1-4fc6-99d0-aaba6605be76 filled: 3.0 @ 32.96 (303.0/303)
2025-06-12 13:08:44,787 - src.tws_connection - INFO - Open Order - ID: 2112, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:08:44,789 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:08:44,790 - src.tws_connection - INFO - Open Order - ID: 2113, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:08:44,791 - __main__ - INFO -    Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,791 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:44,791 - src.tws_connection - INFO - Open Order - ID: 2112, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:08:44,792 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:08:44,792 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 13:08:44,792 - src.tws_connection - INFO - Open Order - ID: 2112, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:08:44,794 - __main__ - INFO -    Status: filled
2025-06-12 13:08:44,795 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:08:44,795 - src.tws_connection - INFO - Open Order - ID: 2114, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:08:44,796 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:44,797 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:08:44,798 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:08:44,799 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:08:44,799 - UnifiedFillManager - INFO -   Main orders: {'1c36e258-ced1-4fc6-99d0-aaba6605be76'}
2025-06-12 13:08:44,799 - UnifiedFillManager - INFO -   Stop orders: {'03cd9764-c2c5-4aa1-bffc-5a959155ba1e'}
2025-06-12 13:08:44,799 - UnifiedFillManager - INFO -   Target orders: {'a11067fb-b763-475a-b9cb-ccae01400035'}
2025-06-12 13:08:44,800 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:08:44,800 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:08:44,800 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:08:44,801 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:08:44,801 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:08:44,801 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:08:44,802 - UnifiedFillManager - INFO - Stop order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e already has correct quantity -303, no update needed
2025-06-12 13:08:44,802 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:08:44,802 - UnifiedFillManager - INFO - Target order a11067fb-b763-475a-b9cb-ccae01400035 already has correct quantity -303, no update needed
2025-06-12 13:08:44,802 - src.order.base - INFO - Order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:08:45,180 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['03cd9764-c2c5-4aa1-bffc-5a959155ba1e']
2025-06-12 13:08:45,181 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 13:08:45,181 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.96
2025-06-12 13:08:45,199 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 13:08:45,199 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.96, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.95, original_qty=303, dd_qty=303
2025-06-12 13:08:45,200 - src.order.base - INFO - Order 575581ad-9a64-4d97-859d-8ccca7bf75ed status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:08:45,200 - src.order.manager - INFO - Submitting order 575581ad-9a64-4d97-859d-8ccca7bf75ed to TWS
2025-06-12 13:08:45,201 - src.order.manager - INFO - Got broker order ID 2115 for order 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:08:45,201 - src.order.manager - INFO - Calling placeOrder with ID 2115, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.950000 DAY
2025-06-12 13:08:45,201 - src.order.manager - INFO - placeOrder called successfully for order 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:08:45,202 - src.order.base - INFO - Order 575581ad-9a64-4d97-859d-8ccca7bf75ed status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:08:45,202 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 13:08:45,202 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.95
2025-06-12 13:08:45,203 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 13:08:45,203 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 1c36e258-ced1-4fc6-99d0-aaba6605be76 for SLV
2025-06-12 13:08:45,203 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:08:45,203 - __main__ - INFO -    Order ID: 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:08:45,204 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:08:45,204 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:08:45,204 - __main__ - INFO -    Quantity: 303
2025-06-12 13:08:45,204 - __main__ - INFO -    Limit Price: $32.95
2025-06-12 13:08:45,204 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:45,204 - __main__ - INFO -    Order ID: 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:08:45,205 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:08:45,205 - __main__ - INFO -    Previous: created
2025-06-12 13:08:45,205 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:08:45,205 - __main__ - INFO -    Order ID: 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:08:45,205 - __main__ - INFO -    Status: submitted
2025-06-12 13:08:45,205 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:08:45,292 - src.tws_connection - INFO - Open Order - ID: 2115, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:08:46,634 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:08:51,636 - __main__ - INFO - 
================================================================================
2025-06-12 13:08:51,637 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:08:51,637 - __main__ - INFO - ================================================================================
2025-06-12 13:08:51,638 - __main__ - WARNING - No SLV context found!
2025-06-12 13:08:51,638 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:08:51,638 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:08:51,638 - __main__ - INFO -    Market orders: 1
2025-06-12 13:08:51,638 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:08:51,639 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:08:51,639 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:08:51,639 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:08:51,639 - __main__ - INFO - 
   Order #1:
2025-06-12 13:08:51,639 - __main__ - INFO -      ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:51,640 - __main__ - INFO -      Type: market
2025-06-12 13:08:51,640 - __main__ - INFO -      Quantity: 303
2025-06-12 13:08:51,641 - __main__ - INFO - 
   Order #2:
2025-06-12 13:08:51,641 - __main__ - INFO -      ID: 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:08:51,642 - __main__ - INFO -      Type: stop
2025-06-12 13:08:51,642 - __main__ - INFO -      Quantity: -303
2025-06-12 13:08:51,642 - __main__ - INFO -      Stop: $32.94
2025-06-12 13:08:51,643 - __main__ - INFO - 
   Order #3:
2025-06-12 13:08:51,643 - __main__ - INFO -      ID: a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:08:51,643 - __main__ - INFO -      Type: limit
2025-06-12 13:08:51,643 - __main__ - INFO -      Quantity: -303
2025-06-12 13:08:51,644 - __main__ - INFO -      Limit: $32.98
2025-06-12 13:08:51,644 - __main__ - INFO - 
   Order #4:
2025-06-12 13:08:51,644 - __main__ - INFO -      ID: 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:08:51,644 - __main__ - INFO -      Type: limit
2025-06-12 13:08:51,644 - __main__ - INFO -      Quantity: 303
2025-06-12 13:08:51,644 - __main__ - INFO -      Limit: $32.95
2025-06-12 13:08:51,644 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:08:51,645 - __main__ - INFO -    Total fills received: 2
2025-06-12 13:08:51,645 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:08:51,645 - __main__ - INFO -      Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:51,645 - __main__ - INFO -      Quantity: 300.0
2025-06-12 13:08:51,645 - __main__ - INFO -      Price: $32.96
2025-06-12 13:08:51,645 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:08:51,645 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:08:51,645 - __main__ - INFO -      Order ID: 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:08:51,645 - __main__ - INFO -      Quantity: 3.0
2025-06-12 13:08:51,645 - __main__ - INFO -      Price: $32.96
2025-06-12 13:08:51,646 - __main__ - INFO -      Status: filled
2025-06-12 13:08:51,646 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:09:21,653 - __main__ - INFO - 
================================================================================
2025-06-12 13:09:21,654 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:09:21,655 - __main__ - INFO - ================================================================================
2025-06-12 13:09:21,656 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:09:21,656 - __main__ - INFO - 
Order 1c36e258-ced1-4fc6-99d0-aaba6605be76:
2025-06-12 13:09:21,657 - __main__ - INFO -   Type: market
2025-06-12 13:09:21,657 - __main__ - INFO -   Status: filled
2025-06-12 13:09:21,657 - __main__ - INFO -   Quantity: 303
2025-06-12 13:09:21,658 - __main__ - INFO -   Broker ID: 2112
2025-06-12 13:09:21,658 - __main__ - INFO - 
Order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e:
2025-06-12 13:09:21,659 - __main__ - INFO -   Type: stop
2025-06-12 13:09:21,659 - __main__ - INFO -   Status: accepted
2025-06-12 13:09:21,660 - __main__ - INFO -   Quantity: -303
2025-06-12 13:09:21,660 - __main__ - INFO -   Broker ID: 2113
2025-06-12 13:09:21,660 - __main__ - INFO - 
Order a11067fb-b763-475a-b9cb-ccae01400035:
2025-06-12 13:09:21,660 - __main__ - INFO -   Type: limit
2025-06-12 13:09:21,661 - __main__ - INFO -   Status: submitted
2025-06-12 13:09:21,661 - __main__ - INFO -   Quantity: -303
2025-06-12 13:09:21,661 - __main__ - INFO -   Broker ID: 2114
2025-06-12 13:09:21,661 - __main__ - INFO - 
Order 575581ad-9a64-4d97-859d-8ccca7bf75ed:
2025-06-12 13:09:21,661 - __main__ - INFO -   Type: limit
2025-06-12 13:09:21,661 - __main__ - INFO -   Status: submitted
2025-06-12 13:09:21,662 - __main__ - INFO -   Quantity: 303
2025-06-12 13:09:21,662 - __main__ - INFO -   Broker ID: 2115
2025-06-12 13:09:21,662 - __main__ - INFO - 
================================================================================
2025-06-12 13:09:21,663 - __main__ - INFO - STOP LOSS FILL SIMULATION
2025-06-12 13:09:21,663 - __main__ - INFO - ================================================================================
2025-06-12 13:09:21,663 - __main__ - INFO - 
Would you like to simulate a stop loss fill to test position closure?
2025-06-12 13:09:21,663 - __main__ - INFO - This will emit a fill event for the stop order to test if UnifiedFillManager
2025-06-12 13:09:21,663 - __main__ - INFO - properly cancels all other orders (take profit, double down).
2025-06-12 13:09:21,663 - __main__ - INFO - 
Automatically simulating stop loss fill for testing...
2025-06-12 13:09:21,664 - __main__ - INFO - 
================================================================================
2025-06-12 13:09:21,664 - __main__ - INFO - SIMULATING STOP LOSS FILL TO TEST POSITION CLOSURE
2025-06-12 13:09:21,664 - __main__ - INFO - ================================================================================
2025-06-12 13:09:21,664 - __main__ - INFO - Simulating stop loss fill on order: 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:09:21,664 - __main__ - INFO - Emitting stop loss fill event: -303 shares at $32.94
2025-06-12 13:09:21,665 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:09:21,665 - __main__ - INFO -    Order ID: 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:09:21,665 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:09:21,665 - __main__ - INFO -    Fill Price: $32.94
2025-06-12 13:09:21,666 - __main__ - INFO -    Fill Quantity: -303
2025-06-12 13:09:21,666 - __main__ - INFO -    Status: filled
2025-06-12 13:09:21,666 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:09:21,666 - UnifiedFillManager - INFO - Processing fill for SLV: -303 shares on order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:09:21,666 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 13:09:21,666 - UnifiedFillManager - INFO - Partial stop fill for SLV, remaining position: 303.0
2025-06-12 13:09:21,667 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:09:21,667 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:09:21,667 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:09:21,668 - UnifiedFillManager - INFO - Target order a11067fb-b763-475a-b9cb-ccae01400035 already has correct quantity -303, no update needed
2025-06-12 13:09:24,679 - __main__ - INFO - UnifiedFillManager should have cancelled all remaining orders
2025-06-12 13:09:24,679 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the stop loss fill...
2025-06-12 13:09:29,690 - __main__ - INFO - 
================================================================================
2025-06-12 13:09:29,691 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:09:29,691 - __main__ - INFO - ================================================================================
2025-06-12 13:09:29,692 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:09:29,692 - __main__ - INFO - 
Order 1c36e258-ced1-4fc6-99d0-aaba6605be76:
2025-06-12 13:09:29,692 - __main__ - INFO -   Type: market
2025-06-12 13:09:29,692 - __main__ - INFO -   Status: filled
2025-06-12 13:09:29,693 - __main__ - INFO -   Quantity: 303
2025-06-12 13:09:29,693 - __main__ - INFO -   Broker ID: 2112
2025-06-12 13:09:29,693 - __main__ - INFO - 
Order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e:
2025-06-12 13:09:29,694 - __main__ - INFO -   Type: stop
2025-06-12 13:09:29,695 - __main__ - INFO -   Status: accepted
2025-06-12 13:09:29,695 - __main__ - INFO -   Quantity: -303
2025-06-12 13:09:29,695 - __main__ - INFO -   Broker ID: 2113
2025-06-12 13:09:29,695 - __main__ - INFO - 
Order a11067fb-b763-475a-b9cb-ccae01400035:
2025-06-12 13:09:29,696 - __main__ - INFO -   Type: limit
2025-06-12 13:09:29,696 - __main__ - INFO -   Status: submitted
2025-06-12 13:09:29,697 - __main__ - INFO -   Quantity: -303
2025-06-12 13:09:29,697 - __main__ - INFO -   Broker ID: 2114
2025-06-12 13:09:29,697 - __main__ - INFO - 
Order 575581ad-9a64-4d97-859d-8ccca7bf75ed:
2025-06-12 13:09:29,697 - __main__ - INFO -   Type: limit
2025-06-12 13:09:29,697 - __main__ - INFO -   Status: submitted
2025-06-12 13:09:29,697 - __main__ - INFO -   Quantity: 303
2025-06-12 13:09:29,697 - __main__ - INFO -   Broker ID: 2115
2025-06-12 13:09:29,698 - __main__ - INFO - 
================================================================================
2025-06-12 13:09:29,698 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:09:29,698 - __main__ - INFO - ================================================================================
2025-06-12 13:09:29,698 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:09:29,698 - src.order.manager - WARNING - Cannot cancel inactive order 1c36e258-ced1-4fc6-99d0-aaba6605be76 with status filled
2025-06-12 13:09:29,698 - __main__ - INFO -    Cancelled order 1c36e258-ced1-4fc6-99d0-aaba6605be76
2025-06-12 13:09:29,699 - src.order.base - INFO - Order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 13:09:29,699 - src.order.manager - INFO - Cancelling order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e with broker ID 2113
2025-06-12 13:09:29,699 - __main__ - INFO -    Cancelled order 03cd9764-c2c5-4aa1-bffc-5a959155ba1e
2025-06-12 13:09:29,699 - src.order.base - INFO - Order a11067fb-b763-475a-b9cb-ccae01400035 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:09:29,700 - src.order.manager - INFO - Cancelling order a11067fb-b763-475a-b9cb-ccae01400035 with broker ID 2114
2025-06-12 13:09:29,700 - __main__ - INFO -    Cancelled order a11067fb-b763-475a-b9cb-ccae01400035
2025-06-12 13:09:29,700 - src.order.base - INFO - Order 575581ad-9a64-4d97-859d-8ccca7bf75ed status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:09:29,700 - src.order.manager - INFO - Cancelling order 575581ad-9a64-4d97-859d-8ccca7bf75ed with broker ID 2115
2025-06-12 13:09:29,701 - __main__ - INFO -    Cancelled order 575581ad-9a64-4d97-859d-8ccca7bf75ed
2025-06-12 13:09:29,701 - UnifiedFillManager - INFO - Order queue processor for SLV cancelled
2025-06-12 13:09:29,701 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:09:29,702 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:09:29,702 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:09:29,702 - __main__ - INFO - Rule engine stopped
2025-06-12 13:09:29,702 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:09:29,702 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:09:29,703 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:09:29,703 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:09:29,704 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:09:29,704 - __main__ - INFO - 
================================================================================
2025-06-12 13:09:29,704 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:09:29,704 - __main__ - INFO - ================================================================================
2025-06-12 13:10:07,404 - __main__ - INFO - ================================================================================
2025-06-12 13:10:07,404 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:10:07,404 - __main__ - INFO - ================================================================================
2025-06-12 13:10:07,404 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:10:07,404 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:10:07,405 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:10:07,406 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:10:07,406 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:10:07,407 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:10:09,399 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:10:09,400 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:10:09,412 - src.tws_connection - INFO - ✅ Next valid order ID received: 2116
2025-06-12 13:10:09,412 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:10:09,413 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:10:09,414 - src.tws_connection - INFO - ✅ Next valid order ID received: 2116
2025-06-12 13:10:09,415 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:10:09,415 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:10:09,415 - src.tws_connection - INFO - ✅ Next valid order ID received: 2116
2025-06-12 13:10:09,416 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:10:09,416 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:10:09,417 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:10:09,417 - __main__ - INFO - Rule engine context configured
2025-06-12 13:10:09,417 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:10:09,418 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:10:09,418 - __main__ - INFO - 
================================================================================
2025-06-12 13:10:09,418 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 13:10:09,418 - __main__ - INFO - ================================================================================
2025-06-12 13:10:09,418 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:10:09,419 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:10:09,419 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 13:10:09,419 - __main__ - INFO - 
================================================================================
2025-06-12 13:10:09,419 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 13:10:09,420 - __main__ - INFO - ================================================================================
2025-06-12 13:10:14,421 - __main__ - INFO - Current SLV price: $32.96
2025-06-12 13:10:14,421 - __main__ - INFO - Created prediction event:
2025-06-12 13:10:14,422 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:14,422 - __main__ - INFO -    Signal: BUY
2025-06-12 13:10:14,423 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:10:14,423 - __main__ - INFO -    Price: $32.96
2025-06-12 13:10:14,424 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:10:14,424 - __main__ - INFO - Rule engine started
2025-06-12 13:10:14,425 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:10:14,426 - __main__ - INFO - Prediction event emitted
2025-06-12 13:10:14,426 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:10:14,426 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:10:14,427 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:10:14,427 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 13:10:14,428 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 13:10:15,427 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.96 = $9986.88 (99.9% of $10000.00 allocation)
2025-06-12 13:10:15,428 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:10:15,428 - src.order.manager - INFO - Submitting order ece5eae3-67e8-4915-afed-58ddfde87cb3 to TWS
2025-06-12 13:10:15,429 - src.order.manager - INFO - Got broker order ID 2116 for order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,429 - src.order.manager - INFO - Calling placeOrder with ID 2116, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 13:10:15,429 - src.order.manager - INFO - placeOrder called successfully for order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,429 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:10:15,430 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 13:10:15,445 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 13:10:15,445 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.94 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:10:15,445 - src.order.base - INFO - Order ebf24af1-a127-4622-9571-e7c7a87ea319 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:10:15,446 - src.order.manager - INFO - Submitting order ebf24af1-a127-4622-9571-e7c7a87ea319 to TWS
2025-06-12 13:10:15,446 - src.order.manager - INFO - Got broker order ID 2117 for order ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:15,446 - src.order.manager - INFO - Calling placeOrder with ID 2117, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:10:15,447 - src.order.manager - INFO - placeOrder called successfully for order ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:15,447 - src.order.base - INFO - Order ebf24af1-a127-4622-9571-e7c7a87ea319 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:10:15,447 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:10:15,447 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss ebf24af1-a127-4622-9571-e7c7a87ea319 at $32.94
2025-06-12 13:10:15,447 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.98 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:10:15,447 - src.order.base - INFO - Order a864742e-85f7-400c-b95c-b426d3aeb9d2 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:10:15,448 - src.order.manager - INFO - Submitting order a864742e-85f7-400c-b95c-b426d3aeb9d2 to TWS
2025-06-12 13:10:15,448 - src.order.manager - INFO - Got broker order ID 2118 for order a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:10:15,448 - src.order.manager - INFO - Calling placeOrder with ID 2118, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.980000 DAY
2025-06-12 13:10:15,448 - src.order.manager - INFO - placeOrder called successfully for order a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:10:15,448 - src.order.base - INFO - Order a864742e-85f7-400c-b95c-b426d3aeb9d2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:10:15,448 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:10:15,448 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit a864742e-85f7-400c-b95c-b426d3aeb9d2 at $32.98
2025-06-12 13:10:15,449 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 13:10:15,449 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:10:15,449 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,449 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,449 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:10:15,449 - __main__ - INFO -    Quantity: 303
2025-06-12 13:10:15,450 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,450 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,450 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:10:15,450 - __main__ - INFO -    Previous: created
2025-06-12 13:10:15,450 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,450 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,450 - __main__ - INFO -    Status: submitted
2025-06-12 13:10:15,450 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:10:15,451 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:10:15,451 - __main__ - INFO -    Order ID: ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:15,451 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,451 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:10:15,451 - __main__ - INFO -    Quantity: -303
2025-06-12 13:10:15,451 - __main__ - INFO -    Stop Price: $32.94
2025-06-12 13:10:15,451 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,452 - __main__ - INFO -    Order ID: ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:15,452 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:10:15,452 - __main__ - INFO -    Previous: created
2025-06-12 13:10:15,452 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,452 - __main__ - INFO -    Order ID: ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:15,452 - __main__ - INFO -    Status: submitted
2025-06-12 13:10:15,452 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:10:15,452 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:10:15,452 - __main__ - INFO -    Order ID: a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:10:15,452 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,453 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:10:15,453 - __main__ - INFO -    Quantity: -303
2025-06-12 13:10:15,453 - __main__ - INFO -    Limit Price: $32.98
2025-06-12 13:10:15,453 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,453 - __main__ - INFO -    Order ID: a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:10:15,453 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:10:15,453 - __main__ - INFO -    Previous: created
2025-06-12 13:10:15,453 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,453 - __main__ - INFO -    Order ID: a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:10:15,453 - __main__ - INFO -    Status: submitted
2025-06-12 13:10:15,454 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:10:15,525 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,526 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:10:15,532 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:10:15,533 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 filled: 100.0 @ 32.96 (100.0/303)
2025-06-12 13:10:15,532 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,533 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:10:15,534 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,534 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,534 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:10:15,534 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 13:10:15,534 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:10:15,535 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:10:15,535 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,535 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:10:15,535 - UnifiedFillManager - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 fill status: partially_filled, is_fully_filled: False
2025-06-12 13:10:15,535 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:10:15,535 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:10:15,536 - UnifiedFillManager - INFO -   Main orders: {'ece5eae3-67e8-4915-afed-58ddfde87cb3'}
2025-06-12 13:10:15,536 - UnifiedFillManager - INFO -   Stop orders: {'ebf24af1-a127-4622-9571-e7c7a87ea319'}
2025-06-12 13:10:15,536 - UnifiedFillManager - INFO -   Target orders: {'a864742e-85f7-400c-b95c-b426d3aeb9d2'}
2025-06-12 13:10:15,536 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:10:15,536 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:10:15,536 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:10:15,537 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:10:15,537 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:10:15,537 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:10:15,537 - UnifiedFillManager - INFO - Stop order ebf24af1-a127-4622-9571-e7c7a87ea319 already has correct quantity -303, no update needed
2025-06-12 13:10:15,537 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:10:15,537 - UnifiedFillManager - INFO - Target order a864742e-85f7-400c-b95c-b426d3aeb9d2 already has correct quantity -303, no update needed
2025-06-12 13:10:15,538 - UnifiedFillManager - INFO - Started order queue processor for SLV
2025-06-12 13:10:15,538 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:10:15,539 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:10:15,539 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 filled: 100.0 @ 32.96 (200.0/303)
2025-06-12 13:10:15,540 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:10:15,540 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,541 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,541 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:10:15,542 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 13:10:15,542 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:10:15,541 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,542 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:10:15,543 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,543 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:10:15,544 - UnifiedFillManager - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 fill status: partially_filled, is_fully_filled: False
2025-06-12 13:10:15,544 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:10:15,544 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:10:15,544 - UnifiedFillManager - INFO -   Main orders: {'ece5eae3-67e8-4915-afed-58ddfde87cb3'}
2025-06-12 13:10:15,545 - UnifiedFillManager - INFO -   Stop orders: {'ebf24af1-a127-4622-9571-e7c7a87ea319'}
2025-06-12 13:10:15,545 - UnifiedFillManager - INFO -   Target orders: {'a864742e-85f7-400c-b95c-b426d3aeb9d2'}
2025-06-12 13:10:15,545 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:10:15,545 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:10:15,546 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:10:15,546 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:10:15,546 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:10:15,546 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:10:15,547 - UnifiedFillManager - INFO - Stop order ebf24af1-a127-4622-9571-e7c7a87ea319 already has correct quantity -303, no update needed
2025-06-12 13:10:15,547 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:10:15,547 - UnifiedFillManager - INFO - Target order a864742e-85f7-400c-b95c-b426d3aeb9d2 already has correct quantity -303, no update needed
2025-06-12 13:10:15,548 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:10:15,548 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:10:15,548 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,548 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 filled: 100.0 @ 32.96 (300.0/303)
2025-06-12 13:10:15,549 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:10:15,549 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,549 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,550 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:10:15,550 - __main__ - INFO -    Fill Quantity: 100.0
2025-06-12 13:10:15,550 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:10:15,550 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:10:15,550 - UnifiedFillManager - INFO - Processing fill for SLV: 100.0 shares on order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,550 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 fill status: partially_filled, is_fully_filled: False
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO -   Main orders: {'ece5eae3-67e8-4915-afed-58ddfde87cb3'}
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO -   Stop orders: {'ebf24af1-a127-4622-9571-e7c7a87ea319'}
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO -   Target orders: {'a864742e-85f7-400c-b95c-b426d3aeb9d2'}
2025-06-12 13:10:15,551 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:10:15,552 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:10:15,552 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:10:15,552 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:10:15,552 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:10:15,552 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,553 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:10:15,554 - UnifiedFillManager - INFO - Stop order ebf24af1-a127-4622-9571-e7c7a87ea319 already has correct quantity -303, no update needed
2025-06-12 13:10:15,555 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:10:15,554 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,555 - UnifiedFillManager - INFO - Target order a864742e-85f7-400c-b95c-b426d3aeb9d2 already has correct quantity -303, no update needed
2025-06-12 13:10:15,555 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:10:15,556 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:10:15,556 - src.order.base - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 filled: 3.0 @ 32.96 (303.0/303)
2025-06-12 13:10:15,557 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:10:15,557 - __main__ - INFO -    Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,557 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,558 - __main__ - INFO -    Fill Price: $32.96
2025-06-12 13:10:15,557 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,558 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 13:10:15,559 - __main__ - INFO -    Status: filled
2025-06-12 13:10:15,559 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:10:15,559 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,560 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:15,560 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO - Order ece5eae3-67e8-4915-afed-58ddfde87cb3 fill status: filled, is_fully_filled: True
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO -   Main orders: {'ece5eae3-67e8-4915-afed-58ddfde87cb3'}
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO -   Stop orders: {'ebf24af1-a127-4622-9571-e7c7a87ea319'}
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO -   Target orders: {'a864742e-85f7-400c-b95c-b426d3aeb9d2'}
2025-06-12 13:10:15,561 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:10:15,562 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:10:15,561 - src.tws_connection - INFO - Open Order - ID: 2116, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:15,562 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:10:15,562 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:10:15,562 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:10:15,562 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:10:15,562 - UnifiedFillManager - INFO - Stop order ebf24af1-a127-4622-9571-e7c7a87ea319 already has correct quantity -303, no update needed
2025-06-12 13:10:15,563 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:10:15,563 - UnifiedFillManager - INFO - Target order a864742e-85f7-400c-b95c-b426d3aeb9d2 already has correct quantity -303, no update needed
2025-06-12 13:10:15,579 - src.tws_connection - INFO - Open Order - ID: 2117, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:10:15,579 - src.order.base - INFO - Order ebf24af1-a127-4622-9571-e7c7a87ea319 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:10:15,580 - src.tws_connection - INFO - Open Order - ID: 2118, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:10:15,963 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['ebf24af1-a127-4622-9571-e7c7a87ea319']
2025-06-12 13:10:15,963 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 13:10:15,964 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.96
2025-06-12 13:10:15,979 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 13:10:15,980 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.96, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.95, original_qty=303, dd_qty=303
2025-06-12 13:10:15,980 - src.order.base - INFO - Order a87cf98c-6a29-438b-90e8-964e37b8b403 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:10:15,981 - src.order.manager - INFO - Submitting order a87cf98c-6a29-438b-90e8-964e37b8b403 to TWS
2025-06-12 13:10:15,981 - src.order.manager - INFO - Got broker order ID 2119 for order a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:10:15,981 - src.order.manager - INFO - Calling placeOrder with ID 2119, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.950000 DAY
2025-06-12 13:10:15,981 - src.order.manager - INFO - placeOrder called successfully for order a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:10:15,982 - src.order.base - INFO - Order a87cf98c-6a29-438b-90e8-964e37b8b403 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:10:15,982 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 13:10:15,982 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.95
2025-06-12 13:10:15,983 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 13:10:15,983 - src.rule.linked_order_actions - INFO - Created and linked BUY main order ece5eae3-67e8-4915-afed-58ddfde87cb3 for SLV
2025-06-12 13:10:15,983 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:10:15,983 - __main__ - INFO -    Order ID: a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:10:15,984 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:15,984 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:10:15,984 - __main__ - INFO -    Quantity: 303
2025-06-12 13:10:15,984 - __main__ - INFO -    Limit Price: $32.95
2025-06-12 13:10:15,984 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,984 - __main__ - INFO -    Order ID: a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:10:15,985 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:10:15,985 - __main__ - INFO -    Previous: created
2025-06-12 13:10:15,985 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:10:15,985 - __main__ - INFO -    Order ID: a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:10:15,985 - __main__ - INFO -    Status: submitted
2025-06-12 13:10:15,985 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:10:16,081 - src.tws_connection - INFO - Open Order - ID: 2119, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:17,428 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:10:22,443 - __main__ - INFO - 
================================================================================
2025-06-12 13:10:22,444 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:10:22,444 - __main__ - INFO - ================================================================================
2025-06-12 13:10:22,445 - __main__ - WARNING - No SLV context found!
2025-06-12 13:10:22,445 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:10:22,445 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:10:22,445 - __main__ - INFO -    Market orders: 1
2025-06-12 13:10:22,446 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:10:22,446 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:10:22,446 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:10:22,447 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:10:22,447 - __main__ - INFO - 
   Order #1:
2025-06-12 13:10:22,447 - __main__ - INFO -      ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:22,447 - __main__ - INFO -      Type: market
2025-06-12 13:10:22,447 - __main__ - INFO -      Quantity: 303
2025-06-12 13:10:22,447 - __main__ - INFO - 
   Order #2:
2025-06-12 13:10:22,448 - __main__ - INFO -      ID: ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:22,448 - __main__ - INFO -      Type: stop
2025-06-12 13:10:22,448 - __main__ - INFO -      Quantity: -303
2025-06-12 13:10:22,448 - __main__ - INFO -      Stop: $32.94
2025-06-12 13:10:22,448 - __main__ - INFO - 
   Order #3:
2025-06-12 13:10:22,448 - __main__ - INFO -      ID: a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:10:22,448 - __main__ - INFO -      Type: limit
2025-06-12 13:10:22,448 - __main__ - INFO -      Quantity: -303
2025-06-12 13:10:22,449 - __main__ - INFO -      Limit: $32.98
2025-06-12 13:10:22,449 - __main__ - INFO - 
   Order #4:
2025-06-12 13:10:22,449 - __main__ - INFO -      ID: a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:10:22,449 - __main__ - INFO -      Type: limit
2025-06-12 13:10:22,449 - __main__ - INFO -      Quantity: 303
2025-06-12 13:10:22,449 - __main__ - INFO -      Limit: $32.95
2025-06-12 13:10:22,449 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:10:22,450 - __main__ - INFO -    Total fills received: 4
2025-06-12 13:10:22,450 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:10:22,450 - __main__ - INFO -      Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:22,450 - __main__ - INFO -      Quantity: 100.0
2025-06-12 13:10:22,450 - __main__ - INFO -      Price: $32.96
2025-06-12 13:10:22,450 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:10:22,450 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:10:22,450 - __main__ - INFO -      Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:22,450 - __main__ - INFO -      Quantity: 100.0
2025-06-12 13:10:22,451 - __main__ - INFO -      Price: $32.96
2025-06-12 13:10:22,451 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:10:22,451 - __main__ - INFO - 
   Fill #3:
2025-06-12 13:10:22,451 - __main__ - INFO -      Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:22,451 - __main__ - INFO -      Quantity: 100.0
2025-06-12 13:10:22,451 - __main__ - INFO -      Price: $32.96
2025-06-12 13:10:22,451 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:10:22,451 - __main__ - INFO - 
   Fill #4:
2025-06-12 13:10:22,451 - __main__ - INFO -      Order ID: ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:10:22,452 - __main__ - INFO -      Quantity: 3.0
2025-06-12 13:10:22,452 - __main__ - INFO -      Price: $32.96
2025-06-12 13:10:22,452 - __main__ - INFO -      Status: filled
2025-06-12 13:10:22,452 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:10:36,493 - src.tws_connection - INFO - Open Order - ID: 2119, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:10:52,456 - __main__ - INFO - 
================================================================================
2025-06-12 13:10:52,457 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:10:52,458 - __main__ - INFO - ================================================================================
2025-06-12 13:10:52,458 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:10:52,458 - __main__ - INFO - 
Order ece5eae3-67e8-4915-afed-58ddfde87cb3:
2025-06-12 13:10:52,459 - __main__ - INFO -   Type: market
2025-06-12 13:10:52,459 - __main__ - INFO -   Status: filled
2025-06-12 13:10:52,459 - __main__ - INFO -   Quantity: 303
2025-06-12 13:10:52,459 - __main__ - INFO -   Broker ID: 2116
2025-06-12 13:10:52,460 - __main__ - INFO - 
Order ebf24af1-a127-4622-9571-e7c7a87ea319:
2025-06-12 13:10:52,460 - __main__ - INFO -   Type: stop
2025-06-12 13:10:52,460 - __main__ - INFO -   Status: accepted
2025-06-12 13:10:52,460 - __main__ - INFO -   Quantity: -303
2025-06-12 13:10:52,460 - __main__ - INFO -   Broker ID: 2117
2025-06-12 13:10:52,461 - __main__ - INFO - 
Order a864742e-85f7-400c-b95c-b426d3aeb9d2:
2025-06-12 13:10:52,461 - __main__ - INFO -   Type: limit
2025-06-12 13:10:52,461 - __main__ - INFO -   Status: submitted
2025-06-12 13:10:52,461 - __main__ - INFO -   Quantity: -303
2025-06-12 13:10:52,461 - __main__ - INFO -   Broker ID: 2118
2025-06-12 13:10:52,461 - __main__ - INFO - 
Order a87cf98c-6a29-438b-90e8-964e37b8b403:
2025-06-12 13:10:52,461 - __main__ - INFO -   Type: limit
2025-06-12 13:10:52,462 - __main__ - INFO -   Status: submitted
2025-06-12 13:10:52,462 - __main__ - INFO -   Quantity: 303
2025-06-12 13:10:52,462 - __main__ - INFO -   Broker ID: 2119
2025-06-12 13:10:52,462 - __main__ - INFO - 
================================================================================
2025-06-12 13:10:52,462 - __main__ - INFO - STOP LOSS FILL SIMULATION
2025-06-12 13:10:52,463 - __main__ - INFO - ================================================================================
2025-06-12 13:10:52,463 - __main__ - INFO - 
Would you like to simulate a stop loss fill to test position closure?
2025-06-12 13:10:52,463 - __main__ - INFO - This will emit a fill event for the stop order to test if UnifiedFillManager
2025-06-12 13:10:52,463 - __main__ - INFO - properly cancels all other orders (take profit, double down).
2025-06-12 13:10:52,463 - __main__ - INFO - 
Automatically simulating stop loss fill for testing...
2025-06-12 13:10:52,463 - __main__ - INFO - 
================================================================================
2025-06-12 13:10:52,463 - __main__ - INFO - SIMULATING STOP LOSS FILL TO TEST POSITION CLOSURE
2025-06-12 13:10:52,464 - __main__ - INFO - ================================================================================
2025-06-12 13:10:52,464 - __main__ - INFO - Simulating stop loss fill on order: ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:52,464 - __main__ - INFO - Emitting stop loss fill event: -303 shares at $32.94
2025-06-12 13:10:52,464 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:10:52,464 - __main__ - INFO -    Order ID: ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:52,464 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:10:52,464 - __main__ - INFO -    Fill Price: $32.94
2025-06-12 13:10:52,465 - __main__ - INFO -    Fill Quantity: -303
2025-06-12 13:10:52,465 - __main__ - INFO -    Status: filled
2025-06-12 13:10:52,465 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:10:52,465 - UnifiedFillManager - INFO - Processing fill for SLV: -303 shares on order ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:10:52,465 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 13:10:52,465 - UnifiedFillManager - INFO - Order ebf24af1-a127-4622-9571-e7c7a87ea319 fill status: filled, is_fully_filled: True
2025-06-12 13:10:52,465 - UnifiedFillManager - INFO - Closing position for SLV: Stop order fully filled
2025-06-12 13:10:52,466 - src.position.position_manager - INFO - Closed position for SLV
2025-06-12 13:10:52,466 - src.trade_tracker - INFO - Closed trade for SLV
2025-06-12 13:10:52,466 - UnifiedFillManager - INFO - Position closed for SLV: cancellation queued, trackers updated
2025-06-12 13:10:52,466 - UnifiedFillManager - INFO - Processing operation for SLV: cancel_all
2025-06-12 13:10:52,466 - src.order.base - INFO - Order a87cf98c-6a29-438b-90e8-964e37b8b403 status changed: submitted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:10:52,467 - src.order.manager - INFO - Cancelling order a87cf98c-6a29-438b-90e8-964e37b8b403 with broker ID 2119
2025-06-12 13:10:52,467 - src.order.base - INFO - Order a864742e-85f7-400c-b95c-b426d3aeb9d2 status changed: submitted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:10:52,467 - src.order.manager - INFO - Cancelling order a864742e-85f7-400c-b95c-b426d3aeb9d2 with broker ID 2118
2025-06-12 13:10:52,467 - src.order.base - INFO - Order ebf24af1-a127-4622-9571-e7c7a87ea319 status changed: accepted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:10:52,467 - src.order.manager - INFO - Cancelling order ebf24af1-a127-4622-9571-e7c7a87ea319 with broker ID 2117
2025-06-12 13:10:52,468 - UnifiedFillManager - INFO - Cancelled 3 orders for SLV
2025-06-12 13:10:52,468 - UnifiedFillManager - INFO - Completed operation for SLV: cancel_all
2025-06-12 13:10:52,517 - src.order.base - INFO - Order a87cf98c-6a29-438b-90e8-964e37b8b403 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:10:52,517 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2119)
2025-06-12 13:10:52,620 - src.order.base - INFO - Order a864742e-85f7-400c-b95c-b426d3aeb9d2 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:10:52,620 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2118)
2025-06-12 13:10:52,701 - src.order.base - INFO - Order ebf24af1-a127-4622-9571-e7c7a87ea319 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:10:52,701 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2117)
2025-06-12 13:10:55,467 - __main__ - INFO - UnifiedFillManager should have cancelled all remaining orders
2025-06-12 13:10:55,468 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the stop loss fill...
2025-06-12 13:11:00,471 - __main__ - INFO - 
================================================================================
2025-06-12 13:11:00,472 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:11:00,472 - __main__ - INFO - ================================================================================
2025-06-12 13:11:00,472 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:11:00,473 - __main__ - INFO - 
Order ece5eae3-67e8-4915-afed-58ddfde87cb3:
2025-06-12 13:11:00,473 - __main__ - INFO -   Type: market
2025-06-12 13:11:00,474 - __main__ - INFO -   Status: filled
2025-06-12 13:11:00,474 - __main__ - INFO -   Quantity: 303
2025-06-12 13:11:00,474 - __main__ - INFO -   Broker ID: 2116
2025-06-12 13:11:00,475 - __main__ - INFO - 
Order ebf24af1-a127-4622-9571-e7c7a87ea319:
2025-06-12 13:11:00,475 - __main__ - INFO -   Type: stop
2025-06-12 13:11:00,475 - __main__ - INFO -   Status: cancelled
2025-06-12 13:11:00,475 - __main__ - INFO -   Quantity: -303
2025-06-12 13:11:00,476 - __main__ - INFO -   Broker ID: 2117
2025-06-12 13:11:00,476 - __main__ - INFO - 
Order a864742e-85f7-400c-b95c-b426d3aeb9d2:
2025-06-12 13:11:00,476 - __main__ - INFO -   Type: limit
2025-06-12 13:11:00,476 - __main__ - INFO -   Status: cancelled
2025-06-12 13:11:00,477 - __main__ - INFO -   Quantity: -303
2025-06-12 13:11:00,477 - __main__ - INFO -   Broker ID: 2118
2025-06-12 13:11:00,477 - __main__ - INFO - 
Order a87cf98c-6a29-438b-90e8-964e37b8b403:
2025-06-12 13:11:00,477 - __main__ - INFO -   Type: limit
2025-06-12 13:11:00,477 - __main__ - INFO -   Status: cancelled
2025-06-12 13:11:00,477 - __main__ - INFO -   Quantity: 303
2025-06-12 13:11:00,478 - __main__ - INFO -   Broker ID: 2119
2025-06-12 13:11:00,478 - __main__ - INFO - 
================================================================================
2025-06-12 13:11:00,478 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:11:00,478 - __main__ - INFO - ================================================================================
2025-06-12 13:11:00,478 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:11:00,478 - src.order.manager - WARNING - Cannot cancel inactive order ece5eae3-67e8-4915-afed-58ddfde87cb3 with status filled
2025-06-12 13:11:00,479 - __main__ - INFO -    Cancelled order ece5eae3-67e8-4915-afed-58ddfde87cb3
2025-06-12 13:11:00,479 - src.order.manager - WARNING - Cannot cancel inactive order ebf24af1-a127-4622-9571-e7c7a87ea319 with status cancelled
2025-06-12 13:11:00,479 - __main__ - INFO -    Cancelled order ebf24af1-a127-4622-9571-e7c7a87ea319
2025-06-12 13:11:00,479 - src.order.manager - WARNING - Cannot cancel inactive order a864742e-85f7-400c-b95c-b426d3aeb9d2 with status cancelled
2025-06-12 13:11:00,479 - __main__ - INFO -    Cancelled order a864742e-85f7-400c-b95c-b426d3aeb9d2
2025-06-12 13:11:00,479 - src.order.manager - WARNING - Cannot cancel inactive order a87cf98c-6a29-438b-90e8-964e37b8b403 with status cancelled
2025-06-12 13:11:00,479 - __main__ - INFO -    Cancelled order a87cf98c-6a29-438b-90e8-964e37b8b403
2025-06-12 13:11:00,479 - UnifiedFillManager - INFO - Order queue processor for SLV cancelled
2025-06-12 13:11:00,480 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:11:00,480 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:11:00,480 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:11:00,480 - __main__ - INFO - Rule engine stopped
2025-06-12 13:11:00,480 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:11:00,480 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:11:00,480 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:11:00,481 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:11:00,481 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:11:00,481 - __main__ - INFO - 
================================================================================
2025-06-12 13:11:00,481 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:11:00,482 - __main__ - INFO - ================================================================================
2025-06-12 13:13:07,034 - __main__ - INFO - ================================================================================
2025-06-12 13:13:07,034 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:13:07,034 - __main__ - INFO - ================================================================================
2025-06-12 13:13:07,035 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:13:07,035 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:13:07,035 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:13:07,036 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:13:07,036 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:13:07,037 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:13:12,750 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:13:12,751 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:13:12,766 - src.tws_connection - INFO - ✅ Next valid order ID received: 2120
2025-06-12 13:13:12,767 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:13:12,767 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:13:12,768 - src.tws_connection - INFO - ✅ Next valid order ID received: 2120
2025-06-12 13:13:12,768 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:13:12,769 - src.tws_connection - INFO - ✅ Next valid order ID received: 2120
2025-06-12 13:13:12,770 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:13:12,770 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:13:12,770 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:13:12,771 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:13:12,771 - __main__ - INFO - Rule engine context configured
2025-06-12 13:13:12,771 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:13:12,772 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:13:12,772 - __main__ - INFO - 
================================================================================
2025-06-12 13:13:12,772 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 13:13:12,772 - __main__ - INFO - ================================================================================
2025-06-12 13:13:12,773 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:13:12,773 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:13:12,773 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 13:13:12,774 - __main__ - INFO - 
================================================================================
2025-06-12 13:13:12,774 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 13:13:12,774 - __main__ - INFO - ================================================================================
2025-06-12 13:13:17,777 - __main__ - INFO - Current SLV price: $32.94
2025-06-12 13:13:17,777 - __main__ - INFO - Created prediction event:
2025-06-12 13:13:17,778 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:17,778 - __main__ - INFO -    Signal: BUY
2025-06-12 13:13:17,779 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:13:17,779 - __main__ - INFO -    Price: $32.94
2025-06-12 13:13:17,780 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:13:17,780 - __main__ - INFO - Rule engine started
2025-06-12 13:13:17,780 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:13:17,780 - __main__ - INFO - Prediction event emitted
2025-06-12 13:13:17,781 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:13:17,781 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:13:17,782 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:13:17,782 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 13:13:17,782 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 13:13:18,781 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.94 = $9980.82 (99.8% of $10000.00 allocation)
2025-06-12 13:13:18,782 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:13:18,782 - src.order.manager - INFO - Submitting order 463d0461-3136-4ea2-870f-4f2563d49d39 to TWS
2025-06-12 13:13:18,783 - src.order.manager - INFO - Got broker order ID 2120 for order 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,783 - src.order.manager - INFO - Calling placeOrder with ID 2120, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 13:13:18,783 - src.order.manager - INFO - placeOrder called successfully for order 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,783 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:13:18,784 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 13:13:18,799 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 13:13:18,800 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.92 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:13:18,800 - src.order.base - INFO - Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:13:18,800 - src.order.manager - INFO - Submitting order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 to TWS
2025-06-12 13:13:18,800 - src.order.manager - INFO - Got broker order ID 2121 for order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:18,800 - src.order.manager - INFO - Calling placeOrder with ID 2121, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:13:18,800 - src.order.manager - INFO - placeOrder called successfully for order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:18,801 - src.order.base - INFO - Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:13:18,801 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:13:18,801 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 at $32.92
2025-06-12 13:13:18,801 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.96 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:13:18,801 - src.order.base - INFO - Order b9441363-184d-4415-bc45-04dabc7db6bc status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:13:18,802 - src.order.manager - INFO - Submitting order b9441363-184d-4415-bc45-04dabc7db6bc to TWS
2025-06-12 13:13:18,802 - src.order.manager - INFO - Got broker order ID 2122 for order b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:13:18,802 - src.order.manager - INFO - Calling placeOrder with ID 2122, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.960000 DAY
2025-06-12 13:13:18,802 - src.order.manager - INFO - placeOrder called successfully for order b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:13:18,802 - src.order.base - INFO - Order b9441363-184d-4415-bc45-04dabc7db6bc status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:13:18,803 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:13:18,803 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit b9441363-184d-4415-bc45-04dabc7db6bc at $32.96
2025-06-12 13:13:18,803 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 13:13:18,804 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:13:18,804 - __main__ - INFO -    Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,805 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:18,805 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:13:18,805 - __main__ - INFO -    Quantity: 303
2025-06-12 13:13:18,805 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:18,805 - __main__ - INFO -    Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,805 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:13:18,805 - __main__ - INFO -    Previous: created
2025-06-12 13:13:18,805 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:18,805 - __main__ - INFO -    Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,806 - __main__ - INFO -    Status: submitted
2025-06-12 13:13:18,808 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:13:18,808 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:13:18,808 - __main__ - INFO -    Order ID: 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:18,808 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:18,809 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:13:18,809 - __main__ - INFO -    Quantity: -303
2025-06-12 13:13:18,809 - __main__ - INFO -    Stop Price: $32.92
2025-06-12 13:13:18,809 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:18,810 - __main__ - INFO -    Order ID: 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:18,810 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:13:18,810 - __main__ - INFO -    Previous: created
2025-06-12 13:13:18,810 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:18,810 - __main__ - INFO -    Order ID: 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:18,810 - __main__ - INFO -    Status: submitted
2025-06-12 13:13:18,810 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:13:18,811 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:13:18,811 - __main__ - INFO -    Order ID: b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:13:18,811 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:18,812 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:13:18,812 - __main__ - INFO -    Quantity: -303
2025-06-12 13:13:18,812 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:13:18,813 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:18,813 - __main__ - INFO -    Order ID: b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:13:18,813 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:13:18,813 - __main__ - INFO -    Previous: created
2025-06-12 13:13:18,813 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:18,813 - __main__ - INFO -    Order ID: b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:13:18,814 - __main__ - INFO -    Status: submitted
2025-06-12 13:13:18,814 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:13:18,883 - src.tws_connection - INFO - Open Order - ID: 2120, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:13:18,885 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:13:18,888 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:13:18,888 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 filled: 300.0 @ 32.95 (300.0/303)
2025-06-12 13:13:18,888 - src.tws_connection - INFO - Open Order - ID: 2120, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:13:18,891 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:13:18,892 - __main__ - INFO -    Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,892 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:18,893 - __main__ - INFO -    Fill Price: $32.95
2025-06-12 13:13:18,894 - __main__ - INFO -    Fill Quantity: 300.0
2025-06-12 13:13:18,894 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:13:18,894 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:13:18,894 - UnifiedFillManager - INFO - Processing fill for SLV: 300.0 shares on order 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,895 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:13:18,895 - UnifiedFillManager - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 fill status: partially_filled, is_fully_filled: False
2025-06-12 13:13:18,895 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:13:18,895 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:13:18,895 - UnifiedFillManager - INFO -   Main orders: {'463d0461-3136-4ea2-870f-4f2563d49d39'}
2025-06-12 13:13:18,895 - UnifiedFillManager - INFO -   Stop orders: {'4b0fd0ca-9dc2-48ee-9528-ec98f0acf475'}
2025-06-12 13:13:18,896 - UnifiedFillManager - INFO -   Target orders: {'b9441363-184d-4415-bc45-04dabc7db6bc'}
2025-06-12 13:13:18,896 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:13:18,896 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:13:18,896 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:13:18,897 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:13:18,897 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:13:18,897 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:13:18,897 - UnifiedFillManager - INFO - Stop order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 already has correct quantity -303, no update needed
2025-06-12 13:13:18,898 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:13:18,898 - UnifiedFillManager - INFO - Target order b9441363-184d-4415-bc45-04dabc7db6bc already has correct quantity -303, no update needed
2025-06-12 13:13:18,898 - UnifiedFillManager - INFO - Started order queue processor for SLV
2025-06-12 13:13:18,898 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:13:18,925 - src.tws_connection - INFO - Open Order - ID: 2121, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:13:18,926 - src.order.base - INFO - Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:13:18,929 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:13:18,929 - src.tws_connection - INFO - Open Order - ID: 2120, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:13:18,930 - src.order.base - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 filled: 3.0 @ 32.95 (303.0/303)
2025-06-12 13:13:18,930 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:13:18,930 - src.tws_connection - INFO - Open Order - ID: 2120, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:13:18,931 - __main__ - INFO -    Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,932 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:18,932 - src.tws_connection - INFO - Open Order - ID: 2120, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:13:18,932 - __main__ - INFO -    Fill Price: $32.95
2025-06-12 13:13:18,933 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 13:13:18,933 - src.tws_connection - INFO - Open Order - ID: 2122, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:13:18,933 - __main__ - INFO -    Status: filled
2025-06-12 13:13:18,934 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:13:18,934 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:18,934 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:13:18,934 - UnifiedFillManager - INFO - Order 463d0461-3136-4ea2-870f-4f2563d49d39 fill status: filled, is_fully_filled: True
2025-06-12 13:13:18,935 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:13:18,935 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:13:18,935 - UnifiedFillManager - INFO -   Main orders: {'463d0461-3136-4ea2-870f-4f2563d49d39'}
2025-06-12 13:13:18,936 - UnifiedFillManager - INFO -   Stop orders: {'4b0fd0ca-9dc2-48ee-9528-ec98f0acf475'}
2025-06-12 13:13:18,936 - UnifiedFillManager - INFO -   Target orders: {'b9441363-184d-4415-bc45-04dabc7db6bc'}
2025-06-12 13:13:18,936 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:13:18,936 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:13:18,937 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:13:18,937 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:13:18,937 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:13:18,938 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:13:18,938 - UnifiedFillManager - INFO - Stop order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 already has correct quantity -303, no update needed
2025-06-12 13:13:18,938 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:13:18,939 - UnifiedFillManager - INFO - Target order b9441363-184d-4415-bc45-04dabc7db6bc already has correct quantity -303, no update needed
2025-06-12 13:13:19,305 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['4b0fd0ca-9dc2-48ee-9528-ec98f0acf475']
2025-06-12 13:13:19,306 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 13:13:19,307 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.94
2025-06-12 13:13:19,319 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 13:13:19,319 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.94, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.93, original_qty=303, dd_qty=303
2025-06-12 13:13:19,320 - src.order.base - INFO - Order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:13:19,320 - src.order.manager - INFO - Submitting order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 to TWS
2025-06-12 13:13:19,321 - src.order.manager - INFO - Got broker order ID 2123 for order c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:13:19,321 - src.order.manager - INFO - Calling placeOrder with ID 2123, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.930000 DAY
2025-06-12 13:13:19,322 - src.order.manager - INFO - placeOrder called successfully for order c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:13:19,322 - src.order.base - INFO - Order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:13:19,322 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 13:13:19,323 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.93
2025-06-12 13:13:19,323 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 13:13:19,324 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 463d0461-3136-4ea2-870f-4f2563d49d39 for SLV
2025-06-12 13:13:19,324 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:13:19,324 - __main__ - INFO -    Order ID: c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:13:19,324 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:19,325 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:13:19,325 - __main__ - INFO -    Quantity: 303
2025-06-12 13:13:19,325 - __main__ - INFO -    Limit Price: $32.93
2025-06-12 13:13:19,326 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:19,327 - __main__ - INFO -    Order ID: c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:13:19,327 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:13:19,327 - __main__ - INFO -    Previous: created
2025-06-12 13:13:19,327 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:13:19,327 - __main__ - INFO -    Order ID: c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:13:19,327 - __main__ - INFO -    Status: submitted
2025-06-12 13:13:19,328 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:13:19,413 - src.tws_connection - INFO - Open Order - ID: 2123, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:13:20,796 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:13:25,806 - __main__ - INFO - 
================================================================================
2025-06-12 13:13:25,807 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:13:25,808 - __main__ - INFO - ================================================================================
2025-06-12 13:13:25,808 - __main__ - WARNING - No SLV context found!
2025-06-12 13:13:25,808 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:13:25,809 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:13:25,809 - __main__ - INFO -    Market orders: 1
2025-06-12 13:13:25,809 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:13:25,810 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:13:25,810 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:13:25,810 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:13:25,811 - __main__ - INFO - 
   Order #1:
2025-06-12 13:13:25,812 - __main__ - INFO -      ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:25,812 - __main__ - INFO -      Type: market
2025-06-12 13:13:25,813 - __main__ - INFO -      Quantity: 303
2025-06-12 13:13:25,813 - __main__ - INFO - 
   Order #2:
2025-06-12 13:13:25,813 - __main__ - INFO -      ID: 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:25,813 - __main__ - INFO -      Type: stop
2025-06-12 13:13:25,814 - __main__ - INFO -      Quantity: -303
2025-06-12 13:13:25,814 - __main__ - INFO -      Stop: $32.92
2025-06-12 13:13:25,814 - __main__ - INFO - 
   Order #3:
2025-06-12 13:13:25,814 - __main__ - INFO -      ID: b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:13:25,814 - __main__ - INFO -      Type: limit
2025-06-12 13:13:25,815 - __main__ - INFO -      Quantity: -303
2025-06-12 13:13:25,815 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:13:25,815 - __main__ - INFO - 
   Order #4:
2025-06-12 13:13:25,815 - __main__ - INFO -      ID: c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:13:25,815 - __main__ - INFO -      Type: limit
2025-06-12 13:13:25,816 - __main__ - INFO -      Quantity: 303
2025-06-12 13:13:25,816 - __main__ - INFO -      Limit: $32.93
2025-06-12 13:13:25,816 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:13:25,816 - __main__ - INFO -    Total fills received: 2
2025-06-12 13:13:25,816 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:13:25,817 - __main__ - INFO -      Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:25,817 - __main__ - INFO -      Quantity: 300.0
2025-06-12 13:13:25,817 - __main__ - INFO -      Price: $32.95
2025-06-12 13:13:25,817 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:13:25,817 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:13:25,817 - __main__ - INFO -      Order ID: 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:13:25,817 - __main__ - INFO -      Quantity: 3.0
2025-06-12 13:13:25,818 - __main__ - INFO -      Price: $32.95
2025-06-12 13:13:25,818 - __main__ - INFO -      Status: filled
2025-06-12 13:13:25,818 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:13:55,826 - __main__ - INFO - 
================================================================================
2025-06-12 13:13:55,827 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:13:55,829 - __main__ - INFO - ================================================================================
2025-06-12 13:13:55,829 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:13:55,830 - __main__ - INFO - 
Order 463d0461-3136-4ea2-870f-4f2563d49d39:
2025-06-12 13:13:55,831 - __main__ - INFO -   Type: market
2025-06-12 13:13:55,831 - __main__ - INFO -   Status: filled
2025-06-12 13:13:55,832 - __main__ - INFO -   Quantity: 303
2025-06-12 13:13:55,832 - __main__ - INFO -   Broker ID: 2120
2025-06-12 13:13:55,833 - __main__ - INFO - 
Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475:
2025-06-12 13:13:55,833 - __main__ - INFO -   Type: stop
2025-06-12 13:13:55,834 - __main__ - INFO -   Status: accepted
2025-06-12 13:13:55,834 - __main__ - INFO -   Quantity: -303
2025-06-12 13:13:55,834 - __main__ - INFO -   Broker ID: 2121
2025-06-12 13:13:55,835 - __main__ - INFO - 
Order b9441363-184d-4415-bc45-04dabc7db6bc:
2025-06-12 13:13:55,836 - __main__ - INFO -   Type: limit
2025-06-12 13:13:55,837 - __main__ - INFO -   Status: submitted
2025-06-12 13:13:55,837 - __main__ - INFO -   Quantity: -303
2025-06-12 13:13:55,837 - __main__ - INFO -   Broker ID: 2122
2025-06-12 13:13:55,838 - __main__ - INFO - 
Order c1c6663a-f295-4214-a4b9-7046d2f8a6c7:
2025-06-12 13:13:55,839 - __main__ - INFO -   Type: limit
2025-06-12 13:13:55,839 - __main__ - INFO -   Status: submitted
2025-06-12 13:13:55,840 - __main__ - INFO -   Quantity: 303
2025-06-12 13:13:55,840 - __main__ - INFO -   Broker ID: 2123
2025-06-12 13:13:55,841 - __main__ - INFO - 
================================================================================
2025-06-12 13:13:55,841 - __main__ - INFO - STOP LOSS FILL SIMULATION
2025-06-12 13:13:55,842 - __main__ - INFO - ================================================================================
2025-06-12 13:13:55,842 - __main__ - INFO - 
Would you like to simulate a stop loss fill to test position closure?
2025-06-12 13:13:55,842 - __main__ - INFO - This will emit a fill event for the stop order to test if UnifiedFillManager
2025-06-12 13:13:55,843 - __main__ - INFO - properly cancels all other orders (take profit, double down).
2025-06-12 13:13:55,845 - __main__ - INFO - 
Automatically simulating stop loss fill for testing...
2025-06-12 13:13:55,845 - __main__ - INFO - 
================================================================================
2025-06-12 13:13:55,846 - __main__ - INFO - SIMULATING STOP LOSS FILL TO TEST POSITION CLOSURE
2025-06-12 13:13:55,846 - __main__ - INFO - ================================================================================
2025-06-12 13:13:55,847 - __main__ - INFO - Simulating stop loss fill on order: 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:55,848 - __main__ - INFO - Emitting stop loss fill event: -303 shares at $32.92
2025-06-12 13:13:55,849 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:13:55,850 - __main__ - INFO -    Order ID: 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:55,851 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:13:55,851 - __main__ - INFO -    Fill Price: $32.92
2025-06-12 13:13:55,852 - __main__ - INFO -    Fill Quantity: -303
2025-06-12 13:13:55,852 - __main__ - INFO -    Status: filled
2025-06-12 13:13:55,853 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:13:55,853 - UnifiedFillManager - INFO - Processing fill for SLV: -303 shares on order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:13:55,853 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 13:13:55,854 - UnifiedFillManager - INFO - Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 fill status: filled, is_fully_filled: True
2025-06-12 13:13:55,854 - UnifiedFillManager - INFO - Closing position for SLV: Stop order fully filled
2025-06-12 13:13:55,854 - src.position.position_manager - INFO - Closed position for SLV
2025-06-12 13:13:55,854 - src.trade_tracker - INFO - Closed trade for SLV
2025-06-12 13:13:55,854 - UnifiedFillManager - INFO - Position closed for SLV: cancellation queued, trackers updated
2025-06-12 13:13:55,855 - UnifiedFillManager - INFO - Processing operation for SLV: cancel_all
2025-06-12 13:13:55,855 - src.order.base - INFO - Order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 status changed: submitted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:13:55,855 - src.order.manager - INFO - Cancelling order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 with broker ID 2123
2025-06-12 13:13:55,856 - src.order.base - INFO - Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 status changed: accepted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:13:55,856 - src.order.manager - INFO - Cancelling order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 with broker ID 2121
2025-06-12 13:13:55,857 - src.order.base - INFO - Order b9441363-184d-4415-bc45-04dabc7db6bc status changed: submitted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:13:55,857 - src.order.manager - INFO - Cancelling order b9441363-184d-4415-bc45-04dabc7db6bc with broker ID 2122
2025-06-12 13:13:55,858 - UnifiedFillManager - INFO - Cancelled 3 orders for SLV
2025-06-12 13:13:55,858 - UnifiedFillManager - INFO - Completed operation for SLV: cancel_all
2025-06-12 13:13:55,909 - src.order.base - INFO - Order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:13:55,908 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2123)
2025-06-12 13:13:55,991 - src.order.base - INFO - Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:13:55,990 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2121)
2025-06-12 13:13:56,108 - src.order.base - INFO - Order b9441363-184d-4415-bc45-04dabc7db6bc status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:13:56,108 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2122)
2025-06-12 13:13:58,857 - __main__ - INFO - UnifiedFillManager should have cancelled all remaining orders
2025-06-12 13:13:58,858 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the stop loss fill...
2025-06-12 13:14:03,860 - __main__ - INFO - 
================================================================================
2025-06-12 13:14:03,861 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:14:03,861 - __main__ - INFO - ================================================================================
2025-06-12 13:14:03,862 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:14:03,862 - __main__ - INFO - 
Order 463d0461-3136-4ea2-870f-4f2563d49d39:
2025-06-12 13:14:03,862 - __main__ - INFO -   Type: market
2025-06-12 13:14:03,863 - __main__ - INFO -   Status: filled
2025-06-12 13:14:03,863 - __main__ - INFO -   Quantity: 303
2025-06-12 13:14:03,863 - __main__ - INFO -   Broker ID: 2120
2025-06-12 13:14:03,863 - __main__ - INFO - 
Order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475:
2025-06-12 13:14:03,864 - __main__ - INFO -   Type: stop
2025-06-12 13:14:03,864 - __main__ - INFO -   Status: cancelled
2025-06-12 13:14:03,864 - __main__ - INFO -   Quantity: -303
2025-06-12 13:14:03,865 - __main__ - INFO -   Broker ID: 2121
2025-06-12 13:14:03,865 - __main__ - INFO - 
Order b9441363-184d-4415-bc45-04dabc7db6bc:
2025-06-12 13:14:03,865 - __main__ - INFO -   Type: limit
2025-06-12 13:14:03,865 - __main__ - INFO -   Status: cancelled
2025-06-12 13:14:03,866 - __main__ - INFO -   Quantity: -303
2025-06-12 13:14:03,866 - __main__ - INFO -   Broker ID: 2122
2025-06-12 13:14:03,866 - __main__ - INFO - 
Order c1c6663a-f295-4214-a4b9-7046d2f8a6c7:
2025-06-12 13:14:03,866 - __main__ - INFO -   Type: limit
2025-06-12 13:14:03,866 - __main__ - INFO -   Status: cancelled
2025-06-12 13:14:03,866 - __main__ - INFO -   Quantity: 303
2025-06-12 13:14:03,867 - __main__ - INFO -   Broker ID: 2123
2025-06-12 13:14:03,867 - __main__ - INFO - 
================================================================================
2025-06-12 13:14:03,867 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:14:03,867 - __main__ - INFO - ================================================================================
2025-06-12 13:14:03,867 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:14:03,867 - src.order.manager - WARNING - Cannot cancel inactive order 463d0461-3136-4ea2-870f-4f2563d49d39 with status filled
2025-06-12 13:14:03,867 - __main__ - INFO -    Cancelled order 463d0461-3136-4ea2-870f-4f2563d49d39
2025-06-12 13:14:03,867 - src.order.manager - WARNING - Cannot cancel inactive order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475 with status cancelled
2025-06-12 13:14:03,868 - __main__ - INFO -    Cancelled order 4b0fd0ca-9dc2-48ee-9528-ec98f0acf475
2025-06-12 13:14:03,868 - src.order.manager - WARNING - Cannot cancel inactive order b9441363-184d-4415-bc45-04dabc7db6bc with status cancelled
2025-06-12 13:14:03,868 - __main__ - INFO -    Cancelled order b9441363-184d-4415-bc45-04dabc7db6bc
2025-06-12 13:14:03,868 - src.order.manager - WARNING - Cannot cancel inactive order c1c6663a-f295-4214-a4b9-7046d2f8a6c7 with status cancelled
2025-06-12 13:14:03,868 - __main__ - INFO -    Cancelled order c1c6663a-f295-4214-a4b9-7046d2f8a6c7
2025-06-12 13:14:03,868 - UnifiedFillManager - INFO - Order queue processor for SLV cancelled
2025-06-12 13:14:03,868 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:14:03,868 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:14:03,869 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:14:03,869 - __main__ - INFO - Rule engine stopped
2025-06-12 13:14:03,869 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:14:03,869 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:14:03,869 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:14:03,870 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:14:03,870 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:14:03,870 - __main__ - INFO - 
================================================================================
2025-06-12 13:14:03,871 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:14:03,871 - __main__ - INFO - ================================================================================
2025-06-12 13:15:32,268 - __main__ - INFO - ================================================================================
2025-06-12 13:15:32,269 - __main__ - INFO - INITIALIZING SLV BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:15:32,269 - __main__ - INFO - ================================================================================
2025-06-12 13:15:32,269 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:15:32,269 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:15:32,269 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:15:32,270 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:15:32,270 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:15:32,271 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:15:36,151 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:15:36,152 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:15:36,165 - src.tws_connection - INFO - ✅ Next valid order ID received: 2124
2025-06-12 13:15:36,166 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:15:36,166 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:15:36,167 - src.tws_connection - INFO - ✅ Next valid order ID received: 2124
2025-06-12 13:15:36,168 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:15:36,168 - src.tws_connection - INFO - ✅ Next valid order ID received: 2124
2025-06-12 13:15:36,169 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:15:36,169 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:15:36,169 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:15:36,169 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:15:36,170 - __main__ - INFO - Rule engine context configured
2025-06-12 13:15:36,170 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:15:36,170 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:15:36,170 - __main__ - INFO - 
================================================================================
2025-06-12 13:15:36,171 - __main__ - INFO - SETTING UP SLV BUY RULE
2025-06-12 13:15:36,171 - __main__ - INFO - ================================================================================
2025-06-12 13:15:36,171 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:15:36,172 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:15:36,172 - __main__ - INFO - Registered rule: slv_buy_test_rule
2025-06-12 13:15:36,172 - __main__ - INFO - 
================================================================================
2025-06-12 13:15:36,173 - __main__ - INFO - SIMULATING SLV BUY SIGNAL
2025-06-12 13:15:36,173 - __main__ - INFO - ================================================================================
2025-06-12 13:15:41,184 - __main__ - INFO - Current SLV price: $32.94
2025-06-12 13:15:41,185 - __main__ - INFO - Created prediction event:
2025-06-12 13:15:41,185 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:41,186 - __main__ - INFO -    Signal: BUY
2025-06-12 13:15:41,187 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:15:41,187 - __main__ - INFO -    Price: $32.94
2025-06-12 13:15:41,187 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:15:41,188 - __main__ - INFO - Rule engine started
2025-06-12 13:15:41,188 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:15:41,188 - __main__ - INFO - Prediction event emitted
2025-06-12 13:15:41,188 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:15:41,189 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:15:41,189 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:15:41,190 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-12 13:15:41,190 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-12 13:15:42,201 - src.position.sizer - INFO - BUY position size: 303 shares @ $32.93 = $9977.79 (99.8% of $10000.00 allocation)
2025-06-12 13:15:42,202 - src.order.base - INFO - Order 3406a83f-ea2a-4520-b904-55287fd21224 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:42,203 - src.order.manager - INFO - Submitting order 3406a83f-ea2a-4520-b904-55287fd21224 to TWS
2025-06-12 13:15:42,203 - src.order.manager - INFO - Got broker order ID 2124 for order 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,204 - src.order.manager - INFO - Calling placeOrder with ID 2124, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 303@0.000000 DAY
2025-06-12 13:15:42,204 - src.order.manager - INFO - placeOrder called successfully for order 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,205 - src.order.base - INFO - Order 3406a83f-ea2a-4520-b904-55287fd21224 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:42,205 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-12 13:15:42,219 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0121
2025-06-12 13:15:42,220 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.92 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:15:42,220 - src.order.base - INFO - Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:42,220 - src.order.manager - INFO - Submitting order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 to TWS
2025-06-12 13:15:42,220 - src.order.manager - INFO - Got broker order ID 2125 for order 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:15:42,221 - src.order.manager - INFO - Calling placeOrder with ID 2125, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 303@0.000000 DAY
2025-06-12 13:15:42,221 - src.order.manager - INFO - placeOrder called successfully for order 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:15:42,221 - src.order.base - INFO - Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:42,221 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:15:42,222 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 94cc93af-20e5-42fb-89ff-2fa4ad37d283 at $32.92
2025-06-12 13:15:42,222 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.96 (ATR: 0.0121 * 1.5 = 0.0182)
2025-06-12 13:15:42,223 - src.order.base - INFO - Order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:42,224 - src.order.manager - INFO - Submitting order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a to TWS
2025-06-12 13:15:42,224 - src.order.manager - INFO - Got broker order ID 2126 for order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:15:42,225 - src.order.manager - INFO - Calling placeOrder with ID 2126, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 303@32.960000 DAY
2025-06-12 13:15:42,225 - src.order.manager - INFO - placeOrder called successfully for order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:15:42,225 - src.order.base - INFO - Order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:42,225 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:15:42,225 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a at $32.96
2025-06-12 13:15:42,226 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-12 13:15:42,226 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:42,226 - __main__ - INFO -    Order ID: 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,226 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,226 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:15:42,226 - __main__ - INFO -    Quantity: 303
2025-06-12 13:15:42,227 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,227 - __main__ - INFO -    Order ID: 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,227 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:42,227 - __main__ - INFO -    Previous: created
2025-06-12 13:15:42,227 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,227 - __main__ - INFO -    Order ID: 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,227 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:42,228 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:42,228 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:42,228 - __main__ - INFO -    Order ID: 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:15:42,228 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,228 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:15:42,228 - __main__ - INFO -    Quantity: -303
2025-06-12 13:15:42,228 - __main__ - INFO -    Stop Price: $32.92
2025-06-12 13:15:42,228 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,229 - __main__ - INFO -    Order ID: 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:15:42,229 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:42,229 - __main__ - INFO -    Previous: created
2025-06-12 13:15:42,229 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,229 - __main__ - INFO -    Order ID: 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:15:42,230 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:42,230 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:42,230 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:42,231 - __main__ - INFO -    Order ID: 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:15:42,231 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,231 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:15:42,231 - __main__ - INFO -    Quantity: -303
2025-06-12 13:15:42,232 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:15:42,233 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,233 - __main__ - INFO -    Order ID: 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:15:42,233 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:42,234 - __main__ - INFO -    Previous: created
2025-06-12 13:15:42,234 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,234 - __main__ - INFO -    Order ID: 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:15:42,234 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:42,234 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:42,296 - src.tws_connection - INFO - Open Order - ID: 2124, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,305 - src.tws_connection - INFO - Open Order - ID: 2125, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:15:42,307 - src.order.base - INFO - Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:15:42,334 - src.tws_connection - INFO - Open Order - ID: 2126, Symbol: SLV, Action: SELL, Quantity: 303.0
2025-06-12 13:15:42,469 - src.order.base - INFO - Order 3406a83f-ea2a-4520-b904-55287fd21224 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:15:42,469 - src.order.base - INFO - Order 3406a83f-ea2a-4520-b904-55287fd21224 filled: 303.0 @ 32.94 (303.0/303)
2025-06-12 13:15:42,470 - src.tws_connection - INFO - Open Order - ID: 2124, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,470 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:15:42,471 - __main__ - INFO -    Order ID: 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,471 - src.tws_connection - INFO - Open Order - ID: 2124, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,471 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,472 - __main__ - INFO -    Fill Price: $32.94
2025-06-12 13:15:42,472 - __main__ - INFO -    Fill Quantity: 303.0
2025-06-12 13:15:42,473 - __main__ - INFO -    Status: filled
2025-06-12 13:15:42,473 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:15:42,474 - UnifiedFillManager - INFO - Processing fill for SLV: 303.0 shares on order 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:42,474 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:15:42,474 - UnifiedFillManager - INFO - Order 3406a83f-ea2a-4520-b904-55287fd21224 fill status: filled, is_fully_filled: True
2025-06-12 13:15:42,474 - UnifiedFillManager - INFO - Main order filled for SLV
2025-06-12 13:15:42,474 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:15:42,475 - UnifiedFillManager - INFO -   Main orders: {'3406a83f-ea2a-4520-b904-55287fd21224'}
2025-06-12 13:15:42,475 - UnifiedFillManager - INFO -   Stop orders: {'94cc93af-20e5-42fb-89ff-2fa4ad37d283'}
2025-06-12 13:15:42,475 - UnifiedFillManager - INFO -   Target orders: {'2280184e-cf2c-4615-b8c3-d9cd58bd6b4a'}
2025-06-12 13:15:42,475 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:15:42,475 - UnifiedFillManager - INFO -   Current position size: 303.0
2025-06-12 13:15:42,476 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 303.0
2025-06-12 13:15:42,476 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=303.0, protective_qty=-303.0
2025-06-12 13:15:42,476 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:15:42,477 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:15:42,478 - UnifiedFillManager - INFO - Stop order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 already has correct quantity -303, no update needed
2025-06-12 13:15:42,478 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:15:42,478 - UnifiedFillManager - INFO - Target order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a already has correct quantity -303, no update needed
2025-06-12 13:15:42,479 - UnifiedFillManager - INFO - Started order queue processor for SLV
2025-06-12 13:15:42,741 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['94cc93af-20e5-42fb-89ff-2fa4ad37d283']
2025-06-12 13:15:42,742 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-12 13:15:42,742 - src.rule.linked_order_actions - INFO - Using context price for SLV: $32.94
2025-06-12 13:15:42,755 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0182
2025-06-12 13:15:42,756 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.94, stop_distance=$0.02, dd_distance=$0.01, dd_price=$32.93, original_qty=303, dd_qty=303
2025-06-12 13:15:42,757 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:42,757 - src.order.manager - INFO - Submitting order 83ba5631-f3ee-4830-897d-c8530e1e347b to TWS
2025-06-12 13:15:42,758 - src.order.manager - INFO - Got broker order ID 2127 for order 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,758 - src.order.manager - INFO - Calling placeOrder with ID 2127, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 303@32.930000 DAY
2025-06-12 13:15:42,758 - src.order.manager - INFO - placeOrder called successfully for order 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,759 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:42,759 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-12 13:15:42,760 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 303 shares @ $32.93
2025-06-12 13:15:42,760 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-12 13:15:42,760 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 3406a83f-ea2a-4520-b904-55287fd21224 for SLV
2025-06-12 13:15:42,760 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:42,760 - __main__ - INFO -    Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,761 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,761 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:15:42,761 - __main__ - INFO -    Quantity: 303
2025-06-12 13:15:42,761 - __main__ - INFO -    Limit Price: $32.93
2025-06-12 13:15:42,761 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,761 - __main__ - INFO -    Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,762 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:42,762 - __main__ - INFO -    Previous: created
2025-06-12 13:15:42,762 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:42,762 - __main__ - INFO -    Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,762 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:42,762 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:42,857 - src.tws_connection - INFO - Open Order - ID: 2127, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,858 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:15:42,900 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 13:15:42,900 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b filled: 300.0 @ 32.93 (300.0/303)
2025-06-12 13:15:42,900 - src.tws_connection - INFO - Open Order - ID: 2127, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,901 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:15:42,903 - __main__ - INFO -    Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,903 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,903 - src.tws_connection - INFO - Open Order - ID: 2127, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,904 - __main__ - INFO -    Fill Price: $32.93
2025-06-12 13:15:42,905 - __main__ - INFO -    Fill Quantity: 300.0
2025-06-12 13:15:42,905 - src.tws_connection - INFO - Open Order - ID: 2127, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,907 - __main__ - INFO -    Status: partially_filled
2025-06-12 13:15:42,908 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:15:42,908 - src.tws_connection - INFO - Open Order - ID: 2127, Symbol: SLV, Action: BUY, Quantity: 303.0
2025-06-12 13:15:42,908 - UnifiedFillManager - INFO - Processing fill for SLV: 300.0 shares on order 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,909 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:15:42,909 - UnifiedFillManager - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b fill status: partially_filled, is_fully_filled: False
2025-06-12 13:15:42,910 - UnifiedFillManager - INFO - Double down fill for SLV, new position size: 603.0
2025-06-12 13:15:42,910 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=603.0, protective_qty=-603.0
2025-06-12 13:15:42,910 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:15:42,910 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:15:42,910 - UnifiedFillManager - INFO - Queueing update for stop order 94cc93af-20e5-42fb-89ff-2fa4ad37d283: current qty=-303, new qty=-603.0
2025-06-12 13:15:42,911 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:15:42,911 - UnifiedFillManager - INFO - Queueing update for target order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a: current qty=-303, new qty=-603.0
2025-06-12 13:15:42,911 - UnifiedFillManager - INFO - Processing operation for SLV: replace_stop
2025-06-12 13:15:42,912 - src.order.base - INFO - Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 status changed: accepted -> pending_cancel (Updating quantity to -603.0)
2025-06-12 13:15:42,912 - src.order.manager - INFO - Cancelling order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 with broker ID 2125
2025-06-12 13:15:42,912 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 13:15:42,913 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b status changed: accepted -> filled (Order fully filled)
2025-06-12 13:15:42,913 - src.order.base - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b filled: 3.0 @ 32.93 (303.0/303)
2025-06-12 13:15:42,913 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:15:42,913 - __main__ - INFO -    Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,914 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:42,914 - __main__ - INFO -    Fill Price: $32.93
2025-06-12 13:15:42,914 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 13:15:42,914 - __main__ - INFO -    Status: filled
2025-06-12 13:15:42,915 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:15:42,915 - UnifiedFillManager - INFO - Processing fill for SLV: 3.0 shares on order 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:42,915 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:15:42,915 - UnifiedFillManager - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b fill status: filled, is_fully_filled: True
2025-06-12 13:15:42,915 - UnifiedFillManager - INFO - Double down fill for SLV, new position size: 606.0
2025-06-12 13:15:42,915 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=606.0, protective_qty=-606.0
2025-06-12 13:15:42,915 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:15:42,916 - UnifiedFillManager - INFO - Checking 0 stop orders
2025-06-12 13:15:42,916 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:15:42,916 - UnifiedFillManager - INFO - Queueing update for target order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a: current qty=-303, new qty=-606.0
2025-06-12 13:15:42,945 - src.order.base - INFO - Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:15:42,945 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2125)
2025-06-12 13:15:43,019 - src.order.base - INFO - Order c1f6307a-ba48-4986-9191-ff8a6db80642 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:43,019 - src.order.manager - INFO - Submitting order c1f6307a-ba48-4986-9191-ff8a6db80642 to TWS
2025-06-12 13:15:43,020 - src.order.manager - INFO - Got broker order ID 2128 for order c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:15:43,020 - src.order.manager - INFO - Calling placeOrder with ID 2128, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 603@0.000000 DAY
2025-06-12 13:15:43,020 - src.order.manager - INFO - placeOrder called successfully for order c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:15:43,020 - src.order.base - INFO - Order c1f6307a-ba48-4986-9191-ff8a6db80642 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:43,021 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:15:43,021 - UnifiedFillManager - INFO - Created updated stop order c1f6307a-ba48-4986-9191-ff8a6db80642 for SLV at $32.92 for -603.0 shares
2025-06-12 13:15:43,021 - UnifiedFillManager - INFO - Completed operation for SLV: replace_stop
2025-06-12 13:15:43,021 - UnifiedFillManager - INFO - Processing operation for SLV: replace_target
2025-06-12 13:15:43,021 - src.order.base - INFO - Order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a status changed: submitted -> pending_cancel (Updating quantity to -603.0)
2025-06-12 13:15:43,022 - src.order.manager - INFO - Cancelling order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a with broker ID 2126
2025-06-12 13:15:43,022 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:43,023 - __main__ - INFO -    Order ID: c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:15:43,024 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:43,024 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:15:43,024 - __main__ - INFO -    Quantity: -603.0
2025-06-12 13:15:43,025 - __main__ - INFO -    Stop Price: $32.92
2025-06-12 13:15:43,025 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:43,025 - __main__ - INFO -    Order ID: c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:15:43,025 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:43,025 - __main__ - INFO -    Previous: created
2025-06-12 13:15:43,026 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:43,026 - __main__ - INFO -    Order ID: c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:15:43,026 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:43,026 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:43,089 - src.tws_connection - INFO - Open Order - ID: 2128, Symbol: SLV, Action: SELL, Quantity: 603.0
2025-06-12 13:15:43,090 - src.order.base - INFO - Order c1f6307a-ba48-4986-9191-ff8a6db80642 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:15:43,125 - src.order.base - INFO - Order da6007d4-6bfd-4259-983f-04e17f6e6021 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:43,125 - src.order.manager - INFO - Submitting order da6007d4-6bfd-4259-983f-04e17f6e6021 to TWS
2025-06-12 13:15:43,126 - src.order.manager - INFO - Got broker order ID 2129 for order da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:15:43,126 - src.order.manager - INFO - Calling placeOrder with ID 2129, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 603@32.960000 DAY
2025-06-12 13:15:43,126 - src.order.manager - INFO - placeOrder called successfully for order da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:15:43,127 - src.order.base - INFO - Order da6007d4-6bfd-4259-983f-04e17f6e6021 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:43,127 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:15:43,127 - UnifiedFillManager - INFO - Created updated target order da6007d4-6bfd-4259-983f-04e17f6e6021 for SLV at $32.96 for -603.0 shares
2025-06-12 13:15:43,128 - UnifiedFillManager - INFO - Completed operation for SLV: replace_target
2025-06-12 13:15:43,128 - UnifiedFillManager - INFO - Processing operation for SLV: replace_target
2025-06-12 13:15:43,128 - src.order.manager - WARNING - Cannot cancel inactive order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a with status pending_cancel
2025-06-12 13:15:43,128 - UnifiedFillManager - WARNING - Failed to cancel order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a on attempt 1
2025-06-12 13:15:43,129 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:43,129 - __main__ - INFO -    Order ID: da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:15:43,129 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:43,129 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:15:43,129 - __main__ - INFO -    Quantity: -603.0
2025-06-12 13:15:43,130 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:15:43,130 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:43,130 - __main__ - INFO -    Order ID: da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:15:43,130 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:43,130 - __main__ - INFO -    Previous: created
2025-06-12 13:15:43,131 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:43,131 - __main__ - INFO -    Order ID: da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:15:43,131 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:43,131 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:43,168 - src.order.base - INFO - Order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:15:43,168 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2126)
2025-06-12 13:15:43,247 - src.tws_connection - INFO - Open Order - ID: 2129, Symbol: SLV, Action: SELL, Quantity: 603.0
2025-06-12 13:15:43,634 - src.order.manager - WARNING - Cannot cancel inactive order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a with status cancelled
2025-06-12 13:15:43,635 - UnifiedFillManager - WARNING - Failed to cancel order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a on attempt 2
2025-06-12 13:15:44,146 - src.order.manager - WARNING - Cannot cancel inactive order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a with status cancelled
2025-06-12 13:15:44,146 - UnifiedFillManager - WARNING - Failed to cancel order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a on attempt 3
2025-06-12 13:15:44,192 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:15:44,255 - src.order.base - INFO - Order 6622d133-3789-4663-8eec-75fabff8fc9b status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:15:44,256 - src.order.manager - INFO - Submitting order 6622d133-3789-4663-8eec-75fabff8fc9b to TWS
2025-06-12 13:15:44,257 - src.order.manager - INFO - Got broker order ID 2130 for order 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:15:44,257 - src.order.manager - INFO - Calling placeOrder with ID 2130, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 606@32.960000 DAY
2025-06-12 13:15:44,257 - src.order.manager - INFO - placeOrder called successfully for order 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:15:44,257 - src.order.base - INFO - Order 6622d133-3789-4663-8eec-75fabff8fc9b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:15:44,258 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:15:44,258 - UnifiedFillManager - INFO - Created updated target order 6622d133-3789-4663-8eec-75fabff8fc9b for SLV at $32.96 for -606.0 shares
2025-06-12 13:15:44,258 - UnifiedFillManager - INFO - Completed operation for SLV: replace_target
2025-06-12 13:15:44,259 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:15:44,259 - __main__ - INFO -    Order ID: 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:15:44,259 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:15:44,260 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:15:44,260 - __main__ - INFO -    Quantity: -606.0
2025-06-12 13:15:44,260 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:15:44,260 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:44,261 - __main__ - INFO -    Order ID: 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:15:44,261 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:15:44,261 - __main__ - INFO -    Previous: created
2025-06-12 13:15:44,261 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:15:44,262 - __main__ - INFO -    Order ID: 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:15:44,262 - __main__ - INFO -    Status: submitted
2025-06-12 13:15:44,262 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:15:44,353 - src.tws_connection - INFO - Open Order - ID: 2130, Symbol: SLV, Action: SELL, Quantity: 606.0
2025-06-12 13:15:49,196 - __main__ - INFO - 
================================================================================
2025-06-12 13:15:49,197 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:15:49,197 - __main__ - INFO - ================================================================================
2025-06-12 13:15:49,197 - __main__ - WARNING - No SLV context found!
2025-06-12 13:15:49,198 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:15:49,198 - __main__ - INFO -    Total orders created: 7
2025-06-12 13:15:49,199 - __main__ - INFO -    Market orders: 1
2025-06-12 13:15:49,199 - __main__ - INFO -    Stop orders: 2
2025-06-12 13:15:49,199 - __main__ - INFO -    Limit orders: 4
2025-06-12 13:15:49,199 - __main__ - WARNING - 
⚠️ WARNING: Expected 4 orders but got 7
2025-06-12 13:15:49,200 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:15:49,200 - __main__ - INFO - 
   Order #1:
2025-06-12 13:15:49,200 - __main__ - INFO -      ID: 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:49,200 - __main__ - INFO -      Type: market
2025-06-12 13:15:49,200 - __main__ - INFO -      Quantity: 303
2025-06-12 13:15:49,200 - __main__ - INFO - 
   Order #2:
2025-06-12 13:15:49,201 - __main__ - INFO -      ID: 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:15:49,201 - __main__ - INFO -      Type: stop
2025-06-12 13:15:49,201 - __main__ - INFO -      Quantity: -303
2025-06-12 13:15:49,201 - __main__ - INFO -      Stop: $32.92
2025-06-12 13:15:49,201 - __main__ - INFO - 
   Order #3:
2025-06-12 13:15:49,202 - __main__ - INFO -      ID: 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:15:49,202 - __main__ - INFO -      Type: limit
2025-06-12 13:15:49,202 - __main__ - INFO -      Quantity: -303
2025-06-12 13:15:49,202 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:15:49,202 - __main__ - INFO - 
   Order #4:
2025-06-12 13:15:49,203 - __main__ - INFO -      ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:49,203 - __main__ - INFO -      Type: limit
2025-06-12 13:15:49,203 - __main__ - INFO -      Quantity: 303
2025-06-12 13:15:49,203 - __main__ - INFO -      Limit: $32.93
2025-06-12 13:15:49,203 - __main__ - INFO - 
   Order #5:
2025-06-12 13:15:49,203 - __main__ - INFO -      ID: c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:15:49,204 - __main__ - INFO -      Type: stop
2025-06-12 13:15:49,204 - __main__ - INFO -      Quantity: -603.0
2025-06-12 13:15:49,204 - __main__ - INFO -      Stop: $32.92
2025-06-12 13:15:49,204 - __main__ - INFO - 
   Order #6:
2025-06-12 13:15:49,204 - __main__ - INFO -      ID: da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:15:49,205 - __main__ - INFO -      Type: limit
2025-06-12 13:15:49,205 - __main__ - INFO -      Quantity: -603.0
2025-06-12 13:15:49,205 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:15:49,205 - __main__ - INFO - 
   Order #7:
2025-06-12 13:15:49,205 - __main__ - INFO -      ID: 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:15:49,205 - __main__ - INFO -      Type: limit
2025-06-12 13:15:49,206 - __main__ - INFO -      Quantity: -606.0
2025-06-12 13:15:49,206 - __main__ - INFO -      Limit: $32.96
2025-06-12 13:15:49,206 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:15:49,207 - __main__ - INFO -    Total fills received: 3
2025-06-12 13:15:49,207 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:15:49,207 - __main__ - INFO -      Order ID: 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:15:49,208 - __main__ - INFO -      Quantity: 303.0
2025-06-12 13:15:49,208 - __main__ - INFO -      Price: $32.94
2025-06-12 13:15:49,208 - __main__ - INFO -      Status: filled
2025-06-12 13:15:49,208 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:15:49,208 - __main__ - INFO -      Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:49,209 - __main__ - INFO -      Quantity: 300.0
2025-06-12 13:15:49,209 - __main__ - INFO -      Price: $32.93
2025-06-12 13:15:49,209 - __main__ - INFO -      Status: partially_filled
2025-06-12 13:15:49,209 - __main__ - INFO - 
   Fill #3:
2025-06-12 13:15:49,209 - __main__ - INFO -      Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:15:49,209 - __main__ - INFO -      Quantity: 3.0
2025-06-12 13:15:49,209 - __main__ - INFO -      Price: $32.93
2025-06-12 13:15:49,210 - __main__ - INFO -      Status: filled
2025-06-12 13:15:49,210 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:16:19,217 - __main__ - INFO - 
================================================================================
2025-06-12 13:16:19,218 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:16:19,218 - __main__ - INFO - ================================================================================
2025-06-12 13:16:19,218 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:16:19,219 - __main__ - INFO - 
Order 3406a83f-ea2a-4520-b904-55287fd21224:
2025-06-12 13:16:19,219 - __main__ - INFO -   Type: market
2025-06-12 13:16:19,219 - __main__ - INFO -   Status: filled
2025-06-12 13:16:19,219 - __main__ - INFO -   Quantity: 303
2025-06-12 13:16:19,219 - __main__ - INFO -   Broker ID: 2124
2025-06-12 13:16:19,219 - __main__ - INFO - 
Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283:
2025-06-12 13:16:19,219 - __main__ - INFO -   Type: stop
2025-06-12 13:16:19,219 - __main__ - INFO -   Status: cancelled
2025-06-12 13:16:19,220 - __main__ - INFO -   Quantity: -303
2025-06-12 13:16:19,220 - __main__ - INFO -   Broker ID: 2125
2025-06-12 13:16:19,220 - __main__ - INFO - 
Order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a:
2025-06-12 13:16:19,220 - __main__ - INFO -   Type: limit
2025-06-12 13:16:19,220 - __main__ - INFO -   Status: cancelled
2025-06-12 13:16:19,220 - __main__ - INFO -   Quantity: -303
2025-06-12 13:16:19,221 - __main__ - INFO -   Broker ID: 2126
2025-06-12 13:16:19,221 - __main__ - INFO - 
Order 83ba5631-f3ee-4830-897d-c8530e1e347b:
2025-06-12 13:16:19,221 - __main__ - INFO -   Type: limit
2025-06-12 13:16:19,221 - __main__ - INFO -   Status: filled
2025-06-12 13:16:19,221 - __main__ - INFO -   Quantity: 303
2025-06-12 13:16:19,221 - __main__ - INFO -   Broker ID: 2127
2025-06-12 13:16:19,221 - __main__ - INFO - 
Order c1f6307a-ba48-4986-9191-ff8a6db80642:
2025-06-12 13:16:19,221 - __main__ - INFO -   Type: stop
2025-06-12 13:16:19,222 - __main__ - INFO -   Status: accepted
2025-06-12 13:16:19,222 - __main__ - INFO -   Quantity: -603.0
2025-06-12 13:16:19,222 - __main__ - INFO -   Broker ID: 2128
2025-06-12 13:16:19,222 - __main__ - INFO - 
Order da6007d4-6bfd-4259-983f-04e17f6e6021:
2025-06-12 13:16:19,222 - __main__ - INFO -   Type: limit
2025-06-12 13:16:19,222 - __main__ - INFO -   Status: submitted
2025-06-12 13:16:19,222 - __main__ - INFO -   Quantity: -603.0
2025-06-12 13:16:19,223 - __main__ - INFO -   Broker ID: 2129
2025-06-12 13:16:19,223 - __main__ - INFO - 
Order 6622d133-3789-4663-8eec-75fabff8fc9b:
2025-06-12 13:16:19,224 - __main__ - INFO -   Type: limit
2025-06-12 13:16:19,224 - __main__ - INFO -   Status: submitted
2025-06-12 13:16:19,224 - __main__ - INFO -   Quantity: -606.0
2025-06-12 13:16:19,224 - __main__ - INFO -   Broker ID: 2130
2025-06-12 13:16:19,224 - __main__ - INFO - 
================================================================================
2025-06-12 13:16:19,225 - __main__ - INFO - DOUBLE DOWN FILL SIMULATION
2025-06-12 13:16:19,225 - __main__ - INFO - ================================================================================
2025-06-12 13:16:19,225 - __main__ - INFO - 
Would you like to simulate a double down fill to test protective order updates?
2025-06-12 13:16:19,225 - __main__ - INFO - This will emit a fill event for the double down order to test if UnifiedFillManager
2025-06-12 13:16:19,225 - __main__ - INFO - properly updates the stop and take profit quantities to match the new position size.
2025-06-12 13:16:19,225 - __main__ - INFO - 
Automatically simulating double down fill for testing...
2025-06-12 13:16:19,226 - __main__ - INFO - 
================================================================================
2025-06-12 13:16:19,226 - __main__ - INFO - SIMULATING DOUBLE DOWN FILL TO TEST PROTECTIVE ORDER UPDATES
2025-06-12 13:16:19,226 - __main__ - INFO - ================================================================================
2025-06-12 13:16:19,226 - __main__ - INFO - Simulating double down fill on order: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:16:19,226 - __main__ - INFO - Double down order details: 303 shares @ $32.93
2025-06-12 13:16:19,226 - __main__ - INFO - Emitting double down fill event: 303 shares at $32.93
2025-06-12 13:16:19,227 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:16:19,227 - __main__ - INFO -    Order ID: 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:16:19,227 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:16:19,227 - __main__ - INFO -    Fill Price: $32.93
2025-06-12 13:16:19,227 - __main__ - INFO -    Fill Quantity: 303
2025-06-12 13:16:19,227 - __main__ - INFO -    Status: filled
2025-06-12 13:16:19,227 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:16:19,227 - UnifiedFillManager - INFO - Processing fill for SLV: 303 shares on order 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Order 83ba5631-f3ee-4830-897d-c8530e1e347b fill status: filled, is_fully_filled: True
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Double down fill for SLV, new position size: 606.0
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Updating protective orders for SLV: position=606.0, protective_qty=-606.0
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Checking protective orders to update for SLV
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:16:19,228 - UnifiedFillManager - INFO - Queueing update for stop order c1f6307a-ba48-4986-9191-ff8a6db80642: current qty=-603.0, new qty=-606.0
2025-06-12 13:16:19,229 - UnifiedFillManager - INFO - Checking 2 target orders
2025-06-12 13:16:19,229 - UnifiedFillManager - INFO - Queueing update for target order da6007d4-6bfd-4259-983f-04e17f6e6021: current qty=-603.0, new qty=-606.0
2025-06-12 13:16:19,229 - UnifiedFillManager - INFO - Target order 6622d133-3789-4663-8eec-75fabff8fc9b already has correct quantity -606.0, no update needed
2025-06-12 13:16:19,229 - UnifiedFillManager - INFO - Processing operation for SLV: replace_stop
2025-06-12 13:16:19,229 - src.order.base - INFO - Order c1f6307a-ba48-4986-9191-ff8a6db80642 status changed: accepted -> pending_cancel (Updating quantity to -606.0)
2025-06-12 13:16:19,230 - src.order.manager - INFO - Cancelling order c1f6307a-ba48-4986-9191-ff8a6db80642 with broker ID 2128
2025-06-12 13:16:19,265 - src.order.base - INFO - Order c1f6307a-ba48-4986-9191-ff8a6db80642 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:16:19,264 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2128)
2025-06-12 13:16:19,341 - src.order.base - INFO - Order 5fd5126c-412f-4437-b4a9-3315b41d71c4 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:16:19,342 - src.order.manager - INFO - Submitting order 5fd5126c-412f-4437-b4a9-3315b41d71c4 to TWS
2025-06-12 13:16:19,342 - src.order.manager - INFO - Got broker order ID 2131 for order 5fd5126c-412f-4437-b4a9-3315b41d71c4
2025-06-12 13:16:19,342 - src.order.manager - INFO - Calling placeOrder with ID 2131, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 606@0.000000 DAY
2025-06-12 13:16:19,343 - src.order.manager - INFO - placeOrder called successfully for order 5fd5126c-412f-4437-b4a9-3315b41d71c4
2025-06-12 13:16:19,343 - src.order.base - INFO - Order 5fd5126c-412f-4437-b4a9-3315b41d71c4 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:16:19,343 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-12 13:16:19,343 - UnifiedFillManager - INFO - Created updated stop order 5fd5126c-412f-4437-b4a9-3315b41d71c4 for SLV at $32.92 for -606.0 shares
2025-06-12 13:16:19,344 - UnifiedFillManager - INFO - Completed operation for SLV: replace_stop
2025-06-12 13:16:19,344 - UnifiedFillManager - INFO - Processing operation for SLV: replace_target
2025-06-12 13:16:19,344 - src.order.base - INFO - Order da6007d4-6bfd-4259-983f-04e17f6e6021 status changed: submitted -> pending_cancel (Updating quantity to -606.0)
2025-06-12 13:16:19,344 - src.order.manager - INFO - Cancelling order da6007d4-6bfd-4259-983f-04e17f6e6021 with broker ID 2129
2025-06-12 13:16:19,345 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:16:19,345 - __main__ - INFO -    Order ID: 5fd5126c-412f-4437-b4a9-3315b41d71c4
2025-06-12 13:16:19,345 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:16:19,345 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:16:19,346 - __main__ - INFO -    Quantity: -606.0
2025-06-12 13:16:19,346 - __main__ - INFO -    Stop Price: $32.92
2025-06-12 13:16:19,346 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:16:19,346 - __main__ - INFO -    Order ID: 5fd5126c-412f-4437-b4a9-3315b41d71c4
2025-06-12 13:16:19,346 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:16:19,347 - __main__ - INFO -    Previous: created
2025-06-12 13:16:19,347 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:16:19,347 - __main__ - INFO -    Order ID: 5fd5126c-412f-4437-b4a9-3315b41d71c4
2025-06-12 13:16:19,347 - __main__ - INFO -    Status: submitted
2025-06-12 13:16:19,347 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:16:19,418 - src.tws_connection - INFO - Open Order - ID: 2131, Symbol: SLV, Action: SELL, Quantity: 606.0
2025-06-12 13:16:19,419 - src.order.base - INFO - Order 5fd5126c-412f-4437-b4a9-3315b41d71c4 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:16:19,450 - src.order.base - INFO - Order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:16:19,451 - src.order.manager - INFO - Submitting order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7 to TWS
2025-06-12 13:16:19,451 - src.order.manager - INFO - Got broker order ID 2132 for order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7
2025-06-12 13:16:19,451 - src.order.manager - INFO - Calling placeOrder with ID 2132, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 606@32.960000 DAY
2025-06-12 13:16:19,452 - src.order.manager - INFO - placeOrder called successfully for order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7
2025-06-12 13:16:19,452 - src.order.base - INFO - Order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:16:19,452 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-12 13:16:19,452 - UnifiedFillManager - INFO - Created updated target order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7 for SLV at $32.96 for -606.0 shares
2025-06-12 13:16:19,453 - UnifiedFillManager - INFO - Completed operation for SLV: replace_target
2025-06-12 13:16:19,453 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:16:19,453 - __main__ - INFO -    Order ID: d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7
2025-06-12 13:16:19,453 - __main__ - INFO -    Symbol: SLV
2025-06-12 13:16:19,453 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:16:19,454 - __main__ - INFO -    Quantity: -606.0
2025-06-12 13:16:19,454 - __main__ - INFO -    Limit Price: $32.96
2025-06-12 13:16:19,454 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:16:19,454 - __main__ - INFO -    Order ID: d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7
2025-06-12 13:16:19,454 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:16:19,454 - __main__ - INFO -    Previous: created
2025-06-12 13:16:19,454 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:16:19,455 - __main__ - INFO -    Order ID: d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7
2025-06-12 13:16:19,455 - __main__ - INFO -    Status: submitted
2025-06-12 13:16:19,455 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:16:19,498 - src.order.base - INFO - Order da6007d4-6bfd-4259-983f-04e17f6e6021 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:16:19,498 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2129)
2025-06-12 13:16:19,563 - src.tws_connection - INFO - Open Order - ID: 2132, Symbol: SLV, Action: SELL, Quantity: 606.0
2025-06-12 13:16:22,228 - __main__ - INFO - UnifiedFillManager should have updated protective orders to new position size (606 shares)
2025-06-12 13:16:22,229 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the double down fill...
2025-06-12 13:16:27,238 - __main__ - INFO - 
================================================================================
2025-06-12 13:16:27,239 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:16:27,240 - __main__ - INFO - ================================================================================
2025-06-12 13:16:27,240 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:16:27,241 - __main__ - INFO - 
Order 3406a83f-ea2a-4520-b904-55287fd21224:
2025-06-12 13:16:27,242 - __main__ - INFO -   Type: market
2025-06-12 13:16:27,242 - __main__ - INFO -   Status: filled
2025-06-12 13:16:27,243 - __main__ - INFO -   Quantity: 303
2025-06-12 13:16:27,243 - __main__ - INFO -   Broker ID: 2124
2025-06-12 13:16:27,244 - __main__ - INFO - 
Order 94cc93af-20e5-42fb-89ff-2fa4ad37d283:
2025-06-12 13:16:27,245 - __main__ - INFO -   Type: stop
2025-06-12 13:16:27,245 - __main__ - INFO -   Status: cancelled
2025-06-12 13:16:27,245 - __main__ - INFO -   Quantity: -303
2025-06-12 13:16:27,246 - __main__ - INFO -   Broker ID: 2125
2025-06-12 13:16:27,246 - __main__ - INFO - 
Order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a:
2025-06-12 13:16:27,246 - __main__ - INFO -   Type: limit
2025-06-12 13:16:27,246 - __main__ - INFO -   Status: cancelled
2025-06-12 13:16:27,247 - __main__ - INFO -   Quantity: -303
2025-06-12 13:16:27,247 - __main__ - INFO -   Broker ID: 2126
2025-06-12 13:16:27,247 - __main__ - INFO - 
Order 83ba5631-f3ee-4830-897d-c8530e1e347b:
2025-06-12 13:16:27,248 - __main__ - INFO -   Type: limit
2025-06-12 13:16:27,248 - __main__ - INFO -   Status: filled
2025-06-12 13:16:27,249 - __main__ - INFO -   Quantity: 303
2025-06-12 13:16:27,249 - __main__ - INFO -   Broker ID: 2127
2025-06-12 13:16:27,249 - __main__ - INFO - 
Order c1f6307a-ba48-4986-9191-ff8a6db80642:
2025-06-12 13:16:27,249 - __main__ - INFO -   Type: stop
2025-06-12 13:16:27,249 - __main__ - INFO -   Status: cancelled
2025-06-12 13:16:27,250 - __main__ - INFO -   Quantity: -603.0
2025-06-12 13:16:27,250 - __main__ - INFO -   Broker ID: 2128
2025-06-12 13:16:27,250 - __main__ - INFO - 
Order da6007d4-6bfd-4259-983f-04e17f6e6021:
2025-06-12 13:16:27,250 - __main__ - INFO -   Type: limit
2025-06-12 13:16:27,250 - __main__ - INFO -   Status: cancelled
2025-06-12 13:16:27,250 - __main__ - INFO -   Quantity: -603.0
2025-06-12 13:16:27,251 - __main__ - INFO -   Broker ID: 2129
2025-06-12 13:16:27,251 - __main__ - INFO - 
Order 6622d133-3789-4663-8eec-75fabff8fc9b:
2025-06-12 13:16:27,251 - __main__ - INFO -   Type: limit
2025-06-12 13:16:27,251 - __main__ - INFO -   Status: submitted
2025-06-12 13:16:27,251 - __main__ - INFO -   Quantity: -606.0
2025-06-12 13:16:27,251 - __main__ - INFO -   Broker ID: 2130
2025-06-12 13:16:27,251 - __main__ - INFO - 
Order 5fd5126c-412f-4437-b4a9-3315b41d71c4:
2025-06-12 13:16:27,251 - __main__ - INFO -   Type: stop
2025-06-12 13:16:27,252 - __main__ - INFO -   Status: accepted
2025-06-12 13:16:27,252 - __main__ - INFO -   Quantity: -606.0
2025-06-12 13:16:27,252 - __main__ - INFO -   Broker ID: 2131
2025-06-12 13:16:27,252 - __main__ - INFO - 
Order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7:
2025-06-12 13:16:27,252 - __main__ - INFO -   Type: limit
2025-06-12 13:16:27,252 - __main__ - INFO -   Status: submitted
2025-06-12 13:16:27,252 - __main__ - INFO -   Quantity: -606.0
2025-06-12 13:16:27,253 - __main__ - INFO -   Broker ID: 2132
2025-06-12 13:16:27,253 - __main__ - INFO - 
================================================================================
2025-06-12 13:16:27,253 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:16:27,253 - __main__ - INFO - ================================================================================
2025-06-12 13:16:27,253 - __main__ - INFO - Cancelling 9 test orders...
2025-06-12 13:16:27,254 - src.order.manager - WARNING - Cannot cancel inactive order 3406a83f-ea2a-4520-b904-55287fd21224 with status filled
2025-06-12 13:16:27,254 - __main__ - INFO -    Cancelled order 3406a83f-ea2a-4520-b904-55287fd21224
2025-06-12 13:16:27,254 - src.order.manager - WARNING - Cannot cancel inactive order 94cc93af-20e5-42fb-89ff-2fa4ad37d283 with status cancelled
2025-06-12 13:16:27,254 - __main__ - INFO -    Cancelled order 94cc93af-20e5-42fb-89ff-2fa4ad37d283
2025-06-12 13:16:27,254 - src.order.manager - WARNING - Cannot cancel inactive order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a with status cancelled
2025-06-12 13:16:27,254 - __main__ - INFO -    Cancelled order 2280184e-cf2c-4615-b8c3-d9cd58bd6b4a
2025-06-12 13:16:27,255 - src.order.manager - WARNING - Cannot cancel inactive order 83ba5631-f3ee-4830-897d-c8530e1e347b with status filled
2025-06-12 13:16:27,255 - __main__ - INFO -    Cancelled order 83ba5631-f3ee-4830-897d-c8530e1e347b
2025-06-12 13:16:27,255 - src.order.manager - WARNING - Cannot cancel inactive order c1f6307a-ba48-4986-9191-ff8a6db80642 with status cancelled
2025-06-12 13:16:27,255 - __main__ - INFO -    Cancelled order c1f6307a-ba48-4986-9191-ff8a6db80642
2025-06-12 13:16:27,255 - src.order.manager - WARNING - Cannot cancel inactive order da6007d4-6bfd-4259-983f-04e17f6e6021 with status cancelled
2025-06-12 13:16:27,255 - __main__ - INFO -    Cancelled order da6007d4-6bfd-4259-983f-04e17f6e6021
2025-06-12 13:16:27,256 - src.order.base - INFO - Order 6622d133-3789-4663-8eec-75fabff8fc9b status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:16:27,256 - src.order.manager - INFO - Cancelling order 6622d133-3789-4663-8eec-75fabff8fc9b with broker ID 2130
2025-06-12 13:16:27,257 - __main__ - INFO -    Cancelled order 6622d133-3789-4663-8eec-75fabff8fc9b
2025-06-12 13:16:27,257 - src.order.base - INFO - Order 5fd5126c-412f-4437-b4a9-3315b41d71c4 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 13:16:27,257 - src.order.manager - INFO - Cancelling order 5fd5126c-412f-4437-b4a9-3315b41d71c4 with broker ID 2131
2025-06-12 13:16:27,258 - __main__ - INFO -    Cancelled order 5fd5126c-412f-4437-b4a9-3315b41d71c4
2025-06-12 13:16:27,258 - src.order.base - INFO - Order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:16:27,258 - src.order.manager - INFO - Cancelling order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7 with broker ID 2132
2025-06-12 13:16:27,258 - __main__ - INFO -    Cancelled order d55feb5e-ee7d-4e06-8f6d-0a135a0fe5f7
2025-06-12 13:16:27,259 - UnifiedFillManager - INFO - Order queue processor for SLV cancelled
2025-06-12 13:16:27,259 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:16:27,259 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:16:27,259 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:16:27,259 - __main__ - INFO - Rule engine stopped
2025-06-12 13:16:27,259 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:16:27,260 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:16:27,260 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:16:27,261 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:16:27,262 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:16:27,262 - __main__ - INFO - 
================================================================================
2025-06-12 13:16:27,262 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:16:27,262 - __main__ - INFO - ================================================================================
