2025-06-12 13:19:57,511 - __main__ - INFO - ================================================================================
2025-06-12 13:19:57,511 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:19:57,512 - __main__ - INFO - ================================================================================
2025-06-12 13:19:57,512 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:19:57,513 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:19:57,513 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:19:57,519 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:19:57,520 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:19:57,521 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:20:00,942 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:20:00,943 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:20:00,947 - src.tws_connection - INFO - ✅ Next valid order ID received: 2133
2025-06-12 13:20:00,947 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:20:00,947 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:20:00,948 - src.tws_connection - INFO - ✅ Next valid order ID received: 2133
2025-06-12 13:20:00,948 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:20:00,948 - src.tws_connection - INFO - ✅ Next valid order ID received: 2133
2025-06-12 13:20:00,949 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:20:00,949 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:20:00,949 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:20:00,949 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:20:00,949 - __main__ - INFO - Rule engine context configured
2025-06-12 13:20:00,950 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:20:00,950 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:20:00,950 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:00,950 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 13:20:00,950 - __main__ - INFO - ================================================================================
2025-06-12 13:20:00,950 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:20:00,950 - __main__ - INFO - Created BUY action ($10K allocation, 1.5x ATR stop, 1.5x ATR target)
2025-06-12 13:20:00,950 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 13:20:00,950 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:00,951 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 13:20:00,951 - __main__ - INFO - ================================================================================
2025-06-12 13:20:05,958 - __main__ - INFO - Current GLD price: $311.41
2025-06-12 13:20:05,959 - __main__ - INFO - Created prediction event:
2025-06-12 13:20:05,959 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:05,959 - __main__ - INFO -    Signal: BUY
2025-06-12 13:20:05,960 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:20:05,960 - __main__ - INFO -    Price: $311.41
2025-06-12 13:20:05,961 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:20:05,961 - __main__ - INFO - Rule engine started
2025-06-12 13:20:05,962 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:20:05,962 - __main__ - INFO - Prediction event emitted
2025-06-12 13:20:05,962 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:20:05,963 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:20:05,963 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:20:05,963 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 13:20:05,963 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 13:20:06,975 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.39 = $9964.48 (99.6% of $10000.00 allocation)
2025-06-12 13:20:06,976 - src.order.base - INFO - Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:20:06,977 - src.order.manager - INFO - Submitting order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 to TWS
2025-06-12 13:20:06,977 - src.order.manager - INFO - Got broker order ID 2133 for order a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:06,978 - src.order.manager - INFO - Calling placeOrder with ID 2133, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 13:20:06,979 - src.order.manager - INFO - placeOrder called successfully for order a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:06,979 - src.order.base - INFO - Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:20:06,979 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 13:20:06,980 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:20:06,980 - __main__ - INFO -    Order ID: a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:06,980 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:06,981 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:20:06,981 - __main__ - INFO -    Quantity: 32
2025-06-12 13:20:06,981 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:06,982 - __main__ - INFO -    Order ID: a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:06,982 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:20:06,982 - __main__ - INFO -    Previous: created
2025-06-12 13:20:06,983 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:06,983 - __main__ - INFO -    Order ID: a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:06,984 - __main__ - INFO -    Status: submitted
2025-06-12 13:20:06,984 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:20:07,117 - src.tws_connection - INFO - Open Order - ID: 2133, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:20:07,118 - src.order.base - INFO - Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:20:07,160 - src.order.base - INFO - Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:20:07,161 - src.order.base - INFO - Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 filled: 32.0 @ 311.41 (32.0/32)
2025-06-12 13:20:07,161 - src.tws_connection - INFO - Open Order - ID: 2133, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:20:07,162 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:20:07,162 - __main__ - INFO -    Order ID: a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:07,162 - src.tws_connection - INFO - Open Order - ID: 2133, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:20:07,163 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:07,163 - __main__ - INFO -    Fill Price: $311.41
2025-06-12 13:20:07,163 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:20:07,164 - __main__ - INFO -    Status: filled
2025-06-12 13:20:07,164 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:20:07,164 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:07,164 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:20:07,164 - UnifiedFillManager - INFO - Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 fill status: filled, is_fully_filled: True
2025-06-12 13:20:07,164 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 13:20:07,165 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:20:07,165 - UnifiedFillManager - INFO -   Main orders: {'a947c4e6-080f-493e-ba51-f2b0e9ad7d33'}
2025-06-12 13:20:07,165 - UnifiedFillManager - INFO -   Stop orders: set()
2025-06-12 13:20:07,165 - UnifiedFillManager - INFO -   Target orders: set()
2025-06-12 13:20:07,166 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:20:07,166 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 13:20:07,166 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 13:20:07,166 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:20:07,167 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:20:07,167 - UnifiedFillManager - INFO - Checking 0 stop orders
2025-06-12 13:20:07,167 - UnifiedFillManager - INFO - Checking 0 target orders
2025-06-12 13:20:07,167 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 13:20:07,176 - src.tws_connection - WARNING - ⚠️ TWS Error 2176: Warning: Your API version does not support fractional share size rules. Please upgrade to a minimum version 163. Trimmed value 615.65 to 615 (reqId: 1000)
2025-06-12 13:20:08,966 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 13:20:08,967 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.37 (ATR: 0.0236 * 1.5 = 0.0354)
2025-06-12 13:20:08,967 - src.order.base - INFO - Order 7a759767-4600-4160-8a7c-8b477d6b556f status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:20:08,968 - src.order.manager - INFO - Submitting order 7a759767-4600-4160-8a7c-8b477d6b556f to TWS
2025-06-12 13:20:08,968 - src.order.manager - INFO - Got broker order ID 2134 for order 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:08,968 - src.order.manager - INFO - Calling placeOrder with ID 2134, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 13:20:08,968 - src.order.manager - INFO - placeOrder called successfully for order 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:08,968 - src.order.base - INFO - Order 7a759767-4600-4160-8a7c-8b477d6b556f status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:20:08,969 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:20:08,969 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 7a759767-4600-4160-8a7c-8b477d6b556f at $311.37
2025-06-12 13:20:08,969 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.45 (ATR: 0.0236 * 1.5 = 0.0354)
2025-06-12 13:20:08,969 - src.order.base - INFO - Order a32fd953-a30e-49a8-b48e-5f082557ea0e status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:20:08,970 - src.order.manager - INFO - Submitting order a32fd953-a30e-49a8-b48e-5f082557ea0e to TWS
2025-06-12 13:20:08,970 - src.order.manager - INFO - Got broker order ID 2135 for order a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:08,970 - src.order.manager - INFO - Calling placeOrder with ID 2135, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.450000 DAY
2025-06-12 13:20:08,970 - src.order.manager - INFO - placeOrder called successfully for order a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:08,971 - src.order.base - INFO - Order a32fd953-a30e-49a8-b48e-5f082557ea0e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:20:08,971 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:20:08,971 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit a32fd953-a30e-49a8-b48e-5f082557ea0e at $311.45
2025-06-12 13:20:08,971 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 13:20:08,972 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:20:08,972 - __main__ - INFO -    Order ID: 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:08,972 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:08,973 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:20:08,973 - __main__ - INFO -    Quantity: -32
2025-06-12 13:20:08,973 - __main__ - INFO -    Stop Price: $311.37
2025-06-12 13:20:08,974 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:08,974 - __main__ - INFO -    Order ID: 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:08,974 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:20:08,975 - __main__ - INFO -    Previous: created
2025-06-12 13:20:08,975 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:08,975 - __main__ - INFO -    Order ID: 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:08,975 - __main__ - INFO -    Status: submitted
2025-06-12 13:20:08,975 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:20:08,976 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:20:08,976 - __main__ - INFO -    Order ID: a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:08,976 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:08,976 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:20:08,976 - __main__ - INFO -    Quantity: -32
2025-06-12 13:20:08,976 - __main__ - INFO -    Limit Price: $311.45
2025-06-12 13:20:08,977 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:08,977 - __main__ - INFO -    Order ID: a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:08,977 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:20:08,977 - __main__ - INFO -    Previous: created
2025-06-12 13:20:08,977 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:08,977 - __main__ - INFO -    Order ID: a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:08,978 - __main__ - INFO -    Status: submitted
2025-06-12 13:20:08,978 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:20:08,978 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:20:09,039 - src.tws_connection - INFO - Open Order - ID: 2134, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:20:09,041 - src.order.base - INFO - Order 7a759767-4600-4160-8a7c-8b477d6b556f status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:20:09,088 - src.tws_connection - INFO - Open Order - ID: 2135, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:20:09,473 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['7a759767-4600-4160-8a7c-8b477d6b556f']
2025-06-12 13:20:09,474 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 13:20:09,474 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.41
2025-06-12 13:20:09,511 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0354
2025-06-12 13:20:09,511 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.41, stop_distance=$0.04, dd_distance=$0.02, dd_price=$311.39, original_qty=32, dd_qty=32
2025-06-12 13:20:09,512 - src.order.base - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:20:09,512 - src.order.manager - INFO - Submitting order d782b1d6-3de5-432a-9459-f8c9d4a7edca to TWS
2025-06-12 13:20:09,512 - src.order.manager - INFO - Got broker order ID 2136 for order d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,513 - src.order.manager - INFO - Calling placeOrder with ID 2136, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.390000 DAY
2025-06-12 13:20:09,513 - src.order.manager - INFO - placeOrder called successfully for order d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,513 - src.order.base - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:20:09,513 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 13:20:09,514 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.39
2025-06-12 13:20:09,515 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 13:20:09,515 - src.rule.linked_order_actions - INFO - Created and linked BUY main order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 for GLD
2025-06-12 13:20:09,515 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:20:09,516 - __main__ - INFO -    Order ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,517 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:09,517 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:20:09,518 - __main__ - INFO -    Quantity: 32
2025-06-12 13:20:09,518 - __main__ - INFO -    Limit Price: $311.39
2025-06-12 13:20:09,519 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:09,519 - __main__ - INFO -    Order ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,519 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:20:09,519 - __main__ - INFO -    Previous: created
2025-06-12 13:20:09,520 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:09,520 - __main__ - INFO -    Order ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,520 - __main__ - INFO -    Status: submitted
2025-06-12 13:20:09,521 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:20:09,605 - src.tws_connection - INFO - Open Order - ID: 2136, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:20:09,607 - src.order.base - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:20:09,650 - src.order.base - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca status changed: accepted -> filled (Order fully filled)
2025-06-12 13:20:09,650 - src.tws_connection - INFO - Open Order - ID: 2136, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:20:09,651 - src.order.base - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca filled: 32.0 @ 311.37 (32.0/32)
2025-06-12 13:20:09,652 - src.tws_connection - INFO - Open Order - ID: 2136, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:20:09,653 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:20:09,653 - __main__ - INFO -    Order ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,653 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:09,654 - __main__ - INFO -    Fill Price: $311.37
2025-06-12 13:20:09,654 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:20:09,654 - __main__ - INFO -    Status: filled
2025-06-12 13:20:09,655 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:20:09,655 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:09,656 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:20:09,656 - UnifiedFillManager - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca fill status: filled, is_fully_filled: True
2025-06-12 13:20:09,656 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 64.0
2025-06-12 13:20:09,657 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=64.0, protective_qty=-64.0
2025-06-12 13:20:09,658 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:20:09,658 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:20:09,658 - UnifiedFillManager - INFO - Queueing update for stop order 7a759767-4600-4160-8a7c-8b477d6b556f: current qty=-32, new qty=-64.0
2025-06-12 13:20:09,659 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:20:09,659 - UnifiedFillManager - INFO - Queueing update for target order a32fd953-a30e-49a8-b48e-5f082557ea0e: current qty=-32, new qty=-64.0
2025-06-12 13:20:09,660 - UnifiedFillManager - INFO - Processing operation for GLD: replace_stop
2025-06-12 13:20:09,660 - src.order.base - INFO - Order 7a759767-4600-4160-8a7c-8b477d6b556f status changed: accepted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 13:20:09,660 - src.order.manager - INFO - Cancelling order 7a759767-4600-4160-8a7c-8b477d6b556f with broker ID 2134
2025-06-12 13:20:09,692 - src.order.base - INFO - Order 7a759767-4600-4160-8a7c-8b477d6b556f status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:20:09,693 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2134)
2025-06-12 13:20:09,765 - src.order.base - INFO - Order ae4e4172-9eb6-41c2-98d5-406d3af301ce status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:20:09,766 - src.order.manager - INFO - Submitting order ae4e4172-9eb6-41c2-98d5-406d3af301ce to TWS
2025-06-12 13:20:09,766 - src.order.manager - INFO - Got broker order ID 2137 for order ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:09,767 - src.order.manager - INFO - Calling placeOrder with ID 2137, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 64@0.000000 DAY
2025-06-12 13:20:09,767 - src.order.manager - INFO - placeOrder called successfully for order ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:09,768 - src.order.base - INFO - Order ae4e4172-9eb6-41c2-98d5-406d3af301ce status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:20:09,768 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:20:09,769 - UnifiedFillManager - INFO - Created updated stop order ae4e4172-9eb6-41c2-98d5-406d3af301ce for GLD at $311.37 for -64.0 shares
2025-06-12 13:20:09,769 - UnifiedFillManager - INFO - Completed operation for GLD: replace_stop
2025-06-12 13:20:09,770 - UnifiedFillManager - INFO - Processing operation for GLD: replace_target
2025-06-12 13:20:09,770 - src.order.base - INFO - Order a32fd953-a30e-49a8-b48e-5f082557ea0e status changed: submitted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 13:20:09,771 - src.order.manager - INFO - Cancelling order a32fd953-a30e-49a8-b48e-5f082557ea0e with broker ID 2135
2025-06-12 13:20:09,771 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:20:09,771 - __main__ - INFO -    Order ID: ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:09,772 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:09,773 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:20:09,774 - __main__ - INFO -    Quantity: -64.0
2025-06-12 13:20:09,774 - __main__ - INFO -    Stop Price: $311.37
2025-06-12 13:20:09,775 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:09,775 - __main__ - INFO -    Order ID: ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:09,776 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:20:09,777 - __main__ - INFO -    Previous: created
2025-06-12 13:20:09,778 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:09,778 - __main__ - INFO -    Order ID: ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:09,778 - __main__ - INFO -    Status: submitted
2025-06-12 13:20:09,779 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:20:09,845 - src.order.base - INFO - Order a32fd953-a30e-49a8-b48e-5f082557ea0e status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:20:09,844 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2135)
2025-06-12 13:20:09,857 - src.tws_connection - INFO - Open Order - ID: 2137, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:20:09,858 - src.order.base - INFO - Order ae4e4172-9eb6-41c2-98d5-406d3af301ce status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:20:09,872 - src.order.base - INFO - Order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:20:09,872 - src.order.manager - INFO - Submitting order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 to TWS
2025-06-12 13:20:09,873 - src.order.manager - INFO - Got broker order ID 2138 for order 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:09,873 - src.order.manager - INFO - Calling placeOrder with ID 2138, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 64@311.450000 DAY
2025-06-12 13:20:09,874 - src.order.manager - INFO - placeOrder called successfully for order 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:09,874 - src.order.base - INFO - Order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:20:09,875 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:20:09,876 - UnifiedFillManager - INFO - Created updated target order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 for GLD at $311.45 for -64.0 shares
2025-06-12 13:20:09,876 - UnifiedFillManager - INFO - Completed operation for GLD: replace_target
2025-06-12 13:20:09,877 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:20:09,877 - __main__ - INFO -    Order ID: 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:09,877 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:09,878 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:20:09,878 - __main__ - INFO -    Quantity: -64.0
2025-06-12 13:20:09,878 - __main__ - INFO -    Limit Price: $311.45
2025-06-12 13:20:09,879 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:09,879 - __main__ - INFO -    Order ID: 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:09,879 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:20:09,879 - __main__ - INFO -    Previous: created
2025-06-12 13:20:09,879 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:20:09,879 - __main__ - INFO -    Order ID: 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:09,880 - __main__ - INFO -    Status: submitted
2025-06-12 13:20:09,880 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:20:09,970 - src.tws_connection - INFO - Open Order - ID: 2138, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:20:11,167 - src.tws_connection - INFO - Open Order - ID: 2137, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:20:11,191 - src.order.base - INFO - Order ae4e4172-9eb6-41c2-98d5-406d3af301ce status changed: accepted -> filled (Order fully filled)
2025-06-12 13:20:11,191 - src.tws_connection - INFO - Open Order - ID: 2137, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:20:11,192 - src.order.base - INFO - Order ae4e4172-9eb6-41c2-98d5-406d3af301ce filled: 64.0 @ 311.34 (64.0/64.0)
2025-06-12 13:20:11,193 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:20:11,193 - src.tws_connection - INFO - Open Order - ID: 2137, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:20:11,194 - __main__ - INFO -    Order ID: ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:11,195 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:11,195 - __main__ - INFO -    Fill Price: $311.34
2025-06-12 13:20:11,195 - __main__ - INFO -    Fill Quantity: 64.0
2025-06-12 13:20:11,195 - __main__ - INFO -    Status: filled
2025-06-12 13:20:11,196 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:20:11,196 - UnifiedFillManager - INFO - Processing fill for GLD: 64.0 shares on order ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:11,196 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 13:20:11,196 - UnifiedFillManager - INFO - Order ae4e4172-9eb6-41c2-98d5-406d3af301ce fill status: filled, is_fully_filled: True
2025-06-12 13:20:11,197 - UnifiedFillManager - INFO - Closing position for GLD: Stop order fully filled
2025-06-12 13:20:11,197 - src.position.position_manager - INFO - Closed position for GLD
2025-06-12 13:20:11,197 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-12 13:20:11,197 - UnifiedFillManager - INFO - Position closed for GLD: cancellation queued, trackers updated
2025-06-12 13:20:11,198 - UnifiedFillManager - INFO - Processing operation for GLD: cancel_all
2025-06-12 13:20:11,198 - src.order.base - INFO - Order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 status changed: submitted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 13:20:11,198 - src.order.manager - INFO - Cancelling order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 with broker ID 2138
2025-06-12 13:20:11,198 - UnifiedFillManager - INFO - Cancelled 1 orders for GLD
2025-06-12 13:20:11,198 - UnifiedFillManager - INFO - Completed operation for GLD: cancel_all
2025-06-12 13:20:11,252 - src.order.base - INFO - Order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:20:11,251 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2138)
2025-06-12 13:20:13,993 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:13,994 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:20:13,994 - __main__ - INFO - ================================================================================
2025-06-12 13:20:13,995 - __main__ - WARNING - No GLD context found!
2025-06-12 13:20:13,995 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:20:13,995 - __main__ - INFO -    Total orders created: 6
2025-06-12 13:20:13,995 - __main__ - INFO -    Market orders: 1
2025-06-12 13:20:13,996 - __main__ - INFO -    Stop orders: 2
2025-06-12 13:20:13,996 - __main__ - INFO -    Limit orders: 3
2025-06-12 13:20:13,996 - __main__ - WARNING - 
⚠️ WARNING: Expected 4 orders but got 6
2025-06-12 13:20:13,996 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:20:13,996 - __main__ - INFO - 
   Order #1:
2025-06-12 13:20:13,997 - __main__ - INFO -      ID: a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:13,997 - __main__ - INFO -      Type: market
2025-06-12 13:20:13,997 - __main__ - INFO -      Quantity: 32
2025-06-12 13:20:13,997 - __main__ - INFO - 
   Order #2:
2025-06-12 13:20:13,997 - __main__ - INFO -      ID: 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:13,997 - __main__ - INFO -      Type: stop
2025-06-12 13:20:13,997 - __main__ - INFO -      Quantity: -32
2025-06-12 13:20:13,998 - __main__ - INFO -      Stop: $311.37
2025-06-12 13:20:13,998 - __main__ - INFO - 
   Order #3:
2025-06-12 13:20:13,998 - __main__ - INFO -      ID: a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:13,998 - __main__ - INFO -      Type: limit
2025-06-12 13:20:13,998 - __main__ - INFO -      Quantity: -32
2025-06-12 13:20:13,998 - __main__ - INFO -      Limit: $311.45
2025-06-12 13:20:13,998 - __main__ - INFO - 
   Order #4:
2025-06-12 13:20:13,998 - __main__ - INFO -      ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:13,998 - __main__ - INFO -      Type: limit
2025-06-12 13:20:13,999 - __main__ - INFO -      Quantity: 32
2025-06-12 13:20:13,999 - __main__ - INFO -      Limit: $311.39
2025-06-12 13:20:13,999 - __main__ - INFO - 
   Order #5:
2025-06-12 13:20:13,999 - __main__ - INFO -      ID: ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:13,999 - __main__ - INFO -      Type: stop
2025-06-12 13:20:13,999 - __main__ - INFO -      Quantity: -64.0
2025-06-12 13:20:13,999 - __main__ - INFO -      Stop: $311.37
2025-06-12 13:20:13,999 - __main__ - INFO - 
   Order #6:
2025-06-12 13:20:14,000 - __main__ - INFO -      ID: 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:14,000 - __main__ - INFO -      Type: limit
2025-06-12 13:20:14,000 - __main__ - INFO -      Quantity: -64.0
2025-06-12 13:20:14,000 - __main__ - INFO -      Limit: $311.45
2025-06-12 13:20:14,000 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:20:14,000 - __main__ - INFO -    Total fills received: 3
2025-06-12 13:20:14,000 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:20:14,001 - __main__ - INFO -      Order ID: a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:14,001 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:20:14,001 - __main__ - INFO -      Price: $311.41
2025-06-12 13:20:14,001 - __main__ - INFO -      Status: filled
2025-06-12 13:20:14,001 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:20:14,001 - __main__ - INFO -      Order ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:14,001 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:20:14,001 - __main__ - INFO -      Price: $311.37
2025-06-12 13:20:14,001 - __main__ - INFO -      Status: filled
2025-06-12 13:20:14,001 - __main__ - INFO - 
   Fill #3:
2025-06-12 13:20:14,002 - __main__ - INFO -      Order ID: ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:14,002 - __main__ - INFO -      Quantity: 64.0
2025-06-12 13:20:14,002 - __main__ - INFO -      Price: $311.34
2025-06-12 13:20:14,002 - __main__ - INFO -      Status: filled
2025-06-12 13:20:14,002 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:20:44,017 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:44,018 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:20:44,018 - __main__ - INFO - ================================================================================
2025-06-12 13:20:44,019 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:20:44,019 - __main__ - INFO - 
Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33:
2025-06-12 13:20:44,020 - __main__ - INFO -   Type: market
2025-06-12 13:20:44,020 - __main__ - INFO -   Status: filled
2025-06-12 13:20:44,021 - __main__ - INFO -   Quantity: 32
2025-06-12 13:20:44,021 - __main__ - INFO -   Broker ID: 2133
2025-06-12 13:20:44,021 - __main__ - INFO - 
Order 7a759767-4600-4160-8a7c-8b477d6b556f:
2025-06-12 13:20:44,022 - __main__ - INFO -   Type: stop
2025-06-12 13:20:44,022 - __main__ - INFO -   Status: cancelled
2025-06-12 13:20:44,023 - __main__ - INFO -   Quantity: -32
2025-06-12 13:20:44,023 - __main__ - INFO -   Broker ID: 2134
2025-06-12 13:20:44,024 - __main__ - INFO - 
Order a32fd953-a30e-49a8-b48e-5f082557ea0e:
2025-06-12 13:20:44,024 - __main__ - INFO -   Type: limit
2025-06-12 13:20:44,024 - __main__ - INFO -   Status: cancelled
2025-06-12 13:20:44,025 - __main__ - INFO -   Quantity: -32
2025-06-12 13:20:44,025 - __main__ - INFO -   Broker ID: 2135
2025-06-12 13:20:44,025 - __main__ - INFO - 
Order d782b1d6-3de5-432a-9459-f8c9d4a7edca:
2025-06-12 13:20:44,026 - __main__ - INFO -   Type: limit
2025-06-12 13:20:44,026 - __main__ - INFO -   Status: filled
2025-06-12 13:20:44,026 - __main__ - INFO -   Quantity: 32
2025-06-12 13:20:44,027 - __main__ - INFO -   Broker ID: 2136
2025-06-12 13:20:44,027 - __main__ - INFO - 
Order ae4e4172-9eb6-41c2-98d5-406d3af301ce:
2025-06-12 13:20:44,027 - __main__ - INFO -   Type: stop
2025-06-12 13:20:44,027 - __main__ - INFO -   Status: filled
2025-06-12 13:20:44,027 - __main__ - INFO -   Quantity: -64.0
2025-06-12 13:20:44,028 - __main__ - INFO -   Broker ID: 2137
2025-06-12 13:20:44,028 - __main__ - INFO - 
Order 12dce0f4-a3a8-4484-a642-c6ca72a90b32:
2025-06-12 13:20:44,028 - __main__ - INFO -   Type: limit
2025-06-12 13:20:44,028 - __main__ - INFO -   Status: cancelled
2025-06-12 13:20:44,028 - __main__ - INFO -   Quantity: -64.0
2025-06-12 13:20:44,028 - __main__ - INFO -   Broker ID: 2138
2025-06-12 13:20:44,029 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:44,029 - __main__ - INFO - DOUBLE DOWN FILL SIMULATION
2025-06-12 13:20:44,029 - __main__ - INFO - ================================================================================
2025-06-12 13:20:44,029 - __main__ - INFO - 
Would you like to simulate a double down fill to test protective order updates?
2025-06-12 13:20:44,029 - __main__ - INFO - This will emit a fill event for the double down order to test if UnifiedFillManager
2025-06-12 13:20:44,029 - __main__ - INFO - properly updates the stop and take profit quantities to match the new position size.
2025-06-12 13:20:44,030 - __main__ - INFO - 
Automatically simulating double down fill for testing...
2025-06-12 13:20:44,030 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:44,030 - __main__ - INFO - SIMULATING DOUBLE DOWN FILL TO TEST PROTECTIVE ORDER UPDATES
2025-06-12 13:20:44,030 - __main__ - INFO - ================================================================================
2025-06-12 13:20:44,030 - __main__ - INFO - Simulating double down fill on order: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:44,030 - __main__ - INFO - Double down order details: 32 shares @ $311.39
2025-06-12 13:20:44,031 - __main__ - INFO - Emitting double down fill event: 32 shares at $311.39
2025-06-12 13:20:44,031 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:20:44,031 - __main__ - INFO -    Order ID: d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:44,031 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:20:44,031 - __main__ - INFO -    Fill Price: $311.39
2025-06-12 13:20:44,031 - __main__ - INFO -    Fill Quantity: 32
2025-06-12 13:20:44,032 - __main__ - INFO -    Status: filled
2025-06-12 13:20:44,032 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:20:44,032 - UnifiedFillManager - INFO - Processing fill for GLD: 32 shares on order d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:44,032 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:20:44,032 - UnifiedFillManager - INFO - Order d782b1d6-3de5-432a-9459-f8c9d4a7edca fill status: filled, is_fully_filled: True
2025-06-12 13:20:44,032 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 128.0
2025-06-12 13:20:44,033 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=128.0, protective_qty=-128.0
2025-06-12 13:20:44,033 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:20:44,033 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:20:44,033 - UnifiedFillManager - INFO - Stop order ae4e4172-9eb6-41c2-98d5-406d3af301ce not active, skipping update
2025-06-12 13:20:44,033 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:20:44,033 - UnifiedFillManager - INFO - Target order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 not active, skipping update
2025-06-12 13:20:47,033 - __main__ - INFO - UnifiedFillManager should have updated protective orders to new position size (606 shares)
2025-06-12 13:20:47,033 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the double down fill...
2025-06-12 13:20:52,037 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:52,039 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:20:52,039 - __main__ - INFO - ================================================================================
2025-06-12 13:20:52,040 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:20:52,041 - __main__ - INFO - 
Order a947c4e6-080f-493e-ba51-f2b0e9ad7d33:
2025-06-12 13:20:52,041 - __main__ - INFO -   Type: market
2025-06-12 13:20:52,042 - __main__ - INFO -   Status: filled
2025-06-12 13:20:52,043 - __main__ - INFO -   Quantity: 32
2025-06-12 13:20:52,043 - __main__ - INFO -   Broker ID: 2133
2025-06-12 13:20:52,043 - __main__ - INFO - 
Order 7a759767-4600-4160-8a7c-8b477d6b556f:
2025-06-12 13:20:52,044 - __main__ - INFO -   Type: stop
2025-06-12 13:20:52,044 - __main__ - INFO -   Status: cancelled
2025-06-12 13:20:52,044 - __main__ - INFO -   Quantity: -32
2025-06-12 13:20:52,044 - __main__ - INFO -   Broker ID: 2134
2025-06-12 13:20:52,045 - __main__ - INFO - 
Order a32fd953-a30e-49a8-b48e-5f082557ea0e:
2025-06-12 13:20:52,045 - __main__ - INFO -   Type: limit
2025-06-12 13:20:52,045 - __main__ - INFO -   Status: cancelled
2025-06-12 13:20:52,046 - __main__ - INFO -   Quantity: -32
2025-06-12 13:20:52,046 - __main__ - INFO -   Broker ID: 2135
2025-06-12 13:20:52,046 - __main__ - INFO - 
Order d782b1d6-3de5-432a-9459-f8c9d4a7edca:
2025-06-12 13:20:52,046 - __main__ - INFO -   Type: limit
2025-06-12 13:20:52,046 - __main__ - INFO -   Status: filled
2025-06-12 13:20:52,047 - __main__ - INFO -   Quantity: 32
2025-06-12 13:20:52,047 - __main__ - INFO -   Broker ID: 2136
2025-06-12 13:20:52,047 - __main__ - INFO - 
Order ae4e4172-9eb6-41c2-98d5-406d3af301ce:
2025-06-12 13:20:52,047 - __main__ - INFO -   Type: stop
2025-06-12 13:20:52,047 - __main__ - INFO -   Status: filled
2025-06-12 13:20:52,048 - __main__ - INFO -   Quantity: -64.0
2025-06-12 13:20:52,048 - __main__ - INFO -   Broker ID: 2137
2025-06-12 13:20:52,048 - __main__ - INFO - 
Order 12dce0f4-a3a8-4484-a642-c6ca72a90b32:
2025-06-12 13:20:52,048 - __main__ - INFO -   Type: limit
2025-06-12 13:20:52,048 - __main__ - INFO -   Status: cancelled
2025-06-12 13:20:52,048 - __main__ - INFO -   Quantity: -64.0
2025-06-12 13:20:52,049 - __main__ - INFO -   Broker ID: 2138
2025-06-12 13:20:52,049 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:52,049 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:20:52,049 - __main__ - INFO - ================================================================================
2025-06-12 13:20:52,049 - __main__ - INFO - Cancelling 6 test orders...
2025-06-12 13:20:52,049 - src.order.manager - WARNING - Cannot cancel inactive order a947c4e6-080f-493e-ba51-f2b0e9ad7d33 with status filled
2025-06-12 13:20:52,049 - __main__ - INFO -    Cancelled order a947c4e6-080f-493e-ba51-f2b0e9ad7d33
2025-06-12 13:20:52,050 - src.order.manager - WARNING - Cannot cancel inactive order 7a759767-4600-4160-8a7c-8b477d6b556f with status cancelled
2025-06-12 13:20:52,050 - __main__ - INFO -    Cancelled order 7a759767-4600-4160-8a7c-8b477d6b556f
2025-06-12 13:20:52,050 - src.order.manager - WARNING - Cannot cancel inactive order a32fd953-a30e-49a8-b48e-5f082557ea0e with status cancelled
2025-06-12 13:20:52,050 - __main__ - INFO -    Cancelled order a32fd953-a30e-49a8-b48e-5f082557ea0e
2025-06-12 13:20:52,050 - src.order.manager - WARNING - Cannot cancel inactive order d782b1d6-3de5-432a-9459-f8c9d4a7edca with status filled
2025-06-12 13:20:52,050 - __main__ - INFO -    Cancelled order d782b1d6-3de5-432a-9459-f8c9d4a7edca
2025-06-12 13:20:52,050 - src.order.manager - WARNING - Cannot cancel inactive order ae4e4172-9eb6-41c2-98d5-406d3af301ce with status filled
2025-06-12 13:20:52,050 - __main__ - INFO -    Cancelled order ae4e4172-9eb6-41c2-98d5-406d3af301ce
2025-06-12 13:20:52,051 - src.order.manager - WARNING - Cannot cancel inactive order 12dce0f4-a3a8-4484-a642-c6ca72a90b32 with status cancelled
2025-06-12 13:20:52,051 - __main__ - INFO -    Cancelled order 12dce0f4-a3a8-4484-a642-c6ca72a90b32
2025-06-12 13:20:52,051 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 13:20:52,051 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:20:52,051 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:20:52,051 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:20:52,051 - __main__ - INFO - Rule engine stopped
2025-06-12 13:20:52,052 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:20:52,052 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:20:52,052 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:20:52,052 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:20:52,053 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:20:52,053 - __main__ - INFO - 
================================================================================
2025-06-12 13:20:52,054 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:20:52,054 - __main__ - INFO - ================================================================================
2025-06-12 13:23:52,220 - __main__ - INFO - ================================================================================
2025-06-12 13:23:52,221 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:23:52,221 - __main__ - INFO - ================================================================================
2025-06-12 13:23:52,221 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:23:52,221 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:23:52,221 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:23:52,223 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:23:52,223 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:23:52,224 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:23:54,768 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:23:54,769 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:23:54,790 - src.tws_connection - INFO - ✅ Next valid order ID received: 2139
2025-06-12 13:23:54,791 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:23:54,791 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:23:54,792 - src.tws_connection - INFO - ✅ Next valid order ID received: 2139
2025-06-12 13:23:54,793 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:23:54,793 - src.tws_connection - INFO - ✅ Next valid order ID received: 2139
2025-06-12 13:23:54,793 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:23:54,794 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:23:54,794 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:23:54,795 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:23:54,795 - __main__ - INFO - Rule engine context configured
2025-06-12 13:23:54,795 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:23:54,795 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:23:54,795 - __main__ - INFO - 
================================================================================
2025-06-12 13:23:54,796 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 13:23:54,796 - __main__ - INFO - ================================================================================
2025-06-12 13:23:54,796 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:23:54,796 - __main__ - INFO - Created BUY action ($10K allocation, 2.0x ATR stop, 2.0x ATR target)
2025-06-12 13:23:54,796 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 13:23:54,797 - __main__ - INFO - 
================================================================================
2025-06-12 13:23:54,797 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 13:23:54,797 - __main__ - INFO - ================================================================================
2025-06-12 13:23:59,804 - __main__ - INFO - Current GLD price: $311.26
2025-06-12 13:23:59,804 - __main__ - INFO - Created prediction event:
2025-06-12 13:23:59,805 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:23:59,805 - __main__ - INFO -    Signal: BUY
2025-06-12 13:23:59,805 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:23:59,806 - __main__ - INFO -    Price: $311.26
2025-06-12 13:23:59,807 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:23:59,807 - __main__ - INFO - Rule engine started
2025-06-12 13:23:59,808 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:23:59,808 - __main__ - INFO - Prediction event emitted
2025-06-12 13:23:59,809 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:23:59,809 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:23:59,810 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:23:59,810 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 13:23:59,811 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 13:24:00,821 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.27 = $9960.64 (99.6% of $10000.00 allocation)
2025-06-12 13:24:00,822 - src.order.base - INFO - Order beeb0437-678f-40ba-b28b-ffc67e8462a7 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:24:00,823 - src.order.manager - INFO - Submitting order beeb0437-678f-40ba-b28b-ffc67e8462a7 to TWS
2025-06-12 13:24:00,824 - src.order.manager - INFO - Got broker order ID 2139 for order beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,824 - src.order.manager - INFO - Calling placeOrder with ID 2139, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 13:24:00,825 - src.order.manager - INFO - placeOrder called successfully for order beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,825 - src.order.base - INFO - Order beeb0437-678f-40ba-b28b-ffc67e8462a7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:24:00,826 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 13:24:00,846 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 13:24:00,847 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.21 (ATR: 0.0236 * 2.0 = 0.0471)
2025-06-12 13:24:00,847 - src.order.base - INFO - Order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:24:00,848 - src.order.manager - INFO - Submitting order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a to TWS
2025-06-12 13:24:00,848 - src.order.manager - INFO - Got broker order ID 2140 for order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a
2025-06-12 13:24:00,848 - src.order.manager - INFO - Calling placeOrder with ID 2140, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 13:24:00,849 - src.order.manager - INFO - placeOrder called successfully for order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a
2025-06-12 13:24:00,849 - src.order.base - INFO - Order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:24:00,849 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:24:00,850 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a at $311.21
2025-06-12 13:24:00,850 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.31 (ATR: 0.0236 * 2.0 = 0.0471)
2025-06-12 13:24:00,850 - src.order.base - INFO - Order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:24:00,850 - src.order.manager - INFO - Submitting order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 to TWS
2025-06-12 13:24:00,850 - src.order.manager - INFO - Got broker order ID 2141 for order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:00,850 - src.order.manager - INFO - Calling placeOrder with ID 2141, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.310000 DAY
2025-06-12 13:24:00,851 - src.order.manager - INFO - placeOrder called successfully for order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:00,851 - src.order.base - INFO - Order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:24:00,851 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:24:00,851 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 at $311.31
2025-06-12 13:24:00,851 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 13:24:00,851 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:24:00,852 - __main__ - INFO -    Order ID: beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,852 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:24:00,852 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:24:00,852 - __main__ - INFO -    Quantity: 32
2025-06-12 13:24:00,852 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:00,853 - __main__ - INFO -    Order ID: beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,853 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:24:00,853 - __main__ - INFO -    Previous: created
2025-06-12 13:24:00,853 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:00,853 - __main__ - INFO -    Order ID: beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,853 - __main__ - INFO -    Status: submitted
2025-06-12 13:24:00,853 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:24:00,853 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:24:00,854 - __main__ - INFO -    Order ID: bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a
2025-06-12 13:24:00,854 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:24:00,854 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:24:00,854 - __main__ - INFO -    Quantity: -32
2025-06-12 13:24:00,854 - __main__ - INFO -    Stop Price: $311.21
2025-06-12 13:24:00,854 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:00,854 - __main__ - INFO -    Order ID: bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a
2025-06-12 13:24:00,854 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:24:00,854 - __main__ - INFO -    Previous: created
2025-06-12 13:24:00,855 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:00,855 - __main__ - INFO -    Order ID: bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a
2025-06-12 13:24:00,855 - __main__ - INFO -    Status: submitted
2025-06-12 13:24:00,855 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:24:00,855 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:24:00,856 - __main__ - INFO -    Order ID: 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:00,856 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:24:00,857 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:24:00,857 - __main__ - INFO -    Quantity: -32
2025-06-12 13:24:00,857 - __main__ - INFO -    Limit Price: $311.31
2025-06-12 13:24:00,858 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:00,858 - __main__ - INFO -    Order ID: 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:00,858 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:24:00,858 - __main__ - INFO -    Previous: created
2025-06-12 13:24:00,858 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:00,859 - __main__ - INFO -    Order ID: 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:00,859 - __main__ - INFO -    Status: submitted
2025-06-12 13:24:00,859 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:24:00,917 - src.tws_connection - INFO - Open Order - ID: 2139, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:24:00,918 - src.order.base - INFO - Order beeb0437-678f-40ba-b28b-ffc67e8462a7 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:24:00,926 - src.order.base - INFO - Order beeb0437-678f-40ba-b28b-ffc67e8462a7 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:24:00,927 - src.tws_connection - INFO - Open Order - ID: 2139, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:24:00,927 - src.order.base - INFO - Order beeb0437-678f-40ba-b28b-ffc67e8462a7 filled: 32.0 @ 311.28 (32.0/32)
2025-06-12 13:24:00,928 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:24:00,928 - src.tws_connection - INFO - Open Order - ID: 2139, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:24:00,929 - __main__ - INFO -    Order ID: beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,929 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:24:00,929 - __main__ - INFO -    Fill Price: $311.28
2025-06-12 13:24:00,929 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:24:00,930 - __main__ - INFO -    Status: filled
2025-06-12 13:24:00,930 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:24:00,930 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:00,930 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:24:00,930 - UnifiedFillManager - INFO - Order beeb0437-678f-40ba-b28b-ffc67e8462a7 fill status: filled, is_fully_filled: True
2025-06-12 13:24:00,931 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 13:24:00,931 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:24:00,931 - UnifiedFillManager - INFO -   Main orders: {'beeb0437-678f-40ba-b28b-ffc67e8462a7'}
2025-06-12 13:24:00,931 - UnifiedFillManager - INFO -   Stop orders: {'bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a'}
2025-06-12 13:24:00,931 - UnifiedFillManager - INFO -   Target orders: {'6feaa8b2-9931-4f43-8c37-dfc1aece7eb6'}
2025-06-12 13:24:00,932 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:24:00,932 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 13:24:00,932 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 13:24:00,932 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:24:00,932 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:24:00,933 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:24:00,933 - UnifiedFillManager - INFO - Stop order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a already has correct quantity -32, no update needed
2025-06-12 13:24:00,933 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:24:00,933 - UnifiedFillManager - INFO - Target order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 already has correct quantity -32, no update needed
2025-06-12 13:24:00,933 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 13:24:00,964 - src.tws_connection - INFO - Open Order - ID: 2140, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:24:00,965 - src.order.base - INFO - Order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:24:00,965 - src.tws_connection - INFO - Open Order - ID: 2141, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:24:01,361 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a']
2025-06-12 13:24:01,361 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 13:24:01,362 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.26
2025-06-12 13:24:01,384 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0471
2025-06-12 13:24:01,385 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.26, stop_distance=$0.05, dd_distance=$0.02, dd_price=$311.24, original_qty=32, dd_qty=32
2025-06-12 13:24:01,385 - src.order.base - INFO - Order 42d507a8-81a1-454f-9f5e-651a5045afdc status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:24:01,386 - src.order.manager - INFO - Submitting order 42d507a8-81a1-454f-9f5e-651a5045afdc to TWS
2025-06-12 13:24:01,386 - src.order.manager - INFO - Got broker order ID 2142 for order 42d507a8-81a1-454f-9f5e-651a5045afdc
2025-06-12 13:24:01,387 - src.order.manager - INFO - Calling placeOrder with ID 2142, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.240000 DAY
2025-06-12 13:24:01,387 - src.order.manager - INFO - placeOrder called successfully for order 42d507a8-81a1-454f-9f5e-651a5045afdc
2025-06-12 13:24:01,387 - src.order.base - INFO - Order 42d507a8-81a1-454f-9f5e-651a5045afdc status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:24:01,388 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 13:24:01,388 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.24
2025-06-12 13:24:01,388 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 13:24:01,388 - src.rule.linked_order_actions - INFO - Created and linked BUY main order beeb0437-678f-40ba-b28b-ffc67e8462a7 for GLD
2025-06-12 13:24:01,388 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:24:01,389 - __main__ - INFO -    Order ID: 42d507a8-81a1-454f-9f5e-651a5045afdc
2025-06-12 13:24:01,390 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:24:01,391 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:24:01,391 - __main__ - INFO -    Quantity: 32
2025-06-12 13:24:01,391 - __main__ - INFO -    Limit Price: $311.24
2025-06-12 13:24:01,391 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:01,391 - __main__ - INFO -    Order ID: 42d507a8-81a1-454f-9f5e-651a5045afdc
2025-06-12 13:24:01,392 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:24:01,392 - __main__ - INFO -    Previous: created
2025-06-12 13:24:01,392 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:24:01,392 - __main__ - INFO -    Order ID: 42d507a8-81a1-454f-9f5e-651a5045afdc
2025-06-12 13:24:01,392 - __main__ - INFO -    Status: submitted
2025-06-12 13:24:01,392 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:24:01,478 - src.tws_connection - INFO - Open Order - ID: 2142, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:24:02,815 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:24:07,826 - __main__ - INFO - 
================================================================================
2025-06-12 13:24:07,826 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:24:07,827 - __main__ - INFO - ================================================================================
2025-06-12 13:24:07,827 - __main__ - WARNING - No GLD context found!
2025-06-12 13:24:07,828 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:24:07,828 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:24:07,828 - __main__ - INFO -    Market orders: 1
2025-06-12 13:24:07,829 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:24:07,829 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:24:07,829 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:24:07,830 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:24:07,830 - __main__ - INFO - 
   Order #1:
2025-06-12 13:24:07,830 - __main__ - INFO -      ID: beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:07,831 - __main__ - INFO -      Type: market
2025-06-12 13:24:07,831 - __main__ - INFO -      Quantity: 32
2025-06-12 13:24:07,831 - __main__ - INFO - 
   Order #2:
2025-06-12 13:24:07,832 - __main__ - INFO -      ID: bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a
2025-06-12 13:24:07,832 - __main__ - INFO -      Type: stop
2025-06-12 13:24:07,832 - __main__ - INFO -      Quantity: -32
2025-06-12 13:24:07,832 - __main__ - INFO -      Stop: $311.21
2025-06-12 13:24:07,832 - __main__ - INFO - 
   Order #3:
2025-06-12 13:24:07,833 - __main__ - INFO -      ID: 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:07,833 - __main__ - INFO -      Type: limit
2025-06-12 13:24:07,833 - __main__ - INFO -      Quantity: -32
2025-06-12 13:24:07,833 - __main__ - INFO -      Limit: $311.31
2025-06-12 13:24:07,833 - __main__ - INFO - 
   Order #4:
2025-06-12 13:24:07,834 - __main__ - INFO -      ID: 42d507a8-81a1-454f-9f5e-651a5045afdc
2025-06-12 13:24:07,834 - __main__ - INFO -      Type: limit
2025-06-12 13:24:07,834 - __main__ - INFO -      Quantity: 32
2025-06-12 13:24:07,834 - __main__ - INFO -      Limit: $311.24
2025-06-12 13:24:07,834 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:24:07,834 - __main__ - INFO -    Total fills received: 1
2025-06-12 13:24:07,835 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:24:07,835 - __main__ - INFO -      Order ID: beeb0437-678f-40ba-b28b-ffc67e8462a7
2025-06-12 13:24:07,835 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:24:07,835 - __main__ - INFO -      Price: $311.28
2025-06-12 13:24:07,835 - __main__ - INFO -      Status: filled
2025-06-12 13:24:07,835 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:24:09,187 - src.order.base - INFO - Order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:24:09,187 - src.tws_connection - INFO - Open Order - ID: 2141, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:24:09,187 - src.order.base - INFO - Order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 filled: 32.0 @ 311.31 (32.0/32)
2025-06-12 13:24:09,188 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:24:09,188 - src.tws_connection - INFO - Open Order - ID: 2141, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:24:09,189 - __main__ - INFO -    Order ID: 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:09,190 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:24:09,190 - __main__ - INFO -    Fill Price: $311.31
2025-06-12 13:24:09,190 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:24:09,191 - __main__ - INFO -    Status: filled
2025-06-12 13:24:09,191 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:24:09,191 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6
2025-06-12 13:24:09,191 - UnifiedFillManager - INFO - Fill is for target order
2025-06-12 13:24:09,192 - UnifiedFillManager - INFO - Order 6feaa8b2-9931-4f43-8c37-dfc1aece7eb6 fill status: filled, is_fully_filled: True
2025-06-12 13:24:09,192 - UnifiedFillManager - INFO - Closing position for GLD: Target order fully filled
2025-06-12 13:24:09,192 - src.position.position_manager - INFO - Closed position for GLD
2025-06-12 13:24:09,192 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-12 13:24:09,193 - UnifiedFillManager - INFO - Position closed for GLD: cancellation queued, trackers updated
2025-06-12 13:24:09,193 - UnifiedFillManager - INFO - Processing operation for GLD: cancel_all
2025-06-12 13:24:09,193 - src.order.base - INFO - Order 42d507a8-81a1-454f-9f5e-651a5045afdc status changed: submitted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 13:24:09,194 - src.order.manager - INFO - Cancelling order 42d507a8-81a1-454f-9f5e-651a5045afdc with broker ID 2142
2025-06-12 13:24:09,194 - src.order.base - INFO - Order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a status changed: accepted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 13:24:09,194 - src.order.manager - INFO - Cancelling order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a with broker ID 2140
2025-06-12 13:24:09,195 - UnifiedFillManager - INFO - Cancelled 2 orders for GLD
2025-06-12 13:24:09,195 - UnifiedFillManager - INFO - Completed operation for GLD: cancel_all
2025-06-12 13:24:09,244 - src.order.base - INFO - Order 42d507a8-81a1-454f-9f5e-651a5045afdc status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:24:09,244 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2142)
2025-06-12 13:24:09,329 - src.order.base - INFO - Order bc1d2e84-34c1-4f92-b0a9-12d348cb3b0a status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:24:09,329 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2140)
2025-06-12 13:24:56,226 - __main__ - INFO - ================================================================================
2025-06-12 13:24:56,227 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:24:56,227 - __main__ - INFO - ================================================================================
2025-06-12 13:24:56,227 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:24:56,228 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:24:56,228 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:24:56,230 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:24:56,230 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:24:56,231 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:24:58,457 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:24:58,458 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:24:58,469 - src.tws_connection - INFO - ✅ Next valid order ID received: 2143
2025-06-12 13:24:58,470 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:24:58,470 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:24:58,471 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:24:58,471 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:24:58,471 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:24:58,472 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:24:58,472 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:24:58,472 - __main__ - INFO - Rule engine context configured
2025-06-12 13:24:58,473 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:24:58,473 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:24:58,474 - __main__ - INFO - 
================================================================================
2025-06-12 13:24:58,474 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 13:24:58,475 - __main__ - INFO - ================================================================================
2025-06-12 13:24:58,475 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:24:58,475 - __main__ - INFO - Created BUY action ($10K allocation, 3.5x ATR stop, 3.5x ATR target)
2025-06-12 13:24:58,475 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 13:24:58,476 - __main__ - INFO - 
================================================================================
2025-06-12 13:24:58,476 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 13:24:58,476 - __main__ - INFO - ================================================================================
2025-06-12 13:24:58,558 - src.tws_connection - INFO - ✅ Next valid order ID received: 2143
2025-06-12 13:24:58,657 - src.tws_connection - INFO - ✅ Next valid order ID received: 2143
2025-06-12 13:25:03,478 - __main__ - INFO - Current GLD price: $311.22
2025-06-12 13:25:03,478 - __main__ - INFO - Created prediction event:
2025-06-12 13:25:03,479 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:03,479 - __main__ - INFO -    Signal: BUY
2025-06-12 13:25:03,479 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:25:03,480 - __main__ - INFO -    Price: $311.22
2025-06-12 13:25:03,480 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:25:03,480 - __main__ - INFO - Rule engine started
2025-06-12 13:25:03,480 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:25:03,481 - __main__ - INFO - Prediction event emitted
2025-06-12 13:25:03,481 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:25:03,481 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:25:03,481 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:25:03,482 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 13:25:03,482 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 13:25:04,484 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.20 = $9958.40 (99.6% of $10000.00 allocation)
2025-06-12 13:25:04,485 - src.order.base - INFO - Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:25:04,485 - src.order.manager - INFO - Submitting order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe to TWS
2025-06-12 13:25:04,486 - src.order.manager - INFO - Got broker order ID 2143 for order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,486 - src.order.manager - INFO - Calling placeOrder with ID 2143, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 13:25:04,487 - src.order.manager - INFO - placeOrder called successfully for order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,487 - src.order.base - INFO - Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:25:04,488 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 13:25:04,507 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 13:25:04,507 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.14 (ATR: 0.0236 * 3.5 = 0.0825)
2025-06-12 13:25:04,508 - src.order.base - INFO - Order 50a25321-a16c-4641-8660-1588cb26d741 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:25:04,509 - src.order.manager - INFO - Submitting order 50a25321-a16c-4641-8660-1588cb26d741 to TWS
2025-06-12 13:25:04,509 - src.order.manager - INFO - Got broker order ID 2144 for order 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:04,509 - src.order.manager - INFO - Calling placeOrder with ID 2144, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 13:25:04,510 - src.order.manager - INFO - placeOrder called successfully for order 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:04,510 - src.order.base - INFO - Order 50a25321-a16c-4641-8660-1588cb26d741 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:25:04,511 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:25:04,511 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 50a25321-a16c-4641-8660-1588cb26d741 at $311.14
2025-06-12 13:25:04,511 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.30 (ATR: 0.0236 * 3.5 = 0.0825)
2025-06-12 13:25:04,512 - src.order.base - INFO - Order b78cf2f5-b220-409a-9c24-c77b51d62004 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:25:04,512 - src.order.manager - INFO - Submitting order b78cf2f5-b220-409a-9c24-c77b51d62004 to TWS
2025-06-12 13:25:04,512 - src.order.manager - INFO - Got broker order ID 2145 for order b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:04,513 - src.order.manager - INFO - Calling placeOrder with ID 2145, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.300000 DAY
2025-06-12 13:25:04,514 - src.order.manager - INFO - placeOrder called successfully for order b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:04,515 - src.order.base - INFO - Order b78cf2f5-b220-409a-9c24-c77b51d62004 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:25:04,516 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:25:04,516 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit b78cf2f5-b220-409a-9c24-c77b51d62004 at $311.30
2025-06-12 13:25:04,516 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 13:25:04,517 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:25:04,518 - __main__ - INFO -    Order ID: 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,518 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:04,518 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:25:04,518 - __main__ - INFO -    Quantity: 32
2025-06-12 13:25:04,519 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:04,519 - __main__ - INFO -    Order ID: 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,520 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:25:04,520 - __main__ - INFO -    Previous: created
2025-06-12 13:25:04,520 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:04,521 - __main__ - INFO -    Order ID: 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,522 - __main__ - INFO -    Status: submitted
2025-06-12 13:25:04,522 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:25:04,523 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:25:04,524 - __main__ - INFO -    Order ID: 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:04,524 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:04,524 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:25:04,525 - __main__ - INFO -    Quantity: -32
2025-06-12 13:25:04,526 - __main__ - INFO -    Stop Price: $311.14
2025-06-12 13:25:04,527 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:04,528 - __main__ - INFO -    Order ID: 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:04,528 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:25:04,529 - __main__ - INFO -    Previous: created
2025-06-12 13:25:04,529 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:04,530 - __main__ - INFO -    Order ID: 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:04,530 - __main__ - INFO -    Status: submitted
2025-06-12 13:25:04,530 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:25:04,531 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:25:04,532 - __main__ - INFO -    Order ID: b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:04,532 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:04,533 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:25:04,534 - __main__ - INFO -    Quantity: -32
2025-06-12 13:25:04,534 - __main__ - INFO -    Limit Price: $311.30
2025-06-12 13:25:04,535 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:04,535 - __main__ - INFO -    Order ID: b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:04,536 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:25:04,536 - __main__ - INFO -    Previous: created
2025-06-12 13:25:04,537 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:04,537 - __main__ - INFO -    Order ID: b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:04,537 - __main__ - INFO -    Status: submitted
2025-06-12 13:25:04,538 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:25:04,590 - src.tws_connection - INFO - Open Order - ID: 2143, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:25:04,591 - src.order.base - INFO - Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:25:04,595 - src.order.base - INFO - Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe status changed: accepted -> filled (Order fully filled)
2025-06-12 13:25:04,595 - src.order.base - INFO - Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe filled: 32.0 @ 311.24 (32.0/32)
2025-06-12 13:25:04,596 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:25:04,596 - src.tws_connection - INFO - Open Order - ID: 2143, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:25:04,597 - __main__ - INFO -    Order ID: 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,597 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:04,598 - __main__ - INFO -    Fill Price: $311.24
2025-06-12 13:25:04,598 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:25:04,598 - src.tws_connection - INFO - Open Order - ID: 2143, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:25:04,598 - __main__ - INFO -    Status: filled
2025-06-12 13:25:04,599 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:25:04,600 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:04,600 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:25:04,600 - UnifiedFillManager - INFO - Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe fill status: filled, is_fully_filled: True
2025-06-12 13:25:04,601 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 13:25:04,601 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:25:04,601 - UnifiedFillManager - INFO -   Main orders: {'8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe'}
2025-06-12 13:25:04,602 - UnifiedFillManager - INFO -   Stop orders: {'50a25321-a16c-4641-8660-1588cb26d741'}
2025-06-12 13:25:04,602 - src.tws_connection - INFO - Open Order - ID: 2144, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:25:04,602 - UnifiedFillManager - INFO -   Target orders: {'b78cf2f5-b220-409a-9c24-c77b51d62004'}
2025-06-12 13:25:04,603 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:25:04,603 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 13:25:04,603 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 13:25:04,603 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:25:04,603 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:25:04,604 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:25:04,604 - UnifiedFillManager - INFO - Stop order 50a25321-a16c-4641-8660-1588cb26d741 already has correct quantity -32, no update needed
2025-06-12 13:25:04,604 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:25:04,605 - UnifiedFillManager - INFO - Target order b78cf2f5-b220-409a-9c24-c77b51d62004 already has correct quantity -32, no update needed
2025-06-12 13:25:04,605 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 13:25:04,606 - src.order.base - INFO - Order 50a25321-a16c-4641-8660-1588cb26d741 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:25:04,640 - src.tws_connection - INFO - Open Order - ID: 2145, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:25:05,024 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['50a25321-a16c-4641-8660-1588cb26d741']
2025-06-12 13:25:05,025 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 13:25:05,026 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.22
2025-06-12 13:25:05,046 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0825
2025-06-12 13:25:05,046 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.22, stop_distance=$0.08, dd_distance=$0.04, dd_price=$311.18, original_qty=32, dd_qty=32
2025-06-12 13:25:05,047 - src.order.base - INFO - Order 0afaf069-357f-4213-a879-3d6ffdbd88b2 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:25:05,047 - src.order.manager - INFO - Submitting order 0afaf069-357f-4213-a879-3d6ffdbd88b2 to TWS
2025-06-12 13:25:05,047 - src.order.manager - INFO - Got broker order ID 2146 for order 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:05,047 - src.order.manager - INFO - Calling placeOrder with ID 2146, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.180000 DAY
2025-06-12 13:25:05,048 - src.order.manager - INFO - placeOrder called successfully for order 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:05,048 - src.order.base - INFO - Order 0afaf069-357f-4213-a879-3d6ffdbd88b2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:25:05,048 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 13:25:05,048 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.18
2025-06-12 13:25:05,049 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 13:25:05,049 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe for GLD
2025-06-12 13:25:05,049 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:25:05,049 - __main__ - INFO -    Order ID: 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:05,049 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:05,049 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:25:05,050 - __main__ - INFO -    Quantity: 32
2025-06-12 13:25:05,050 - __main__ - INFO -    Limit Price: $311.18
2025-06-12 13:25:05,050 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:05,050 - __main__ - INFO -    Order ID: 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:05,050 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:25:05,051 - __main__ - INFO -    Previous: created
2025-06-12 13:25:05,051 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:25:05,051 - __main__ - INFO -    Order ID: 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:05,051 - __main__ - INFO -    Status: submitted
2025-06-12 13:25:05,051 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:25:05,142 - src.tws_connection - INFO - Open Order - ID: 2146, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:25:06,483 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:25:11,493 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:11,493 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:25:11,493 - __main__ - INFO - ================================================================================
2025-06-12 13:25:11,494 - __main__ - WARNING - No GLD context found!
2025-06-12 13:25:11,494 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:25:11,494 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:25:11,494 - __main__ - INFO -    Market orders: 1
2025-06-12 13:25:11,494 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:25:11,495 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:25:11,495 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:25:11,495 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:25:11,495 - __main__ - INFO - 
   Order #1:
2025-06-12 13:25:11,496 - __main__ - INFO -      ID: 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:11,496 - __main__ - INFO -      Type: market
2025-06-12 13:25:11,496 - __main__ - INFO -      Quantity: 32
2025-06-12 13:25:11,496 - __main__ - INFO - 
   Order #2:
2025-06-12 13:25:11,496 - __main__ - INFO -      ID: 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:11,496 - __main__ - INFO -      Type: stop
2025-06-12 13:25:11,496 - __main__ - INFO -      Quantity: -32
2025-06-12 13:25:11,496 - __main__ - INFO -      Stop: $311.14
2025-06-12 13:25:11,496 - __main__ - INFO - 
   Order #3:
2025-06-12 13:25:11,497 - __main__ - INFO -      ID: b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:11,497 - __main__ - INFO -      Type: limit
2025-06-12 13:25:11,497 - __main__ - INFO -      Quantity: -32
2025-06-12 13:25:11,497 - __main__ - INFO -      Limit: $311.30
2025-06-12 13:25:11,497 - __main__ - INFO - 
   Order #4:
2025-06-12 13:25:11,498 - __main__ - INFO -      ID: 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:11,498 - __main__ - INFO -      Type: limit
2025-06-12 13:25:11,498 - __main__ - INFO -      Quantity: 32
2025-06-12 13:25:11,498 - __main__ - INFO -      Limit: $311.18
2025-06-12 13:25:11,498 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:25:11,499 - __main__ - INFO -    Total fills received: 1
2025-06-12 13:25:11,499 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:25:11,499 - __main__ - INFO -      Order ID: 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:11,499 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:25:11,499 - __main__ - INFO -      Price: $311.24
2025-06-12 13:25:11,499 - __main__ - INFO -      Status: filled
2025-06-12 13:25:11,500 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:25:34,222 - src.order.base - INFO - Order b78cf2f5-b220-409a-9c24-c77b51d62004 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:25:34,221 - src.tws_connection - INFO - Open Order - ID: 2145, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:25:34,223 - src.order.base - INFO - Order b78cf2f5-b220-409a-9c24-c77b51d62004 filled: 32.0 @ 311.3 (32.0/32)
2025-06-12 13:25:34,224 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:25:34,225 - __main__ - INFO -    Order ID: b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:34,225 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:34,225 - __main__ - INFO -    Fill Price: $311.30
2025-06-12 13:25:34,226 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:25:34,226 - __main__ - INFO -    Status: filled
2025-06-12 13:25:34,226 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:25:34,226 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:34,226 - UnifiedFillManager - INFO - Fill is for target order
2025-06-12 13:25:34,227 - UnifiedFillManager - INFO - Order b78cf2f5-b220-409a-9c24-c77b51d62004 fill status: filled, is_fully_filled: True
2025-06-12 13:25:34,227 - UnifiedFillManager - INFO - Closing position for GLD: Target order fully filled
2025-06-12 13:25:34,228 - src.position.position_manager - INFO - Closed position for GLD
2025-06-12 13:25:34,228 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-12 13:25:34,228 - UnifiedFillManager - INFO - Position closed for GLD: cancellation queued, trackers updated
2025-06-12 13:25:34,229 - UnifiedFillManager - INFO - Processing operation for GLD: cancel_all
2025-06-12 13:25:34,229 - src.order.base - INFO - Order 0afaf069-357f-4213-a879-3d6ffdbd88b2 status changed: submitted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 13:25:34,229 - src.order.manager - INFO - Cancelling order 0afaf069-357f-4213-a879-3d6ffdbd88b2 with broker ID 2146
2025-06-12 13:25:34,230 - src.order.base - INFO - Order 50a25321-a16c-4641-8660-1588cb26d741 status changed: accepted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 13:25:34,230 - src.order.manager - INFO - Cancelling order 50a25321-a16c-4641-8660-1588cb26d741 with broker ID 2144
2025-06-12 13:25:34,230 - UnifiedFillManager - INFO - Cancelled 2 orders for GLD
2025-06-12 13:25:34,230 - UnifiedFillManager - INFO - Completed operation for GLD: cancel_all
2025-06-12 13:25:34,261 - src.tws_connection - INFO - Open Order - ID: 2145, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:25:34,286 - src.order.base - INFO - Order 0afaf069-357f-4213-a879-3d6ffdbd88b2 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:25:34,286 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2146)
2025-06-12 13:25:34,365 - src.order.base - INFO - Order 50a25321-a16c-4641-8660-1588cb26d741 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:25:34,365 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2144)
2025-06-12 13:25:41,509 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:41,510 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:25:41,510 - __main__ - INFO - ================================================================================
2025-06-12 13:25:41,510 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:25:41,510 - __main__ - INFO - 
Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe:
2025-06-12 13:25:41,510 - __main__ - INFO -   Type: market
2025-06-12 13:25:41,511 - __main__ - INFO -   Status: filled
2025-06-12 13:25:41,511 - __main__ - INFO -   Quantity: 32
2025-06-12 13:25:41,511 - __main__ - INFO -   Broker ID: 2143
2025-06-12 13:25:41,511 - __main__ - INFO - 
Order 50a25321-a16c-4641-8660-1588cb26d741:
2025-06-12 13:25:41,511 - __main__ - INFO -   Type: stop
2025-06-12 13:25:41,511 - __main__ - INFO -   Status: cancelled
2025-06-12 13:25:41,511 - __main__ - INFO -   Quantity: -32
2025-06-12 13:25:41,512 - __main__ - INFO -   Broker ID: 2144
2025-06-12 13:25:41,512 - __main__ - INFO - 
Order b78cf2f5-b220-409a-9c24-c77b51d62004:
2025-06-12 13:25:41,512 - __main__ - INFO -   Type: limit
2025-06-12 13:25:41,513 - __main__ - INFO -   Status: filled
2025-06-12 13:25:41,513 - __main__ - INFO -   Quantity: -32
2025-06-12 13:25:41,513 - __main__ - INFO -   Broker ID: 2145
2025-06-12 13:25:41,513 - __main__ - INFO - 
Order 0afaf069-357f-4213-a879-3d6ffdbd88b2:
2025-06-12 13:25:41,513 - __main__ - INFO -   Type: limit
2025-06-12 13:25:41,513 - __main__ - INFO -   Status: cancelled
2025-06-12 13:25:41,513 - __main__ - INFO -   Quantity: 32
2025-06-12 13:25:41,514 - __main__ - INFO -   Broker ID: 2146
2025-06-12 13:25:41,514 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:41,514 - __main__ - INFO - DOUBLE DOWN FILL SIMULATION
2025-06-12 13:25:41,514 - __main__ - INFO - ================================================================================
2025-06-12 13:25:41,514 - __main__ - INFO - 
Would you like to simulate a double down fill to test protective order updates?
2025-06-12 13:25:41,514 - __main__ - INFO - This will emit a fill event for the double down order to test if UnifiedFillManager
2025-06-12 13:25:41,514 - __main__ - INFO - properly updates the stop and take profit quantities to match the new position size.
2025-06-12 13:25:41,514 - __main__ - INFO - 
Automatically simulating double down fill for testing...
2025-06-12 13:25:41,515 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:41,515 - __main__ - INFO - SIMULATING DOUBLE DOWN FILL TO TEST PROTECTIVE ORDER UPDATES
2025-06-12 13:25:41,515 - __main__ - INFO - ================================================================================
2025-06-12 13:25:41,515 - __main__ - INFO - Simulating double down fill on order: 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:41,516 - __main__ - INFO - Double down order details: 32 shares @ $311.18
2025-06-12 13:25:41,516 - __main__ - INFO - Emitting double down fill event: 32 shares at $311.18
2025-06-12 13:25:41,516 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:25:41,517 - __main__ - INFO -    Order ID: 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:41,518 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:25:41,518 - __main__ - INFO -    Fill Price: $311.18
2025-06-12 13:25:41,518 - __main__ - INFO -    Fill Quantity: 32
2025-06-12 13:25:41,518 - __main__ - INFO -    Status: filled
2025-06-12 13:25:41,518 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Processing fill for GLD: 32 shares on order 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Order 0afaf069-357f-4213-a879-3d6ffdbd88b2 fill status: filled, is_fully_filled: True
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 64.0
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=64.0, protective_qty=-64.0
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Stop order 50a25321-a16c-4641-8660-1588cb26d741 not active, skipping update
2025-06-12 13:25:41,519 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:25:41,520 - UnifiedFillManager - INFO - Target order b78cf2f5-b220-409a-9c24-c77b51d62004 not active, skipping update
2025-06-12 13:25:44,519 - __main__ - INFO - UnifiedFillManager should have updated protective orders to new position size (606 shares)
2025-06-12 13:25:44,520 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the double down fill...
2025-06-12 13:25:49,533 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:49,534 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:25:49,534 - __main__ - INFO - ================================================================================
2025-06-12 13:25:49,534 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:25:49,534 - __main__ - INFO - 
Order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe:
2025-06-12 13:25:49,535 - __main__ - INFO -   Type: market
2025-06-12 13:25:49,535 - __main__ - INFO -   Status: filled
2025-06-12 13:25:49,535 - __main__ - INFO -   Quantity: 32
2025-06-12 13:25:49,535 - __main__ - INFO -   Broker ID: 2143
2025-06-12 13:25:49,535 - __main__ - INFO - 
Order 50a25321-a16c-4641-8660-1588cb26d741:
2025-06-12 13:25:49,535 - __main__ - INFO -   Type: stop
2025-06-12 13:25:49,536 - __main__ - INFO -   Status: cancelled
2025-06-12 13:25:49,536 - __main__ - INFO -   Quantity: -32
2025-06-12 13:25:49,536 - __main__ - INFO -   Broker ID: 2144
2025-06-12 13:25:49,536 - __main__ - INFO - 
Order b78cf2f5-b220-409a-9c24-c77b51d62004:
2025-06-12 13:25:49,536 - __main__ - INFO -   Type: limit
2025-06-12 13:25:49,536 - __main__ - INFO -   Status: filled
2025-06-12 13:25:49,536 - __main__ - INFO -   Quantity: -32
2025-06-12 13:25:49,536 - __main__ - INFO -   Broker ID: 2145
2025-06-12 13:25:49,537 - __main__ - INFO - 
Order 0afaf069-357f-4213-a879-3d6ffdbd88b2:
2025-06-12 13:25:49,537 - __main__ - INFO -   Type: limit
2025-06-12 13:25:49,537 - __main__ - INFO -   Status: cancelled
2025-06-12 13:25:49,537 - __main__ - INFO -   Quantity: 32
2025-06-12 13:25:49,537 - __main__ - INFO -   Broker ID: 2146
2025-06-12 13:25:49,537 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:49,537 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:25:49,538 - __main__ - INFO - ================================================================================
2025-06-12 13:25:49,538 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:25:49,538 - src.order.manager - WARNING - Cannot cancel inactive order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe with status filled
2025-06-12 13:25:49,538 - __main__ - INFO -    Cancelled order 8928ddcd-d918-4b26-a7cf-e1dd5aa46dbe
2025-06-12 13:25:49,538 - src.order.manager - WARNING - Cannot cancel inactive order 50a25321-a16c-4641-8660-1588cb26d741 with status cancelled
2025-06-12 13:25:49,538 - __main__ - INFO -    Cancelled order 50a25321-a16c-4641-8660-1588cb26d741
2025-06-12 13:25:49,538 - src.order.manager - WARNING - Cannot cancel inactive order b78cf2f5-b220-409a-9c24-c77b51d62004 with status filled
2025-06-12 13:25:49,539 - __main__ - INFO -    Cancelled order b78cf2f5-b220-409a-9c24-c77b51d62004
2025-06-12 13:25:49,539 - src.order.manager - WARNING - Cannot cancel inactive order 0afaf069-357f-4213-a879-3d6ffdbd88b2 with status cancelled
2025-06-12 13:25:49,540 - __main__ - INFO -    Cancelled order 0afaf069-357f-4213-a879-3d6ffdbd88b2
2025-06-12 13:25:49,540 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 13:25:49,540 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:25:49,540 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:25:49,541 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:25:49,541 - __main__ - INFO - Rule engine stopped
2025-06-12 13:25:49,541 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:25:49,541 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:25:49,541 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:25:49,542 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:25:49,542 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:25:49,542 - __main__ - INFO - 
================================================================================
2025-06-12 13:25:49,542 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:25:49,542 - __main__ - INFO - ================================================================================
2025-06-12 13:26:33,867 - __main__ - INFO - ================================================================================
2025-06-12 13:26:33,867 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:26:33,867 - __main__ - INFO - ================================================================================
2025-06-12 13:26:33,867 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:26:33,868 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:26:33,868 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:26:33,869 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:26:33,869 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:26:33,870 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:26:35,640 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:26:35,640 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:26:35,658 - src.tws_connection - INFO - ✅ Next valid order ID received: 2147
2025-06-12 13:26:35,658 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:26:35,659 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:26:35,659 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:26:35,660 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:26:35,660 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:26:35,660 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:26:35,660 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:26:35,661 - __main__ - INFO - Rule engine context configured
2025-06-12 13:26:35,661 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:26:35,662 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:26:35,662 - __main__ - INFO - 
================================================================================
2025-06-12 13:26:35,662 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 13:26:35,663 - __main__ - INFO - ================================================================================
2025-06-12 13:26:35,663 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:26:35,663 - __main__ - INFO - Created BUY action ($10K allocation, 3.5x ATR stop, 3.5x ATR target)
2025-06-12 13:26:35,663 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 13:26:35,664 - __main__ - INFO - 
================================================================================
2025-06-12 13:26:35,664 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 13:26:35,664 - __main__ - INFO - ================================================================================
2025-06-12 13:26:35,744 - src.tws_connection - INFO - ✅ Next valid order ID received: 2147
2025-06-12 13:26:35,841 - src.tws_connection - INFO - ✅ Next valid order ID received: 2147
2025-06-12 13:26:40,668 - __main__ - INFO - Current GLD price: $311.37
2025-06-12 13:26:40,668 - __main__ - INFO - Created prediction event:
2025-06-12 13:26:40,669 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:40,669 - __main__ - INFO -    Signal: BUY
2025-06-12 13:26:40,670 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:26:40,670 - __main__ - INFO -    Price: $311.37
2025-06-12 13:26:40,670 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:26:40,670 - __main__ - INFO - Rule engine started
2025-06-12 13:26:40,670 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:26:40,670 - __main__ - INFO - Prediction event emitted
2025-06-12 13:26:40,670 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:26:40,671 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:26:40,671 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:26:40,671 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 13:26:40,671 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 13:26:41,685 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.39 = $9964.48 (99.6% of $10000.00 allocation)
2025-06-12 13:26:41,685 - src.order.base - INFO - Order 0d038064-c381-4765-8d97-7b94d10ca004 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:26:41,686 - src.order.manager - INFO - Submitting order 0d038064-c381-4765-8d97-7b94d10ca004 to TWS
2025-06-12 13:26:41,686 - src.order.manager - INFO - Got broker order ID 2147 for order 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,686 - src.order.manager - INFO - Calling placeOrder with ID 2147, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 13:26:41,687 - src.order.manager - INFO - placeOrder called successfully for order 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,687 - src.order.base - INFO - Order 0d038064-c381-4765-8d97-7b94d10ca004 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:26:41,687 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 13:26:41,708 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 13:26:41,708 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.29 (ATR: 0.0236 * 3.5 = 0.0825)
2025-06-12 13:26:41,709 - src.order.base - INFO - Order c6a466b0-f16b-4b44-80fa-6047ad042272 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:26:41,709 - src.order.manager - INFO - Submitting order c6a466b0-f16b-4b44-80fa-6047ad042272 to TWS
2025-06-12 13:26:41,709 - src.order.manager - INFO - Got broker order ID 2148 for order c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:26:41,709 - src.order.manager - INFO - Calling placeOrder with ID 2148, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 13:26:41,710 - src.order.manager - INFO - placeOrder called successfully for order c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:26:41,710 - src.order.base - INFO - Order c6a466b0-f16b-4b44-80fa-6047ad042272 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:26:41,711 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:26:41,711 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss c6a466b0-f16b-4b44-80fa-6047ad042272 at $311.29
2025-06-12 13:26:41,711 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.45 (ATR: 0.0236 * 3.5 = 0.0825)
2025-06-12 13:26:41,711 - src.order.base - INFO - Order 1646df73-2a91-4db6-acdf-e9666ebeb320 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:26:41,711 - src.order.manager - INFO - Submitting order 1646df73-2a91-4db6-acdf-e9666ebeb320 to TWS
2025-06-12 13:26:41,712 - src.order.manager - INFO - Got broker order ID 2149 for order 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:41,712 - src.order.manager - INFO - Calling placeOrder with ID 2149, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.450000 DAY
2025-06-12 13:26:41,712 - src.order.manager - INFO - placeOrder called successfully for order 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:41,712 - src.order.base - INFO - Order 1646df73-2a91-4db6-acdf-e9666ebeb320 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:26:41,713 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:26:41,713 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 1646df73-2a91-4db6-acdf-e9666ebeb320 at $311.45
2025-06-12 13:26:41,713 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 13:26:41,713 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:26:41,713 - __main__ - INFO -    Order ID: 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,713 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:41,714 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:26:41,714 - __main__ - INFO -    Quantity: 32
2025-06-12 13:26:41,714 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:41,714 - __main__ - INFO -    Order ID: 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,714 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:26:41,714 - __main__ - INFO -    Previous: created
2025-06-12 13:26:41,714 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:41,715 - __main__ - INFO -    Order ID: 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,715 - __main__ - INFO -    Status: submitted
2025-06-12 13:26:41,715 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:26:41,715 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:26:41,715 - __main__ - INFO -    Order ID: c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:26:41,715 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:41,715 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:26:41,715 - __main__ - INFO -    Quantity: -32
2025-06-12 13:26:41,716 - __main__ - INFO -    Stop Price: $311.29
2025-06-12 13:26:41,716 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:41,716 - __main__ - INFO -    Order ID: c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:26:41,716 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:26:41,716 - __main__ - INFO -    Previous: created
2025-06-12 13:26:41,716 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:41,716 - __main__ - INFO -    Order ID: c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:26:41,716 - __main__ - INFO -    Status: submitted
2025-06-12 13:26:41,716 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:26:41,716 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:26:41,717 - __main__ - INFO -    Order ID: 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:41,717 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:41,717 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:26:41,717 - __main__ - INFO -    Quantity: -32
2025-06-12 13:26:41,717 - __main__ - INFO -    Limit Price: $311.45
2025-06-12 13:26:41,717 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:41,717 - __main__ - INFO -    Order ID: 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:41,717 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:26:41,717 - __main__ - INFO -    Previous: created
2025-06-12 13:26:41,718 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:41,718 - __main__ - INFO -    Order ID: 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:41,718 - __main__ - INFO -    Status: submitted
2025-06-12 13:26:41,718 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:26:41,783 - src.tws_connection - INFO - Open Order - ID: 2147, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:26:41,785 - src.order.base - INFO - Order 0d038064-c381-4765-8d97-7b94d10ca004 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:26:41,796 - src.order.base - INFO - Order 0d038064-c381-4765-8d97-7b94d10ca004 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:26:41,796 - src.tws_connection - INFO - Open Order - ID: 2147, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:26:41,797 - src.order.base - INFO - Order 0d038064-c381-4765-8d97-7b94d10ca004 filled: 32.0 @ 311.39 (32.0/32)
2025-06-12 13:26:41,798 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:26:41,797 - src.tws_connection - INFO - Open Order - ID: 2147, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:26:41,799 - __main__ - INFO -    Order ID: 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,800 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:41,801 - __main__ - INFO -    Fill Price: $311.39
2025-06-12 13:26:41,801 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:26:41,802 - __main__ - INFO -    Status: filled
2025-06-12 13:26:41,802 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:26:41,802 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:41,803 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:26:41,803 - UnifiedFillManager - INFO - Order 0d038064-c381-4765-8d97-7b94d10ca004 fill status: filled, is_fully_filled: True
2025-06-12 13:26:41,803 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 13:26:41,803 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:26:41,803 - UnifiedFillManager - INFO -   Main orders: {'0d038064-c381-4765-8d97-7b94d10ca004'}
2025-06-12 13:26:41,804 - UnifiedFillManager - INFO -   Stop orders: {'c6a466b0-f16b-4b44-80fa-6047ad042272'}
2025-06-12 13:26:41,804 - UnifiedFillManager - INFO -   Target orders: {'1646df73-2a91-4db6-acdf-e9666ebeb320'}
2025-06-12 13:26:41,804 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:26:41,804 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 13:26:41,805 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 13:26:41,805 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:26:41,805 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:26:41,805 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:26:41,806 - UnifiedFillManager - INFO - Stop order c6a466b0-f16b-4b44-80fa-6047ad042272 already has correct quantity -32, no update needed
2025-06-12 13:26:41,806 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:26:41,807 - UnifiedFillManager - INFO - Target order 1646df73-2a91-4db6-acdf-e9666ebeb320 already has correct quantity -32, no update needed
2025-06-12 13:26:41,808 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 13:26:41,832 - src.tws_connection - INFO - Open Order - ID: 2148, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:26:41,833 - src.order.base - INFO - Order c6a466b0-f16b-4b44-80fa-6047ad042272 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:26:41,834 - src.tws_connection - INFO - Open Order - ID: 2149, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:26:42,223 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['c6a466b0-f16b-4b44-80fa-6047ad042272']
2025-06-12 13:26:42,224 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 13:26:42,224 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.37
2025-06-12 13:26:42,243 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0825
2025-06-12 13:26:42,244 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.37, stop_distance=$0.08, dd_distance=$0.04, dd_price=$311.33, original_qty=32, dd_qty=32
2025-06-12 13:26:42,244 - src.order.base - INFO - Order 392aefb7-a044-46f5-8c42-77fd15d1bc02 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:26:42,244 - src.order.manager - INFO - Submitting order 392aefb7-a044-46f5-8c42-77fd15d1bc02 to TWS
2025-06-12 13:26:42,245 - src.order.manager - INFO - Got broker order ID 2150 for order 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:26:42,245 - src.order.manager - INFO - Calling placeOrder with ID 2150, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.330000 DAY
2025-06-12 13:26:42,245 - src.order.manager - INFO - placeOrder called successfully for order 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:26:42,246 - src.order.base - INFO - Order 392aefb7-a044-46f5-8c42-77fd15d1bc02 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:26:42,246 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 13:26:42,246 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.33
2025-06-12 13:26:42,247 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 13:26:42,247 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 0d038064-c381-4765-8d97-7b94d10ca004 for GLD
2025-06-12 13:26:42,247 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:26:42,247 - __main__ - INFO -    Order ID: 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:26:42,248 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:42,248 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:26:42,248 - __main__ - INFO -    Quantity: 32
2025-06-12 13:26:42,248 - __main__ - INFO -    Limit Price: $311.33
2025-06-12 13:26:42,248 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:42,249 - __main__ - INFO -    Order ID: 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:26:42,249 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:26:42,249 - __main__ - INFO -    Previous: created
2025-06-12 13:26:42,249 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:26:42,250 - __main__ - INFO -    Order ID: 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:26:42,250 - __main__ - INFO -    Status: submitted
2025-06-12 13:26:42,250 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:26:42,334 - src.tws_connection - INFO - Open Order - ID: 2150, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:26:43,679 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:26:48,687 - __main__ - INFO - 
================================================================================
2025-06-12 13:26:48,687 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:26:48,687 - __main__ - INFO - ================================================================================
2025-06-12 13:26:48,688 - __main__ - WARNING - No GLD context found!
2025-06-12 13:26:48,688 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:26:48,688 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:26:48,688 - __main__ - INFO -    Market orders: 1
2025-06-12 13:26:48,688 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:26:48,688 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:26:48,688 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:26:48,688 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:26:48,689 - __main__ - INFO - 
   Order #1:
2025-06-12 13:26:48,689 - __main__ - INFO -      ID: 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:48,690 - __main__ - INFO -      Type: market
2025-06-12 13:26:48,690 - __main__ - INFO -      Quantity: 32
2025-06-12 13:26:48,690 - __main__ - INFO - 
   Order #2:
2025-06-12 13:26:48,691 - __main__ - INFO -      ID: c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:26:48,691 - __main__ - INFO -      Type: stop
2025-06-12 13:26:48,692 - __main__ - INFO -      Quantity: -32
2025-06-12 13:26:48,692 - __main__ - INFO -      Stop: $311.29
2025-06-12 13:26:48,692 - __main__ - INFO - 
   Order #3:
2025-06-12 13:26:48,692 - __main__ - INFO -      ID: 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:48,693 - __main__ - INFO -      Type: limit
2025-06-12 13:26:48,693 - __main__ - INFO -      Quantity: -32
2025-06-12 13:26:48,693 - __main__ - INFO -      Limit: $311.45
2025-06-12 13:26:48,693 - __main__ - INFO - 
   Order #4:
2025-06-12 13:26:48,693 - __main__ - INFO -      ID: 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:26:48,694 - __main__ - INFO -      Type: limit
2025-06-12 13:26:48,694 - __main__ - INFO -      Quantity: 32
2025-06-12 13:26:48,694 - __main__ - INFO -      Limit: $311.33
2025-06-12 13:26:48,694 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:26:48,694 - __main__ - INFO -    Total fills received: 1
2025-06-12 13:26:48,694 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:26:48,694 - __main__ - INFO -      Order ID: 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:26:48,694 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:26:48,695 - __main__ - INFO -      Price: $311.39
2025-06-12 13:26:48,695 - __main__ - INFO -      Status: filled
2025-06-12 13:26:48,695 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:26:53,131 - src.order.base - INFO - Order 1646df73-2a91-4db6-acdf-e9666ebeb320 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:26:53,131 - src.tws_connection - INFO - Open Order - ID: 2149, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:26:53,132 - src.order.base - INFO - Order 1646df73-2a91-4db6-acdf-e9666ebeb320 filled: 32.0 @ 311.45 (32.0/32)
2025-06-12 13:26:53,132 - src.tws_connection - INFO - Open Order - ID: 2149, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:26:53,133 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:26:53,133 - __main__ - INFO -    Order ID: 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:53,134 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:26:53,134 - __main__ - INFO -    Fill Price: $311.45
2025-06-12 13:26:53,134 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:26:53,134 - __main__ - INFO -    Status: filled
2025-06-12 13:26:53,134 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:26:53,135 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:26:53,135 - UnifiedFillManager - INFO - Fill is for target order
2025-06-12 13:26:53,135 - UnifiedFillManager - INFO - Order 1646df73-2a91-4db6-acdf-e9666ebeb320 fill status: filled, is_fully_filled: True
2025-06-12 13:26:53,135 - UnifiedFillManager - INFO - Closing position for GLD: Target order fully filled
2025-06-12 13:26:53,135 - src.position.position_manager - INFO - Closed position for GLD
2025-06-12 13:26:53,136 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-12 13:26:53,136 - UnifiedFillManager - INFO - Position closed for GLD: cancellation queued, trackers updated
2025-06-12 13:26:53,136 - UnifiedFillManager - INFO - Processing operation for GLD: cancel_all
2025-06-12 13:26:53,136 - src.order.base - INFO - Order c6a466b0-f16b-4b44-80fa-6047ad042272 status changed: accepted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 13:26:53,136 - src.order.manager - INFO - Cancelling order c6a466b0-f16b-4b44-80fa-6047ad042272 with broker ID 2148
2025-06-12 13:26:53,137 - src.order.base - INFO - Order 392aefb7-a044-46f5-8c42-77fd15d1bc02 status changed: submitted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 13:26:53,138 - src.order.manager - INFO - Cancelling order 392aefb7-a044-46f5-8c42-77fd15d1bc02 with broker ID 2150
2025-06-12 13:26:53,138 - UnifiedFillManager - INFO - Cancelled 2 orders for GLD
2025-06-12 13:26:53,138 - UnifiedFillManager - INFO - Completed operation for GLD: cancel_all
2025-06-12 13:26:53,168 - src.order.base - INFO - Order c6a466b0-f16b-4b44-80fa-6047ad042272 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:26:53,167 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2148)
2025-06-12 13:26:53,286 - src.order.base - INFO - Order 392aefb7-a044-46f5-8c42-77fd15d1bc02 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:26:53,285 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2150)
2025-06-12 13:27:18,700 - __main__ - INFO - 
================================================================================
2025-06-12 13:27:18,700 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:27:18,701 - __main__ - INFO - ================================================================================
2025-06-12 13:27:18,701 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:27:18,701 - __main__ - INFO - 
Order 0d038064-c381-4765-8d97-7b94d10ca004:
2025-06-12 13:27:18,701 - __main__ - INFO -   Type: market
2025-06-12 13:27:18,701 - __main__ - INFO -   Status: filled
2025-06-12 13:27:18,702 - __main__ - INFO -   Quantity: 32
2025-06-12 13:27:18,702 - __main__ - INFO -   Broker ID: 2147
2025-06-12 13:27:18,702 - __main__ - INFO - 
Order c6a466b0-f16b-4b44-80fa-6047ad042272:
2025-06-12 13:27:18,702 - __main__ - INFO -   Type: stop
2025-06-12 13:27:18,703 - __main__ - INFO -   Status: cancelled
2025-06-12 13:27:18,703 - __main__ - INFO -   Quantity: -32
2025-06-12 13:27:18,703 - __main__ - INFO -   Broker ID: 2148
2025-06-12 13:27:18,703 - __main__ - INFO - 
Order 1646df73-2a91-4db6-acdf-e9666ebeb320:
2025-06-12 13:27:18,703 - __main__ - INFO -   Type: limit
2025-06-12 13:27:18,704 - __main__ - INFO -   Status: filled
2025-06-12 13:27:18,704 - __main__ - INFO -   Quantity: -32
2025-06-12 13:27:18,704 - __main__ - INFO -   Broker ID: 2149
2025-06-12 13:27:18,704 - __main__ - INFO - 
Order 392aefb7-a044-46f5-8c42-77fd15d1bc02:
2025-06-12 13:27:18,704 - __main__ - INFO -   Type: limit
2025-06-12 13:27:18,705 - __main__ - INFO -   Status: cancelled
2025-06-12 13:27:18,705 - __main__ - INFO -   Quantity: 32
2025-06-12 13:27:18,705 - __main__ - INFO -   Broker ID: 2150
2025-06-12 13:27:18,705 - __main__ - INFO - 
================================================================================
2025-06-12 13:27:18,706 - __main__ - INFO - DOUBLE DOWN FILL SIMULATION
2025-06-12 13:27:18,706 - __main__ - INFO - ================================================================================
2025-06-12 13:27:18,707 - __main__ - INFO - 
Would you like to simulate a double down fill to test protective order updates?
2025-06-12 13:27:18,707 - __main__ - INFO - This will emit a fill event for the double down order to test if UnifiedFillManager
2025-06-12 13:27:18,707 - __main__ - INFO - properly updates the stop and take profit quantities to match the new position size.
2025-06-12 13:27:18,707 - __main__ - INFO - 
Automatically simulating double down fill for testing...
2025-06-12 13:27:18,708 - __main__ - INFO - 
================================================================================
2025-06-12 13:27:18,708 - __main__ - INFO - SIMULATING DOUBLE DOWN FILL TO TEST PROTECTIVE ORDER UPDATES
2025-06-12 13:27:18,708 - __main__ - INFO - ================================================================================
2025-06-12 13:27:18,708 - __main__ - INFO - Simulating double down fill on order: 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:27:18,708 - __main__ - INFO - Double down order details: 32 shares @ $311.33
2025-06-12 13:27:18,708 - __main__ - INFO - Emitting double down fill event: 32 shares at $311.33
2025-06-12 13:27:18,708 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:27:18,709 - __main__ - INFO -    Order ID: 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:27:18,709 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:27:18,709 - __main__ - INFO -    Fill Price: $311.33
2025-06-12 13:27:18,709 - __main__ - INFO -    Fill Quantity: 32
2025-06-12 13:27:18,709 - __main__ - INFO -    Status: filled
2025-06-12 13:27:18,709 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:27:18,709 - UnifiedFillManager - INFO - Processing fill for GLD: 32 shares on order 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:27:18,709 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:27:18,709 - UnifiedFillManager - INFO - Order 392aefb7-a044-46f5-8c42-77fd15d1bc02 fill status: filled, is_fully_filled: True
2025-06-12 13:27:18,709 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 64.0
2025-06-12 13:27:18,709 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=64.0, protective_qty=-64.0
2025-06-12 13:27:18,710 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:27:18,710 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:27:18,710 - UnifiedFillManager - INFO - Stop order c6a466b0-f16b-4b44-80fa-6047ad042272 not active, skipping update
2025-06-12 13:27:18,710 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:27:18,710 - UnifiedFillManager - INFO - Target order 1646df73-2a91-4db6-acdf-e9666ebeb320 not active, skipping update
2025-06-12 13:27:21,718 - __main__ - INFO - UnifiedFillManager should have updated protective orders to new position size (606 shares)
2025-06-12 13:27:21,718 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the double down fill...
2025-06-12 13:27:26,723 - __main__ - INFO - 
================================================================================
2025-06-12 13:27:26,724 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:27:26,725 - __main__ - INFO - ================================================================================
2025-06-12 13:27:26,725 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:27:26,725 - __main__ - INFO - 
Order 0d038064-c381-4765-8d97-7b94d10ca004:
2025-06-12 13:27:26,726 - __main__ - INFO -   Type: market
2025-06-12 13:27:26,726 - __main__ - INFO -   Status: filled
2025-06-12 13:27:26,726 - __main__ - INFO -   Quantity: 32
2025-06-12 13:27:26,726 - __main__ - INFO -   Broker ID: 2147
2025-06-12 13:27:26,726 - __main__ - INFO - 
Order c6a466b0-f16b-4b44-80fa-6047ad042272:
2025-06-12 13:27:26,727 - __main__ - INFO -   Type: stop
2025-06-12 13:27:26,727 - __main__ - INFO -   Status: cancelled
2025-06-12 13:27:26,727 - __main__ - INFO -   Quantity: -32
2025-06-12 13:27:26,727 - __main__ - INFO -   Broker ID: 2148
2025-06-12 13:27:26,728 - __main__ - INFO - 
Order 1646df73-2a91-4db6-acdf-e9666ebeb320:
2025-06-12 13:27:26,728 - __main__ - INFO -   Type: limit
2025-06-12 13:27:26,728 - __main__ - INFO -   Status: filled
2025-06-12 13:27:26,728 - __main__ - INFO -   Quantity: -32
2025-06-12 13:27:26,728 - __main__ - INFO -   Broker ID: 2149
2025-06-12 13:27:26,728 - __main__ - INFO - 
Order 392aefb7-a044-46f5-8c42-77fd15d1bc02:
2025-06-12 13:27:26,728 - __main__ - INFO -   Type: limit
2025-06-12 13:27:26,729 - __main__ - INFO -   Status: cancelled
2025-06-12 13:27:26,729 - __main__ - INFO -   Quantity: 32
2025-06-12 13:27:26,729 - __main__ - INFO -   Broker ID: 2150
2025-06-12 13:27:26,729 - __main__ - INFO - 
================================================================================
2025-06-12 13:27:26,729 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:27:26,729 - __main__ - INFO - ================================================================================
2025-06-12 13:27:26,729 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:27:26,729 - src.order.manager - WARNING - Cannot cancel inactive order 0d038064-c381-4765-8d97-7b94d10ca004 with status filled
2025-06-12 13:27:26,730 - __main__ - INFO -    Cancelled order 0d038064-c381-4765-8d97-7b94d10ca004
2025-06-12 13:27:26,730 - src.order.manager - WARNING - Cannot cancel inactive order c6a466b0-f16b-4b44-80fa-6047ad042272 with status cancelled
2025-06-12 13:27:26,730 - __main__ - INFO -    Cancelled order c6a466b0-f16b-4b44-80fa-6047ad042272
2025-06-12 13:27:26,730 - src.order.manager - WARNING - Cannot cancel inactive order 1646df73-2a91-4db6-acdf-e9666ebeb320 with status filled
2025-06-12 13:27:26,730 - __main__ - INFO -    Cancelled order 1646df73-2a91-4db6-acdf-e9666ebeb320
2025-06-12 13:27:26,730 - src.order.manager - WARNING - Cannot cancel inactive order 392aefb7-a044-46f5-8c42-77fd15d1bc02 with status cancelled
2025-06-12 13:27:26,730 - __main__ - INFO -    Cancelled order 392aefb7-a044-46f5-8c42-77fd15d1bc02
2025-06-12 13:27:26,731 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 13:27:26,731 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:27:26,731 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:27:26,731 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:27:26,731 - __main__ - INFO - Rule engine stopped
2025-06-12 13:27:26,731 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:27:26,731 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:27:26,732 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:27:26,732 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:27:26,732 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:27:26,732 - __main__ - INFO - 
================================================================================
2025-06-12 13:27:26,732 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:27:26,732 - __main__ - INFO - ================================================================================
2025-06-12 13:30:11,344 - __main__ - INFO - ================================================================================
2025-06-12 13:30:11,344 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:30:11,344 - __main__ - INFO - ================================================================================
2025-06-12 13:30:11,344 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:30:11,345 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:30:11,345 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:30:11,346 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:30:11,346 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:30:11,347 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:30:14,065 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:30:14,066 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:30:14,078 - src.tws_connection - INFO - ✅ Next valid order ID received: 2151
2025-06-12 13:30:14,079 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:30:14,079 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:30:14,079 - src.tws_connection - INFO - ✅ Next valid order ID received: 2151
2025-06-12 13:30:14,079 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:30:14,080 - src.tws_connection - INFO - ✅ Next valid order ID received: 2151
2025-06-12 13:30:14,080 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:30:14,080 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:30:14,081 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:30:14,081 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:30:14,081 - __main__ - INFO - Rule engine context configured
2025-06-12 13:30:14,081 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:30:14,081 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:30:14,081 - __main__ - INFO - 
================================================================================
2025-06-12 13:30:14,082 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 13:30:14,082 - __main__ - INFO - ================================================================================
2025-06-12 13:30:14,082 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:30:14,083 - __main__ - INFO - Created BUY action ($10K allocation, 3.5x ATR stop, 3.5x ATR target)
2025-06-12 13:30:14,083 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 13:30:14,083 - __main__ - INFO - 
================================================================================
2025-06-12 13:30:14,084 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 13:30:14,084 - __main__ - INFO - ================================================================================
2025-06-12 13:30:19,097 - __main__ - INFO - Current GLD price: $311.46
2025-06-12 13:30:19,097 - __main__ - INFO - Created prediction event:
2025-06-12 13:30:19,098 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:19,098 - __main__ - INFO -    Signal: BUY
2025-06-12 13:30:19,098 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:30:19,099 - __main__ - INFO -    Price: $311.46
2025-06-12 13:30:19,099 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:30:19,099 - __main__ - INFO - Rule engine started
2025-06-12 13:30:19,100 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:30:19,100 - __main__ - INFO - Prediction event emitted
2025-06-12 13:30:19,100 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:30:19,100 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:30:19,101 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:30:19,101 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 13:30:19,101 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 13:30:20,115 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.45 = $9966.40 (99.7% of $10000.00 allocation)
2025-06-12 13:30:20,117 - src.order.base - INFO - Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:30:20,117 - src.order.manager - INFO - Submitting order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 to TWS
2025-06-12 13:30:20,118 - src.order.manager - INFO - Got broker order ID 2151 for order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,119 - src.order.manager - INFO - Calling placeOrder with ID 2151, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 13:30:20,119 - src.order.manager - INFO - placeOrder called successfully for order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,120 - src.order.base - INFO - Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:30:20,120 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 13:30:20,139 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 13:30:20,140 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.38 (ATR: 0.0236 * 3.5 = 0.0825)
2025-06-12 13:30:20,140 - src.order.base - INFO - Order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:30:20,141 - src.order.manager - INFO - Submitting order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe to TWS
2025-06-12 13:30:20,141 - src.order.manager - INFO - Got broker order ID 2152 for order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:30:20,141 - src.order.manager - INFO - Calling placeOrder with ID 2152, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 13:30:20,142 - src.order.manager - INFO - placeOrder called successfully for order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:30:20,142 - src.order.base - INFO - Order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:30:20,142 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:30:20,143 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe at $311.38
2025-06-12 13:30:20,143 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.54 (ATR: 0.0236 * 3.5 = 0.0825)
2025-06-12 13:30:20,143 - src.order.base - INFO - Order e0487e94-6d52-490e-8bff-1f760a98b045 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:30:20,143 - src.order.manager - INFO - Submitting order e0487e94-6d52-490e-8bff-1f760a98b045 to TWS
2025-06-12 13:30:20,143 - src.order.manager - INFO - Got broker order ID 2153 for order e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:30:20,143 - src.order.manager - INFO - Calling placeOrder with ID 2153, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.540000 DAY
2025-06-12 13:30:20,144 - src.order.manager - INFO - placeOrder called successfully for order e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:30:20,144 - src.order.base - INFO - Order e0487e94-6d52-490e-8bff-1f760a98b045 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:30:20,144 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:30:20,144 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e0487e94-6d52-490e-8bff-1f760a98b045 at $311.54
2025-06-12 13:30:20,144 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 13:30:20,144 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:30:20,145 - __main__ - INFO -    Order ID: e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,145 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:20,145 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:30:20,145 - __main__ - INFO -    Quantity: 32
2025-06-12 13:30:20,145 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,145 - __main__ - INFO -    Order ID: e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,145 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:30:20,145 - __main__ - INFO -    Previous: created
2025-06-12 13:30:20,145 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,145 - __main__ - INFO -    Order ID: e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,146 - __main__ - INFO -    Status: submitted
2025-06-12 13:30:20,146 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:30:20,146 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:30:20,146 - __main__ - INFO -    Order ID: aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:30:20,146 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:20,146 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:30:20,147 - __main__ - INFO -    Quantity: -32
2025-06-12 13:30:20,147 - __main__ - INFO -    Stop Price: $311.38
2025-06-12 13:30:20,147 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,147 - __main__ - INFO -    Order ID: aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:30:20,147 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:30:20,147 - __main__ - INFO -    Previous: created
2025-06-12 13:30:20,147 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,147 - __main__ - INFO -    Order ID: aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:30:20,148 - __main__ - INFO -    Status: submitted
2025-06-12 13:30:20,148 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:30:20,148 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:30:20,148 - __main__ - INFO -    Order ID: e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:30:20,148 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:20,148 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:30:20,148 - __main__ - INFO -    Quantity: -32
2025-06-12 13:30:20,148 - __main__ - INFO -    Limit Price: $311.54
2025-06-12 13:30:20,149 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,149 - __main__ - INFO -    Order ID: e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:30:20,149 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:30:20,149 - __main__ - INFO -    Previous: created
2025-06-12 13:30:20,150 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,150 - __main__ - INFO -    Order ID: e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:30:20,150 - __main__ - INFO -    Status: submitted
2025-06-12 13:30:20,150 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:30:20,217 - src.tws_connection - INFO - Open Order - ID: 2151, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:30:20,221 - src.tws_connection - INFO - Open Order - ID: 2151, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:30:20,222 - src.order.base - INFO - Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:30:20,223 - src.order.base - INFO - Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 filled: 32.0 @ 311.47 (32.0/32)
2025-06-12 13:30:20,223 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:30:20,223 - __main__ - INFO -    Order ID: e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,224 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:20,224 - __main__ - INFO -    Fill Price: $311.47
2025-06-12 13:30:20,224 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:30:20,224 - __main__ - INFO -    Status: filled
2025-06-12 13:30:20,225 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:30:20,225 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:20,225 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:30:20,226 - UnifiedFillManager - INFO - Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 fill status: filled, is_fully_filled: True
2025-06-12 13:30:20,226 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 13:30:20,227 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:30:20,227 - UnifiedFillManager - INFO -   Main orders: {'e24f2a7c-1f25-4c49-8bc5-c5738fc44c16'}
2025-06-12 13:30:20,227 - UnifiedFillManager - INFO -   Stop orders: {'aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe'}
2025-06-12 13:30:20,228 - UnifiedFillManager - INFO -   Target orders: {'e0487e94-6d52-490e-8bff-1f760a98b045'}
2025-06-12 13:30:20,228 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:30:20,228 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 13:30:20,229 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 13:30:20,229 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:30:20,229 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:30:20,229 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:30:20,229 - UnifiedFillManager - INFO - Stop order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe already has correct quantity -32, no update needed
2025-06-12 13:30:20,230 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:30:20,230 - UnifiedFillManager - INFO - Target order e0487e94-6d52-490e-8bff-1f760a98b045 already has correct quantity -32, no update needed
2025-06-12 13:30:20,230 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 13:30:20,264 - src.tws_connection - INFO - Open Order - ID: 2152, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:30:20,265 - src.order.base - INFO - Order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:30:20,265 - src.tws_connection - INFO - Open Order - ID: 2151, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:30:20,267 - src.tws_connection - INFO - Open Order - ID: 2153, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:30:20,651 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe']
2025-06-12 13:30:20,651 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 13:30:20,651 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.46
2025-06-12 13:30:20,674 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0825
2025-06-12 13:30:20,674 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.46, stop_distance=$0.08, dd_distance=$0.04, dd_price=$311.42, original_qty=32, dd_qty=32
2025-06-12 13:30:20,675 - src.order.base - INFO - Order be960dcb-e5a5-440d-aeae-50b48eeecfba status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:30:20,675 - src.order.manager - INFO - Submitting order be960dcb-e5a5-440d-aeae-50b48eeecfba to TWS
2025-06-12 13:30:20,676 - src.order.manager - INFO - Got broker order ID 2154 for order be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:20,676 - src.order.manager - INFO - Calling placeOrder with ID 2154, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.420000 DAY
2025-06-12 13:30:20,676 - src.order.manager - INFO - placeOrder called successfully for order be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:20,676 - src.order.base - INFO - Order be960dcb-e5a5-440d-aeae-50b48eeecfba status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:30:20,677 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 13:30:20,677 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.42
2025-06-12 13:30:20,678 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 13:30:20,678 - src.rule.linked_order_actions - INFO - Created and linked BUY main order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 for GLD
2025-06-12 13:30:20,678 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:30:20,678 - __main__ - INFO -    Order ID: be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:20,678 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:20,679 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:30:20,679 - __main__ - INFO -    Quantity: 32
2025-06-12 13:30:20,679 - __main__ - INFO -    Limit Price: $311.42
2025-06-12 13:30:20,679 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,679 - __main__ - INFO -    Order ID: be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:20,679 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:30:20,679 - __main__ - INFO -    Previous: created
2025-06-12 13:30:20,680 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:30:20,680 - __main__ - INFO -    Order ID: be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:20,680 - __main__ - INFO -    Status: submitted
2025-06-12 13:30:20,680 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:30:20,788 - src.tws_connection - INFO - Open Order - ID: 2154, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:30:22,111 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:30:27,114 - __main__ - INFO - 
================================================================================
2025-06-12 13:30:27,115 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:30:27,115 - __main__ - INFO - ================================================================================
2025-06-12 13:30:27,115 - __main__ - WARNING - No GLD context found!
2025-06-12 13:30:27,116 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:30:27,116 - __main__ - INFO -    Total orders created: 4
2025-06-12 13:30:27,116 - __main__ - INFO -    Market orders: 1
2025-06-12 13:30:27,116 - __main__ - INFO -    Stop orders: 1
2025-06-12 13:30:27,117 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:30:27,117 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 13:30:27,117 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:30:27,117 - __main__ - INFO - 
   Order #1:
2025-06-12 13:30:27,117 - __main__ - INFO -      ID: e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:27,117 - __main__ - INFO -      Type: market
2025-06-12 13:30:27,117 - __main__ - INFO -      Quantity: 32
2025-06-12 13:30:27,118 - __main__ - INFO - 
   Order #2:
2025-06-12 13:30:27,118 - __main__ - INFO -      ID: aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:30:27,118 - __main__ - INFO -      Type: stop
2025-06-12 13:30:27,118 - __main__ - INFO -      Quantity: -32
2025-06-12 13:30:27,118 - __main__ - INFO -      Stop: $311.38
2025-06-12 13:30:27,118 - __main__ - INFO - 
   Order #3:
2025-06-12 13:30:27,118 - __main__ - INFO -      ID: e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:30:27,118 - __main__ - INFO -      Type: limit
2025-06-12 13:30:27,119 - __main__ - INFO -      Quantity: -32
2025-06-12 13:30:27,119 - __main__ - INFO -      Limit: $311.54
2025-06-12 13:30:27,119 - __main__ - INFO - 
   Order #4:
2025-06-12 13:30:27,119 - __main__ - INFO -      ID: be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:27,119 - __main__ - INFO -      Type: limit
2025-06-12 13:30:27,119 - __main__ - INFO -      Quantity: 32
2025-06-12 13:30:27,119 - __main__ - INFO -      Limit: $311.42
2025-06-12 13:30:27,119 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:30:27,119 - __main__ - INFO -    Total fills received: 1
2025-06-12 13:30:27,119 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:30:27,120 - __main__ - INFO -      Order ID: e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:30:27,120 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:30:27,120 - __main__ - INFO -      Price: $311.47
2025-06-12 13:30:27,120 - __main__ - INFO -      Status: filled
2025-06-12 13:30:27,120 - __main__ - INFO - 
Monitoring for order updates and fills...
2025-06-12 13:30:57,121 - __main__ - INFO - 
================================================================================
2025-06-12 13:30:57,121 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:30:57,121 - __main__ - INFO - ================================================================================
2025-06-12 13:30:57,123 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:30:57,123 - __main__ - INFO - 
Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16:
2025-06-12 13:30:57,124 - __main__ - INFO -   Type: market
2025-06-12 13:30:57,124 - __main__ - INFO -   Status: filled
2025-06-12 13:30:57,125 - __main__ - INFO -   Quantity: 32
2025-06-12 13:30:57,125 - __main__ - INFO -   Broker ID: 2151
2025-06-12 13:30:57,126 - __main__ - INFO - 
Order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe:
2025-06-12 13:30:57,126 - __main__ - INFO -   Type: stop
2025-06-12 13:30:57,126 - __main__ - INFO -   Status: accepted
2025-06-12 13:30:57,126 - __main__ - INFO -   Quantity: -32
2025-06-12 13:30:57,127 - __main__ - INFO -   Broker ID: 2152
2025-06-12 13:30:57,127 - __main__ - INFO - 
Order e0487e94-6d52-490e-8bff-1f760a98b045:
2025-06-12 13:30:57,127 - __main__ - INFO -   Type: limit
2025-06-12 13:30:57,127 - __main__ - INFO -   Status: submitted
2025-06-12 13:30:57,127 - __main__ - INFO -   Quantity: -32
2025-06-12 13:30:57,128 - __main__ - INFO -   Broker ID: 2153
2025-06-12 13:30:57,128 - __main__ - INFO - 
Order be960dcb-e5a5-440d-aeae-50b48eeecfba:
2025-06-12 13:30:57,128 - __main__ - INFO -   Type: limit
2025-06-12 13:30:57,128 - __main__ - INFO -   Status: submitted
2025-06-12 13:30:57,129 - __main__ - INFO -   Quantity: 32
2025-06-12 13:30:57,129 - __main__ - INFO -   Broker ID: 2154
2025-06-12 13:30:57,129 - __main__ - INFO - 
================================================================================
2025-06-12 13:30:57,129 - __main__ - INFO - DOUBLE DOWN FILL SIMULATION
2025-06-12 13:30:57,129 - __main__ - INFO - ================================================================================
2025-06-12 13:30:57,129 - __main__ - INFO - 
Would you like to simulate a double down fill to test protective order updates?
2025-06-12 13:30:57,129 - __main__ - INFO - This will emit a fill event for the double down order to test if UnifiedFillManager
2025-06-12 13:30:57,129 - __main__ - INFO - properly updates the stop and take profit quantities to match the new position size.
2025-06-12 13:30:57,130 - __main__ - INFO - 
Automatically simulating double down fill for testing...
2025-06-12 13:30:57,130 - __main__ - INFO - 
================================================================================
2025-06-12 13:30:57,130 - __main__ - INFO - SIMULATING DOUBLE DOWN FILL TO TEST PROTECTIVE ORDER UPDATES
2025-06-12 13:30:57,130 - __main__ - INFO - ================================================================================
2025-06-12 13:30:57,130 - __main__ - INFO - Simulating double down fill on order: be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:57,130 - __main__ - INFO - Double down order details: 32 shares @ $311.42
2025-06-12 13:30:57,130 - __main__ - INFO - Emitting double down fill event: 32 shares at $311.42
2025-06-12 13:30:57,131 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:30:57,131 - __main__ - INFO -    Order ID: be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:57,131 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:30:57,131 - __main__ - INFO -    Fill Price: $311.42
2025-06-12 13:30:57,131 - __main__ - INFO -    Fill Quantity: 32
2025-06-12 13:30:57,131 - __main__ - INFO -    Status: filled
2025-06-12 13:30:57,131 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:30:57,131 - UnifiedFillManager - INFO - Processing fill for GLD: 32 shares on order be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:30:57,132 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:30:57,132 - UnifiedFillManager - INFO - Order be960dcb-e5a5-440d-aeae-50b48eeecfba fill status: filled, is_fully_filled: True
2025-06-12 13:30:57,132 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 32.0
2025-06-12 13:30:57,132 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:30:57,132 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:30:57,133 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:30:57,133 - UnifiedFillManager - INFO - Stop order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe already has correct quantity -32, no update needed
2025-06-12 13:30:57,133 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:30:57,133 - UnifiedFillManager - INFO - Target order e0487e94-6d52-490e-8bff-1f760a98b045 already has correct quantity -32, no update needed
2025-06-12 13:31:00,145 - __main__ - INFO - UnifiedFillManager should have updated protective orders to new position size (606 shares)
2025-06-12 13:31:00,146 - __main__ - INFO - 
Waiting for UnifiedFillManager to process the double down fill...
2025-06-12 13:31:05,161 - __main__ - INFO - 
================================================================================
2025-06-12 13:31:05,161 - __main__ - INFO - FINAL ORDER STATE
2025-06-12 13:31:05,162 - __main__ - INFO - ================================================================================
2025-06-12 13:31:05,162 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:31:05,162 - __main__ - INFO - 
Order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16:
2025-06-12 13:31:05,163 - __main__ - INFO -   Type: market
2025-06-12 13:31:05,163 - __main__ - INFO -   Status: filled
2025-06-12 13:31:05,163 - __main__ - INFO -   Quantity: 32
2025-06-12 13:31:05,163 - __main__ - INFO -   Broker ID: 2151
2025-06-12 13:31:05,164 - __main__ - INFO - 
Order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe:
2025-06-12 13:31:05,164 - __main__ - INFO -   Type: stop
2025-06-12 13:31:05,164 - __main__ - INFO -   Status: accepted
2025-06-12 13:31:05,164 - __main__ - INFO -   Quantity: -32
2025-06-12 13:31:05,165 - __main__ - INFO -   Broker ID: 2152
2025-06-12 13:31:05,165 - __main__ - INFO - 
Order e0487e94-6d52-490e-8bff-1f760a98b045:
2025-06-12 13:31:05,165 - __main__ - INFO -   Type: limit
2025-06-12 13:31:05,165 - __main__ - INFO -   Status: submitted
2025-06-12 13:31:05,165 - __main__ - INFO -   Quantity: -32
2025-06-12 13:31:05,166 - __main__ - INFO -   Broker ID: 2153
2025-06-12 13:31:05,166 - __main__ - INFO - 
Order be960dcb-e5a5-440d-aeae-50b48eeecfba:
2025-06-12 13:31:05,166 - __main__ - INFO -   Type: limit
2025-06-12 13:31:05,166 - __main__ - INFO -   Status: submitted
2025-06-12 13:31:05,167 - __main__ - INFO -   Quantity: 32
2025-06-12 13:31:05,167 - __main__ - INFO -   Broker ID: 2154
2025-06-12 13:31:05,167 - __main__ - INFO - 
================================================================================
2025-06-12 13:31:05,167 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:31:05,168 - __main__ - INFO - ================================================================================
2025-06-12 13:31:05,168 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 13:31:05,168 - src.order.manager - WARNING - Cannot cancel inactive order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16 with status filled
2025-06-12 13:31:05,168 - __main__ - INFO -    Cancelled order e24f2a7c-1f25-4c49-8bc5-c5738fc44c16
2025-06-12 13:31:05,168 - src.order.base - INFO - Order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 13:31:05,169 - src.order.manager - INFO - Cancelling order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe with broker ID 2152
2025-06-12 13:31:05,169 - __main__ - INFO -    Cancelled order aa1e0704-05b1-4cc7-b4c6-f38c6118ccbe
2025-06-12 13:31:05,169 - src.order.base - INFO - Order e0487e94-6d52-490e-8bff-1f760a98b045 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:31:05,169 - src.order.manager - INFO - Cancelling order e0487e94-6d52-490e-8bff-1f760a98b045 with broker ID 2153
2025-06-12 13:31:05,169 - __main__ - INFO -    Cancelled order e0487e94-6d52-490e-8bff-1f760a98b045
2025-06-12 13:31:05,169 - src.order.base - INFO - Order be960dcb-e5a5-440d-aeae-50b48eeecfba status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:31:05,170 - src.order.manager - INFO - Cancelling order be960dcb-e5a5-440d-aeae-50b48eeecfba with broker ID 2154
2025-06-12 13:31:05,170 - __main__ - INFO -    Cancelled order be960dcb-e5a5-440d-aeae-50b48eeecfba
2025-06-12 13:31:05,170 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 13:31:05,170 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:31:05,171 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:31:05,171 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:31:05,171 - __main__ - INFO - Rule engine stopped
2025-06-12 13:31:05,171 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:31:05,171 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:31:05,172 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:31:05,173 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:31:05,174 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:31:05,174 - __main__ - INFO - 
================================================================================
2025-06-12 13:31:05,174 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:31:05,174 - __main__ - INFO - ================================================================================
2025-06-12 13:33:54,099 - __main__ - INFO - ================================================================================
2025-06-12 13:33:54,099 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 13:33:54,100 - __main__ - INFO - ================================================================================
2025-06-12 13:33:54,100 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 13:33:54,100 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 13:33:54,100 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 13:33:54,101 - __main__ - INFO - Connecting to TWS...
2025-06-12 13:33:54,101 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 13:33:54,102 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 13:34:02,556 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 13:34:02,557 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 13:34:02,568 - src.tws_connection - INFO - ✅ Next valid order ID received: 2155
2025-06-12 13:34:02,568 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 13:34:02,569 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 13:34:02,570 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 13:34:02,571 - __main__ - INFO - Connected to TWS successfully
2025-06-12 13:34:02,571 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 13:34:02,571 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 13:34:02,571 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 13:34:02,572 - __main__ - INFO - Rule engine context configured
2025-06-12 13:34:02,572 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 13:34:02,572 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 13:34:02,572 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:02,573 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 13:34:02,573 - __main__ - INFO - ================================================================================
2025-06-12 13:34:02,573 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 13:34:02,574 - __main__ - INFO - Created BUY action ($10K allocation, 1.0x ATR stop, 1.0x ATR target)
2025-06-12 13:34:02,574 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 13:34:02,574 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:02,575 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 13:34:02,576 - __main__ - INFO - ================================================================================
2025-06-12 13:34:02,657 - src.tws_connection - INFO - ✅ Next valid order ID received: 2155
2025-06-12 13:34:02,757 - src.tws_connection - INFO - ✅ Next valid order ID received: 2155
2025-06-12 13:34:07,592 - __main__ - INFO - Current GLD price: $311.34
2025-06-12 13:34:07,593 - __main__ - INFO - Created prediction event:
2025-06-12 13:34:07,593 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:07,594 - __main__ - INFO -    Signal: BUY
2025-06-12 13:34:07,594 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 13:34:07,594 - __main__ - INFO -    Price: $311.34
2025-06-12 13:34:07,595 - src.rule.engine - INFO - Rule engine started
2025-06-12 13:34:07,595 - __main__ - INFO - Rule engine started
2025-06-12 13:34:07,595 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 13:34:07,595 - __main__ - INFO - Prediction event emitted
2025-06-12 13:34:07,596 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 13:34:07,596 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 13:34:07,596 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 13:34:07,596 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 13:34:07,596 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 13:34:08,597 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.35 = $9963.20 (99.6% of $10000.00 allocation)
2025-06-12 13:34:08,598 - src.order.base - INFO - Order 7ac99c33-2a0e-48a9-b389-bffe157dac52 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:34:08,598 - src.order.manager - INFO - Submitting order 7ac99c33-2a0e-48a9-b389-bffe157dac52 to TWS
2025-06-12 13:34:08,598 - src.order.manager - INFO - Got broker order ID 2155 for order 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,598 - src.order.manager - INFO - Calling placeOrder with ID 2155, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 13:34:08,599 - src.order.manager - INFO - placeOrder called successfully for order 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,599 - src.order.base - INFO - Order 7ac99c33-2a0e-48a9-b389-bffe157dac52 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:34:08,599 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 13:34:08,617 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 13:34:08,617 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.32 (ATR: 0.0236 * 1.0 = 0.0236)
2025-06-12 13:34:08,617 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:34:08,618 - src.order.manager - INFO - Submitting order e5b62fb4-1ad5-4b2d-b312-eea20c905963 to TWS
2025-06-12 13:34:08,618 - src.order.manager - INFO - Got broker order ID 2156 for order e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:08,618 - src.order.manager - INFO - Calling placeOrder with ID 2156, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 13:34:08,618 - src.order.manager - INFO - placeOrder called successfully for order e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:08,618 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:34:08,619 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:34:08,619 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss e5b62fb4-1ad5-4b2d-b312-eea20c905963 at $311.32
2025-06-12 13:34:08,619 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.36 (ATR: 0.0236 * 1.0 = 0.0236)
2025-06-12 13:34:08,619 - src.order.base - INFO - Order 5ab499e3-8486-403f-a4d7-0dede4cf294c status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:34:08,620 - src.order.manager - INFO - Submitting order 5ab499e3-8486-403f-a4d7-0dede4cf294c to TWS
2025-06-12 13:34:08,620 - src.order.manager - INFO - Got broker order ID 2157 for order 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:08,620 - src.order.manager - INFO - Calling placeOrder with ID 2157, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.360000 DAY
2025-06-12 13:34:08,620 - src.order.manager - INFO - placeOrder called successfully for order 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:08,620 - src.order.base - INFO - Order 5ab499e3-8486-403f-a4d7-0dede4cf294c status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:34:08,620 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:34:08,620 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 5ab499e3-8486-403f-a4d7-0dede4cf294c at $311.36
2025-06-12 13:34:08,621 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 13:34:08,621 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:34:08,621 - __main__ - INFO -    Order ID: 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,621 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:08,621 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 13:34:08,621 - __main__ - INFO -    Quantity: 32
2025-06-12 13:34:08,622 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:08,622 - __main__ - INFO -    Order ID: 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,623 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:34:08,623 - __main__ - INFO -    Previous: created
2025-06-12 13:34:08,623 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:08,623 - __main__ - INFO -    Order ID: 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,623 - __main__ - INFO -    Status: submitted
2025-06-12 13:34:08,624 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:34:08,624 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:34:08,624 - __main__ - INFO -    Order ID: e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:08,624 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:08,625 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:34:08,625 - __main__ - INFO -    Quantity: -32
2025-06-12 13:34:08,625 - __main__ - INFO -    Stop Price: $311.32
2025-06-12 13:34:08,625 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:08,625 - __main__ - INFO -    Order ID: e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:08,625 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:34:08,625 - __main__ - INFO -    Previous: created
2025-06-12 13:34:08,626 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:08,626 - __main__ - INFO -    Order ID: e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:08,626 - __main__ - INFO -    Status: submitted
2025-06-12 13:34:08,626 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:34:08,626 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:34:08,626 - __main__ - INFO -    Order ID: 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:08,626 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:08,626 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:34:08,627 - __main__ - INFO -    Quantity: -32
2025-06-12 13:34:08,627 - __main__ - INFO -    Limit Price: $311.36
2025-06-12 13:34:08,627 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:08,627 - __main__ - INFO -    Order ID: 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:08,627 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:34:08,627 - __main__ - INFO -    Previous: created
2025-06-12 13:34:08,627 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:08,627 - __main__ - INFO -    Order ID: 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:08,627 - __main__ - INFO -    Status: submitted
2025-06-12 13:34:08,627 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:34:08,694 - src.tws_connection - INFO - Open Order - ID: 2155, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:34:08,695 - src.order.base - INFO - Order 7ac99c33-2a0e-48a9-b389-bffe157dac52 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:34:08,704 - src.order.base - INFO - Order 7ac99c33-2a0e-48a9-b389-bffe157dac52 status changed: accepted -> filled (Order fully filled)
2025-06-12 13:34:08,703 - src.tws_connection - INFO - Open Order - ID: 2155, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:34:08,704 - src.order.base - INFO - Order 7ac99c33-2a0e-48a9-b389-bffe157dac52 filled: 32.0 @ 311.34 (32.0/32)
2025-06-12 13:34:08,705 - src.tws_connection - INFO - Open Order - ID: 2155, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:34:08,706 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:34:08,707 - __main__ - INFO -    Order ID: 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,707 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:08,707 - __main__ - INFO -    Fill Price: $311.34
2025-06-12 13:34:08,707 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:34:08,707 - __main__ - INFO -    Status: filled
2025-06-12 13:34:08,708 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:34:08,708 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:08,709 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 13:34:08,709 - UnifiedFillManager - INFO - Order 7ac99c33-2a0e-48a9-b389-bffe157dac52 fill status: filled, is_fully_filled: True
2025-06-12 13:34:08,710 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 13:34:08,710 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 13:34:08,711 - UnifiedFillManager - INFO -   Main orders: {'7ac99c33-2a0e-48a9-b389-bffe157dac52'}
2025-06-12 13:34:08,711 - UnifiedFillManager - INFO -   Stop orders: {'e5b62fb4-1ad5-4b2d-b312-eea20c905963'}
2025-06-12 13:34:08,711 - UnifiedFillManager - INFO -   Target orders: {'5ab499e3-8486-403f-a4d7-0dede4cf294c'}
2025-06-12 13:34:08,712 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 13:34:08,712 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 13:34:08,713 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 13:34:08,714 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 13:34:08,714 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:34:08,715 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:34:08,715 - UnifiedFillManager - INFO - Stop order e5b62fb4-1ad5-4b2d-b312-eea20c905963 already has correct quantity -32, no update needed
2025-06-12 13:34:08,715 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:34:08,716 - UnifiedFillManager - INFO - Target order 5ab499e3-8486-403f-a4d7-0dede4cf294c already has correct quantity -32, no update needed
2025-06-12 13:34:08,716 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 13:34:08,743 - src.tws_connection - INFO - Open Order - ID: 2156, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:34:08,744 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:34:08,744 - src.tws_connection - INFO - Open Order - ID: 2157, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:34:09,121 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['e5b62fb4-1ad5-4b2d-b312-eea20c905963']
2025-06-12 13:34:09,122 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 13:34:09,123 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.34
2025-06-12 13:34:09,143 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0236
2025-06-12 13:34:09,143 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.34, stop_distance=$0.02, dd_distance=$0.01, dd_price=$311.33, original_qty=32, dd_qty=32
2025-06-12 13:34:09,144 - src.order.base - INFO - Order 2ad7440e-075b-45af-bd8b-63df743c6d29 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:34:09,144 - src.order.manager - INFO - Submitting order 2ad7440e-075b-45af-bd8b-63df743c6d29 to TWS
2025-06-12 13:34:09,144 - src.order.manager - INFO - Got broker order ID 2158 for order 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:09,145 - src.order.manager - INFO - Calling placeOrder with ID 2158, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.330000 DAY
2025-06-12 13:34:09,145 - src.order.manager - INFO - placeOrder called successfully for order 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:09,145 - src.order.base - INFO - Order 2ad7440e-075b-45af-bd8b-63df743c6d29 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:34:09,145 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 13:34:09,146 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.33
2025-06-12 13:34:09,146 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 13:34:09,146 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 7ac99c33-2a0e-48a9-b389-bffe157dac52 for GLD
2025-06-12 13:34:09,146 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:34:09,146 - __main__ - INFO -    Order ID: 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:09,146 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:09,146 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:34:09,146 - __main__ - INFO -    Quantity: 32
2025-06-12 13:34:09,147 - __main__ - INFO -    Limit Price: $311.33
2025-06-12 13:34:09,147 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:09,147 - __main__ - INFO -    Order ID: 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:09,147 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:34:09,147 - __main__ - INFO -    Previous: created
2025-06-12 13:34:09,147 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:09,147 - __main__ - INFO -    Order ID: 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:09,147 - __main__ - INFO -    Status: submitted
2025-06-12 13:34:09,148 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:34:09,240 - src.tws_connection - INFO - Open Order - ID: 2158, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:34:10,603 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 13:34:15,489 - src.order.base - INFO - Order 2ad7440e-075b-45af-bd8b-63df743c6d29 status changed: submitted -> filled (Order fully filled)
2025-06-12 13:34:15,490 - src.order.base - INFO - Order 2ad7440e-075b-45af-bd8b-63df743c6d29 filled: 32.0 @ 311.33 (32.0/32)
2025-06-12 13:34:15,491 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 13:34:15,492 - __main__ - INFO -    Order ID: 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:15,490 - src.tws_connection - INFO - Open Order - ID: 2158, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:34:15,492 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:15,492 - __main__ - INFO -    Fill Price: $311.33
2025-06-12 13:34:15,493 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 13:34:15,494 - __main__ - INFO -    Status: filled
2025-06-12 13:34:15,494 - src.tws_connection - INFO - Open Order - ID: 2158, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 13:34:15,494 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 13:34:15,495 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:15,495 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 13:34:15,495 - UnifiedFillManager - INFO - Order 2ad7440e-075b-45af-bd8b-63df743c6d29 fill status: filled, is_fully_filled: True
2025-06-12 13:34:15,496 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 64.0
2025-06-12 13:34:15,496 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=64.0, protective_qty=-64.0
2025-06-12 13:34:15,496 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 13:34:15,496 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 13:34:15,496 - UnifiedFillManager - INFO - Queueing update for stop order e5b62fb4-1ad5-4b2d-b312-eea20c905963: current qty=-32, new qty=-64.0
2025-06-12 13:34:15,497 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 13:34:15,497 - UnifiedFillManager - INFO - Queueing update for target order 5ab499e3-8486-403f-a4d7-0dede4cf294c: current qty=-32, new qty=-64.0
2025-06-12 13:34:15,497 - UnifiedFillManager - INFO - Processing operation for GLD: replace_stop
2025-06-12 13:34:15,498 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: accepted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 13:34:15,498 - src.order.manager - INFO - Cancelling order e5b62fb4-1ad5-4b2d-b312-eea20c905963 with broker ID 2156
2025-06-12 13:34:15,532 - src.tws_connection - INFO - Open Order - ID: 2156, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:34:15,554 - src.order.manager - WARNING - Cannot process fill for inactive order e5b62fb4-1ad5-4b2d-b312-eea20c905963 with status pending_cancel
2025-06-12 13:34:15,554 - src.tws_connection - INFO - Open Order - ID: 2156, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:34:15,556 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: pending_cancel -> filled (IB status: Filled)
2025-06-12 13:34:15,594 - src.tws_connection - INFO - Open Order - ID: 2156, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:34:15,594 - src.order.manager - WARNING - Cannot process fill for inactive order e5b62fb4-1ad5-4b2d-b312-eea20c905963 with status filled
2025-06-12 13:34:15,595 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: filled -> cancelled (IB status: Cancelled)
2025-06-12 13:34:15,596 - src.tws_connection - INFO - Open Order - ID: 2156, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 13:34:15,597 - src.order.base - INFO - Order e5b62fb4-1ad5-4b2d-b312-eea20c905963 status changed: cancelled -> filled (IB status: Filled)
2025-06-12 13:34:15,601 - src.order.base - INFO - Order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:34:15,601 - src.order.manager - INFO - Submitting order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b to TWS
2025-06-12 13:34:15,601 - src.order.manager - INFO - Got broker order ID 2159 for order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:15,601 - src.order.manager - INFO - Calling placeOrder with ID 2159, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 64@0.000000 DAY
2025-06-12 13:34:15,602 - src.order.manager - INFO - placeOrder called successfully for order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:15,602 - src.order.base - INFO - Order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:34:15,603 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 13:34:15,603 - UnifiedFillManager - INFO - Created updated stop order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b for GLD at $311.32 for -64.0 shares
2025-06-12 13:34:15,603 - UnifiedFillManager - INFO - Completed operation for GLD: replace_stop
2025-06-12 13:34:15,603 - UnifiedFillManager - INFO - Processing operation for GLD: replace_target
2025-06-12 13:34:15,603 - src.order.base - INFO - Order 5ab499e3-8486-403f-a4d7-0dede4cf294c status changed: submitted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 13:34:15,604 - src.order.manager - INFO - Cancelling order 5ab499e3-8486-403f-a4d7-0dede4cf294c with broker ID 2157
2025-06-12 13:34:15,604 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:34:15,604 - __main__ - INFO -    Order ID: df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:15,604 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:15,604 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 13:34:15,604 - __main__ - INFO -    Quantity: -64.0
2025-06-12 13:34:15,606 - __main__ - INFO -    Stop Price: $311.32
2025-06-12 13:34:15,607 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:15,608 - __main__ - INFO -    Order ID: df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:15,608 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:34:15,608 - __main__ - INFO -    Previous: created
2025-06-12 13:34:15,608 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:15,609 - __main__ - INFO -    Order ID: df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:15,609 - __main__ - INFO -    Status: submitted
2025-06-12 13:34:15,609 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:34:15,610 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:15,610 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 13:34:15,610 - __main__ - INFO - ================================================================================
2025-06-12 13:34:15,611 - __main__ - WARNING - No GLD context found!
2025-06-12 13:34:15,611 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 13:34:15,611 - __main__ - INFO -    Total orders created: 5
2025-06-12 13:34:15,611 - __main__ - INFO -    Market orders: 1
2025-06-12 13:34:15,611 - __main__ - INFO -    Stop orders: 2
2025-06-12 13:34:15,611 - __main__ - INFO -    Limit orders: 2
2025-06-12 13:34:15,612 - __main__ - WARNING - 
⚠️ WARNING: Expected 4 orders but got 5
2025-06-12 13:34:15,612 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 13:34:15,612 - __main__ - INFO - 
   Order #1:
2025-06-12 13:34:15,612 - __main__ - INFO -      ID: 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:15,612 - __main__ - INFO -      Type: market
2025-06-12 13:34:15,613 - __main__ - INFO -      Quantity: 32
2025-06-12 13:34:15,613 - __main__ - INFO - 
   Order #2:
2025-06-12 13:34:15,613 - __main__ - INFO -      ID: e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:15,613 - __main__ - INFO -      Type: stop
2025-06-12 13:34:15,613 - __main__ - INFO -      Quantity: -32
2025-06-12 13:34:15,613 - __main__ - INFO -      Stop: $311.32
2025-06-12 13:34:15,613 - __main__ - INFO - 
   Order #3:
2025-06-12 13:34:15,613 - __main__ - INFO -      ID: 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:15,614 - __main__ - INFO -      Type: limit
2025-06-12 13:34:15,614 - __main__ - INFO -      Quantity: -32
2025-06-12 13:34:15,614 - __main__ - INFO -      Limit: $311.36
2025-06-12 13:34:15,614 - __main__ - INFO - 
   Order #4:
2025-06-12 13:34:15,614 - __main__ - INFO -      ID: 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:15,614 - __main__ - INFO -      Type: limit
2025-06-12 13:34:15,614 - __main__ - INFO -      Quantity: 32
2025-06-12 13:34:15,615 - __main__ - INFO -      Limit: $311.33
2025-06-12 13:34:15,615 - __main__ - INFO - 
   Order #5:
2025-06-12 13:34:15,615 - __main__ - INFO -      ID: df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:15,615 - __main__ - INFO -      Type: stop
2025-06-12 13:34:15,615 - __main__ - INFO -      Quantity: -64.0
2025-06-12 13:34:15,615 - __main__ - INFO -      Stop: $311.32
2025-06-12 13:34:15,615 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 13:34:15,615 - __main__ - INFO -    Total fills received: 2
2025-06-12 13:34:15,616 - __main__ - INFO - 
   Fill #1:
2025-06-12 13:34:15,616 - __main__ - INFO -      Order ID: 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:15,616 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:34:15,616 - __main__ - INFO -      Price: $311.34
2025-06-12 13:34:15,616 - __main__ - INFO -      Status: filled
2025-06-12 13:34:15,616 - __main__ - INFO - 
   Fill #2:
2025-06-12 13:34:15,617 - __main__ - INFO -      Order ID: 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:15,617 - __main__ - INFO -      Quantity: 32.0
2025-06-12 13:34:15,618 - __main__ - INFO -      Price: $311.33
2025-06-12 13:34:15,618 - __main__ - INFO -      Status: filled
2025-06-12 13:34:15,618 - __main__ - INFO - 
📊 Monitoring for position closure...
2025-06-12 13:34:15,618 - __main__ - INFO - Waiting for one of the following:
2025-06-12 13:34:15,618 - __main__ - INFO -   - Double down to fill (increases position)
2025-06-12 13:34:15,618 - __main__ - INFO -   - Stop loss to fill (closes position)
2025-06-12 13:34:15,618 - __main__ - INFO -   - Take profit to fill (closes position)
2025-06-12 13:34:15,674 - src.tws_connection - INFO - Open Order - ID: 2159, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:34:15,675 - src.order.base - INFO - Order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 13:34:15,709 - src.order.base - INFO - Order 95584ea3-e058-4e68-917a-61f417bfac9a status changed: created -> pending_submit (Submitting to broker)
2025-06-12 13:34:15,710 - src.order.manager - INFO - Submitting order 95584ea3-e058-4e68-917a-61f417bfac9a to TWS
2025-06-12 13:34:15,710 - src.order.manager - INFO - Got broker order ID 2160 for order 95584ea3-e058-4e68-917a-61f417bfac9a
2025-06-12 13:34:15,710 - src.order.manager - INFO - Calling placeOrder with ID 2160, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 64@311.360000 DAY
2025-06-12 13:34:15,711 - src.order.manager - INFO - placeOrder called successfully for order 95584ea3-e058-4e68-917a-61f417bfac9a
2025-06-12 13:34:15,711 - src.order.base - INFO - Order 95584ea3-e058-4e68-917a-61f417bfac9a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 13:34:15,711 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 13:34:15,711 - UnifiedFillManager - INFO - Created updated target order 95584ea3-e058-4e68-917a-61f417bfac9a for GLD at $311.36 for -64.0 shares
2025-06-12 13:34:15,712 - UnifiedFillManager - INFO - Completed operation for GLD: replace_target
2025-06-12 13:34:15,712 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 13:34:15,712 - __main__ - INFO -    Order ID: 95584ea3-e058-4e68-917a-61f417bfac9a
2025-06-12 13:34:15,712 - __main__ - INFO -    Symbol: GLD
2025-06-12 13:34:15,712 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 13:34:15,713 - __main__ - INFO -    Quantity: -64.0
2025-06-12 13:34:15,713 - __main__ - INFO -    Limit Price: $311.36
2025-06-12 13:34:15,713 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:15,713 - __main__ - INFO -    Order ID: 95584ea3-e058-4e68-917a-61f417bfac9a
2025-06-12 13:34:15,713 - __main__ - INFO -    Status: pending_submit
2025-06-12 13:34:15,714 - __main__ - INFO -    Previous: created
2025-06-12 13:34:15,714 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 13:34:15,714 - __main__ - INFO -    Order ID: 95584ea3-e058-4e68-917a-61f417bfac9a
2025-06-12 13:34:15,714 - __main__ - INFO -    Status: submitted
2025-06-12 13:34:15,714 - __main__ - INFO -    Previous: pending_submit
2025-06-12 13:34:15,760 - src.order.base - INFO - Order 5ab499e3-8486-403f-a4d7-0dede4cf294c status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 13:34:15,760 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2157)
2025-06-12 13:34:15,828 - src.tws_connection - INFO - Open Order - ID: 2160, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 13:34:17,627 - __main__ - INFO - 
✅ Position closed - GLD removed from context
2025-06-12 13:34:17,629 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:17,631 - __main__ - INFO - FINAL ORDER STATE & VERIFICATION
2025-06-12 13:34:17,632 - __main__ - INFO - ================================================================================
2025-06-12 13:34:17,632 - __main__ - INFO - 
Checking current order states...
2025-06-12 13:34:17,633 - __main__ - INFO - 
Order 7ac99c33-2a0e-48a9-b389-bffe157dac52:
2025-06-12 13:34:17,633 - __main__ - INFO -   Type: market
2025-06-12 13:34:17,634 - __main__ - INFO -   Status: filled
2025-06-12 13:34:17,635 - __main__ - INFO -   Quantity: 32
2025-06-12 13:34:17,636 - __main__ - INFO -   Broker ID: 2155
2025-06-12 13:34:17,636 - __main__ - INFO - 
Order e5b62fb4-1ad5-4b2d-b312-eea20c905963:
2025-06-12 13:34:17,637 - __main__ - INFO -   Type: stop
2025-06-12 13:34:17,637 - __main__ - INFO -   Status: filled
2025-06-12 13:34:17,638 - __main__ - INFO -   Quantity: -32
2025-06-12 13:34:17,638 - __main__ - INFO -   Broker ID: 2156
2025-06-12 13:34:17,638 - __main__ - INFO - 
Order 5ab499e3-8486-403f-a4d7-0dede4cf294c:
2025-06-12 13:34:17,638 - __main__ - INFO -   Type: limit
2025-06-12 13:34:17,639 - __main__ - INFO -   Status: cancelled
2025-06-12 13:34:17,639 - __main__ - INFO -   Quantity: -32
2025-06-12 13:34:17,639 - __main__ - INFO -   Broker ID: 2157
2025-06-12 13:34:17,639 - __main__ - INFO - 
Order 2ad7440e-075b-45af-bd8b-63df743c6d29:
2025-06-12 13:34:17,640 - __main__ - INFO -   Type: limit
2025-06-12 13:34:17,640 - __main__ - INFO -   Status: filled
2025-06-12 13:34:17,641 - __main__ - INFO -   Quantity: 32
2025-06-12 13:34:17,641 - __main__ - INFO -   Broker ID: 2158
2025-06-12 13:34:17,642 - __main__ - INFO - 
Order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b:
2025-06-12 13:34:17,644 - __main__ - INFO -   Type: stop
2025-06-12 13:34:17,645 - __main__ - INFO -   Status: accepted
2025-06-12 13:34:17,646 - __main__ - INFO -   Quantity: -64.0
2025-06-12 13:34:17,647 - __main__ - INFO -   Broker ID: 2159
2025-06-12 13:34:17,647 - __main__ - INFO - 
Order 95584ea3-e058-4e68-917a-61f417bfac9a:
2025-06-12 13:34:17,648 - __main__ - INFO -   Type: limit
2025-06-12 13:34:17,649 - __main__ - INFO -   Status: submitted
2025-06-12 13:34:17,651 - __main__ - INFO -   Quantity: -64.0
2025-06-12 13:34:17,652 - __main__ - INFO -   Broker ID: 2160
2025-06-12 13:34:17,654 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:17,655 - __main__ - INFO - FLOW VERIFICATION
2025-06-12 13:34:17,655 - __main__ - INFO - ================================================================================
2025-06-12 13:34:17,655 - __main__ - INFO - ✓ Main order filled: True
2025-06-12 13:34:17,656 - __main__ - INFO - ✓ Double down filled: True
2025-06-12 13:34:17,656 - __main__ - INFO - ○ Stop loss filled: False
2025-06-12 13:34:17,656 - __main__ - INFO - ○ Take profit filled: False
2025-06-12 13:34:17,656 - __main__ - INFO - 
⚠️ Double down filled but position not closed - protective orders should have been updated
2025-06-12 13:34:17,657 - __main__ - INFO - 
Total orders cancelled: 1
2025-06-12 13:34:17,657 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:17,657 - __main__ - INFO - TEST SUMMARY
2025-06-12 13:34:17,658 - __main__ - INFO - ================================================================================
2025-06-12 13:34:17,659 - __main__ - INFO - ⚠️ Position did not close during test - manual intervention may be needed
2025-06-12 13:34:17,661 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:17,663 - __main__ - INFO - CLEANING UP TEST
2025-06-12 13:34:17,663 - __main__ - INFO - ================================================================================
2025-06-12 13:34:17,664 - __main__ - INFO - Cancelling 6 test orders...
2025-06-12 13:34:17,664 - src.order.manager - WARNING - Cannot cancel inactive order 7ac99c33-2a0e-48a9-b389-bffe157dac52 with status filled
2025-06-12 13:34:17,665 - __main__ - INFO -    Cancelled order 7ac99c33-2a0e-48a9-b389-bffe157dac52
2025-06-12 13:34:17,665 - src.order.manager - WARNING - Cannot cancel inactive order e5b62fb4-1ad5-4b2d-b312-eea20c905963 with status filled
2025-06-12 13:34:17,666 - __main__ - INFO -    Cancelled order e5b62fb4-1ad5-4b2d-b312-eea20c905963
2025-06-12 13:34:17,666 - src.order.manager - WARNING - Cannot cancel inactive order 5ab499e3-8486-403f-a4d7-0dede4cf294c with status cancelled
2025-06-12 13:34:17,667 - __main__ - INFO -    Cancelled order 5ab499e3-8486-403f-a4d7-0dede4cf294c
2025-06-12 13:34:17,668 - src.order.manager - WARNING - Cannot cancel inactive order 2ad7440e-075b-45af-bd8b-63df743c6d29 with status filled
2025-06-12 13:34:17,668 - __main__ - INFO -    Cancelled order 2ad7440e-075b-45af-bd8b-63df743c6d29
2025-06-12 13:34:17,669 - src.order.base - INFO - Order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 13:34:17,669 - src.order.manager - INFO - Cancelling order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b with broker ID 2159
2025-06-12 13:34:17,670 - __main__ - INFO -    Cancelled order df5a1e5c-d561-4fef-b209-e1ebf96d0b3b
2025-06-12 13:34:17,670 - src.order.base - INFO - Order 95584ea3-e058-4e68-917a-61f417bfac9a status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 13:34:17,670 - src.order.manager - INFO - Cancelling order 95584ea3-e058-4e68-917a-61f417bfac9a with broker ID 2160
2025-06-12 13:34:17,671 - __main__ - INFO -    Cancelled order 95584ea3-e058-4e68-917a-61f417bfac9a
2025-06-12 13:34:17,672 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 13:34:17,672 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 13:34:17,674 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 13:34:17,675 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 13:34:17,676 - __main__ - INFO - Rule engine stopped
2025-06-12 13:34:17,677 - __main__ - INFO - 
Test cleanup complete
2025-06-12 13:34:17,679 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 13:34:17,680 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 13:34:17,681 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 13:34:17,682 - __main__ - INFO - Disconnected from TWS
2025-06-12 13:34:17,683 - __main__ - INFO - 
================================================================================
2025-06-12 13:34:17,684 - __main__ - INFO - TEST COMPLETE
2025-06-12 13:34:17,685 - __main__ - INFO - ================================================================================
2025-06-12 14:27:04,609 - __main__ - INFO - ================================================================================
2025-06-12 14:27:04,610 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 14:27:04,610 - __main__ - INFO - ================================================================================
2025-06-12 14:27:04,610 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 14:27:04,610 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 14:27:04,611 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 14:27:04,613 - __main__ - INFO - Connecting to TWS...
2025-06-12 14:27:04,613 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 14:27:04,614 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 14:27:06,291 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 14:27:06,291 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 14:27:06,300 - src.tws_connection - INFO - ✅ Next valid order ID received: 2161
2025-06-12 14:27:06,300 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 14:27:06,301 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 14:27:06,301 - src.tws_connection - INFO - ✅ Next valid order ID received: 2161
2025-06-12 14:27:06,302 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 14:27:06,302 - src.tws_connection - INFO - ✅ Next valid order ID received: 2161
2025-06-12 14:27:06,302 - __main__ - INFO - Connected to TWS successfully
2025-06-12 14:27:06,303 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 14:27:06,303 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 14:27:06,303 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 14:27:06,303 - __main__ - INFO - Rule engine context configured
2025-06-12 14:27:06,304 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 14:27:06,304 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 14:27:06,304 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:06,304 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 14:27:06,304 - __main__ - INFO - ================================================================================
2025-06-12 14:27:06,305 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 14:27:06,305 - __main__ - INFO - Created BUY action ($10K allocation, 1.0x ATR stop, 1.0x ATR target)
2025-06-12 14:27:06,305 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 14:27:06,306 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:06,306 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 14:27:06,306 - __main__ - INFO - ================================================================================
2025-06-12 14:27:11,317 - __main__ - INFO - Current GLD price: $311.66
2025-06-12 14:27:11,318 - __main__ - INFO - Created prediction event:
2025-06-12 14:27:11,318 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:11,318 - __main__ - INFO -    Signal: BUY
2025-06-12 14:27:11,319 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 14:27:11,319 - __main__ - INFO -    Price: $311.66
2025-06-12 14:27:11,319 - src.rule.engine - INFO - Rule engine started
2025-06-12 14:27:11,319 - __main__ - INFO - Rule engine started
2025-06-12 14:27:11,320 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 14:27:11,321 - __main__ - INFO - Prediction event emitted
2025-06-12 14:27:11,321 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 14:27:11,321 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 14:27:11,321 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 14:27:11,322 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 14:27:11,322 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 14:27:12,336 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.66 = $9973.12 (99.7% of $10000.00 allocation)
2025-06-12 14:27:12,338 - src.order.base - INFO - Order 787d255d-e59b-4e13-b47a-d61fea61f360 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:27:12,339 - src.order.manager - INFO - Submitting order 787d255d-e59b-4e13-b47a-d61fea61f360 to TWS
2025-06-12 14:27:12,339 - src.order.manager - INFO - Got broker order ID 2161 for order 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,339 - src.order.manager - INFO - Calling placeOrder with ID 2161, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 14:27:12,339 - src.order.manager - INFO - placeOrder called successfully for order 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,340 - src.order.base - INFO - Order 787d255d-e59b-4e13-b47a-d61fea61f360 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:27:12,340 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 14:27:12,358 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 14:27:12,358 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.64 (ATR: 0.0236 * 1.0 = 0.0236)
2025-06-12 14:27:12,359 - src.order.base - INFO - Order e519e8b9-297f-439e-94b6-06c050b42c45 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:27:12,359 - src.order.manager - INFO - Submitting order e519e8b9-297f-439e-94b6-06c050b42c45 to TWS
2025-06-12 14:27:12,360 - src.order.manager - INFO - Got broker order ID 2162 for order e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:12,360 - src.order.manager - INFO - Calling placeOrder with ID 2162, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 14:27:12,361 - src.order.manager - INFO - placeOrder called successfully for order e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:12,361 - src.order.base - INFO - Order e519e8b9-297f-439e-94b6-06c050b42c45 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:27:12,361 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 14:27:12,362 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss e519e8b9-297f-439e-94b6-06c050b42c45 at $311.64
2025-06-12 14:27:12,362 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.68 (ATR: 0.0236 * 1.0 = 0.0236)
2025-06-12 14:27:12,363 - src.order.base - INFO - Order 73279989-4ddb-42d9-8094-a54bfd44d044 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:27:12,364 - src.order.manager - INFO - Submitting order 73279989-4ddb-42d9-8094-a54bfd44d044 to TWS
2025-06-12 14:27:12,364 - src.order.manager - INFO - Got broker order ID 2163 for order 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:12,364 - src.order.manager - INFO - Calling placeOrder with ID 2163, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.680000 DAY
2025-06-12 14:27:12,365 - src.order.manager - INFO - placeOrder called successfully for order 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:12,366 - src.order.base - INFO - Order 73279989-4ddb-42d9-8094-a54bfd44d044 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:27:12,367 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:27:12,367 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 73279989-4ddb-42d9-8094-a54bfd44d044 at $311.68
2025-06-12 14:27:12,367 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 14:27:12,367 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:27:12,368 - __main__ - INFO -    Order ID: 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,368 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:12,368 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 14:27:12,369 - __main__ - INFO -    Quantity: 32
2025-06-12 14:27:12,369 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,370 - __main__ - INFO -    Order ID: 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,370 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:27:12,371 - __main__ - INFO -    Previous: created
2025-06-12 14:27:12,371 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,372 - __main__ - INFO -    Order ID: 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,372 - __main__ - INFO -    Status: submitted
2025-06-12 14:27:12,372 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:27:12,372 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:27:12,373 - __main__ - INFO -    Order ID: e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:12,374 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:12,374 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 14:27:12,374 - __main__ - INFO -    Quantity: -32
2025-06-12 14:27:12,374 - __main__ - INFO -    Stop Price: $311.64
2025-06-12 14:27:12,374 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,375 - __main__ - INFO -    Order ID: e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:12,375 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:27:12,375 - __main__ - INFO -    Previous: created
2025-06-12 14:27:12,376 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,376 - __main__ - INFO -    Order ID: e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:12,376 - __main__ - INFO -    Status: submitted
2025-06-12 14:27:12,377 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:27:12,377 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:27:12,377 - __main__ - INFO -    Order ID: 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:12,378 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:12,378 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:27:12,378 - __main__ - INFO -    Quantity: -32
2025-06-12 14:27:12,378 - __main__ - INFO -    Limit Price: $311.68
2025-06-12 14:27:12,379 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,379 - __main__ - INFO -    Order ID: 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:12,379 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:27:12,379 - __main__ - INFO -    Previous: created
2025-06-12 14:27:12,379 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,380 - __main__ - INFO -    Order ID: 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:12,380 - __main__ - INFO -    Status: submitted
2025-06-12 14:27:12,380 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:27:12,442 - src.tws_connection - INFO - Open Order - ID: 2161, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:27:12,443 - src.order.base - INFO - Order 787d255d-e59b-4e13-b47a-d61fea61f360 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:27:12,445 - src.order.base - INFO - Order 787d255d-e59b-4e13-b47a-d61fea61f360 status changed: accepted -> filled (Order fully filled)
2025-06-12 14:27:12,445 - src.order.base - INFO - Order 787d255d-e59b-4e13-b47a-d61fea61f360 filled: 32.0 @ 311.66 (32.0/32)
2025-06-12 14:27:12,446 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:27:12,446 - src.tws_connection - INFO - Open Order - ID: 2161, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:27:12,447 - __main__ - INFO -    Order ID: 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,448 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:12,448 - __main__ - INFO -    Fill Price: $311.66
2025-06-12 14:27:12,448 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 14:27:12,448 - __main__ - INFO -    Status: filled
2025-06-12 14:27:12,448 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:27:12,449 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:12,449 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 14:27:12,450 - UnifiedFillManager - INFO - Order 787d255d-e59b-4e13-b47a-d61fea61f360 fill status: filled, is_fully_filled: True
2025-06-12 14:27:12,450 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 14:27:12,451 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 14:27:12,451 - src.tws_connection - INFO - Open Order - ID: 2162, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:27:12,451 - UnifiedFillManager - INFO -   Main orders: {'787d255d-e59b-4e13-b47a-d61fea61f360'}
2025-06-12 14:27:12,452 - UnifiedFillManager - INFO -   Stop orders: {'e519e8b9-297f-439e-94b6-06c050b42c45'}
2025-06-12 14:27:12,452 - UnifiedFillManager - INFO -   Target orders: {'73279989-4ddb-42d9-8094-a54bfd44d044'}
2025-06-12 14:27:12,453 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 14:27:12,453 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 14:27:12,454 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 14:27:12,454 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 14:27:12,454 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:27:12,454 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 14:27:12,455 - UnifiedFillManager - INFO - Stop order e519e8b9-297f-439e-94b6-06c050b42c45 already has correct quantity -32, no update needed
2025-06-12 14:27:12,455 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:27:12,455 - UnifiedFillManager - INFO - Target order 73279989-4ddb-42d9-8094-a54bfd44d044 already has correct quantity -32, no update needed
2025-06-12 14:27:12,455 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 14:27:12,455 - src.order.base - INFO - Order e519e8b9-297f-439e-94b6-06c050b42c45 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:27:12,492 - src.tws_connection - INFO - Open Order - ID: 2161, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:27:12,494 - src.tws_connection - INFO - Open Order - ID: 2163, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:27:12,874 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['e519e8b9-297f-439e-94b6-06c050b42c45']
2025-06-12 14:27:12,875 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 14:27:12,876 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.66
2025-06-12 14:27:12,893 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0236
2025-06-12 14:27:12,894 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.66, stop_distance=$0.02, dd_distance=$0.01, dd_price=$311.65, original_qty=32, dd_qty=32
2025-06-12 14:27:12,894 - src.order.base - INFO - Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:27:12,895 - src.order.manager - INFO - Submitting order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 to TWS
2025-06-12 14:27:12,896 - src.order.manager - INFO - Got broker order ID 2164 for order 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:12,896 - src.order.manager - INFO - Calling placeOrder with ID 2164, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.650000 DAY
2025-06-12 14:27:12,897 - src.order.manager - INFO - placeOrder called successfully for order 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:12,897 - src.order.base - INFO - Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:27:12,898 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 14:27:12,898 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.65
2025-06-12 14:27:12,898 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 14:27:12,898 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 787d255d-e59b-4e13-b47a-d61fea61f360 for GLD
2025-06-12 14:27:12,898 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:27:12,899 - __main__ - INFO -    Order ID: 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:12,899 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:12,899 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:27:12,899 - __main__ - INFO -    Quantity: 32
2025-06-12 14:27:12,899 - __main__ - INFO -    Limit Price: $311.65
2025-06-12 14:27:12,899 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,900 - __main__ - INFO -    Order ID: 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:12,900 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:27:12,900 - __main__ - INFO -    Previous: created
2025-06-12 14:27:12,900 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:12,900 - __main__ - INFO -    Order ID: 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:12,900 - __main__ - INFO -    Status: submitted
2025-06-12 14:27:12,900 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:27:13,000 - src.tws_connection - INFO - Open Order - ID: 2164, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:27:13,002 - src.order.base - INFO - Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:27:13,004 - src.order.base - INFO - Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 status changed: accepted -> filled (Order fully filled)
2025-06-12 14:27:13,005 - src.order.base - INFO - Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 filled: 32.0 @ 311.65 (32.0/32)
2025-06-12 14:27:13,004 - src.tws_connection - INFO - Open Order - ID: 2164, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:27:13,005 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:27:13,006 - src.tws_connection - INFO - Open Order - ID: 2164, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:27:13,007 - __main__ - INFO -    Order ID: 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:13,007 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:13,008 - __main__ - INFO -    Fill Price: $311.65
2025-06-12 14:27:13,009 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 14:27:13,009 - __main__ - INFO -    Status: filled
2025-06-12 14:27:13,009 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:27:13,009 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:13,010 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 14:27:13,010 - UnifiedFillManager - INFO - Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 fill status: filled, is_fully_filled: True
2025-06-12 14:27:13,010 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 64.0
2025-06-12 14:27:13,010 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=64.0, protective_qty=-64.0
2025-06-12 14:27:13,010 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:27:13,011 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 14:27:13,011 - UnifiedFillManager - INFO - Queueing update for stop order e519e8b9-297f-439e-94b6-06c050b42c45: current qty=-32, new qty=-64.0
2025-06-12 14:27:13,011 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:27:13,011 - UnifiedFillManager - INFO - Queueing update for target order 73279989-4ddb-42d9-8094-a54bfd44d044: current qty=-32, new qty=-64.0
2025-06-12 14:27:13,012 - UnifiedFillManager - INFO - Processing operation for GLD: replace_stop
2025-06-12 14:27:13,012 - src.order.base - INFO - Order e519e8b9-297f-439e-94b6-06c050b42c45 status changed: accepted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 14:27:13,012 - src.order.manager - INFO - Cancelling order e519e8b9-297f-439e-94b6-06c050b42c45 with broker ID 2162
2025-06-12 14:27:13,052 - src.order.base - INFO - Order e519e8b9-297f-439e-94b6-06c050b42c45 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 14:27:13,053 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2162)
2025-06-12 14:27:13,128 - src.order.base - INFO - Order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:27:13,129 - src.order.manager - INFO - Submitting order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c to TWS
2025-06-12 14:27:13,129 - src.order.manager - INFO - Got broker order ID 2165 for order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:13,129 - src.order.manager - INFO - Calling placeOrder with ID 2165, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 64@0.000000 DAY
2025-06-12 14:27:13,130 - src.order.manager - INFO - placeOrder called successfully for order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:13,130 - src.order.base - INFO - Order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:27:13,131 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 14:27:13,131 - UnifiedFillManager - INFO - Created updated stop order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c for GLD at $311.64 for -64.0 shares
2025-06-12 14:27:13,131 - UnifiedFillManager - INFO - Completed operation for GLD: replace_stop
2025-06-12 14:27:13,131 - UnifiedFillManager - INFO - Processing operation for GLD: replace_target
2025-06-12 14:27:13,132 - src.order.base - INFO - Order 73279989-4ddb-42d9-8094-a54bfd44d044 status changed: submitted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 14:27:13,132 - src.order.manager - INFO - Cancelling order 73279989-4ddb-42d9-8094-a54bfd44d044 with broker ID 2163
2025-06-12 14:27:13,132 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:27:13,132 - __main__ - INFO -    Order ID: 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:13,133 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:13,133 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 14:27:13,133 - __main__ - INFO -    Quantity: -64.0
2025-06-12 14:27:13,133 - __main__ - INFO -    Stop Price: $311.64
2025-06-12 14:27:13,133 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:13,134 - __main__ - INFO -    Order ID: 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:13,134 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:27:13,134 - __main__ - INFO -    Previous: created
2025-06-12 14:27:13,135 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:13,135 - __main__ - INFO -    Order ID: 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:13,135 - __main__ - INFO -    Status: submitted
2025-06-12 14:27:13,136 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:27:13,209 - src.tws_connection - INFO - Open Order - ID: 2165, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:27:13,210 - src.order.base - INFO - Order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:27:13,236 - src.order.base - INFO - Order 0255a624-56aa-4793-9861-d0316078364d status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:27:13,237 - src.order.manager - INFO - Submitting order 0255a624-56aa-4793-9861-d0316078364d to TWS
2025-06-12 14:27:13,238 - src.order.manager - INFO - Got broker order ID 2166 for order 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:13,238 - src.order.manager - INFO - Calling placeOrder with ID 2166, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 64@311.680000 DAY
2025-06-12 14:27:13,239 - src.order.manager - INFO - placeOrder called successfully for order 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:13,239 - src.order.base - INFO - Order 0255a624-56aa-4793-9861-d0316078364d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:27:13,240 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:27:13,240 - UnifiedFillManager - INFO - Created updated target order 0255a624-56aa-4793-9861-d0316078364d for GLD at $311.68 for -64.0 shares
2025-06-12 14:27:13,240 - UnifiedFillManager - INFO - Completed operation for GLD: replace_target
2025-06-12 14:27:13,241 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:27:13,241 - __main__ - INFO -    Order ID: 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:13,241 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:13,242 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:27:13,242 - __main__ - INFO -    Quantity: -64.0
2025-06-12 14:27:13,242 - __main__ - INFO -    Limit Price: $311.68
2025-06-12 14:27:13,243 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:13,243 - __main__ - INFO -    Order ID: 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:13,243 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:27:13,243 - __main__ - INFO -    Previous: created
2025-06-12 14:27:13,243 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:27:13,244 - __main__ - INFO -    Order ID: 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:13,244 - __main__ - INFO -    Status: submitted
2025-06-12 14:27:13,244 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:27:13,284 - src.order.base - INFO - Order 73279989-4ddb-42d9-8094-a54bfd44d044 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 14:27:13,284 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2163)
2025-06-12 14:27:13,359 - src.tws_connection - INFO - Open Order - ID: 2166, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:27:14,330 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 14:27:19,335 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:19,335 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 14:27:19,336 - __main__ - INFO - ================================================================================
2025-06-12 14:27:19,336 - __main__ - WARNING - No GLD context found!
2025-06-12 14:27:19,337 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 14:27:19,338 - __main__ - INFO -    Total orders created: 6
2025-06-12 14:27:19,338 - __main__ - INFO -    Market orders: 1
2025-06-12 14:27:19,338 - __main__ - INFO -    Stop orders: 2
2025-06-12 14:27:19,338 - __main__ - INFO -    Limit orders: 3
2025-06-12 14:27:19,338 - __main__ - WARNING - 
⚠️ WARNING: Expected 4 orders but got 6
2025-06-12 14:27:19,339 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 14:27:19,339 - __main__ - INFO - 
   Order #1:
2025-06-12 14:27:19,339 - __main__ - INFO -      ID: 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:19,339 - __main__ - INFO -      Type: market
2025-06-12 14:27:19,340 - __main__ - INFO -      Quantity: 32
2025-06-12 14:27:19,340 - __main__ - INFO - 
   Order #2:
2025-06-12 14:27:19,340 - __main__ - INFO -      ID: e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:19,340 - __main__ - INFO -      Type: stop
2025-06-12 14:27:19,340 - __main__ - INFO -      Quantity: -32
2025-06-12 14:27:19,340 - __main__ - INFO -      Stop: $311.64
2025-06-12 14:27:19,341 - __main__ - INFO - 
   Order #3:
2025-06-12 14:27:19,341 - __main__ - INFO -      ID: 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:19,341 - __main__ - INFO -      Type: limit
2025-06-12 14:27:19,341 - __main__ - INFO -      Quantity: -32
2025-06-12 14:27:19,341 - __main__ - INFO -      Limit: $311.68
2025-06-12 14:27:19,341 - __main__ - INFO - 
   Order #4:
2025-06-12 14:27:19,341 - __main__ - INFO -      ID: 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:19,341 - __main__ - INFO -      Type: limit
2025-06-12 14:27:19,341 - __main__ - INFO -      Quantity: 32
2025-06-12 14:27:19,342 - __main__ - INFO -      Limit: $311.65
2025-06-12 14:27:19,342 - __main__ - INFO - 
   Order #5:
2025-06-12 14:27:19,342 - __main__ - INFO -      ID: 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:19,342 - __main__ - INFO -      Type: stop
2025-06-12 14:27:19,342 - __main__ - INFO -      Quantity: -64.0
2025-06-12 14:27:19,342 - __main__ - INFO -      Stop: $311.64
2025-06-12 14:27:19,342 - __main__ - INFO - 
   Order #6:
2025-06-12 14:27:19,342 - __main__ - INFO -      ID: 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:19,342 - __main__ - INFO -      Type: limit
2025-06-12 14:27:19,342 - __main__ - INFO -      Quantity: -64.0
2025-06-12 14:27:19,343 - __main__ - INFO -      Limit: $311.68
2025-06-12 14:27:19,343 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 14:27:19,343 - __main__ - INFO -    Total fills received: 2
2025-06-12 14:27:19,343 - __main__ - INFO - 
   Fill #1:
2025-06-12 14:27:19,343 - __main__ - INFO -      Order ID: 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:19,343 - __main__ - INFO -      Quantity: 32.0
2025-06-12 14:27:19,343 - __main__ - INFO -      Price: $311.66
2025-06-12 14:27:19,343 - __main__ - INFO -      Status: filled
2025-06-12 14:27:19,344 - __main__ - INFO - 
   Fill #2:
2025-06-12 14:27:19,344 - __main__ - INFO -      Order ID: 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:19,344 - __main__ - INFO -      Quantity: 32.0
2025-06-12 14:27:19,344 - __main__ - INFO -      Price: $311.65
2025-06-12 14:27:19,344 - __main__ - INFO -      Status: filled
2025-06-12 14:27:19,344 - __main__ - INFO - 
📊 Monitoring position and orders...
2025-06-12 14:27:19,344 - __main__ - INFO - Waiting for fills:
2025-06-12 14:27:19,344 - __main__ - INFO -   - Double down to fill (increases position)
2025-06-12 14:27:19,344 - __main__ - INFO -   - Stop loss to fill (closes position)
2025-06-12 14:27:19,345 - __main__ - INFO -   - Take profit to fill (closes position)
2025-06-12 14:27:20,609 - src.order.base - INFO - Order 0255a624-56aa-4793-9861-d0316078364d status changed: submitted -> filled (Order fully filled)
2025-06-12 14:27:20,610 - src.order.base - INFO - Order 0255a624-56aa-4793-9861-d0316078364d filled: 64.0 @ 311.68 (64.0/64.0)
2025-06-12 14:27:20,610 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:27:20,611 - __main__ - INFO -    Order ID: 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:20,611 - src.tws_connection - INFO - Open Order - ID: 2166, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:27:20,611 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:27:20,612 - __main__ - INFO -    Fill Price: $311.68
2025-06-12 14:27:20,612 - __main__ - INFO -    Fill Quantity: 64.0
2025-06-12 14:27:20,612 - __main__ - INFO -    Status: filled
2025-06-12 14:27:20,611 - src.tws_connection - INFO - Open Order - ID: 2166, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:27:20,612 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:27:20,613 - UnifiedFillManager - INFO - Processing fill for GLD: 64.0 shares on order 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:20,613 - UnifiedFillManager - INFO - Fill is for target order
2025-06-12 14:27:20,613 - UnifiedFillManager - INFO - Order 0255a624-56aa-4793-9861-d0316078364d fill status: filled, is_fully_filled: True
2025-06-12 14:27:20,613 - UnifiedFillManager - INFO - Closing position for GLD: Target order fully filled
2025-06-12 14:27:20,613 - src.position.position_manager - INFO - Closed position for GLD
2025-06-12 14:27:20,614 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-12 14:27:20,614 - UnifiedFillManager - INFO - Position closed for GLD: cancellation queued, trackers updated
2025-06-12 14:27:20,614 - UnifiedFillManager - INFO - Processing operation for GLD: cancel_all
2025-06-12 14:27:20,614 - src.order.base - INFO - Order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c status changed: accepted -> pending_cancel (Position closed: Target order fully filled)
2025-06-12 14:27:20,614 - src.order.manager - INFO - Cancelling order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c with broker ID 2165
2025-06-12 14:27:20,615 - UnifiedFillManager - INFO - Cancelled 1 orders for GLD
2025-06-12 14:27:20,615 - UnifiedFillManager - INFO - Completed operation for GLD: cancel_all
2025-06-12 14:27:20,651 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2165)
2025-06-12 14:27:20,651 - src.order.base - INFO - Order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 14:27:21,357 - __main__ - INFO - 
🎯 New fill detected! Total fills: 3
2025-06-12 14:27:21,358 - __main__ - INFO - 
✅ Position closed via protective order
2025-06-12 14:27:24,361 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:24,361 - __main__ - INFO - FINAL ORDER STATE & VERIFICATION
2025-06-12 14:27:24,362 - __main__ - INFO - ================================================================================
2025-06-12 14:27:24,362 - __main__ - INFO - 
Checking current order states...
2025-06-12 14:27:24,362 - __main__ - INFO - 
Order 787d255d-e59b-4e13-b47a-d61fea61f360:
2025-06-12 14:27:24,362 - __main__ - INFO -   Type: market
2025-06-12 14:27:24,362 - __main__ - INFO -   Status: filled
2025-06-12 14:27:24,362 - __main__ - INFO -   Quantity: 32
2025-06-12 14:27:24,363 - __main__ - INFO -   Broker ID: 2161
2025-06-12 14:27:24,363 - __main__ - INFO - 
Order e519e8b9-297f-439e-94b6-06c050b42c45:
2025-06-12 14:27:24,363 - __main__ - INFO -   Type: stop
2025-06-12 14:27:24,363 - __main__ - INFO -   Status: cancelled
2025-06-12 14:27:24,363 - __main__ - INFO -   Quantity: -32
2025-06-12 14:27:24,363 - __main__ - INFO -   Broker ID: 2162
2025-06-12 14:27:24,364 - __main__ - INFO - 
Order 73279989-4ddb-42d9-8094-a54bfd44d044:
2025-06-12 14:27:24,364 - __main__ - INFO -   Type: limit
2025-06-12 14:27:24,364 - __main__ - INFO -   Status: cancelled
2025-06-12 14:27:24,364 - __main__ - INFO -   Quantity: -32
2025-06-12 14:27:24,364 - __main__ - INFO -   Broker ID: 2163
2025-06-12 14:27:24,364 - __main__ - INFO - 
Order 6fd585b1-152b-469d-a3ed-bc3b992a8b66:
2025-06-12 14:27:24,365 - __main__ - INFO -   Type: limit
2025-06-12 14:27:24,365 - __main__ - INFO -   Status: filled
2025-06-12 14:27:24,365 - __main__ - INFO -   Quantity: 32
2025-06-12 14:27:24,365 - __main__ - INFO -   Broker ID: 2164
2025-06-12 14:27:24,365 - __main__ - INFO - 
Order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c:
2025-06-12 14:27:24,365 - __main__ - INFO -   Type: stop
2025-06-12 14:27:24,366 - __main__ - INFO -   Status: cancelled
2025-06-12 14:27:24,366 - __main__ - INFO -   Quantity: -64.0
2025-06-12 14:27:24,366 - __main__ - INFO -   Broker ID: 2165
2025-06-12 14:27:24,366 - __main__ - INFO - 
Order 0255a624-56aa-4793-9861-d0316078364d:
2025-06-12 14:27:24,366 - __main__ - INFO -   Type: limit
2025-06-12 14:27:24,366 - __main__ - INFO -   Status: filled
2025-06-12 14:27:24,366 - __main__ - INFO -   Quantity: -64.0
2025-06-12 14:27:24,367 - __main__ - INFO -   Broker ID: 2166
2025-06-12 14:27:24,367 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:24,367 - __main__ - INFO - FLOW VERIFICATION
2025-06-12 14:27:24,367 - __main__ - INFO - ================================================================================
2025-06-12 14:27:24,368 - __main__ - INFO - ✓ Main order filled: True
2025-06-12 14:27:24,368 - __main__ - INFO - ✓ Double down filled: True
2025-06-12 14:27:24,368 - __main__ - INFO - ○ Stop loss filled: False
2025-06-12 14:27:24,368 - __main__ - INFO - ✓ Take profit filled: True
2025-06-12 14:27:24,368 - __main__ - INFO - 
✅ Take profit filled - all other orders should have been cancelled
2025-06-12 14:27:24,368 - __main__ - INFO - 
Total orders cancelled: 3
2025-06-12 14:27:24,368 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:24,369 - __main__ - INFO - TEST SUMMARY
2025-06-12 14:27:24,369 - __main__ - INFO - ================================================================================
2025-06-12 14:27:24,369 - __main__ - INFO - ✅ Position closed successfully via protective order
2025-06-12 14:27:24,369 - __main__ - INFO - ✅ UnifiedFillManager handled order cancellation correctly
2025-06-12 14:27:24,369 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:24,369 - __main__ - INFO - CLEANING UP TEST
2025-06-12 14:27:24,369 - __main__ - INFO - ================================================================================
2025-06-12 14:27:24,370 - __main__ - INFO - Cancelling 6 test orders...
2025-06-12 14:27:24,370 - src.order.manager - WARNING - Cannot cancel inactive order 787d255d-e59b-4e13-b47a-d61fea61f360 with status filled
2025-06-12 14:27:24,370 - __main__ - INFO -    Cancelled order 787d255d-e59b-4e13-b47a-d61fea61f360
2025-06-12 14:27:24,371 - src.order.manager - WARNING - Cannot cancel inactive order e519e8b9-297f-439e-94b6-06c050b42c45 with status cancelled
2025-06-12 14:27:24,371 - __main__ - INFO -    Cancelled order e519e8b9-297f-439e-94b6-06c050b42c45
2025-06-12 14:27:24,371 - src.order.manager - WARNING - Cannot cancel inactive order 73279989-4ddb-42d9-8094-a54bfd44d044 with status cancelled
2025-06-12 14:27:24,371 - __main__ - INFO -    Cancelled order 73279989-4ddb-42d9-8094-a54bfd44d044
2025-06-12 14:27:24,371 - src.order.manager - WARNING - Cannot cancel inactive order 6fd585b1-152b-469d-a3ed-bc3b992a8b66 with status filled
2025-06-12 14:27:24,371 - __main__ - INFO -    Cancelled order 6fd585b1-152b-469d-a3ed-bc3b992a8b66
2025-06-12 14:27:24,371 - src.order.manager - WARNING - Cannot cancel inactive order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c with status cancelled
2025-06-12 14:27:24,372 - __main__ - INFO -    Cancelled order 29e4471e-1bc6-44d3-8c87-8cee0c4d0c7c
2025-06-12 14:27:24,372 - src.order.manager - WARNING - Cannot cancel inactive order 0255a624-56aa-4793-9861-d0316078364d with status filled
2025-06-12 14:27:24,372 - __main__ - INFO -    Cancelled order 0255a624-56aa-4793-9861-d0316078364d
2025-06-12 14:27:24,372 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 14:27:24,373 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 14:27:24,373 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 14:27:24,373 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 14:27:24,373 - __main__ - INFO - Rule engine stopped
2025-06-12 14:27:24,373 - __main__ - INFO - 
Test cleanup complete
2025-06-12 14:27:24,373 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 14:27:24,374 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 14:27:24,374 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 14:27:24,374 - __main__ - INFO - Disconnected from TWS
2025-06-12 14:27:24,375 - __main__ - INFO - 
================================================================================
2025-06-12 14:27:24,375 - __main__ - INFO - TEST COMPLETE
2025-06-12 14:27:24,375 - __main__ - INFO - ================================================================================
2025-06-12 14:29:13,100 - __main__ - INFO - ================================================================================
2025-06-12 14:29:13,101 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 14:29:13,101 - __main__ - INFO - ================================================================================
2025-06-12 14:29:13,101 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 14:29:13,101 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 14:29:13,102 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 14:29:13,104 - __main__ - INFO - Connecting to TWS...
2025-06-12 14:29:13,104 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 14:29:13,105 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 14:29:15,852 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 14:29:15,853 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 14:29:15,861 - src.tws_connection - INFO - ✅ Next valid order ID received: 2167
2025-06-12 14:29:15,862 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 14:29:15,862 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 14:29:15,863 - src.tws_connection - INFO - ✅ Next valid order ID received: 2167
2025-06-12 14:29:15,863 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 14:29:15,863 - src.tws_connection - INFO - ✅ Next valid order ID received: 2167
2025-06-12 14:29:15,864 - __main__ - INFO - Connected to TWS successfully
2025-06-12 14:29:15,864 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 14:29:15,864 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 14:29:15,864 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 14:29:15,864 - __main__ - INFO - Rule engine context configured
2025-06-12 14:29:15,864 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 14:29:15,865 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 14:29:15,865 - __main__ - INFO - 
================================================================================
2025-06-12 14:29:15,865 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 14:29:15,865 - __main__ - INFO - ================================================================================
2025-06-12 14:29:15,865 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 14:29:15,865 - __main__ - INFO - Created BUY action ($10K allocation, 2.5x ATR stop, 2.5x ATR target)
2025-06-12 14:29:15,866 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 14:29:15,866 - __main__ - INFO - 
================================================================================
2025-06-12 14:29:15,866 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 14:29:15,866 - __main__ - INFO - ================================================================================
2025-06-12 14:29:20,873 - __main__ - INFO - Current GLD price: $311.65
2025-06-12 14:29:20,874 - __main__ - INFO - Created prediction event:
2025-06-12 14:29:20,874 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:29:20,875 - __main__ - INFO -    Signal: BUY
2025-06-12 14:29:20,875 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 14:29:20,876 - __main__ - INFO -    Price: $311.65
2025-06-12 14:29:20,876 - src.rule.engine - INFO - Rule engine started
2025-06-12 14:29:20,876 - __main__ - INFO - Rule engine started
2025-06-12 14:29:20,876 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 14:29:20,876 - __main__ - INFO - Prediction event emitted
2025-06-12 14:29:20,877 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 14:29:20,877 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 14:29:20,877 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 14:29:20,877 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 14:29:20,878 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 14:29:21,889 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.65 = $9972.80 (99.7% of $10000.00 allocation)
2025-06-12 14:29:21,890 - src.order.base - INFO - Order d503c8d8-75b2-4c30-a829-e0591bee135e status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:29:21,890 - src.order.manager - INFO - Submitting order d503c8d8-75b2-4c30-a829-e0591bee135e to TWS
2025-06-12 14:29:21,891 - src.order.manager - INFO - Got broker order ID 2167 for order d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:21,891 - src.order.manager - INFO - Calling placeOrder with ID 2167, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 14:29:21,891 - src.order.manager - INFO - placeOrder called successfully for order d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:21,892 - src.order.base - INFO - Order d503c8d8-75b2-4c30-a829-e0591bee135e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:29:21,892 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 14:29:21,911 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 14:29:21,911 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.59 (ATR: 0.0236 * 2.5 = 0.0589)
2025-06-12 14:29:21,912 - src.order.base - INFO - Order 9616346e-7068-4632-8e90-553bbc5c37e3 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:29:21,912 - src.order.manager - INFO - Submitting order 9616346e-7068-4632-8e90-553bbc5c37e3 to TWS
2025-06-12 14:29:21,912 - src.order.manager - INFO - Got broker order ID 2168 for order 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:21,912 - src.order.manager - INFO - Calling placeOrder with ID 2168, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 14:29:21,912 - src.order.manager - INFO - placeOrder called successfully for order 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:21,913 - src.order.base - INFO - Order 9616346e-7068-4632-8e90-553bbc5c37e3 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:29:21,913 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 14:29:21,913 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9616346e-7068-4632-8e90-553bbc5c37e3 at $311.59
2025-06-12 14:29:21,913 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.71 (ATR: 0.0236 * 2.5 = 0.0589)
2025-06-12 14:29:21,914 - src.order.base - INFO - Order 7c8d20ca-4957-44e9-825b-b6e83a8228b6 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:29:21,914 - src.order.manager - INFO - Submitting order 7c8d20ca-4957-44e9-825b-b6e83a8228b6 to TWS
2025-06-12 14:29:21,914 - src.order.manager - INFO - Got broker order ID 2169 for order 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:21,914 - src.order.manager - INFO - Calling placeOrder with ID 2169, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.710000 DAY
2025-06-12 14:29:21,914 - src.order.manager - INFO - placeOrder called successfully for order 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:21,915 - src.order.base - INFO - Order 7c8d20ca-4957-44e9-825b-b6e83a8228b6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:29:21,915 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:29:21,915 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 7c8d20ca-4957-44e9-825b-b6e83a8228b6 at $311.71
2025-06-12 14:29:21,915 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 14:29:21,915 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:29:21,916 - __main__ - INFO -    Order ID: d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:21,916 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:29:21,916 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 14:29:21,916 - __main__ - INFO -    Quantity: 32
2025-06-12 14:29:21,916 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:21,916 - __main__ - INFO -    Order ID: d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:21,916 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:29:21,917 - __main__ - INFO -    Previous: created
2025-06-12 14:29:21,917 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:21,917 - __main__ - INFO -    Order ID: d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:21,917 - __main__ - INFO -    Status: submitted
2025-06-12 14:29:21,917 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:29:21,917 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:29:21,918 - __main__ - INFO -    Order ID: 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:21,918 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:29:21,918 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 14:29:21,918 - __main__ - INFO -    Quantity: -32
2025-06-12 14:29:21,919 - __main__ - INFO -    Stop Price: $311.59
2025-06-12 14:29:21,919 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:21,919 - __main__ - INFO -    Order ID: 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:21,919 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:29:21,919 - __main__ - INFO -    Previous: created
2025-06-12 14:29:21,920 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:21,920 - __main__ - INFO -    Order ID: 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:21,921 - __main__ - INFO -    Status: submitted
2025-06-12 14:29:21,921 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:29:21,921 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:29:21,921 - __main__ - INFO -    Order ID: 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:21,922 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:29:21,922 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:29:21,922 - __main__ - INFO -    Quantity: -32
2025-06-12 14:29:21,922 - __main__ - INFO -    Limit Price: $311.71
2025-06-12 14:29:21,922 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:21,922 - __main__ - INFO -    Order ID: 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:21,923 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:29:21,923 - __main__ - INFO -    Previous: created
2025-06-12 14:29:21,923 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:21,923 - __main__ - INFO -    Order ID: 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:21,923 - __main__ - INFO -    Status: submitted
2025-06-12 14:29:21,924 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:29:21,990 - src.tws_connection - INFO - Open Order - ID: 2167, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:29:21,991 - src.order.base - INFO - Order d503c8d8-75b2-4c30-a829-e0591bee135e status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:29:22,000 - src.order.base - INFO - Order d503c8d8-75b2-4c30-a829-e0591bee135e status changed: accepted -> filled (Order fully filled)
2025-06-12 14:29:22,001 - src.order.base - INFO - Order d503c8d8-75b2-4c30-a829-e0591bee135e filled: 32.0 @ 311.66 (32.0/32)
2025-06-12 14:29:22,000 - src.tws_connection - INFO - Open Order - ID: 2167, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:29:22,002 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:29:22,002 - src.tws_connection - INFO - Open Order - ID: 2167, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:29:22,003 - __main__ - INFO -    Order ID: d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:22,004 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:29:22,004 - __main__ - INFO -    Fill Price: $311.66
2025-06-12 14:29:22,005 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 14:29:22,005 - __main__ - INFO -    Status: filled
2025-06-12 14:29:22,005 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:29:22,006 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:22,006 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 14:29:22,006 - UnifiedFillManager - INFO - Order d503c8d8-75b2-4c30-a829-e0591bee135e fill status: filled, is_fully_filled: True
2025-06-12 14:29:22,007 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 14:29:22,008 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 14:29:22,008 - UnifiedFillManager - INFO -   Main orders: {'d503c8d8-75b2-4c30-a829-e0591bee135e'}
2025-06-12 14:29:22,008 - UnifiedFillManager - INFO -   Stop orders: {'9616346e-7068-4632-8e90-553bbc5c37e3'}
2025-06-12 14:29:22,009 - UnifiedFillManager - INFO -   Target orders: {'7c8d20ca-4957-44e9-825b-b6e83a8228b6'}
2025-06-12 14:29:22,009 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 14:29:22,010 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 14:29:22,010 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 14:29:22,011 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 14:29:22,011 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:29:22,012 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 14:29:22,012 - UnifiedFillManager - INFO - Stop order 9616346e-7068-4632-8e90-553bbc5c37e3 already has correct quantity -32, no update needed
2025-06-12 14:29:22,012 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:29:22,012 - UnifiedFillManager - INFO - Target order 7c8d20ca-4957-44e9-825b-b6e83a8228b6 already has correct quantity -32, no update needed
2025-06-12 14:29:22,013 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 14:29:22,033 - src.tws_connection - INFO - Open Order - ID: 2168, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:29:22,035 - src.order.base - INFO - Order 9616346e-7068-4632-8e90-553bbc5c37e3 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:29:22,035 - src.tws_connection - INFO - Open Order - ID: 2169, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:29:22,424 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9616346e-7068-4632-8e90-553bbc5c37e3']
2025-06-12 14:29:22,425 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 14:29:22,425 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.65
2025-06-12 14:29:22,444 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0589
2025-06-12 14:29:22,445 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.65, stop_distance=$0.06, dd_distance=$0.03, dd_price=$311.62, original_qty=32, dd_qty=32
2025-06-12 14:29:22,445 - src.order.base - INFO - Order 84e0c96a-f7c0-4328-8b16-3a9364f52de4 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:29:22,446 - src.order.manager - INFO - Submitting order 84e0c96a-f7c0-4328-8b16-3a9364f52de4 to TWS
2025-06-12 14:29:22,446 - src.order.manager - INFO - Got broker order ID 2170 for order 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:22,446 - src.order.manager - INFO - Calling placeOrder with ID 2170, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.620000 DAY
2025-06-12 14:29:22,447 - src.order.manager - INFO - placeOrder called successfully for order 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:22,447 - src.order.base - INFO - Order 84e0c96a-f7c0-4328-8b16-3a9364f52de4 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:29:22,447 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 14:29:22,448 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.62
2025-06-12 14:29:22,448 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 14:29:22,448 - src.rule.linked_order_actions - INFO - Created and linked BUY main order d503c8d8-75b2-4c30-a829-e0591bee135e for GLD
2025-06-12 14:29:22,448 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:29:22,448 - __main__ - INFO -    Order ID: 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:22,449 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:29:22,449 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:29:22,449 - __main__ - INFO -    Quantity: 32
2025-06-12 14:29:22,449 - __main__ - INFO -    Limit Price: $311.62
2025-06-12 14:29:22,450 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:22,450 - __main__ - INFO -    Order ID: 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:22,450 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:29:22,450 - __main__ - INFO -    Previous: created
2025-06-12 14:29:22,450 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:29:22,451 - __main__ - INFO -    Order ID: 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:22,451 - __main__ - INFO -    Status: submitted
2025-06-12 14:29:22,451 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:29:22,535 - src.tws_connection - INFO - Open Order - ID: 2170, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:29:23,892 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 14:29:28,895 - __main__ - INFO - 
================================================================================
2025-06-12 14:29:28,896 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 14:29:28,896 - __main__ - INFO - ================================================================================
2025-06-12 14:29:28,896 - __main__ - WARNING - No GLD context found!
2025-06-12 14:29:28,896 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 14:29:28,897 - __main__ - INFO -    Total orders created: 4
2025-06-12 14:29:28,897 - __main__ - INFO -    Market orders: 1
2025-06-12 14:29:28,897 - __main__ - INFO -    Stop orders: 1
2025-06-12 14:29:28,897 - __main__ - INFO -    Limit orders: 2
2025-06-12 14:29:28,897 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 14:29:28,898 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 14:29:28,898 - __main__ - INFO - 
   Order #1:
2025-06-12 14:29:28,898 - __main__ - INFO -      ID: d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:28,898 - __main__ - INFO -      Type: market
2025-06-12 14:29:28,898 - __main__ - INFO -      Quantity: 32
2025-06-12 14:29:28,898 - __main__ - INFO - 
   Order #2:
2025-06-12 14:29:28,898 - __main__ - INFO -      ID: 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:28,899 - __main__ - INFO -      Type: stop
2025-06-12 14:29:28,899 - __main__ - INFO -      Quantity: -32
2025-06-12 14:29:28,899 - __main__ - INFO -      Stop: $311.59
2025-06-12 14:29:28,899 - __main__ - INFO - 
   Order #3:
2025-06-12 14:29:28,899 - __main__ - INFO -      ID: 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:28,900 - __main__ - INFO -      Type: limit
2025-06-12 14:29:28,900 - __main__ - INFO -      Quantity: -32
2025-06-12 14:29:28,900 - __main__ - INFO -      Limit: $311.71
2025-06-12 14:29:28,900 - __main__ - INFO - 
   Order #4:
2025-06-12 14:29:28,900 - __main__ - INFO -      ID: 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:28,900 - __main__ - INFO -      Type: limit
2025-06-12 14:29:28,900 - __main__ - INFO -      Quantity: 32
2025-06-12 14:29:28,901 - __main__ - INFO -      Limit: $311.62
2025-06-12 14:29:28,901 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 14:29:28,901 - __main__ - INFO -    Total fills received: 1
2025-06-12 14:29:28,901 - __main__ - INFO - 
   Fill #1:
2025-06-12 14:29:28,902 - __main__ - INFO -      Order ID: d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:28,902 - __main__ - INFO -      Quantity: 32.0
2025-06-12 14:29:28,902 - __main__ - INFO -      Price: $311.66
2025-06-12 14:29:28,902 - __main__ - INFO -      Status: filled
2025-06-12 14:29:28,902 - __main__ - INFO - 
📊 Monitoring position and orders...
2025-06-12 14:29:28,903 - __main__ - INFO - Waiting for fills:
2025-06-12 14:29:28,903 - __main__ - INFO -   - Double down to fill (increases position)
2025-06-12 14:29:28,904 - __main__ - INFO -   - Stop loss to fill (closes position)
2025-06-12 14:29:28,904 - __main__ - INFO -   - Take profit to fill (closes position)
2025-06-12 14:29:30,907 - __main__ - ERROR - 
❌ Test failed with error: 'PositionTracker' object has no attribute 'get_positions'
Traceback (most recent call last):
  File "C:\Users\panga\Documents\IBKR\tests\tws_order_management\test_live_slv_buy_flow_unified.py", line 670, in main
    await test.verify_orders()
  File "C:\Users\panga\Documents\IBKR\tests\tws_order_management\test_live_slv_buy_flow_unified.py", line 508, in verify_orders
    positions = position_tracker.get_positions()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PositionTracker' object has no attribute 'get_positions'. Did you mean: 'get_position'?
2025-06-12 14:29:30,915 - __main__ - INFO - 
================================================================================
2025-06-12 14:29:30,915 - __main__ - INFO - CLEANING UP TEST
2025-06-12 14:29:30,915 - __main__ - INFO - ================================================================================
2025-06-12 14:29:30,916 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 14:29:30,916 - src.order.manager - WARNING - Cannot cancel inactive order d503c8d8-75b2-4c30-a829-e0591bee135e with status filled
2025-06-12 14:29:30,916 - __main__ - INFO -    Cancelled order d503c8d8-75b2-4c30-a829-e0591bee135e
2025-06-12 14:29:30,916 - src.order.base - INFO - Order 9616346e-7068-4632-8e90-553bbc5c37e3 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-12 14:29:30,917 - src.order.manager - INFO - Cancelling order 9616346e-7068-4632-8e90-553bbc5c37e3 with broker ID 2168
2025-06-12 14:29:30,917 - __main__ - INFO -    Cancelled order 9616346e-7068-4632-8e90-553bbc5c37e3
2025-06-12 14:29:30,917 - src.order.base - INFO - Order 7c8d20ca-4957-44e9-825b-b6e83a8228b6 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 14:29:30,918 - src.order.manager - INFO - Cancelling order 7c8d20ca-4957-44e9-825b-b6e83a8228b6 with broker ID 2169
2025-06-12 14:29:30,918 - __main__ - INFO -    Cancelled order 7c8d20ca-4957-44e9-825b-b6e83a8228b6
2025-06-12 14:29:30,919 - src.order.base - INFO - Order 84e0c96a-f7c0-4328-8b16-3a9364f52de4 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-12 14:29:30,920 - src.order.manager - INFO - Cancelling order 84e0c96a-f7c0-4328-8b16-3a9364f52de4 with broker ID 2170
2025-06-12 14:29:30,923 - __main__ - INFO -    Cancelled order 84e0c96a-f7c0-4328-8b16-3a9364f52de4
2025-06-12 14:29:30,924 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 14:29:30,924 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 14:29:30,924 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 14:29:30,925 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 14:29:30,925 - __main__ - INFO - Rule engine stopped
2025-06-12 14:29:30,925 - __main__ - INFO - 
Test cleanup complete
2025-06-12 14:29:30,926 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 14:29:30,926 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 14:29:30,927 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 14:29:30,927 - __main__ - INFO - Disconnected from TWS
2025-06-12 14:29:30,927 - __main__ - INFO - 
================================================================================
2025-06-12 14:29:30,928 - __main__ - INFO - TEST COMPLETE
2025-06-12 14:29:30,928 - __main__ - INFO - ================================================================================
2025-06-12 14:31:04,138 - __main__ - INFO - ================================================================================
2025-06-12 14:31:04,139 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 14:31:04,139 - __main__ - INFO - ================================================================================
2025-06-12 14:31:04,139 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 14:31:04,140 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 14:31:04,140 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 14:31:04,142 - __main__ - INFO - Connecting to TWS...
2025-06-12 14:31:04,142 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 14:31:04,144 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 14:31:10,421 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 14:31:10,422 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 14:31:10,438 - src.tws_connection - INFO - ✅ Next valid order ID received: 2171
2025-06-12 14:31:10,439 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 14:31:10,439 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 14:31:10,440 - src.tws_connection - INFO - ✅ Next valid order ID received: 2171
2025-06-12 14:31:10,441 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 14:31:10,442 - src.tws_connection - INFO - ✅ Next valid order ID received: 2171
2025-06-12 14:31:10,443 - __main__ - INFO - Connected to TWS successfully
2025-06-12 14:31:10,443 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 14:31:10,443 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 14:31:10,444 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 14:31:10,444 - __main__ - INFO - Rule engine context configured
2025-06-12 14:31:10,444 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 14:31:10,444 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 14:31:10,444 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:10,445 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 14:31:10,445 - __main__ - INFO - ================================================================================
2025-06-12 14:31:10,445 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 14:31:10,445 - __main__ - INFO - Created BUY action ($10K allocation, 2.5x ATR stop, 2.5x ATR target)
2025-06-12 14:31:10,446 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 14:31:10,446 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:10,446 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 14:31:10,446 - __main__ - INFO - ================================================================================
2025-06-12 14:31:15,459 - __main__ - INFO - Current GLD price: $311.73
2025-06-12 14:31:15,459 - __main__ - INFO - Created prediction event:
2025-06-12 14:31:15,460 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:15,460 - __main__ - INFO -    Signal: BUY
2025-06-12 14:31:15,460 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 14:31:15,461 - __main__ - INFO -    Price: $311.73
2025-06-12 14:31:15,461 - src.rule.engine - INFO - Rule engine started
2025-06-12 14:31:15,461 - __main__ - INFO - Rule engine started
2025-06-12 14:31:15,461 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 14:31:15,462 - __main__ - INFO - Prediction event emitted
2025-06-12 14:31:15,462 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 14:31:15,462 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 14:31:15,463 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 14:31:15,463 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 14:31:15,463 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 14:31:16,473 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.72 = $9975.04 (99.8% of $10000.00 allocation)
2025-06-12 14:31:16,474 - src.order.base - INFO - Order f31cbf3d-2695-4702-9118-967ad63a6164 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:16,475 - src.order.manager - INFO - Submitting order f31cbf3d-2695-4702-9118-967ad63a6164 to TWS
2025-06-12 14:31:16,476 - src.order.manager - INFO - Got broker order ID 2171 for order f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,476 - src.order.manager - INFO - Calling placeOrder with ID 2171, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 14:31:16,476 - src.order.manager - INFO - placeOrder called successfully for order f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,477 - src.order.base - INFO - Order f31cbf3d-2695-4702-9118-967ad63a6164 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:16,477 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 14:31:16,495 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 14:31:16,496 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.67 (ATR: 0.0236 * 2.5 = 0.0589)
2025-06-12 14:31:16,496 - src.order.base - INFO - Order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:16,496 - src.order.manager - INFO - Submitting order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b to TWS
2025-06-12 14:31:16,496 - src.order.manager - INFO - Got broker order ID 2172 for order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:16,497 - src.order.manager - INFO - Calling placeOrder with ID 2172, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 14:31:16,497 - src.order.manager - INFO - placeOrder called successfully for order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:16,497 - src.order.base - INFO - Order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:16,497 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 14:31:16,497 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b at $311.67
2025-06-12 14:31:16,497 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.79 (ATR: 0.0236 * 2.5 = 0.0589)
2025-06-12 14:31:16,498 - src.order.base - INFO - Order 6e7468da-6dfe-4638-b892-62225541d698 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:16,498 - src.order.manager - INFO - Submitting order 6e7468da-6dfe-4638-b892-62225541d698 to TWS
2025-06-12 14:31:16,498 - src.order.manager - INFO - Got broker order ID 2173 for order 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:16,498 - src.order.manager - INFO - Calling placeOrder with ID 2173, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.790000 DAY
2025-06-12 14:31:16,498 - src.order.manager - INFO - placeOrder called successfully for order 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:16,499 - src.order.base - INFO - Order 6e7468da-6dfe-4638-b892-62225541d698 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:16,499 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:31:16,499 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 6e7468da-6dfe-4638-b892-62225541d698 at $311.79
2025-06-12 14:31:16,499 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 14:31:16,499 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:16,499 - __main__ - INFO -    Order ID: f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,499 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:16,500 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 14:31:16,500 - __main__ - INFO -    Quantity: 32
2025-06-12 14:31:16,500 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:16,500 - __main__ - INFO -    Order ID: f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,500 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:16,500 - __main__ - INFO -    Previous: created
2025-06-12 14:31:16,500 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:16,500 - __main__ - INFO -    Order ID: f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,501 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:16,501 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:16,501 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:16,501 - __main__ - INFO -    Order ID: 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:16,501 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:16,501 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 14:31:16,501 - __main__ - INFO -    Quantity: -32
2025-06-12 14:31:16,501 - __main__ - INFO -    Stop Price: $311.67
2025-06-12 14:31:16,502 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:16,502 - __main__ - INFO -    Order ID: 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:16,502 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:16,502 - __main__ - INFO -    Previous: created
2025-06-12 14:31:16,502 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:16,502 - __main__ - INFO -    Order ID: 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:16,502 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:16,504 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:16,505 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:16,505 - __main__ - INFO -    Order ID: 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:16,505 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:16,505 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:31:16,505 - __main__ - INFO -    Quantity: -32
2025-06-12 14:31:16,505 - __main__ - INFO -    Limit Price: $311.79
2025-06-12 14:31:16,506 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:16,506 - __main__ - INFO -    Order ID: 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:16,506 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:16,506 - __main__ - INFO -    Previous: created
2025-06-12 14:31:16,506 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:16,507 - __main__ - INFO -    Order ID: 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:16,507 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:16,508 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:16,575 - src.tws_connection - INFO - Open Order - ID: 2171, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:31:16,577 - src.order.base - INFO - Order f31cbf3d-2695-4702-9118-967ad63a6164 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:31:16,583 - src.order.base - INFO - Order f31cbf3d-2695-4702-9118-967ad63a6164 status changed: accepted -> filled (Order fully filled)
2025-06-12 14:31:16,582 - src.tws_connection - INFO - Open Order - ID: 2171, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:31:16,584 - src.order.base - INFO - Order f31cbf3d-2695-4702-9118-967ad63a6164 filled: 32.0 @ 311.73 (32.0/32)
2025-06-12 14:31:16,584 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:31:16,586 - __main__ - INFO -    Order ID: f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,587 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:16,586 - src.tws_connection - INFO - Open Order - ID: 2171, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:31:16,588 - __main__ - INFO -    Fill Price: $311.73
2025-06-12 14:31:16,589 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 14:31:16,589 - __main__ - INFO -    Status: filled
2025-06-12 14:31:16,590 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:31:16,590 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:16,591 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 14:31:16,591 - UnifiedFillManager - INFO - Order f31cbf3d-2695-4702-9118-967ad63a6164 fill status: filled, is_fully_filled: True
2025-06-12 14:31:16,591 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 14:31:16,592 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 14:31:16,593 - UnifiedFillManager - INFO -   Main orders: {'f31cbf3d-2695-4702-9118-967ad63a6164'}
2025-06-12 14:31:16,593 - UnifiedFillManager - INFO -   Stop orders: {'9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b'}
2025-06-12 14:31:16,593 - UnifiedFillManager - INFO -   Target orders: {'6e7468da-6dfe-4638-b892-62225541d698'}
2025-06-12 14:31:16,593 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 14:31:16,594 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 14:31:16,595 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 14:31:16,595 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 14:31:16,595 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:31:16,595 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 14:31:16,596 - UnifiedFillManager - INFO - Stop order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b already has correct quantity -32, no update needed
2025-06-12 14:31:16,596 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:31:16,596 - UnifiedFillManager - INFO - Target order 6e7468da-6dfe-4638-b892-62225541d698 already has correct quantity -32, no update needed
2025-06-12 14:31:16,597 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 14:31:16,620 - src.tws_connection - INFO - Open Order - ID: 2172, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:31:16,622 - src.order.base - INFO - Order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:31:16,621 - src.tws_connection - INFO - Open Order - ID: 2173, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:31:17,009 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b']
2025-06-12 14:31:17,009 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 14:31:17,010 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.73
2025-06-12 14:31:17,027 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0589
2025-06-12 14:31:17,027 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.73, stop_distance=$0.06, dd_distance=$0.03, dd_price=$311.70, original_qty=32, dd_qty=32
2025-06-12 14:31:17,028 - src.order.base - INFO - Order 893be363-cfb2-49fb-82d3-136ea32938dc status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:17,028 - src.order.manager - INFO - Submitting order 893be363-cfb2-49fb-82d3-136ea32938dc to TWS
2025-06-12 14:31:17,028 - src.order.manager - INFO - Got broker order ID 2174 for order 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,028 - src.order.manager - INFO - Calling placeOrder with ID 2174, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.700000 DAY
2025-06-12 14:31:17,029 - src.order.manager - INFO - placeOrder called successfully for order 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,029 - src.order.base - INFO - Order 893be363-cfb2-49fb-82d3-136ea32938dc status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:17,029 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 14:31:17,029 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.70
2025-06-12 14:31:17,029 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 14:31:17,029 - src.rule.linked_order_actions - INFO - Created and linked BUY main order f31cbf3d-2695-4702-9118-967ad63a6164 for GLD
2025-06-12 14:31:17,029 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:17,030 - __main__ - INFO -    Order ID: 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,030 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:17,030 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:31:17,030 - __main__ - INFO -    Quantity: 32
2025-06-12 14:31:17,031 - __main__ - INFO -    Limit Price: $311.70
2025-06-12 14:31:17,031 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:17,031 - __main__ - INFO -    Order ID: 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,031 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:17,031 - __main__ - INFO -    Previous: created
2025-06-12 14:31:17,031 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:17,031 - __main__ - INFO -    Order ID: 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,031 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:17,031 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:17,135 - src.tws_connection - INFO - Open Order - ID: 2174, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:31:17,422 - src.order.base - INFO - Order 893be363-cfb2-49fb-82d3-136ea32938dc status changed: submitted -> filled (Order fully filled)
2025-06-12 14:31:17,423 - src.tws_connection - INFO - Open Order - ID: 2174, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:31:17,423 - src.order.base - INFO - Order 893be363-cfb2-49fb-82d3-136ea32938dc filled: 32.0 @ 311.7 (32.0/32)
2025-06-12 14:31:17,424 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:31:17,425 - __main__ - INFO -    Order ID: 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,425 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:17,426 - __main__ - INFO -    Fill Price: $311.70
2025-06-12 14:31:17,426 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 14:31:17,426 - __main__ - INFO -    Status: filled
2025-06-12 14:31:17,426 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:31:17,426 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:17,426 - UnifiedFillManager - INFO - Fill is for doubledown order
2025-06-12 14:31:17,426 - UnifiedFillManager - INFO - Order 893be363-cfb2-49fb-82d3-136ea32938dc fill status: filled, is_fully_filled: True
2025-06-12 14:31:17,427 - UnifiedFillManager - INFO - Double down fill for GLD, new position size: 64.0
2025-06-12 14:31:17,427 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=64.0, protective_qty=-64.0
2025-06-12 14:31:17,427 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:31:17,427 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 14:31:17,428 - UnifiedFillManager - INFO - Queueing update for stop order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b: current qty=-32, new qty=-64.0
2025-06-12 14:31:17,429 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:31:17,429 - UnifiedFillManager - INFO - Queueing update for target order 6e7468da-6dfe-4638-b892-62225541d698: current qty=-32, new qty=-64.0
2025-06-12 14:31:17,429 - UnifiedFillManager - INFO - Processing operation for GLD: replace_stop
2025-06-12 14:31:17,430 - src.order.base - INFO - Order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b status changed: accepted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 14:31:17,430 - src.order.manager - INFO - Cancelling order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b with broker ID 2172
2025-06-12 14:31:17,443 - src.tws_connection - INFO - Open Order - ID: 2174, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:31:17,467 - src.order.base - INFO - Order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 14:31:17,467 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2172)
2025-06-12 14:31:17,533 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:17,533 - src.order.manager - INFO - Submitting order 8712ffc5-b273-4fd2-b363-f00eb7e8353d to TWS
2025-06-12 14:31:17,534 - src.order.manager - INFO - Got broker order ID 2175 for order 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:17,534 - src.order.manager - INFO - Calling placeOrder with ID 2175, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 64@0.000000 DAY
2025-06-12 14:31:17,535 - src.order.manager - INFO - placeOrder called successfully for order 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:17,535 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:17,536 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 14:31:17,536 - UnifiedFillManager - INFO - Created updated stop order 8712ffc5-b273-4fd2-b363-f00eb7e8353d for GLD at $311.67 for -64.0 shares
2025-06-12 14:31:17,536 - UnifiedFillManager - INFO - Completed operation for GLD: replace_stop
2025-06-12 14:31:17,537 - UnifiedFillManager - INFO - Processing operation for GLD: replace_target
2025-06-12 14:31:17,537 - src.order.base - INFO - Order 6e7468da-6dfe-4638-b892-62225541d698 status changed: submitted -> pending_cancel (Updating quantity to -64.0)
2025-06-12 14:31:17,538 - src.order.manager - INFO - Cancelling order 6e7468da-6dfe-4638-b892-62225541d698 with broker ID 2173
2025-06-12 14:31:17,539 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:17,539 - __main__ - INFO -    Order ID: 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:17,539 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:17,539 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 14:31:17,540 - __main__ - INFO -    Quantity: -64.0
2025-06-12 14:31:17,540 - __main__ - INFO -    Stop Price: $311.67
2025-06-12 14:31:17,540 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:17,541 - __main__ - INFO -    Order ID: 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:17,541 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:17,541 - __main__ - INFO -    Previous: created
2025-06-12 14:31:17,541 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:17,542 - __main__ - INFO -    Order ID: 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:17,542 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:17,542 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:17,611 - src.order.base - INFO - Order 6e7468da-6dfe-4638-b892-62225541d698 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 14:31:17,611 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2173)
2025-06-12 14:31:17,622 - src.tws_connection - INFO - Open Order - ID: 2175, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:17,623 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:31:17,641 - src.order.base - INFO - Order ab487fd9-883b-4fb5-966b-06163c4af096 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:17,641 - src.order.manager - INFO - Submitting order ab487fd9-883b-4fb5-966b-06163c4af096 to TWS
2025-06-12 14:31:17,641 - src.order.manager - INFO - Got broker order ID 2176 for order ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:17,642 - src.order.manager - INFO - Calling placeOrder with ID 2176, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 64@311.790000 DAY
2025-06-12 14:31:17,642 - src.order.manager - INFO - placeOrder called successfully for order ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:17,642 - src.order.base - INFO - Order ab487fd9-883b-4fb5-966b-06163c4af096 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:17,642 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:31:17,642 - UnifiedFillManager - INFO - Created updated target order ab487fd9-883b-4fb5-966b-06163c4af096 for GLD at $311.79 for -64.0 shares
2025-06-12 14:31:17,643 - UnifiedFillManager - INFO - Completed operation for GLD: replace_target
2025-06-12 14:31:17,643 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:17,643 - __main__ - INFO -    Order ID: ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:17,643 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:17,643 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:31:17,643 - __main__ - INFO -    Quantity: -64.0
2025-06-12 14:31:17,644 - __main__ - INFO -    Limit Price: $311.79
2025-06-12 14:31:17,644 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:17,644 - __main__ - INFO -    Order ID: ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:17,644 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:17,644 - __main__ - INFO -    Previous: created
2025-06-12 14:31:17,645 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:17,645 - __main__ - INFO -    Order ID: ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:17,645 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:17,645 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:17,736 - src.tws_connection - INFO - Open Order - ID: 2176, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:18,475 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 14:31:23,477 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:23,478 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 14:31:23,478 - __main__ - INFO - ================================================================================
2025-06-12 14:31:23,478 - __main__ - WARNING - No GLD context found!
2025-06-12 14:31:23,478 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 14:31:23,478 - __main__ - INFO -    Total orders created: 6
2025-06-12 14:31:23,479 - __main__ - INFO -    Market orders: 1
2025-06-12 14:31:23,479 - __main__ - INFO -    Stop orders: 2
2025-06-12 14:31:23,479 - __main__ - INFO -    Limit orders: 3
2025-06-12 14:31:23,479 - __main__ - WARNING - 
⚠️ WARNING: Expected 4 orders but got 6
2025-06-12 14:31:23,480 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 14:31:23,480 - __main__ - INFO - 
   Order #1:
2025-06-12 14:31:23,480 - __main__ - INFO -      ID: f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:23,480 - __main__ - INFO -      Type: market
2025-06-12 14:31:23,481 - __main__ - INFO -      Quantity: 32
2025-06-12 14:31:23,481 - __main__ - INFO - 
   Order #2:
2025-06-12 14:31:23,481 - __main__ - INFO -      ID: 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:23,481 - __main__ - INFO -      Type: stop
2025-06-12 14:31:23,481 - __main__ - INFO -      Quantity: -32
2025-06-12 14:31:23,482 - __main__ - INFO -      Stop: $311.67
2025-06-12 14:31:23,482 - __main__ - INFO - 
   Order #3:
2025-06-12 14:31:23,482 - __main__ - INFO -      ID: 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:23,482 - __main__ - INFO -      Type: limit
2025-06-12 14:31:23,482 - __main__ - INFO -      Quantity: -32
2025-06-12 14:31:23,483 - __main__ - INFO -      Limit: $311.79
2025-06-12 14:31:23,483 - __main__ - INFO - 
   Order #4:
2025-06-12 14:31:23,483 - __main__ - INFO -      ID: 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:23,483 - __main__ - INFO -      Type: limit
2025-06-12 14:31:23,483 - __main__ - INFO -      Quantity: 32
2025-06-12 14:31:23,484 - __main__ - INFO -      Limit: $311.70
2025-06-12 14:31:23,484 - __main__ - INFO - 
   Order #5:
2025-06-12 14:31:23,484 - __main__ - INFO -      ID: 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:23,484 - __main__ - INFO -      Type: stop
2025-06-12 14:31:23,484 - __main__ - INFO -      Quantity: -64.0
2025-06-12 14:31:23,484 - __main__ - INFO -      Stop: $311.67
2025-06-12 14:31:23,484 - __main__ - INFO - 
   Order #6:
2025-06-12 14:31:23,484 - __main__ - INFO -      ID: ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:23,485 - __main__ - INFO -      Type: limit
2025-06-12 14:31:23,485 - __main__ - INFO -      Quantity: -64.0
2025-06-12 14:31:23,485 - __main__ - INFO -      Limit: $311.79
2025-06-12 14:31:23,485 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 14:31:23,485 - __main__ - INFO -    Total fills received: 2
2025-06-12 14:31:23,485 - __main__ - INFO - 
   Fill #1:
2025-06-12 14:31:23,485 - __main__ - INFO -      Order ID: f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:23,485 - __main__ - INFO -      Quantity: 32.0
2025-06-12 14:31:23,486 - __main__ - INFO -      Price: $311.73
2025-06-12 14:31:23,486 - __main__ - INFO -      Status: filled
2025-06-12 14:31:23,486 - __main__ - INFO - 
   Fill #2:
2025-06-12 14:31:23,486 - __main__ - INFO -      Order ID: 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:23,487 - __main__ - INFO -      Quantity: 32.0
2025-06-12 14:31:23,487 - __main__ - INFO -      Price: $311.70
2025-06-12 14:31:23,487 - __main__ - INFO -      Status: filled
2025-06-12 14:31:23,487 - __main__ - INFO - 
📊 Monitoring position and orders...
2025-06-12 14:31:23,487 - __main__ - INFO - Waiting for fills:
2025-06-12 14:31:23,488 - __main__ - INFO -   - Double down to fill (increases position)
2025-06-12 14:31:23,488 - __main__ - INFO -   - Stop loss to fill (closes position)
2025-06-12 14:31:23,488 - __main__ - INFO -   - Take profit to fill (closes position)
2025-06-12 14:31:32,911 - src.tws_connection - INFO - Open Order - ID: 2175, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:32,932 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d status changed: accepted -> partially_filled (Order partially filled)
2025-06-12 14:31:32,932 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d filled: 3.0 @ 311.67 (3.0/64.0)
2025-06-12 14:31:32,932 - src.tws_connection - INFO - Open Order - ID: 2175, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:32,933 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:31:32,934 - __main__ - INFO -    Order ID: 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:32,934 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:32,934 - __main__ - INFO -    Fill Price: $311.67
2025-06-12 14:31:32,935 - __main__ - INFO -    Fill Quantity: 3.0
2025-06-12 14:31:32,935 - __main__ - INFO -    Status: partially_filled
2025-06-12 14:31:32,935 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:31:32,935 - UnifiedFillManager - INFO - Processing fill for GLD: 3.0 shares on order 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:32,935 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 14:31:32,936 - UnifiedFillManager - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d fill status: partially_filled, is_fully_filled: False
2025-06-12 14:31:32,939 - UnifiedFillManager - INFO - Partial stop fill for GLD, remaining position: 67.0
2025-06-12 14:31:32,939 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=67.0, protective_qty=-67.0
2025-06-12 14:31:32,938 - src.tws_connection - INFO - Open Order - ID: 2175, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:32,940 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:31:32,941 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:31:32,941 - src.tws_connection - INFO - Open Order - ID: 2175, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:32,941 - UnifiedFillManager - INFO - Queueing update for target order ab487fd9-883b-4fb5-966b-06163c4af096: current qty=-64.0, new qty=-67.0
2025-06-12 14:31:32,942 - UnifiedFillManager - INFO - Processing operation for GLD: replace_target
2025-06-12 14:31:32,942 - src.tws_connection - INFO - Open Order - ID: 2175, Symbol: GLD, Action: SELL, Quantity: 64.0
2025-06-12 14:31:32,943 - src.order.base - INFO - Order ab487fd9-883b-4fb5-966b-06163c4af096 status changed: submitted -> pending_cancel (Updating quantity to -67.0)
2025-06-12 14:31:32,944 - src.order.manager - INFO - Cancelling order ab487fd9-883b-4fb5-966b-06163c4af096 with broker ID 2176
2025-06-12 14:31:32,944 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d status changed: partially_filled -> accepted (IB status: PreSubmitted)
2025-06-12 14:31:32,944 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d status changed: accepted -> filled (Order fully filled)
2025-06-12 14:31:32,945 - src.order.base - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d filled: 61.0 @ 311.67 (64.0/64.0)
2025-06-12 14:31:32,945 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:31:32,946 - __main__ - INFO -    Order ID: 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:32,946 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:32,946 - __main__ - INFO -    Fill Price: $311.67
2025-06-12 14:31:32,946 - __main__ - INFO -    Fill Quantity: 61.0
2025-06-12 14:31:32,946 - __main__ - INFO -    Status: filled
2025-06-12 14:31:32,947 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:31:32,947 - UnifiedFillManager - INFO - Processing fill for GLD: 61.0 shares on order 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:32,947 - UnifiedFillManager - INFO - Fill is for stop order
2025-06-12 14:31:32,947 - UnifiedFillManager - INFO - Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d fill status: filled, is_fully_filled: True
2025-06-12 14:31:32,947 - UnifiedFillManager - INFO - Closing position for GLD: Stop order fully filled
2025-06-12 14:31:32,947 - src.position.position_manager - INFO - Closed position for GLD
2025-06-12 14:31:32,948 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-12 14:31:32,948 - UnifiedFillManager - INFO - Position closed for GLD: cancellation queued, trackers updated
2025-06-12 14:31:32,997 - src.order.base - INFO - Order ab487fd9-883b-4fb5-966b-06163c4af096 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-12 14:31:32,997 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2176)
2025-06-12 14:31:33,055 - src.order.base - INFO - Order 78f3132c-f789-453c-9504-160ab3763c39 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:31:33,055 - src.order.manager - INFO - Submitting order 78f3132c-f789-453c-9504-160ab3763c39 to TWS
2025-06-12 14:31:33,056 - src.order.manager - INFO - Got broker order ID 2177 for order 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:33,056 - src.order.manager - INFO - Calling placeOrder with ID 2177, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 67@311.790000 DAY
2025-06-12 14:31:33,056 - src.order.manager - INFO - placeOrder called successfully for order 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:33,057 - src.order.base - INFO - Order 78f3132c-f789-453c-9504-160ab3763c39 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:31:33,057 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:31:33,057 - UnifiedFillManager - INFO - Created updated target order 78f3132c-f789-453c-9504-160ab3763c39 for GLD at $311.79 for -67.0 shares
2025-06-12 14:31:33,058 - UnifiedFillManager - INFO - Completed operation for GLD: replace_target
2025-06-12 14:31:33,058 - UnifiedFillManager - INFO - Processing operation for GLD: cancel_all
2025-06-12 14:31:33,059 - src.order.base - INFO - Order 78f3132c-f789-453c-9504-160ab3763c39 status changed: submitted -> pending_cancel (Position closed: Stop order fully filled)
2025-06-12 14:31:33,059 - src.order.manager - INFO - Cancelling order 78f3132c-f789-453c-9504-160ab3763c39 with broker ID 2177
2025-06-12 14:31:33,059 - UnifiedFillManager - INFO - Cancelled 1 orders for GLD
2025-06-12 14:31:33,060 - UnifiedFillManager - INFO - Completed operation for GLD: cancel_all
2025-06-12 14:31:33,060 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:31:33,060 - __main__ - INFO -    Order ID: 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:33,061 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:31:33,061 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:31:33,061 - __main__ - INFO -    Quantity: -67.0
2025-06-12 14:31:33,061 - __main__ - INFO -    Limit Price: $311.79
2025-06-12 14:31:33,061 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:33,061 - __main__ - INFO -    Order ID: 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:33,062 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:31:33,062 - __main__ - INFO -    Previous: created
2025-06-12 14:31:33,062 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:31:33,062 - __main__ - INFO -    Order ID: 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:33,062 - __main__ - INFO -    Status: submitted
2025-06-12 14:31:33,062 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:31:33,063 - src.order.manager - WARNING - Unknown IB order status: ApiCancelled for order 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:33,531 - __main__ - INFO - 
🎯 New fill detected! Total fills: 4
2025-06-12 14:31:33,531 - __main__ - INFO - 
✅ Position closed via protective order
2025-06-12 14:31:36,536 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:36,537 - __main__ - INFO - FINAL ORDER STATE & VERIFICATION
2025-06-12 14:31:36,537 - __main__ - INFO - ================================================================================
2025-06-12 14:31:36,538 - __main__ - INFO - 
Checking current order states...
2025-06-12 14:31:36,538 - __main__ - INFO - 
Order f31cbf3d-2695-4702-9118-967ad63a6164:
2025-06-12 14:31:36,538 - __main__ - INFO -   Type: market
2025-06-12 14:31:36,538 - __main__ - INFO -   Status: filled
2025-06-12 14:31:36,539 - __main__ - INFO -   Quantity: 32
2025-06-12 14:31:36,539 - __main__ - INFO -   Broker ID: 2171
2025-06-12 14:31:36,539 - __main__ - INFO - 
Order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b:
2025-06-12 14:31:36,539 - __main__ - INFO -   Type: stop
2025-06-12 14:31:36,539 - __main__ - INFO -   Status: cancelled
2025-06-12 14:31:36,540 - __main__ - INFO -   Quantity: -32
2025-06-12 14:31:36,540 - __main__ - INFO -   Broker ID: 2172
2025-06-12 14:31:36,540 - __main__ - INFO - 
Order 6e7468da-6dfe-4638-b892-62225541d698:
2025-06-12 14:31:36,540 - __main__ - INFO -   Type: limit
2025-06-12 14:31:36,541 - __main__ - INFO -   Status: cancelled
2025-06-12 14:31:36,541 - __main__ - INFO -   Quantity: -32
2025-06-12 14:31:36,541 - __main__ - INFO -   Broker ID: 2173
2025-06-12 14:31:36,541 - __main__ - INFO - 
Order 893be363-cfb2-49fb-82d3-136ea32938dc:
2025-06-12 14:31:36,542 - __main__ - INFO -   Type: limit
2025-06-12 14:31:36,542 - __main__ - INFO -   Status: filled
2025-06-12 14:31:36,542 - __main__ - INFO -   Quantity: 32
2025-06-12 14:31:36,542 - __main__ - INFO -   Broker ID: 2174
2025-06-12 14:31:36,542 - __main__ - INFO - 
Order 8712ffc5-b273-4fd2-b363-f00eb7e8353d:
2025-06-12 14:31:36,543 - __main__ - INFO -   Type: stop
2025-06-12 14:31:36,543 - __main__ - INFO -   Status: filled
2025-06-12 14:31:36,543 - __main__ - INFO -   Quantity: -64.0
2025-06-12 14:31:36,543 - __main__ - INFO -   Broker ID: 2175
2025-06-12 14:31:36,543 - __main__ - INFO - 
Order ab487fd9-883b-4fb5-966b-06163c4af096:
2025-06-12 14:31:36,544 - __main__ - INFO -   Type: limit
2025-06-12 14:31:36,544 - __main__ - INFO -   Status: cancelled
2025-06-12 14:31:36,544 - __main__ - INFO -   Quantity: -64.0
2025-06-12 14:31:36,544 - __main__ - INFO -   Broker ID: 2176
2025-06-12 14:31:36,545 - __main__ - INFO - 
Order 78f3132c-f789-453c-9504-160ab3763c39:
2025-06-12 14:31:36,545 - __main__ - INFO -   Type: limit
2025-06-12 14:31:36,545 - __main__ - INFO -   Status: pending_cancel
2025-06-12 14:31:36,545 - __main__ - INFO -   Quantity: -67.0
2025-06-12 14:31:36,545 - __main__ - INFO -   Broker ID: 2177
2025-06-12 14:31:36,546 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:36,546 - __main__ - INFO - FLOW VERIFICATION
2025-06-12 14:31:36,546 - __main__ - INFO - ================================================================================
2025-06-12 14:31:36,546 - __main__ - INFO - ✓ Main order filled: True
2025-06-12 14:31:36,547 - __main__ - INFO - ✓ Double down filled: True
2025-06-12 14:31:36,547 - __main__ - INFO - ✓ Stop loss filled: True
2025-06-12 14:31:36,547 - __main__ - INFO - ○ Take profit filled: False
2025-06-12 14:31:36,547 - __main__ - INFO - 
✅ Stop loss filled - all other orders should have been cancelled
2025-06-12 14:31:36,547 - __main__ - INFO - 
Total orders cancelled: 3
2025-06-12 14:31:36,548 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:36,548 - __main__ - INFO - TEST SUMMARY
2025-06-12 14:31:36,548 - __main__ - INFO - ================================================================================
2025-06-12 14:31:36,549 - __main__ - INFO - ✅ Position closed successfully via protective order
2025-06-12 14:31:36,549 - __main__ - INFO - ✅ UnifiedFillManager handled order cancellation correctly
2025-06-12 14:31:36,549 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:36,550 - __main__ - INFO - CLEANING UP TEST
2025-06-12 14:31:36,550 - __main__ - INFO - ================================================================================
2025-06-12 14:31:36,550 - __main__ - INFO - Cancelling 7 test orders...
2025-06-12 14:31:36,550 - src.order.manager - WARNING - Cannot cancel inactive order f31cbf3d-2695-4702-9118-967ad63a6164 with status filled
2025-06-12 14:31:36,550 - __main__ - INFO -    Cancelled order f31cbf3d-2695-4702-9118-967ad63a6164
2025-06-12 14:31:36,551 - src.order.manager - WARNING - Cannot cancel inactive order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b with status cancelled
2025-06-12 14:31:36,551 - __main__ - INFO -    Cancelled order 9e8cd8e0-33a4-4f3a-a4cf-ed4df342559b
2025-06-12 14:31:36,551 - src.order.manager - WARNING - Cannot cancel inactive order 6e7468da-6dfe-4638-b892-62225541d698 with status cancelled
2025-06-12 14:31:36,551 - __main__ - INFO -    Cancelled order 6e7468da-6dfe-4638-b892-62225541d698
2025-06-12 14:31:36,551 - src.order.manager - WARNING - Cannot cancel inactive order 893be363-cfb2-49fb-82d3-136ea32938dc with status filled
2025-06-12 14:31:36,552 - __main__ - INFO -    Cancelled order 893be363-cfb2-49fb-82d3-136ea32938dc
2025-06-12 14:31:36,552 - src.order.manager - WARNING - Cannot cancel inactive order 8712ffc5-b273-4fd2-b363-f00eb7e8353d with status filled
2025-06-12 14:31:36,552 - __main__ - INFO -    Cancelled order 8712ffc5-b273-4fd2-b363-f00eb7e8353d
2025-06-12 14:31:36,552 - src.order.manager - WARNING - Cannot cancel inactive order ab487fd9-883b-4fb5-966b-06163c4af096 with status cancelled
2025-06-12 14:31:36,552 - __main__ - INFO -    Cancelled order ab487fd9-883b-4fb5-966b-06163c4af096
2025-06-12 14:31:36,554 - src.order.manager - WARNING - Cannot cancel inactive order 78f3132c-f789-453c-9504-160ab3763c39 with status pending_cancel
2025-06-12 14:31:36,554 - __main__ - INFO -    Cancelled order 78f3132c-f789-453c-9504-160ab3763c39
2025-06-12 14:31:36,554 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 14:31:36,555 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 14:31:36,555 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 14:31:36,555 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 14:31:36,555 - __main__ - INFO - Rule engine stopped
2025-06-12 14:31:36,556 - __main__ - INFO - 
Test cleanup complete
2025-06-12 14:31:36,556 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 14:31:36,557 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 14:31:36,557 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 14:31:36,558 - __main__ - INFO - Disconnected from TWS
2025-06-12 14:31:36,558 - __main__ - INFO - 
================================================================================
2025-06-12 14:31:36,558 - __main__ - INFO - TEST COMPLETE
2025-06-12 14:31:36,558 - __main__ - INFO - ================================================================================
2025-06-12 14:50:38,066 - __main__ - INFO - ================================================================================
2025-06-12 14:50:38,067 - __main__ - INFO - INITIALIZING GLD BUY FLOW TEST WITH UNIFIED FILL MANAGER
2025-06-12 14:50:38,067 - __main__ - INFO - ================================================================================
2025-06-12 14:50:38,067 - __main__ - INFO - Event bus created with concurrent processing support
2025-06-12 14:50:38,067 - __main__ - INFO - Subscribed to order and fill events
2025-06-12 14:50:38,067 - __main__ - INFO - TWS Config: host=127.0.0.1, port=7497, client_id=1
2025-06-12 14:50:38,067 - __main__ - INFO - Connecting to TWS...
2025-06-12 14:50:38,067 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-12 14:50:38,068 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-12 14:50:41,336 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-12 14:50:41,336 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-12 14:50:41,349 - src.tws_connection - INFO - ✅ Next valid order ID received: 2178
2025-06-12 14:50:41,349 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-12 14:50:41,349 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-12 14:50:41,349 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-12 14:50:41,350 - __main__ - INFO - Connected to TWS successfully
2025-06-12 14:50:41,350 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-12 14:50:41,350 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-12 14:50:41,350 - __main__ - INFO - Order manager and position tracker initialized
2025-06-12 14:50:41,350 - __main__ - INFO - Rule engine context configured
2025-06-12 14:50:41,350 - UnifiedFillManager - INFO - UnifiedFillManager initialized with concurrency control
2025-06-12 14:50:41,350 - __main__ - INFO - UnifiedFillManager initialized - handles all fill events and protective order updates
2025-06-12 14:50:41,350 - __main__ - INFO - 
================================================================================
2025-06-12 14:50:41,350 - __main__ - INFO - SETTING UP GLD BUY RULE
2025-06-12 14:50:41,350 - __main__ - INFO - ================================================================================
2025-06-12 14:50:41,350 - __main__ - INFO - Created BUY condition (threshold: 50%)
2025-06-12 14:50:41,351 - __main__ - INFO - Created BUY action ($10K allocation, 2.5x ATR stop, 2.5x ATR target)
2025-06-12 14:50:41,351 - __main__ - INFO - Registered rule: gld_buy_test_rule
2025-06-12 14:50:41,351 - __main__ - INFO - 
================================================================================
2025-06-12 14:50:41,351 - __main__ - INFO - SIMULATING GLD BUY SIGNAL
2025-06-12 14:50:41,351 - __main__ - INFO - ================================================================================
2025-06-12 14:50:41,455 - src.tws_connection - INFO - ✅ Next valid order ID received: 2178
2025-06-12 14:50:41,549 - src.tws_connection - INFO - ✅ Next valid order ID received: 2178
2025-06-12 14:50:46,355 - __main__ - INFO - Current GLD price: $311.85
2025-06-12 14:50:46,355 - __main__ - INFO - Created prediction event:
2025-06-12 14:50:46,355 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:50:46,356 - __main__ - INFO -    Signal: BUY
2025-06-12 14:50:46,356 - __main__ - INFO -    Confidence: 77.0%
2025-06-12 14:50:46,356 - __main__ - INFO -    Price: $311.85
2025-06-12 14:50:46,356 - src.rule.engine - INFO - Rule engine started
2025-06-12 14:50:46,356 - __main__ - INFO - Rule engine started
2025-06-12 14:50:46,356 - __main__ - INFO - 
EMITTING PREDICTION EVENT...
2025-06-12 14:50:46,356 - __main__ - INFO - Prediction event emitted
2025-06-12 14:50:46,356 - __main__ - INFO - Waiting for initial order creation...
2025-06-12 14:50:46,356 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-12 14:50:46,356 - src.position.position_manager - INFO - PositionManager initialized
2025-06-12 14:50:46,356 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-12 14:50:46,356 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-12 14:50:47,363 - src.position.sizer - INFO - BUY position size: 32 shares @ $311.84 = $9978.88 (99.8% of $10000.00 allocation)
2025-06-12 14:50:47,363 - src.order.base - INFO - Order 00ac8c45-5198-4703-9c0d-04292dc0fd88 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:50:47,363 - src.order.manager - INFO - Submitting order 00ac8c45-5198-4703-9c0d-04292dc0fd88 to TWS
2025-06-12 14:50:47,363 - src.order.manager - INFO - Got broker order ID 2178 for order 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,363 - src.order.manager - INFO - Calling placeOrder with ID 2178, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 32@0.000000 DAY
2025-06-12 14:50:47,364 - src.order.manager - INFO - placeOrder called successfully for order 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,364 - src.order.base - INFO - Order 00ac8c45-5198-4703-9c0d-04292dc0fd88 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:50:47,364 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-12 14:50:47,381 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0236
2025-06-12 14:50:47,381 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.79 (ATR: 0.0236 * 2.5 = 0.0589)
2025-06-12 14:50:47,381 - src.order.base - INFO - Order 8fc11505-f842-41c6-aea1-118509fc593b status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:50:47,381 - src.order.manager - INFO - Submitting order 8fc11505-f842-41c6-aea1-118509fc593b to TWS
2025-06-12 14:50:47,381 - src.order.manager - INFO - Got broker order ID 2179 for order 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:50:47,381 - src.order.manager - INFO - Calling placeOrder with ID 2179, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 32@0.000000 DAY
2025-06-12 14:50:47,381 - src.order.manager - INFO - placeOrder called successfully for order 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:50:47,382 - src.order.base - INFO - Order 8fc11505-f842-41c6-aea1-118509fc593b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:50:47,382 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-12 14:50:47,382 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 8fc11505-f842-41c6-aea1-118509fc593b at $311.79
2025-06-12 14:50:47,382 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.91 (ATR: 0.0236 * 2.5 = 0.0589)
2025-06-12 14:50:47,382 - src.order.base - INFO - Order 6b9e58fb-bef3-4fb2-833a-dc21c5567147 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:50:47,382 - src.order.manager - INFO - Submitting order 6b9e58fb-bef3-4fb2-833a-dc21c5567147 to TWS
2025-06-12 14:50:47,382 - src.order.manager - INFO - Got broker order ID 2180 for order 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:50:47,382 - src.order.manager - INFO - Calling placeOrder with ID 2180, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 32@311.910000 DAY
2025-06-12 14:50:47,382 - src.order.manager - INFO - placeOrder called successfully for order 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:50:47,382 - src.order.base - INFO - Order 6b9e58fb-bef3-4fb2-833a-dc21c5567147 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:50:47,383 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-12 14:50:47,383 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 6b9e58fb-bef3-4fb2-833a-dc21c5567147 at $311.91
2025-06-12 14:50:47,383 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-12 14:50:47,383 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:50:47,383 - __main__ - INFO -    Order ID: 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,383 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:50:47,383 - __main__ - INFO -    Type: OrderType.MARKET
2025-06-12 14:50:47,383 - __main__ - INFO -    Quantity: 32
2025-06-12 14:50:47,383 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,383 - __main__ - INFO -    Order ID: 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,383 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:50:47,383 - __main__ - INFO -    Previous: created
2025-06-12 14:50:47,383 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,383 - __main__ - INFO -    Order ID: 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,383 - __main__ - INFO -    Status: submitted
2025-06-12 14:50:47,383 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:50:47,383 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:50:47,383 - __main__ - INFO -    Order ID: 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:50:47,383 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:50:47,383 - __main__ - INFO -    Type: OrderType.STOP
2025-06-12 14:50:47,383 - __main__ - INFO -    Quantity: -32
2025-06-12 14:50:47,383 - __main__ - INFO -    Stop Price: $311.79
2025-06-12 14:50:47,384 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,384 - __main__ - INFO -    Order ID: 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:50:47,384 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:50:47,384 - __main__ - INFO -    Previous: created
2025-06-12 14:50:47,384 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,384 - __main__ - INFO -    Order ID: 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:50:47,384 - __main__ - INFO -    Status: submitted
2025-06-12 14:50:47,384 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:50:47,384 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:50:47,384 - __main__ - INFO -    Order ID: 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:50:47,384 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:50:47,384 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:50:47,384 - __main__ - INFO -    Quantity: -32
2025-06-12 14:50:47,384 - __main__ - INFO -    Limit Price: $311.91
2025-06-12 14:50:47,384 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,384 - __main__ - INFO -    Order ID: 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:50:47,384 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:50:47,384 - __main__ - INFO -    Previous: created
2025-06-12 14:50:47,384 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,384 - __main__ - INFO -    Order ID: 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:50:47,384 - __main__ - INFO -    Status: submitted
2025-06-12 14:50:47,384 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:50:47,460 - src.tws_connection - INFO - Open Order - ID: 2178, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:50:47,461 - src.order.base - INFO - Order 00ac8c45-5198-4703-9c0d-04292dc0fd88 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:50:47,469 - src.tws_connection - INFO - Open Order - ID: 2178, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:50:47,469 - src.order.base - INFO - Order 00ac8c45-5198-4703-9c0d-04292dc0fd88 status changed: accepted -> filled (Order fully filled)
2025-06-12 14:50:47,470 - src.order.base - INFO - Order 00ac8c45-5198-4703-9c0d-04292dc0fd88 filled: 32.0 @ 311.85 (32.0/32)
2025-06-12 14:50:47,470 - __main__ - INFO - 
🎯 FILL EVENT RECEIVED:
2025-06-12 14:50:47,470 - __main__ - INFO -    Order ID: 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,471 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:50:47,471 - __main__ - INFO -    Fill Price: $311.85
2025-06-12 14:50:47,471 - __main__ - INFO -    Fill Quantity: 32.0
2025-06-12 14:50:47,471 - __main__ - INFO -    Status: filled
2025-06-12 14:50:47,471 - __main__ - INFO -    ⚡ UnifiedFillManager will handle protective order updates
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Processing fill for GLD: 32.0 shares on order 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Fill is for main order
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Order 00ac8c45-5198-4703-9c0d-04292dc0fd88 fill status: filled, is_fully_filled: True
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Main order filled for GLD
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Position state after main fill:
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO -   Main orders: {'00ac8c45-5198-4703-9c0d-04292dc0fd88'}
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO -   Stop orders: {'8fc11505-f842-41c6-aea1-118509fc593b'}
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO -   Target orders: {'6b9e58fb-bef3-4fb2-833a-dc21c5567147'}
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO -   Double down orders: set()
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO -   Current position size: 32.0
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Updating protective orders after main fill to match position size: 32.0
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Updating protective orders for GLD: position=32.0, protective_qty=-32.0
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Checking protective orders to update for GLD
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Checking 1 stop orders
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Stop order 8fc11505-f842-41c6-aea1-118509fc593b already has correct quantity -32, no update needed
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Checking 1 target orders
2025-06-12 14:50:47,471 - UnifiedFillManager - INFO - Target order 6b9e58fb-bef3-4fb2-833a-dc21c5567147 already has correct quantity -32, no update needed
2025-06-12 14:50:47,472 - UnifiedFillManager - INFO - Started order queue processor for GLD
2025-06-12 14:50:47,472 - src.tws_connection - INFO - Open Order - ID: 2178, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:50:47,509 - src.tws_connection - INFO - Open Order - ID: 2179, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:50:47,510 - src.tws_connection - INFO - Open Order - ID: 2180, Symbol: GLD, Action: SELL, Quantity: 32.0
2025-06-12 14:50:47,510 - src.order.base - INFO - Order 8fc11505-f842-41c6-aea1-118509fc593b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-12 14:50:47,885 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['8fc11505-f842-41c6-aea1-118509fc593b']
2025-06-12 14:50:47,885 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-12 14:50:47,886 - src.rule.linked_order_actions - INFO - Using context price for GLD: $311.85
2025-06-12 14:50:47,904 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.0589
2025-06-12 14:50:47,905 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.85, stop_distance=$0.06, dd_distance=$0.03, dd_price=$311.82, original_qty=32, dd_qty=32
2025-06-12 14:50:47,905 - src.order.base - INFO - Order 75c41125-b79b-49ad-8585-4ffdc3485f15 status changed: created -> pending_submit (Submitting to broker)
2025-06-12 14:50:47,905 - src.order.manager - INFO - Submitting order 75c41125-b79b-49ad-8585-4ffdc3485f15 to TWS
2025-06-12 14:50:47,905 - src.order.manager - INFO - Got broker order ID 2181 for order 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:50:47,905 - src.order.manager - INFO - Calling placeOrder with ID 2181, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 32@311.820000 DAY
2025-06-12 14:50:47,905 - src.order.manager - INFO - placeOrder called successfully for order 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:50:47,905 - src.order.base - INFO - Order 75c41125-b79b-49ad-8585-4ffdc3485f15 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-12 14:50:47,906 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-12 14:50:47,906 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 32 shares @ $311.82
2025-06-12 14:50:47,906 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-12 14:50:47,906 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 00ac8c45-5198-4703-9c0d-04292dc0fd88 for GLD
2025-06-12 14:50:47,906 - __main__ - INFO - 
NEW ORDER CREATED:
2025-06-12 14:50:47,906 - __main__ - INFO -    Order ID: 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:50:47,906 - __main__ - INFO -    Symbol: GLD
2025-06-12 14:50:47,906 - __main__ - INFO -    Type: OrderType.LIMIT
2025-06-12 14:50:47,906 - __main__ - INFO -    Quantity: 32
2025-06-12 14:50:47,906 - __main__ - INFO -    Limit Price: $311.82
2025-06-12 14:50:47,907 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,907 - __main__ - INFO -    Order ID: 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:50:47,907 - __main__ - INFO -    Status: pending_submit
2025-06-12 14:50:47,907 - __main__ - INFO -    Previous: created
2025-06-12 14:50:47,907 - __main__ - INFO - 
ORDER STATUS UPDATE:
2025-06-12 14:50:47,907 - __main__ - INFO -    Order ID: 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:50:47,907 - __main__ - INFO -    Status: submitted
2025-06-12 14:50:47,907 - __main__ - INFO -    Previous: pending_submit
2025-06-12 14:50:47,997 - src.tws_connection - INFO - Open Order - ID: 2181, Symbol: GLD, Action: BUY, Quantity: 32.0
2025-06-12 14:50:49,362 - __main__ - INFO - 
Waiting for order processing...
2025-06-12 14:50:54,375 - __main__ - INFO - 
================================================================================
2025-06-12 14:50:54,375 - __main__ - INFO - VERIFYING ORDERS CREATED
2025-06-12 14:50:54,375 - __main__ - INFO - ================================================================================
2025-06-12 14:50:54,375 - __main__ - WARNING - No GLD context found!
2025-06-12 14:50:54,375 - __main__ - INFO - 
ORDERS SUMMARY:
2025-06-12 14:50:54,375 - __main__ - INFO -    Total orders created: 4
2025-06-12 14:50:54,375 - __main__ - INFO -    Market orders: 1
2025-06-12 14:50:54,375 - __main__ - INFO -    Stop orders: 1
2025-06-12 14:50:54,375 - __main__ - INFO -    Limit orders: 2
2025-06-12 14:50:54,375 - __main__ - INFO - 
✅ SUCCESS: All 4 expected orders were created!
2025-06-12 14:50:54,376 - __main__ - INFO - 
DETAILED ORDER LIST:
2025-06-12 14:50:54,376 - __main__ - INFO - 
   Order #1:
2025-06-12 14:50:54,376 - __main__ - INFO -      ID: 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:54,376 - __main__ - INFO -      Type: market
2025-06-12 14:50:54,376 - __main__ - INFO -      Quantity: 32
2025-06-12 14:50:54,376 - __main__ - INFO - 
   Order #2:
2025-06-12 14:50:54,376 - __main__ - INFO -      ID: 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:50:54,376 - __main__ - INFO -      Type: stop
2025-06-12 14:50:54,376 - __main__ - INFO -      Quantity: -32
2025-06-12 14:50:54,376 - __main__ - INFO -      Stop: $311.79
2025-06-12 14:50:54,376 - __main__ - INFO - 
   Order #3:
2025-06-12 14:50:54,376 - __main__ - INFO -      ID: 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:50:54,376 - __main__ - INFO -      Type: limit
2025-06-12 14:50:54,376 - __main__ - INFO -      Quantity: -32
2025-06-12 14:50:54,376 - __main__ - INFO -      Limit: $311.91
2025-06-12 14:50:54,376 - __main__ - INFO - 
   Order #4:
2025-06-12 14:50:54,376 - __main__ - INFO -      ID: 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:50:54,376 - __main__ - INFO -      Type: limit
2025-06-12 14:50:54,376 - __main__ - INFO -      Quantity: 32
2025-06-12 14:50:54,376 - __main__ - INFO -      Limit: $311.82
2025-06-12 14:50:54,376 - __main__ - INFO - 
🎯 FILLS SUMMARY:
2025-06-12 14:50:54,376 - __main__ - INFO -    Total fills received: 1
2025-06-12 14:50:54,376 - __main__ - INFO - 
   Fill #1:
2025-06-12 14:50:54,376 - __main__ - INFO -      Order ID: 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:50:54,376 - __main__ - INFO -      Quantity: 32.0
2025-06-12 14:50:54,377 - __main__ - INFO -      Price: $311.85
2025-06-12 14:50:54,377 - __main__ - INFO -      Status: filled
2025-06-12 14:50:54,377 - __main__ - INFO - 
📊 Monitoring position and orders...
2025-06-12 14:50:54,377 - __main__ - INFO - Waiting for fills:
2025-06-12 14:50:54,377 - __main__ - INFO -   - Double down to fill (increases position)
2025-06-12 14:50:54,377 - __main__ - INFO -   - Stop loss to fill (closes position)
2025-06-12 14:50:54,377 - __main__ - INFO -   - Take profit to fill (closes position)
2025-06-12 14:50:57,293 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2180)
2025-06-12 14:50:57,294 - src.order.base - INFO - Order 6b9e58fb-bef3-4fb2-833a-dc21c5567147 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-12 14:50:57,587 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2179)
2025-06-12 14:50:57,588 - src.order.base - INFO - Order 8fc11505-f842-41c6-aea1-118509fc593b status changed: accepted -> cancelled (IB status: Cancelled)
2025-06-12 14:50:58,259 - src.order.base - INFO - Order 75c41125-b79b-49ad-8585-4ffdc3485f15 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-12 14:50:58,259 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 2181)
2025-06-12 14:51:24,512 - __main__ - INFO - 

📊 Status update at 30s:
2025-06-12 14:51:24,512 - __main__ - INFO -    Fills received: 1
2025-06-12 14:51:24,512 - __main__ - INFO -    Active orders: 0
2025-06-12 14:51:54,653 - __main__ - INFO - 

📊 Status update at 60s:
2025-06-12 14:51:54,653 - __main__ - INFO -    Fills received: 1
2025-06-12 14:51:54,653 - __main__ - INFO -    Active orders: 0
2025-06-12 14:52:24,766 - __main__ - INFO - 

📊 Status update at 90s:
2025-06-12 14:52:24,766 - __main__ - INFO -    Fills received: 1
2025-06-12 14:52:24,766 - __main__ - INFO -    Active orders: 0
2025-06-12 14:52:54,865 - __main__ - INFO - 

📊 Status update at 120s:
2025-06-12 14:52:54,865 - __main__ - INFO -    Fills received: 1
2025-06-12 14:52:54,865 - __main__ - INFO -    Active orders: 0
2025-06-12 14:53:24,984 - __main__ - INFO - 

📊 Status update at 150s:
2025-06-12 14:53:24,984 - __main__ - INFO -    Fills received: 1
2025-06-12 14:53:24,984 - __main__ - INFO -    Active orders: 0
2025-06-12 14:53:55,126 - __main__ - INFO - 

📊 Status update at 180s:
2025-06-12 14:53:55,126 - __main__ - INFO -    Fills received: 1
2025-06-12 14:53:55,126 - __main__ - INFO -    Active orders: 0
2025-06-12 14:54:25,239 - __main__ - INFO - 

📊 Status update at 210s:
2025-06-12 14:54:25,239 - __main__ - INFO -    Fills received: 1
2025-06-12 14:54:25,239 - __main__ - INFO -    Active orders: 0
2025-06-12 14:55:55,586 - __main__ - INFO - 
⏱️ Monitoring timeout reached (300 seconds)
2025-06-12 14:55:55,586 - __main__ - INFO - 
================================================================================
2025-06-12 14:55:55,586 - __main__ - INFO - FINAL ORDER STATE & VERIFICATION
2025-06-12 14:55:55,587 - __main__ - INFO - ================================================================================
2025-06-12 14:55:55,587 - __main__ - INFO - 
Checking current order states...
2025-06-12 14:55:55,587 - __main__ - INFO - 
Order 00ac8c45-5198-4703-9c0d-04292dc0fd88:
2025-06-12 14:55:55,587 - __main__ - INFO -   Type: market
2025-06-12 14:55:55,587 - __main__ - INFO -   Status: filled
2025-06-12 14:55:55,587 - __main__ - INFO -   Quantity: 32
2025-06-12 14:55:55,587 - __main__ - INFO -   Broker ID: 2178
2025-06-12 14:55:55,587 - __main__ - INFO - 
Order 8fc11505-f842-41c6-aea1-118509fc593b:
2025-06-12 14:55:55,587 - __main__ - INFO -   Type: stop
2025-06-12 14:55:55,587 - __main__ - INFO -   Status: cancelled
2025-06-12 14:55:55,587 - __main__ - INFO -   Quantity: -32
2025-06-12 14:55:55,587 - __main__ - INFO -   Broker ID: 2179
2025-06-12 14:55:55,587 - __main__ - INFO - 
Order 6b9e58fb-bef3-4fb2-833a-dc21c5567147:
2025-06-12 14:55:55,587 - __main__ - INFO -   Type: limit
2025-06-12 14:55:55,587 - __main__ - INFO -   Status: cancelled
2025-06-12 14:55:55,588 - __main__ - INFO -   Quantity: -32
2025-06-12 14:55:55,588 - __main__ - INFO -   Broker ID: 2180
2025-06-12 14:55:55,588 - __main__ - INFO - 
Order 75c41125-b79b-49ad-8585-4ffdc3485f15:
2025-06-12 14:55:55,588 - __main__ - INFO -   Type: limit
2025-06-12 14:55:55,588 - __main__ - INFO -   Status: cancelled
2025-06-12 14:55:55,588 - __main__ - INFO -   Quantity: 32
2025-06-12 14:55:55,588 - __main__ - INFO -   Broker ID: 2181
2025-06-12 14:55:55,588 - __main__ - INFO - 
================================================================================
2025-06-12 14:55:55,588 - __main__ - INFO - FLOW VERIFICATION
2025-06-12 14:55:55,588 - __main__ - INFO - ================================================================================
2025-06-12 14:55:55,588 - __main__ - INFO - ✓ Main order filled: True
2025-06-12 14:55:55,588 - __main__ - INFO - ○ Double down filled: False
2025-06-12 14:55:55,588 - __main__ - INFO - ○ Stop loss filled: False
2025-06-12 14:55:55,588 - __main__ - INFO - ○ Take profit filled: False
2025-06-12 14:55:55,588 - __main__ - INFO - 
Total orders cancelled: 3
2025-06-12 14:55:55,588 - __main__ - INFO - 
================================================================================
2025-06-12 14:55:55,589 - __main__ - INFO - TEST SUMMARY
2025-06-12 14:55:55,589 - __main__ - INFO - ================================================================================
2025-06-12 14:55:55,589 - __main__ - INFO - ⚠️ Position did not close during test - manual intervention may be needed
2025-06-12 14:55:55,589 - __main__ - INFO - 
================================================================================
2025-06-12 14:55:55,589 - __main__ - INFO - CLEANING UP TEST
2025-06-12 14:55:55,589 - __main__ - INFO - ================================================================================
2025-06-12 14:55:55,589 - __main__ - INFO - Cancelling 4 test orders...
2025-06-12 14:55:55,590 - src.order.manager - WARNING - Cannot cancel inactive order 00ac8c45-5198-4703-9c0d-04292dc0fd88 with status filled
2025-06-12 14:55:55,590 - __main__ - INFO -    Cancelled order 00ac8c45-5198-4703-9c0d-04292dc0fd88
2025-06-12 14:55:55,590 - src.order.manager - WARNING - Cannot cancel inactive order 8fc11505-f842-41c6-aea1-118509fc593b with status cancelled
2025-06-12 14:55:55,590 - __main__ - INFO -    Cancelled order 8fc11505-f842-41c6-aea1-118509fc593b
2025-06-12 14:55:55,590 - src.order.manager - WARNING - Cannot cancel inactive order 6b9e58fb-bef3-4fb2-833a-dc21c5567147 with status cancelled
2025-06-12 14:55:55,590 - __main__ - INFO -    Cancelled order 6b9e58fb-bef3-4fb2-833a-dc21c5567147
2025-06-12 14:55:55,590 - src.order.manager - WARNING - Cannot cancel inactive order 75c41125-b79b-49ad-8585-4ffdc3485f15 with status cancelled
2025-06-12 14:55:55,590 - __main__ - INFO -    Cancelled order 75c41125-b79b-49ad-8585-4ffdc3485f15
2025-06-12 14:55:55,590 - UnifiedFillManager - INFO - Order queue processor for GLD cancelled
2025-06-12 14:55:55,590 - UnifiedFillManager - INFO - UnifiedFillManager cleanup completed
2025-06-12 14:55:55,590 - __main__ - INFO - UnifiedFillManager cleaned up
2025-06-12 14:55:55,590 - src.rule.engine - INFO - Rule engine stopped
2025-06-12 14:55:55,591 - __main__ - INFO - Rule engine stopped
2025-06-12 14:55:55,591 - __main__ - INFO - 
Test cleanup complete
2025-06-12 14:55:55,591 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-12 14:55:55,591 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-12 14:55:55,592 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-12 14:55:55,592 - __main__ - INFO - Disconnected from TWS
2025-06-12 14:55:55,592 - __main__ - INFO - 
================================================================================
2025-06-12 14:55:55,592 - __main__ - INFO - TEST COMPLETE
2025-06-12 14:55:55,592 - __main__ - INFO - ================================================================================
