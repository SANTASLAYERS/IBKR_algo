2025-06-04 15:29:35,616 - __main__ - INFO - ================================================================================
2025-06-04 15:29:35,617 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:29:35,617 - __main__ - INFO - ================================================================================
2025-06-04 15:29:35,621 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:29:35,621 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:29:35,626 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:29:45,638 - src.tws_connection - ERROR - ❌ Connection failed or timed out
2025-06-04 15:29:45,639 - src.tws_connection - ERROR - Connected: False, Next ID: None
2025-06-04 15:29:45,640 - src.tws_connection - INFO - Forcing connection cleanup
2025-06-04 15:29:45,642 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:29:45,642 - ibapi.client - WARNING - Disconnected; resetting connection
2025-06-04 15:29:45,643 - __main__ - ERROR - Failed to connect to TWS
2025-06-04 15:29:45,644 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:29:45,645 - src.tws_connection - WARNING - Not connected to TWS
2025-06-04 15:29:45,646 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-04 15:30:00,178 - __main__ - INFO - ================================================================================
2025-06-04 15:30:00,179 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:30:00,179 - __main__ - INFO - ================================================================================
2025-06-04 15:30:00,182 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:30:00,182 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:30:00,184 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:30:01,511 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:30:01,512 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:30:01,611 - src.tws_connection - INFO - ✅ Next valid order ID received: 101
2025-06-04 15:30:01,612 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:30:01,612 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:30:01,614 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:30:01,614 - src.tws_connection - INFO - ✅ Next valid order ID received: 101
2025-06-04 15:30:01,614 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:30:01,615 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:30:01,616 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:30:01,616 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:30:01,617 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:30:01,617 - __main__ - INFO - 
============================================================
2025-06-04 15:30:01,617 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:30:01,618 - __main__ - INFO - ============================================================
2025-06-04 15:30:37,129 - __main__ - INFO - ================================================================================
2025-06-04 15:30:37,130 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:30:37,130 - __main__ - INFO - ================================================================================
2025-06-04 15:30:37,133 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:30:37,133 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:30:37,139 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:30:47,157 - src.tws_connection - ERROR - ❌ Connection failed or timed out
2025-06-04 15:30:47,158 - src.tws_connection - ERROR - Connected: False, Next ID: None
2025-06-04 15:30:47,158 - src.tws_connection - INFO - Forcing connection cleanup
2025-06-04 15:30:47,159 - ibapi.client - WARNING - Disconnected; resetting connection
2025-06-04 15:30:47,159 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:30:47,160 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:30:47,160 - __main__ - ERROR - Failed to connect to TWS
2025-06-04 15:30:47,161 - src.tws_connection - WARNING - Not connected to TWS
2025-06-04 15:30:47,162 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-04 15:37:48,519 - __main__ - INFO - ================================================================================
2025-06-04 15:37:48,520 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:37:48,520 - __main__ - INFO - ================================================================================
2025-06-04 15:37:48,522 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:37:48,522 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:37:48,523 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:37:50,356 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:37:50,356 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:37:50,399 - src.tws_connection - INFO - ✅ Next valid order ID received: 101
2025-06-04 15:37:50,400 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:37:50,400 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:37:50,402 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:37:50,402 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:37:50,403 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:37:50,403 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:37:50,403 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:37:50,404 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:37:50,404 - __main__ - INFO - 
============================================================
2025-06-04 15:37:50,404 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:37:50,405 - __main__ - INFO - ============================================================
2025-06-04 15:37:50,405 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:37:50,406 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-04 15:37:50,406 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-04 15:37:50,406 - src.order.base - INFO - Order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:37:50,407 - src.order.manager - INFO - Submitting order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d to TWS
2025-06-04 15:37:50,407 - src.order.manager - INFO - Got broker order ID 101 for order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d
2025-06-04 15:37:50,407 - src.order.manager - INFO - Calling placeOrder with ID 101, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:37:50,408 - src.order.manager - INFO - placeOrder called successfully for order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d
2025-06-04 15:37:50,410 - src.order.base - INFO - Order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:37:50,411 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-04 15:37:50,480 - src.tws_connection - INFO - ✅ Next valid order ID received: 101
2025-06-04 15:37:50,566 - src.tws_connection - INFO - ✅ Next valid order ID received: 101
2025-06-04 15:37:50,950 - src.tws_connection - INFO - Open Order - ID: 101, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:37:50,956 - src.order.base - INFO - Order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:37:51,088 - src.order.base - INFO - Order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d status changed: accepted -> filled (Order fully filled)
2025-06-04 15:37:51,089 - src.order.base - INFO - Order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d filled: 100.0 @ 31.35 (100.0/100)
2025-06-04 15:37:51,089 - src.tws_connection - INFO - Open Order - ID: 101, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:37:51,091 - src.tws_connection - INFO - Open Order - ID: 101, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:37:51,412 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0136
2025-06-04 15:37:51,413 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $31.27 (ATR: 0.0136 * 6.0 = 0.0814)
2025-06-04 15:37:51,413 - src.order.base - INFO - Order 02b86fdb-c546-4c38-bace-616897f4a2b7 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:37:51,414 - src.order.manager - INFO - Submitting order 02b86fdb-c546-4c38-bace-616897f4a2b7 to TWS
2025-06-04 15:37:51,414 - src.order.manager - INFO - Got broker order ID 101 for order 02b86fdb-c546-4c38-bace-616897f4a2b7
2025-06-04 15:37:51,414 - src.order.manager - INFO - Calling placeOrder with ID 101, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:37:51,415 - src.order.manager - INFO - placeOrder called successfully for order 02b86fdb-c546-4c38-bace-616897f4a2b7
2025-06-04 15:37:51,415 - src.order.base - INFO - Order 02b86fdb-c546-4c38-bace-616897f4a2b7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:37:51,416 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 02b86fdb-c546-4c38-bace-616897f4a2b7 at $31.27
2025-06-04 15:37:51,416 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $31.36 (ATR: 0.0136 * 0.5 = 0.0068)
2025-06-04 15:37:51,416 - src.order.base - INFO - Order fcad3101-7eb3-4af2-a714-29db31fccccb status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:37:51,417 - src.order.manager - INFO - Submitting order fcad3101-7eb3-4af2-a714-29db31fccccb to TWS
2025-06-04 15:37:51,417 - src.order.manager - INFO - Got broker order ID 102 for order fcad3101-7eb3-4af2-a714-29db31fccccb
2025-06-04 15:37:51,417 - src.order.manager - INFO - Calling placeOrder with ID 102, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@31.360000 DAY
2025-06-04 15:37:51,418 - src.order.manager - INFO - placeOrder called successfully for order fcad3101-7eb3-4af2-a714-29db31fccccb
2025-06-04 15:37:51,418 - src.order.base - INFO - Order fcad3101-7eb3-4af2-a714-29db31fccccb status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:37:51,418 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit fcad3101-7eb3-4af2-a714-29db31fccccb at $31.36
2025-06-04 15:37:51,419 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-04 15:37:51,438 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 101)
2025-06-04 15:37:51,628 - src.tws_connection - INFO - Open Order - ID: 102, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:37:51,933 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['02b86fdb-c546-4c38-bace-616897f4a2b7']
2025-06-04 15:37:51,934 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-04 15:37:56,967 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0814
2025-06-04 15:37:56,968 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$31.34, stop_distance=$0.08, dd_distance=$0.04, dd_price=$31.30, original_qty=100, dd_qty=100
2025-06-04 15:37:56,969 - src.order.base - INFO - Order eb1ba5ec-9f71-4ec7-a3e5-186473dfb204 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:37:56,969 - src.order.manager - INFO - Submitting order eb1ba5ec-9f71-4ec7-a3e5-186473dfb204 to TWS
2025-06-04 15:37:56,969 - src.order.manager - INFO - Got broker order ID 103 for order eb1ba5ec-9f71-4ec7-a3e5-186473dfb204
2025-06-04 15:37:56,970 - src.order.manager - INFO - Calling placeOrder with ID 103, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@31.300000 DAY
2025-06-04 15:37:57,020 - src.order.manager - INFO - placeOrder called successfully for order eb1ba5ec-9f71-4ec7-a3e5-186473dfb204
2025-06-04 15:37:57,030 - src.order.base - INFO - Order eb1ba5ec-9f71-4ec7-a3e5-186473dfb204 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:37:57,031 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $31.30
2025-06-04 15:37:57,031 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-04 15:37:57,031 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 99a55eb8-e67b-4175-b645-aa8ce3a4f11d for SLV
2025-06-04 15:37:57,138 - src.tws_connection - INFO - Open Order - ID: 103, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:38:00,411 - __main__ - INFO - 
============================================================
2025-06-04 15:38:00,412 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:38:00,413 - __main__ - INFO - ============================================================
2025-06-04 15:38:00,413 - __main__ - ERROR - ❌ No context found for SLV - orders may not have been created
2025-06-04 15:38:00,414 - __main__ - INFO - 
Cleaning up...
2025-06-04 15:38:00,420 - src.rule.engine - INFO - Rule engine stopped
2025-06-04 15:38:00,421 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-04 15:38:00,422 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:38:00,422 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-04 15:38:00,423 - __main__ - INFO - ✅ Cleanup complete
2025-06-04 15:39:53,457 - __main__ - INFO - ================================================================================
2025-06-04 15:39:53,458 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:39:53,458 - __main__ - INFO - ================================================================================
2025-06-04 15:39:53,463 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:39:53,463 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:39:53,470 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:39:59,352 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:39:59,353 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:39:59,377 - src.tws_connection - INFO - Open Order - ID: 103, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:39:59,378 - src.tws_connection - INFO - Order Status Update - ID: 103, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:39:59,379 - src.tws_connection - INFO - Open Order - ID: 102, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:39:59,381 - src.tws_connection - INFO - Order Status Update - ID: 102, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:39:59,383 - src.tws_connection - INFO - ✅ Next valid order ID received: 104
2025-06-04 15:39:59,384 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:39:59,384 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:39:59,386 - src.tws_connection - INFO - Open Order - ID: 103, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:39:59,386 - src.tws_connection - INFO - Order Status Update - ID: 103, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:39:59,386 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:39:59,387 - src.tws_connection - INFO - Open Order - ID: 102, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:39:59,387 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:39:59,388 - src.tws_connection - INFO - Order Status Update - ID: 102, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:39:59,388 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:39:59,388 - src.tws_connection - INFO - ✅ Next valid order ID received: 104
2025-06-04 15:39:59,388 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:39:59,389 - src.tws_connection - INFO - ✅ Next valid order ID received: 104
2025-06-04 15:39:59,389 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:39:59,390 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:39:59,390 - __main__ - INFO - 
============================================================
2025-06-04 15:39:59,390 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:39:59,390 - __main__ - INFO - ============================================================
2025-06-04 15:39:59,391 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:39:59,391 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-04 15:39:59,391 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-04 15:39:59,392 - src.order.base - INFO - Order eae646c4-0a51-4d33-af9c-d937f596f635 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:39:59,392 - src.order.manager - INFO - Submitting order eae646c4-0a51-4d33-af9c-d937f596f635 to TWS
2025-06-04 15:39:59,392 - src.order.manager - INFO - Got broker order ID 104 for order eae646c4-0a51-4d33-af9c-d937f596f635
2025-06-04 15:39:59,393 - src.order.manager - INFO - Calling placeOrder with ID 104, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:39:59,393 - src.order.manager - INFO - placeOrder called successfully for order eae646c4-0a51-4d33-af9c-d937f596f635
2025-06-04 15:39:59,393 - src.order.base - INFO - Order eae646c4-0a51-4d33-af9c-d937f596f635 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:39:59,394 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-04 15:39:59,516 - src.tws_connection - INFO - Open Order - ID: 104, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:39:59,518 - src.order.base - INFO - Order eae646c4-0a51-4d33-af9c-d937f596f635 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:39:59,521 - src.order.base - INFO - Order eae646c4-0a51-4d33-af9c-d937f596f635 status changed: accepted -> filled (Order fully filled)
2025-06-04 15:39:59,521 - src.tws_connection - INFO - Open Order - ID: 104, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:39:59,521 - src.order.base - INFO - Order eae646c4-0a51-4d33-af9c-d937f596f635 filled: 100.0 @ 31.34 (100.0/100)
2025-06-04 15:39:59,529 - src.tws_connection - WARNING - ⚠️ TWS Error 399: Order Message: BUY 100 SLV ARCA Warning: Your order was repriced so as not to cross a related resting order. (reqId: 104)
2025-06-04 15:39:59,534 - src.tws_connection - INFO - Open Order - ID: 104, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:39:59,537 - src.tws_connection - INFO - Open Order - ID: 104, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:40:00,404 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0136
2025-06-04 15:40:00,404 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $31.25 (ATR: 0.0136 * 6.0 = 0.0814)
2025-06-04 15:40:00,405 - src.order.base - INFO - Order 86a9d701-cdbe-44ba-bc79-61f5dda6ad71 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:40:00,405 - src.order.manager - INFO - Submitting order 86a9d701-cdbe-44ba-bc79-61f5dda6ad71 to TWS
2025-06-04 15:40:00,405 - src.order.manager - INFO - Got broker order ID 105 for order 86a9d701-cdbe-44ba-bc79-61f5dda6ad71
2025-06-04 15:40:00,406 - src.order.manager - INFO - Calling placeOrder with ID 105, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:40:00,407 - src.order.manager - INFO - placeOrder called successfully for order 86a9d701-cdbe-44ba-bc79-61f5dda6ad71
2025-06-04 15:40:00,407 - src.order.base - INFO - Order 86a9d701-cdbe-44ba-bc79-61f5dda6ad71 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:40:00,408 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 86a9d701-cdbe-44ba-bc79-61f5dda6ad71 at $31.25
2025-06-04 15:40:00,408 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $31.34 (ATR: 0.0136 * 0.5 = 0.0068)
2025-06-04 15:40:00,409 - src.order.base - INFO - Order 8c098e5a-aeb0-40ce-8e15-7d83a686d615 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:40:00,409 - src.order.manager - INFO - Submitting order 8c098e5a-aeb0-40ce-8e15-7d83a686d615 to TWS
2025-06-04 15:40:00,412 - src.order.manager - INFO - Got broker order ID 106 for order 8c098e5a-aeb0-40ce-8e15-7d83a686d615
2025-06-04 15:40:00,413 - src.order.manager - INFO - Calling placeOrder with ID 106, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@31.340000 DAY
2025-06-04 15:40:00,415 - src.order.manager - INFO - placeOrder called successfully for order 8c098e5a-aeb0-40ce-8e15-7d83a686d615
2025-06-04 15:40:00,417 - src.order.base - INFO - Order 8c098e5a-aeb0-40ce-8e15-7d83a686d615 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:40:00,417 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 8c098e5a-aeb0-40ce-8e15-7d83a686d615 at $31.34
2025-06-04 15:40:00,417 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-04 15:40:00,506 - src.tws_connection - INFO - Open Order - ID: 105, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:40:00,512 - src.order.base - INFO - Order 86a9d701-cdbe-44ba-bc79-61f5dda6ad71 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:40:00,544 - src.tws_connection - INFO - Open Order - ID: 106, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:40:00,921 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['86a9d701-cdbe-44ba-bc79-61f5dda6ad71']
2025-06-04 15:40:00,922 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-04 15:40:05,935 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0814
2025-06-04 15:40:05,936 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$31.34, stop_distance=$0.08, dd_distance=$0.04, dd_price=$31.30, original_qty=100, dd_qty=100
2025-06-04 15:40:05,938 - src.order.base - INFO - Order 53834cb3-778a-4258-8ab1-db4bb940224a status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:40:05,940 - src.order.manager - INFO - Submitting order 53834cb3-778a-4258-8ab1-db4bb940224a to TWS
2025-06-04 15:40:05,945 - src.order.manager - INFO - Got broker order ID 107 for order 53834cb3-778a-4258-8ab1-db4bb940224a
2025-06-04 15:40:05,946 - src.order.manager - INFO - Calling placeOrder with ID 107, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@31.300000 DAY
2025-06-04 15:40:05,947 - src.order.manager - INFO - placeOrder called successfully for order 53834cb3-778a-4258-8ab1-db4bb940224a
2025-06-04 15:40:05,948 - src.order.base - INFO - Order 53834cb3-778a-4258-8ab1-db4bb940224a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:40:05,949 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $31.30
2025-06-04 15:40:05,949 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-04 15:40:05,950 - src.rule.linked_order_actions - INFO - Created and linked BUY main order eae646c4-0a51-4d33-af9c-d937f596f635 for SLV
2025-06-04 15:40:06,051 - src.tws_connection - INFO - Open Order - ID: 107, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:40:06,099 - src.order.manager - WARNING - Received status update for unknown order: 103
2025-06-04 15:40:06,098 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 103)
2025-06-04 15:40:08,110 - src.order.manager - WARNING - Received status update for unknown order: 102
2025-06-04 15:40:08,111 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 102)
2025-06-04 15:40:09,398 - __main__ - INFO - 
============================================================
2025-06-04 15:40:09,400 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:40:09,400 - __main__ - INFO - ============================================================
2025-06-04 15:42:45,732 - __main__ - INFO - ================================================================================
2025-06-04 15:42:45,732 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:42:45,732 - __main__ - INFO - ================================================================================
2025-06-04 15:42:45,733 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:42:45,733 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:42:45,734 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:42:46,909 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:42:46,910 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:42:46,939 - src.tws_connection - INFO - ✅ Next valid order ID received: 108
2025-06-04 15:42:46,940 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:42:46,940 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:42:46,941 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:42:46,941 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:42:46,942 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:42:46,942 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:42:46,942 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:42:46,943 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:42:46,943 - __main__ - INFO - 
============================================================
2025-06-04 15:42:46,943 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:42:46,944 - __main__ - INFO - ============================================================
2025-06-04 15:42:46,944 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:42:46,945 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-04 15:42:46,945 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-04 15:42:46,946 - src.order.base - INFO - Order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:42:46,946 - src.order.manager - INFO - Submitting order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc to TWS
2025-06-04 15:42:46,946 - src.order.manager - INFO - Got broker order ID 108 for order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc
2025-06-04 15:42:46,947 - src.order.manager - INFO - Calling placeOrder with ID 108, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:42:46,947 - src.order.manager - INFO - placeOrder called successfully for order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc
2025-06-04 15:42:46,947 - src.order.base - INFO - Order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:42:46,948 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-04 15:42:47,010 - src.tws_connection - INFO - ✅ Next valid order ID received: 108
2025-06-04 15:42:47,109 - src.tws_connection - INFO - ✅ Next valid order ID received: 108
2025-06-04 15:42:47,309 - src.tws_connection - INFO - Open Order - ID: 108, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:42:47,310 - src.order.base - INFO - Order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:42:47,344 - src.order.base - INFO - Order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc status changed: accepted -> filled (Order fully filled)
2025-06-04 15:42:47,344 - src.tws_connection - INFO - Open Order - ID: 108, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:42:47,345 - src.order.base - INFO - Order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc filled: 100.0 @ 31.33 (100.0/100)
2025-06-04 15:42:47,346 - src.tws_connection - INFO - Open Order - ID: 108, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:42:47,961 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0136
2025-06-04 15:42:47,962 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $31.25 (ATR: 0.0136 * 6.0 = 0.0814)
2025-06-04 15:42:47,962 - src.order.base - INFO - Order 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:42:47,963 - src.order.manager - INFO - Submitting order 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e to TWS
2025-06-04 15:42:47,963 - src.order.manager - INFO - Got broker order ID 108 for order 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e
2025-06-04 15:42:47,964 - src.order.manager - INFO - Calling placeOrder with ID 108, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:42:47,964 - src.order.manager - INFO - placeOrder called successfully for order 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e
2025-06-04 15:42:47,965 - src.order.base - INFO - Order 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:42:47,965 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e at $31.25
2025-06-04 15:42:47,966 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $31.34 (ATR: 0.0136 * 0.5 = 0.0068)
2025-06-04 15:42:47,966 - src.order.base - INFO - Order 15c6acfe-7178-43db-99ca-dc883eec0e60 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:42:47,966 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 108)
2025-06-04 15:42:47,966 - src.order.manager - INFO - Submitting order 15c6acfe-7178-43db-99ca-dc883eec0e60 to TWS
2025-06-04 15:42:47,967 - src.order.manager - INFO - Got broker order ID 109 for order 15c6acfe-7178-43db-99ca-dc883eec0e60
2025-06-04 15:42:47,967 - src.order.manager - INFO - Calling placeOrder with ID 109, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@31.340000 DAY
2025-06-04 15:42:47,968 - src.order.manager - INFO - placeOrder called successfully for order 15c6acfe-7178-43db-99ca-dc883eec0e60
2025-06-04 15:42:47,968 - src.order.base - INFO - Order 15c6acfe-7178-43db-99ca-dc883eec0e60 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:42:47,969 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 15c6acfe-7178-43db-99ca-dc883eec0e60 at $31.34
2025-06-04 15:42:47,971 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-04 15:42:48,074 - src.tws_connection - INFO - Open Order - ID: 109, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:42:48,482 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e']
2025-06-04 15:42:48,483 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-04 15:42:53,500 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0814
2025-06-04 15:42:53,501 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$31.33, stop_distance=$0.08, dd_distance=$0.04, dd_price=$31.29, original_qty=100, dd_qty=100
2025-06-04 15:42:53,501 - src.order.base - INFO - Order d86c2e1e-116d-4062-bc65-a4f4bcafe759 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:42:53,502 - src.order.manager - INFO - Submitting order d86c2e1e-116d-4062-bc65-a4f4bcafe759 to TWS
2025-06-04 15:42:53,502 - src.order.manager - INFO - Got broker order ID 110 for order d86c2e1e-116d-4062-bc65-a4f4bcafe759
2025-06-04 15:42:53,502 - src.order.manager - INFO - Calling placeOrder with ID 110, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@31.290000 DAY
2025-06-04 15:42:53,503 - src.order.manager - INFO - placeOrder called successfully for order d86c2e1e-116d-4062-bc65-a4f4bcafe759
2025-06-04 15:42:53,507 - src.order.base - INFO - Order d86c2e1e-116d-4062-bc65-a4f4bcafe759 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:42:53,508 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $31.29
2025-06-04 15:42:53,508 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-04 15:42:53,509 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc for SLV
2025-06-04 15:42:53,852 - src.tws_connection - INFO - Open Order - ID: 110, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:42:56,956 - __main__ - INFO - 
============================================================
2025-06-04 15:42:56,957 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:42:56,958 - __main__ - INFO - ============================================================
2025-06-04 15:42:56,958 - __main__ - INFO - Found 4 orders for SLV
2025-06-04 15:42:56,958 - __main__ - INFO - Order d86c2e1e-116d-4062-bc65-a4f4bcafe759: limit buy 100 @ 31.29 - Status: submitted
2025-06-04 15:42:56,965 - __main__ - INFO - Order 60e2f14d-9dcf-4543-8a65-d0cdd155cabc: market buy 100 @ MARKET - Status: filled
2025-06-04 15:42:56,965 - __main__ - INFO - Order 15c6acfe-7178-43db-99ca-dc883eec0e60: limit sell -100 @ 31.34 - Status: submitted
2025-06-04 15:42:56,965 - __main__ - INFO - Order 2cb3cfdd-2a6b-4e1c-a402-94d8ff88bb7e: stop sell -100 @ 31.25 - Status: submitted
2025-06-04 15:42:56,965 - __main__ - INFO - 
Main orders: 1
2025-06-04 15:42:56,966 - __main__ - INFO - Stop orders: 1
2025-06-04 15:42:56,966 - __main__ - INFO - Target orders: 1
2025-06-04 15:42:56,966 - __main__ - INFO - Double down orders: 1
2025-06-04 15:42:56,966 - __main__ - INFO - 
Target order details:
2025-06-04 15:42:56,966 - __main__ - INFO -   ID: 15c6acfe-7178-43db-99ca-dc883eec0e60
2025-06-04 15:42:56,966 - __main__ - INFO -   Status: submitted
2025-06-04 15:42:56,966 - __main__ - INFO -   Limit price: 31.34
2025-06-04 15:42:56,967 - __main__ - INFO - 
Active orders before fill: 3
2025-06-04 15:43:01,978 - __main__ - INFO - 
============================================================
2025-06-04 15:43:01,978 - __main__ - INFO - STEP 3: Simulating profit target fill
2025-06-04 15:43:01,979 - __main__ - INFO - ============================================================
2025-06-04 15:43:35,602 - __main__ - INFO - ================================================================================
2025-06-04 15:43:35,602 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:43:35,602 - __main__ - INFO - ================================================================================
2025-06-04 15:43:35,603 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:43:35,603 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:43:35,604 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:43:38,470 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:43:38,471 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:43:38,500 - src.tws_connection - INFO - Open Order - ID: 110, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:38,500 - src.tws_connection - INFO - Order Status Update - ID: 110, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:43:38,501 - src.tws_connection - INFO - Open Order - ID: 109, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:43:38,523 - src.tws_connection - INFO - Order Status Update - ID: 109, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:43:38,525 - src.tws_connection - INFO - ✅ Next valid order ID received: 111
2025-06-04 15:43:38,525 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:43:38,526 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:43:38,527 - src.tws_connection - INFO - Open Order - ID: 110, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:38,527 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:43:38,527 - src.tws_connection - INFO - Order Status Update - ID: 110, Status: Submitted, Filled: 0.0, Remaining: 100.0
2025-06-04 15:43:38,528 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:43:38,528 - src.tws_connection - INFO - Open Order - ID: 109, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:43:38,529 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:43:38,529 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:43:38,529 - src.tws_connection - INFO - ✅ Next valid order ID received: 111
2025-06-04 15:43:38,529 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:43:38,529 - src.tws_connection - INFO - ✅ Next valid order ID received: 111
2025-06-04 15:43:38,530 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:43:38,530 - __main__ - INFO - 
============================================================
2025-06-04 15:43:38,530 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:43:38,530 - __main__ - INFO - ============================================================
2025-06-04 15:43:38,531 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:43:38,531 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-04 15:43:38,531 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-04 15:43:38,531 - src.order.base - INFO - Order bcd02451-6e01-4acd-a0ab-124f69d2c432 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:43:38,532 - src.order.manager - INFO - Submitting order bcd02451-6e01-4acd-a0ab-124f69d2c432 to TWS
2025-06-04 15:43:38,532 - src.order.manager - INFO - Got broker order ID 111 for order bcd02451-6e01-4acd-a0ab-124f69d2c432
2025-06-04 15:43:38,532 - src.order.manager - INFO - Calling placeOrder with ID 111, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:43:38,532 - src.order.manager - INFO - placeOrder called successfully for order bcd02451-6e01-4acd-a0ab-124f69d2c432
2025-06-04 15:43:38,532 - src.order.base - INFO - Order bcd02451-6e01-4acd-a0ab-124f69d2c432 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:43:38,533 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-04 15:43:38,533 - src.order.manager - WARNING - Received status update for unknown order: 109
2025-06-04 15:43:38,653 - src.tws_connection - INFO - Open Order - ID: 111, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:38,654 - src.order.base - INFO - Order bcd02451-6e01-4acd-a0ab-124f69d2c432 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:43:38,680 - src.order.base - INFO - Order bcd02451-6e01-4acd-a0ab-124f69d2c432 status changed: accepted -> filled (Order fully filled)
2025-06-04 15:43:38,681 - src.order.base - INFO - Order bcd02451-6e01-4acd-a0ab-124f69d2c432 filled: 100.0 @ 31.33 (100.0/100)
2025-06-04 15:43:38,680 - src.tws_connection - INFO - Open Order - ID: 111, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:38,685 - src.tws_connection - INFO - Open Order - ID: 111, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:38,685 - src.tws_connection - WARNING - ⚠️ TWS Error 399: Order Message: BUY 100 SLV ARCA Warning: Your order was repriced so as not to cross a related resting order. (reqId: 111)
2025-06-04 15:43:38,686 - src.tws_connection - INFO - Open Order - ID: 111, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:39,551 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0136
2025-06-04 15:43:39,551 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $31.24 (ATR: 0.0136 * 6.0 = 0.0814)
2025-06-04 15:43:39,552 - src.order.base - INFO - Order 6f29b6db-0909-4457-9492-3151d88f2ece status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:43:39,552 - src.order.manager - INFO - Submitting order 6f29b6db-0909-4457-9492-3151d88f2ece to TWS
2025-06-04 15:43:39,553 - src.order.manager - INFO - Got broker order ID 112 for order 6f29b6db-0909-4457-9492-3151d88f2ece
2025-06-04 15:43:39,553 - src.order.manager - INFO - Calling placeOrder with ID 112, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:43:39,554 - src.order.manager - INFO - placeOrder called successfully for order 6f29b6db-0909-4457-9492-3151d88f2ece
2025-06-04 15:43:39,554 - src.order.base - INFO - Order 6f29b6db-0909-4457-9492-3151d88f2ece status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:43:39,558 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 6f29b6db-0909-4457-9492-3151d88f2ece at $31.24
2025-06-04 15:43:39,559 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $31.33 (ATR: 0.0136 * 0.5 = 0.0068)
2025-06-04 15:43:39,559 - src.order.base - INFO - Order bbdab797-1531-4050-bd40-2c893a9e88db status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:43:39,560 - src.order.manager - INFO - Submitting order bbdab797-1531-4050-bd40-2c893a9e88db to TWS
2025-06-04 15:43:39,560 - src.order.manager - INFO - Got broker order ID 113 for order bbdab797-1531-4050-bd40-2c893a9e88db
2025-06-04 15:43:39,561 - src.order.manager - INFO - Calling placeOrder with ID 113, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@31.330000 DAY
2025-06-04 15:43:39,561 - src.order.manager - INFO - placeOrder called successfully for order bbdab797-1531-4050-bd40-2c893a9e88db
2025-06-04 15:43:39,561 - src.order.base - INFO - Order bbdab797-1531-4050-bd40-2c893a9e88db status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:43:39,562 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit bbdab797-1531-4050-bd40-2c893a9e88db at $31.33
2025-06-04 15:43:39,562 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-04 15:43:39,636 - src.tws_connection - INFO - Open Order - ID: 112, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:43:39,637 - src.order.base - INFO - Order 6f29b6db-0909-4457-9492-3151d88f2ece status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:43:39,683 - src.tws_connection - INFO - Open Order - ID: 113, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:43:40,071 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['6f29b6db-0909-4457-9492-3151d88f2ece']
2025-06-04 15:43:40,073 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-04 15:43:40,922 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 109)
2025-06-04 15:43:40,927 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0814
2025-06-04 15:43:40,927 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$31.32, stop_distance=$0.08, dd_distance=$0.04, dd_price=$31.28, original_qty=100, dd_qty=100
2025-06-04 15:43:40,928 - src.order.base - INFO - Order 220d861e-8e12-441c-bcb7-c45e2a1ac76c status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:43:40,928 - src.order.manager - INFO - Submitting order 220d861e-8e12-441c-bcb7-c45e2a1ac76c to TWS
2025-06-04 15:43:40,929 - src.order.manager - INFO - Got broker order ID 114 for order 220d861e-8e12-441c-bcb7-c45e2a1ac76c
2025-06-04 15:43:40,929 - src.order.manager - INFO - Calling placeOrder with ID 114, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@31.280000 DAY
2025-06-04 15:43:40,930 - src.order.manager - INFO - placeOrder called successfully for order 220d861e-8e12-441c-bcb7-c45e2a1ac76c
2025-06-04 15:43:40,930 - src.order.base - INFO - Order 220d861e-8e12-441c-bcb7-c45e2a1ac76c status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:43:40,931 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $31.28
2025-06-04 15:43:40,931 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-04 15:43:40,931 - src.rule.linked_order_actions - INFO - Created and linked BUY main order bcd02451-6e01-4acd-a0ab-124f69d2c432 for SLV
2025-06-04 15:43:40,932 - src.order.manager - WARNING - Received status update for unknown order: 109
2025-06-04 15:43:41,054 - src.tws_connection - INFO - Open Order - ID: 114, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:43:42,078 - src.order.manager - WARNING - Received status update for unknown order: 110
2025-06-04 15:43:42,078 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 110)
2025-06-04 15:43:48,538 - __main__ - INFO - 
============================================================
2025-06-04 15:43:48,541 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:43:48,541 - __main__ - INFO - ============================================================
2025-06-04 15:43:48,541 - __main__ - INFO - Found 4 orders for SLV
2025-06-04 15:43:48,542 - __main__ - INFO - Order 6f29b6db-0909-4457-9492-3151d88f2ece: stop sell -100 @ 31.24 - Status: accepted
2025-06-04 15:43:48,543 - __main__ - INFO - Order bcd02451-6e01-4acd-a0ab-124f69d2c432: market buy 100 @ MARKET - Status: filled
2025-06-04 15:43:48,543 - __main__ - INFO - Order bbdab797-1531-4050-bd40-2c893a9e88db: limit sell -100 @ 31.33 - Status: submitted
2025-06-04 15:43:48,543 - __main__ - INFO - Order 220d861e-8e12-441c-bcb7-c45e2a1ac76c: limit buy 100 @ 31.28 - Status: submitted
2025-06-04 15:43:48,544 - __main__ - INFO - 
Main orders: 1
2025-06-04 15:43:48,544 - __main__ - INFO - Stop orders: 1
2025-06-04 15:43:48,544 - __main__ - INFO - Target orders: 1
2025-06-04 15:43:48,544 - __main__ - INFO - Double down orders: 1
2025-06-04 15:43:48,545 - __main__ - INFO - 
Target order details:
2025-06-04 15:43:48,546 - __main__ - INFO -   ID: bbdab797-1531-4050-bd40-2c893a9e88db
2025-06-04 15:43:48,546 - __main__ - INFO -   Status: submitted
2025-06-04 15:43:48,546 - __main__ - INFO -   Limit price: 31.33
2025-06-04 15:43:48,547 - __main__ - INFO - 
Active orders before fill: 3
2025-06-04 15:43:53,550 - __main__ - INFO - 
============================================================
2025-06-04 15:43:53,550 - __main__ - INFO - STEP 3: Simulating profit target fill
2025-06-04 15:43:53,551 - __main__ - INFO - ============================================================
2025-06-04 15:43:53,551 - __main__ - INFO - Publishing fill event for order bbdab797-1531-4050-bd40-2c893a9e88db
2025-06-04 15:43:58,560 - __main__ - INFO - 
============================================================
2025-06-04 15:43:58,562 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-04 15:43:58,562 - __main__ - INFO - ============================================================
2025-06-04 15:43:58,563 - __main__ - INFO - Stop order 6f29b6db-0909-4457-9492-3151d88f2ece status: accepted
2025-06-04 15:43:58,563 - __main__ - ERROR - ❌ Stop order is still accepted
2025-06-04 15:43:58,564 - __main__ - INFO - Double down order 220d861e-8e12-441c-bcb7-c45e2a1ac76c status: submitted
2025-06-04 15:43:58,564 - __main__ - ERROR - ❌ Double down order is still submitted
2025-06-04 15:43:58,565 - __main__ - INFO - 
Active orders after fill: 3
2025-06-04 15:43:58,565 - __main__ - ERROR - ❌ TradeTracker still shows active trade for SLV
2025-06-04 15:43:58,566 - __main__ - INFO - 
============================================================
2025-06-04 15:43:58,566 - __main__ - INFO - TEST COMPLETE
2025-06-04 15:43:58,566 - __main__ - INFO - ============================================================
2025-06-04 15:43:58,566 - __main__ - INFO - 
Cleaning up...
2025-06-04 15:43:58,567 - src.rule.engine - INFO - Rule engine stopped
2025-06-04 15:43:58,567 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-04 15:43:58,569 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:43:58,580 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-04 15:43:58,581 - __main__ - INFO - ✅ Cleanup complete
2025-06-04 15:47:30,671 - __main__ - INFO - ================================================================================
2025-06-04 15:47:30,671 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:47:30,671 - __main__ - INFO - ================================================================================
2025-06-04 15:47:30,673 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:47:30,673 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:47:30,674 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:47:33,948 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:47:33,950 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:47:34,061 - src.tws_connection - INFO - ✅ Next valid order ID received: 115
2025-06-04 15:47:34,062 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:47:34,062 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:47:34,063 - src.tws_connection - INFO - ✅ Next valid order ID received: 115
2025-06-04 15:47:34,064 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:47:34,065 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:47:34,065 - src.tws_connection - INFO - ✅ Next valid order ID received: 115
2025-06-04 15:47:34,065 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:47:34,066 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:47:34,066 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:47:34,067 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:47:34,067 - __main__ - INFO - 
============================================================
2025-06-04 15:47:34,068 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:47:34,068 - __main__ - INFO - ============================================================
2025-06-04 15:47:34,069 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:47:34,069 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-04 15:47:34,069 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-04 15:47:34,070 - src.order.base - INFO - Order 59af2587-8968-4fd2-85b8-fa1867a73420 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:47:34,071 - src.order.manager - INFO - Submitting order 59af2587-8968-4fd2-85b8-fa1867a73420 to TWS
2025-06-04 15:47:34,071 - src.order.manager - INFO - Got broker order ID 115 for order 59af2587-8968-4fd2-85b8-fa1867a73420
2025-06-04 15:47:34,071 - src.order.manager - INFO - Calling placeOrder with ID 115, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:47:34,072 - src.order.manager - INFO - placeOrder called successfully for order 59af2587-8968-4fd2-85b8-fa1867a73420
2025-06-04 15:47:34,072 - src.order.base - INFO - Order 59af2587-8968-4fd2-85b8-fa1867a73420 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:47:34,073 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-04 15:47:34,177 - src.tws_connection - INFO - Open Order - ID: 115, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:47:34,178 - src.order.base - INFO - Order 59af2587-8968-4fd2-85b8-fa1867a73420 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:47:34,212 - src.order.base - INFO - Order 59af2587-8968-4fd2-85b8-fa1867a73420 status changed: accepted -> filled (Order fully filled)
2025-06-04 15:47:34,213 - src.order.base - INFO - Order 59af2587-8968-4fd2-85b8-fa1867a73420 filled: 100.0 @ 31.34 (100.0/100)
2025-06-04 15:47:34,213 - src.tws_connection - INFO - Open Order - ID: 115, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:47:34,215 - src.tws_connection - INFO - Open Order - ID: 115, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:47:35,094 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0136
2025-06-04 15:47:35,096 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $31.25 (ATR: 0.0136 * 6.0 = 0.0814)
2025-06-04 15:47:35,096 - src.order.base - INFO - Order 316b542b-81c4-4ff6-bce5-c44e7190219b status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:47:35,100 - src.order.manager - INFO - Submitting order 316b542b-81c4-4ff6-bce5-c44e7190219b to TWS
2025-06-04 15:47:35,101 - src.order.manager - INFO - Got broker order ID 116 for order 316b542b-81c4-4ff6-bce5-c44e7190219b
2025-06-04 15:47:35,101 - src.order.manager - INFO - Calling placeOrder with ID 116, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:47:35,102 - src.order.manager - INFO - placeOrder called successfully for order 316b542b-81c4-4ff6-bce5-c44e7190219b
2025-06-04 15:47:35,103 - src.order.base - INFO - Order 316b542b-81c4-4ff6-bce5-c44e7190219b status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:47:35,104 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 316b542b-81c4-4ff6-bce5-c44e7190219b at $31.25
2025-06-04 15:47:35,104 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $31.33 (ATR: 0.0136 * 0.0 = 0.0000)
2025-06-04 15:47:35,104 - src.order.base - INFO - Order b3863f6b-df96-412f-882a-e96e6b0dfe94 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:47:35,105 - src.order.manager - INFO - Submitting order b3863f6b-df96-412f-882a-e96e6b0dfe94 to TWS
2025-06-04 15:47:35,105 - src.order.manager - INFO - Got broker order ID 117 for order b3863f6b-df96-412f-882a-e96e6b0dfe94
2025-06-04 15:47:35,105 - src.order.manager - INFO - Calling placeOrder with ID 117, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@31.330000 DAY
2025-06-04 15:47:35,105 - src.order.manager - INFO - placeOrder called successfully for order b3863f6b-df96-412f-882a-e96e6b0dfe94
2025-06-04 15:47:35,106 - src.order.base - INFO - Order b3863f6b-df96-412f-882a-e96e6b0dfe94 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:47:35,106 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit b3863f6b-df96-412f-882a-e96e6b0dfe94 at $31.33
2025-06-04 15:47:35,107 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-04 15:47:35,187 - src.tws_connection - INFO - Open Order - ID: 116, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:47:35,188 - src.order.base - INFO - Order 316b542b-81c4-4ff6-bce5-c44e7190219b status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:47:35,237 - src.tws_connection - INFO - Open Order - ID: 117, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:47:35,238 - src.order.base - INFO - Order b3863f6b-df96-412f-882a-e96e6b0dfe94 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:47:35,296 - src.order.base - INFO - Order b3863f6b-df96-412f-882a-e96e6b0dfe94 status changed: accepted -> filled (Order fully filled)
2025-06-04 15:47:35,297 - src.order.base - INFO - Order b3863f6b-df96-412f-882a-e96e6b0dfe94 filled: 100.0 @ 31.33 (100.0/100)
2025-06-04 15:47:35,296 - src.tws_connection - INFO - Open Order - ID: 117, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:47:35,299 - src.tws_connection - INFO - Open Order - ID: 117, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:47:35,612 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['316b542b-81c4-4ff6-bce5-c44e7190219b']
2025-06-04 15:47:35,613 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-04 15:47:40,620 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0814
2025-06-04 15:47:40,620 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$31.33, stop_distance=$0.08, dd_distance=$0.04, dd_price=$31.29, original_qty=100, dd_qty=100
2025-06-04 15:47:40,621 - src.order.base - INFO - Order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:47:40,621 - src.order.manager - INFO - Submitting order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3 to TWS
2025-06-04 15:47:40,622 - src.order.manager - INFO - Got broker order ID 118 for order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3
2025-06-04 15:47:40,622 - src.order.manager - INFO - Calling placeOrder with ID 118, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@31.290000 DAY
2025-06-04 15:47:40,623 - src.order.manager - INFO - placeOrder called successfully for order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3
2025-06-04 15:47:40,624 - src.order.base - INFO - Order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:47:40,624 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $31.29
2025-06-04 15:47:40,624 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-04 15:47:40,625 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 59af2587-8968-4fd2-85b8-fa1867a73420 for SLV
2025-06-04 15:47:40,729 - src.tws_connection - INFO - Open Order - ID: 118, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:47:44,070 - __main__ - INFO - 
============================================================
2025-06-04 15:47:44,071 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:47:44,071 - __main__ - INFO - ============================================================
2025-06-04 15:47:44,072 - __main__ - INFO - Found 4 orders for SLV
2025-06-04 15:47:44,072 - __main__ - INFO - Order 59af2587-8968-4fd2-85b8-fa1867a73420: market buy 100 @ MARKET - Status: filled
2025-06-04 15:47:44,072 - __main__ - INFO - Order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3: limit buy 100 @ 31.29 - Status: submitted
2025-06-04 15:47:44,073 - __main__ - INFO - Order b3863f6b-df96-412f-882a-e96e6b0dfe94: limit sell -100 @ 31.33 - Status: filled
2025-06-04 15:47:44,073 - __main__ - INFO - Order 316b542b-81c4-4ff6-bce5-c44e7190219b: stop sell -100 @ 31.25 - Status: accepted
2025-06-04 15:47:44,074 - __main__ - INFO - 
Main orders: 1
2025-06-04 15:47:44,074 - __main__ - INFO - Stop orders: 1
2025-06-04 15:47:44,074 - __main__ - INFO - Target orders: 1
2025-06-04 15:47:44,075 - __main__ - INFO - Double down orders: 1
2025-06-04 15:47:44,078 - __main__ - INFO - 
Target order details:
2025-06-04 15:47:44,079 - __main__ - INFO -   ID: b3863f6b-df96-412f-882a-e96e6b0dfe94
2025-06-04 15:47:44,079 - __main__ - INFO -   Status: filled
2025-06-04 15:47:44,080 - __main__ - INFO -   Limit price: 31.33
2025-06-04 15:47:44,080 - __main__ - INFO - 
Active orders before fill: 2
2025-06-04 15:47:44,080 - __main__ - INFO - 
============================================================
2025-06-04 15:47:44,080 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-04 15:47:44,081 - __main__ - INFO - ============================================================
2025-06-04 15:47:44,081 - __main__ - INFO - Waiting for target order b3863f6b-df96-412f-882a-e96e6b0dfe94 to fill at $31.33...
2025-06-04 15:47:44,082 - __main__ - INFO - ✅ Target order filled at $31.33!
2025-06-04 15:47:49,098 - __main__ - INFO - 
============================================================
2025-06-04 15:47:49,102 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-04 15:47:49,102 - __main__ - INFO - ============================================================
2025-06-04 15:47:49,103 - __main__ - INFO - Stop order 316b542b-81c4-4ff6-bce5-c44e7190219b status: accepted
2025-06-04 15:47:49,103 - __main__ - ERROR - ❌ Stop order is still accepted
2025-06-04 15:47:49,103 - __main__ - INFO - Double down order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3 status: submitted
2025-06-04 15:47:49,103 - __main__ - ERROR - ❌ Double down order is still submitted
2025-06-04 15:47:49,104 - __main__ - INFO - 
Active orders after fill: 2
2025-06-04 15:47:49,104 - __main__ - ERROR - ❌ TradeTracker still shows active trade for SLV
2025-06-04 15:47:49,104 - __main__ - INFO - 
============================================================
2025-06-04 15:47:49,104 - __main__ - INFO - TEST COMPLETE
2025-06-04 15:47:49,104 - __main__ - INFO - ============================================================
2025-06-04 15:47:49,105 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-04 15:47:49,105 - src.order.manager - WARNING - Cannot cancel inactive order 59af2587-8968-4fd2-85b8-fa1867a73420 with status filled
2025-06-04 15:47:49,105 - src.order.base - INFO - Order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-04 15:47:49,106 - src.order.manager - INFO - Cancelling order be5cf034-d56b-4a3a-b5cd-b7ccc51f7ab3 with broker ID 118
2025-06-04 15:47:49,106 - src.order.manager - WARNING - Cannot cancel inactive order b3863f6b-df96-412f-882a-e96e6b0dfe94 with status filled
2025-06-04 15:47:49,106 - src.order.base - INFO - Order 316b542b-81c4-4ff6-bce5-c44e7190219b status changed: accepted -> pending_cancel (Test cleanup)
2025-06-04 15:47:49,107 - src.order.manager - INFO - Cancelling order 316b542b-81c4-4ff6-bce5-c44e7190219b with broker ID 116
2025-06-04 15:47:49,108 - __main__ - INFO - Cancelled 2 orders
2025-06-04 15:47:49,108 - __main__ - INFO - 
Cleaning up...
2025-06-04 15:47:49,109 - src.rule.engine - INFO - Rule engine stopped
2025-06-04 15:47:49,109 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-04 15:47:49,110 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:47:49,110 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-04 15:47:49,117 - __main__ - INFO - ✅ Cleanup complete
2025-06-04 15:49:28,049 - __main__ - INFO - ================================================================================
2025-06-04 15:49:28,050 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:49:28,050 - __main__ - INFO - ================================================================================
2025-06-04 15:49:28,052 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:49:28,052 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:49:28,053 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:49:29,086 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:49:29,087 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:49:29,114 - src.tws_connection - INFO - ✅ Next valid order ID received: 119
2025-06-04 15:49:29,114 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:49:29,115 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:49:29,116 - src.tws_connection - INFO - ✅ Next valid order ID received: 119
2025-06-04 15:49:29,116 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:49:29,117 - src.tws_connection - INFO - ✅ Next valid order ID received: 119
2025-06-04 15:49:29,117 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:49:29,118 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:49:29,118 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:49:29,118 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:49:29,119 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:49:29,119 - __main__ - INFO - 
============================================================
2025-06-04 15:49:29,119 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:49:29,120 - __main__ - INFO - ============================================================
2025-06-04 15:49:29,120 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:49:29,121 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-04 15:49:29,121 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-04 15:49:29,122 - src.order.base - INFO - Order 002d09a5-69ad-4274-b4b4-f823ea33248d status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:49:29,122 - src.order.manager - INFO - Submitting order 002d09a5-69ad-4274-b4b4-f823ea33248d to TWS
2025-06-04 15:49:29,122 - src.order.manager - INFO - Got broker order ID 119 for order 002d09a5-69ad-4274-b4b4-f823ea33248d
2025-06-04 15:49:29,122 - src.order.manager - INFO - Calling placeOrder with ID 119, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:49:29,123 - src.order.manager - INFO - placeOrder called successfully for order 002d09a5-69ad-4274-b4b4-f823ea33248d
2025-06-04 15:49:29,123 - src.order.base - INFO - Order 002d09a5-69ad-4274-b4b4-f823ea33248d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:49:29,123 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-04 15:49:29,228 - src.tws_connection - INFO - Open Order - ID: 119, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:49:29,229 - src.order.base - INFO - Order 002d09a5-69ad-4274-b4b4-f823ea33248d status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:49:29,261 - src.order.base - INFO - Order 002d09a5-69ad-4274-b4b4-f823ea33248d status changed: accepted -> filled (Order fully filled)
2025-06-04 15:49:29,264 - src.order.base - INFO - Order 002d09a5-69ad-4274-b4b4-f823ea33248d filled: 100.0 @ 31.34 (100.0/100)
2025-06-04 15:49:29,262 - src.tws_connection - INFO - Open Order - ID: 119, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:49:29,265 - src.tws_connection - INFO - Open Order - ID: 119, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:49:30,132 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0136
2025-06-04 15:49:30,133 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $31.25 (ATR: 0.0136 * 6.0 = 0.0814)
2025-06-04 15:49:30,133 - src.order.base - INFO - Order 0db14e9c-890d-42a2-a745-c3a1944550d8 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:49:30,134 - src.order.manager - INFO - Submitting order 0db14e9c-890d-42a2-a745-c3a1944550d8 to TWS
2025-06-04 15:49:30,134 - src.order.manager - INFO - Got broker order ID 120 for order 0db14e9c-890d-42a2-a745-c3a1944550d8
2025-06-04 15:49:30,135 - src.order.manager - INFO - Calling placeOrder with ID 120, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:49:30,136 - src.order.manager - INFO - placeOrder called successfully for order 0db14e9c-890d-42a2-a745-c3a1944550d8
2025-06-04 15:49:30,136 - src.order.base - INFO - Order 0db14e9c-890d-42a2-a745-c3a1944550d8 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:49:30,136 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 0db14e9c-890d-42a2-a745-c3a1944550d8 at $31.25
2025-06-04 15:49:30,136 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $31.33 (ATR: 0.0136 * 0.2 = 0.0027)
2025-06-04 15:49:30,137 - src.order.base - INFO - Order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:49:30,137 - src.order.manager - INFO - Submitting order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 to TWS
2025-06-04 15:49:30,137 - src.order.manager - INFO - Got broker order ID 121 for order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08
2025-06-04 15:49:30,138 - src.order.manager - INFO - Calling placeOrder with ID 121, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@31.330000 DAY
2025-06-04 15:49:30,139 - src.order.manager - INFO - placeOrder called successfully for order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08
2025-06-04 15:49:30,139 - src.order.base - INFO - Order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:49:30,139 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 at $31.33
2025-06-04 15:49:30,139 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-04 15:49:30,216 - src.tws_connection - INFO - Open Order - ID: 120, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:49:30,217 - src.order.base - INFO - Order 0db14e9c-890d-42a2-a745-c3a1944550d8 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:49:30,271 - src.tws_connection - INFO - Open Order - ID: 121, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:49:30,274 - src.order.base - INFO - Order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:49:30,315 - src.order.base - INFO - Order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 status changed: accepted -> filled (Order fully filled)
2025-06-04 15:49:30,315 - src.tws_connection - INFO - Open Order - ID: 121, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:49:30,317 - src.order.base - INFO - Order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 filled: 100.0 @ 31.33 (100.0/100)
2025-06-04 15:49:30,318 - src.tws_connection - INFO - Open Order - ID: 121, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-04 15:49:30,641 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['0db14e9c-890d-42a2-a745-c3a1944550d8']
2025-06-04 15:49:30,642 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-04 15:49:35,659 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0814
2025-06-04 15:49:35,659 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$31.33, stop_distance=$0.08, dd_distance=$0.04, dd_price=$31.29, original_qty=100, dd_qty=100
2025-06-04 15:49:35,659 - src.order.base - INFO - Order 613ef3db-d2ef-4cdf-be86-66a3d68d425d status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:49:35,660 - src.order.manager - INFO - Submitting order 613ef3db-d2ef-4cdf-be86-66a3d68d425d to TWS
2025-06-04 15:49:35,660 - src.order.manager - INFO - Got broker order ID 122 for order 613ef3db-d2ef-4cdf-be86-66a3d68d425d
2025-06-04 15:49:35,660 - src.order.manager - INFO - Calling placeOrder with ID 122, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@31.290000 DAY
2025-06-04 15:49:35,661 - src.order.manager - INFO - placeOrder called successfully for order 613ef3db-d2ef-4cdf-be86-66a3d68d425d
2025-06-04 15:49:35,661 - src.order.base - INFO - Order 613ef3db-d2ef-4cdf-be86-66a3d68d425d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:49:35,661 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $31.29
2025-06-04 15:49:35,661 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-04 15:49:35,662 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 002d09a5-69ad-4274-b4b4-f823ea33248d for SLV
2025-06-04 15:49:35,765 - src.tws_connection - INFO - Open Order - ID: 122, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-04 15:49:39,125 - __main__ - INFO - 
============================================================
2025-06-04 15:49:39,133 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:49:39,133 - __main__ - INFO - ============================================================
2025-06-04 15:49:39,134 - __main__ - INFO - Found 4 orders for SLV
2025-06-04 15:49:39,134 - __main__ - INFO - Order 613ef3db-d2ef-4cdf-be86-66a3d68d425d: limit buy 100 @ 31.29 - Status: submitted
2025-06-04 15:49:39,134 - __main__ - INFO - Order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08: limit sell -100 @ 31.33 - Status: filled
2025-06-04 15:49:39,135 - __main__ - INFO - Order 0db14e9c-890d-42a2-a745-c3a1944550d8: stop sell -100 @ 31.25 - Status: accepted
2025-06-04 15:49:39,135 - __main__ - INFO - Order 002d09a5-69ad-4274-b4b4-f823ea33248d: market buy 100 @ MARKET - Status: filled
2025-06-04 15:49:39,135 - __main__ - INFO - 
Main orders: 1
2025-06-04 15:49:39,138 - __main__ - INFO - Stop orders: 1
2025-06-04 15:49:39,138 - __main__ - INFO - Target orders: 1
2025-06-04 15:49:39,139 - __main__ - INFO - Double down orders: 1
2025-06-04 15:49:39,139 - __main__ - INFO - 
Target order details:
2025-06-04 15:49:39,139 - __main__ - INFO -   ID: e9d60cf2-d25b-44df-b11e-7b62e0d7cd08
2025-06-04 15:49:39,140 - __main__ - INFO -   Status: filled
2025-06-04 15:49:39,141 - __main__ - INFO -   Limit price: 31.33
2025-06-04 15:49:39,141 - __main__ - INFO - 
Active orders before fill: 2
2025-06-04 15:49:39,141 - __main__ - INFO - 
============================================================
2025-06-04 15:49:39,141 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-04 15:49:39,142 - __main__ - INFO - ============================================================
2025-06-04 15:49:39,142 - __main__ - INFO - Waiting for target order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 to fill at $31.33...
2025-06-04 15:49:39,142 - __main__ - INFO - ✅ Target order filled at $31.33!
2025-06-04 15:49:44,143 - __main__ - INFO - 
============================================================
2025-06-04 15:49:44,144 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-04 15:49:44,145 - __main__ - INFO - ============================================================
2025-06-04 15:49:44,145 - __main__ - INFO - Stop order 0db14e9c-890d-42a2-a745-c3a1944550d8 status: accepted
2025-06-04 15:49:44,146 - __main__ - ERROR - ❌ Stop order is still accepted
2025-06-04 15:49:44,146 - __main__ - INFO - Double down order 613ef3db-d2ef-4cdf-be86-66a3d68d425d status: submitted
2025-06-04 15:49:44,146 - __main__ - ERROR - ❌ Double down order is still submitted
2025-06-04 15:49:44,146 - __main__ - INFO - 
Active orders after fill: 2
2025-06-04 15:49:44,147 - __main__ - ERROR - ❌ TradeTracker still shows active trade for SLV
2025-06-04 15:49:44,147 - __main__ - INFO - 
============================================================
2025-06-04 15:49:44,147 - __main__ - INFO - TEST COMPLETE
2025-06-04 15:49:44,148 - __main__ - INFO - ============================================================
2025-06-04 15:49:44,148 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-04 15:49:44,148 - src.order.base - INFO - Order 613ef3db-d2ef-4cdf-be86-66a3d68d425d status changed: submitted -> pending_cancel (Test cleanup)
2025-06-04 15:49:44,148 - src.order.manager - INFO - Cancelling order 613ef3db-d2ef-4cdf-be86-66a3d68d425d with broker ID 122
2025-06-04 15:49:44,149 - src.order.manager - WARNING - Cannot cancel inactive order e9d60cf2-d25b-44df-b11e-7b62e0d7cd08 with status filled
2025-06-04 15:49:44,149 - src.order.base - INFO - Order 0db14e9c-890d-42a2-a745-c3a1944550d8 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-04 15:49:44,150 - src.order.manager - INFO - Cancelling order 0db14e9c-890d-42a2-a745-c3a1944550d8 with broker ID 120
2025-06-04 15:49:44,151 - src.order.manager - WARNING - Cannot cancel inactive order 002d09a5-69ad-4274-b4b4-f823ea33248d with status filled
2025-06-04 15:49:44,153 - __main__ - INFO - Cancelled 2 orders
2025-06-04 15:49:44,154 - __main__ - INFO - 
Cleaning up...
2025-06-04 15:49:44,155 - src.rule.engine - INFO - Rule engine stopped
2025-06-04 15:49:44,156 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-04 15:49:44,156 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:49:44,163 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-04 15:49:44,163 - __main__ - INFO - ✅ Cleanup complete
2025-06-04 15:50:48,459 - __main__ - INFO - ================================================================================
2025-06-04 15:50:48,460 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-04 15:50:48,460 - __main__ - INFO - ================================================================================
2025-06-04 15:50:48,461 - __main__ - INFO - Connecting to TWS...
2025-06-04 15:50:48,461 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-04 15:50:48,462 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-04 15:50:50,058 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-04 15:50:50,058 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-04 15:50:50,083 - src.tws_connection - INFO - ✅ Next valid order ID received: 123
2025-06-04 15:50:50,083 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-04 15:50:50,084 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-04 15:50:50,085 - src.tws_connection - INFO - ✅ Next valid order ID received: 123
2025-06-04 15:50:50,086 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-04 15:50:50,087 - __main__ - INFO - ✅ Connected to TWS
2025-06-04 15:50:50,087 - src.tws_connection - INFO - ✅ Next valid order ID received: 123
2025-06-04 15:50:50,087 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-04 15:50:50,088 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-04 15:50:50,088 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-04 15:50:50,089 - src.rule.engine - INFO - Rule engine started
2025-06-04 15:50:50,089 - __main__ - INFO - 
============================================================
2025-06-04 15:50:50,089 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-04 15:50:50,090 - __main__ - INFO - ============================================================
2025-06-04 15:50:50,090 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-04 15:50:50,090 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-04 15:50:50,091 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-04 15:50:50,091 - src.order.base - INFO - Order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:50:50,092 - src.order.manager - INFO - Submitting order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 to TWS
2025-06-04 15:50:50,092 - src.order.manager - INFO - Got broker order ID 123 for order 5817d957-af52-479d-a8c8-ddc7f14b2cb2
2025-06-04 15:50:50,092 - src.order.manager - INFO - Calling placeOrder with ID 123, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-04 15:50:50,093 - src.order.manager - INFO - placeOrder called successfully for order 5817d957-af52-479d-a8c8-ddc7f14b2cb2
2025-06-04 15:50:50,093 - src.order.base - INFO - Order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:50:50,093 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-04 15:50:50,226 - src.tws_connection - INFO - Open Order - ID: 123, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-04 15:50:50,227 - src.order.base - INFO - Order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:50:50,230 - src.order.base - INFO - Order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 status changed: accepted -> filled (Order fully filled)
2025-06-04 15:50:50,231 - src.order.base - INFO - Order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 filled: 100.0 @ 310.85 (100.0/100)
2025-06-04 15:50:50,231 - src.tws_connection - INFO - Open Order - ID: 123, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-04 15:50:50,267 - src.tws_connection - INFO - Open Order - ID: 123, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-04 15:50:50,368 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0293
2025-06-04 15:50:50,368 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.66 (ATR: 0.0293 * 6.0 = 0.1757)
2025-06-04 15:50:50,368 - src.order.base - INFO - Order 4a1b207e-b637-4656-979d-230b7cc89348 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:50:50,369 - src.order.manager - INFO - Submitting order 4a1b207e-b637-4656-979d-230b7cc89348 to TWS
2025-06-04 15:50:50,369 - src.order.manager - INFO - Got broker order ID 124 for order 4a1b207e-b637-4656-979d-230b7cc89348
2025-06-04 15:50:50,369 - src.order.manager - INFO - Calling placeOrder with ID 124, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-04 15:50:50,369 - src.order.manager - INFO - placeOrder called successfully for order 4a1b207e-b637-4656-979d-230b7cc89348
2025-06-04 15:50:50,369 - src.order.base - INFO - Order 4a1b207e-b637-4656-979d-230b7cc89348 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:50:50,370 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 4a1b207e-b637-4656-979d-230b7cc89348 at $310.66
2025-06-04 15:50:50,370 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.85 (ATR: 0.0293 * 0.2 = 0.0059)
2025-06-04 15:50:50,370 - src.order.base - INFO - Order e5a82e00-4def-462e-b1a3-ed8c088e7b25 status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:50:50,371 - src.order.manager - INFO - Submitting order e5a82e00-4def-462e-b1a3-ed8c088e7b25 to TWS
2025-06-04 15:50:50,371 - src.order.manager - INFO - Got broker order ID 125 for order e5a82e00-4def-462e-b1a3-ed8c088e7b25
2025-06-04 15:50:50,371 - src.order.manager - INFO - Calling placeOrder with ID 125, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.850000 DAY
2025-06-04 15:50:50,372 - src.order.manager - INFO - placeOrder called successfully for order e5a82e00-4def-462e-b1a3-ed8c088e7b25
2025-06-04 15:50:50,372 - src.order.base - INFO - Order e5a82e00-4def-462e-b1a3-ed8c088e7b25 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:50:50,372 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e5a82e00-4def-462e-b1a3-ed8c088e7b25 at $310.85
2025-06-04 15:50:50,372 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-04 15:50:50,443 - src.tws_connection - INFO - Open Order - ID: 124, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-04 15:50:50,445 - src.order.base - INFO - Order 4a1b207e-b637-4656-979d-230b7cc89348 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-04 15:50:50,540 - src.tws_connection - INFO - Open Order - ID: 125, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-04 15:50:50,874 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['4a1b207e-b637-4656-979d-230b7cc89348']
2025-06-04 15:50:50,874 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-04 15:50:51,122 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.1757
2025-06-04 15:50:51,123 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.84, stop_distance=$0.18, dd_distance=$0.09, dd_price=$310.75, original_qty=100, dd_qty=100
2025-06-04 15:50:51,123 - src.order.base - INFO - Order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed status changed: created -> pending_submit (Submitting to broker)
2025-06-04 15:50:51,123 - src.order.manager - INFO - Submitting order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed to TWS
2025-06-04 15:50:51,123 - src.order.manager - INFO - Got broker order ID 126 for order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed
2025-06-04 15:50:51,123 - src.order.manager - INFO - Calling placeOrder with ID 126, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.750000 DAY
2025-06-04 15:50:51,124 - src.order.manager - INFO - placeOrder called successfully for order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed
2025-06-04 15:50:51,124 - src.order.base - INFO - Order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed status changed: pending_submit -> submitted (Submitted to broker)
2025-06-04 15:50:51,124 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.75
2025-06-04 15:50:51,124 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-04 15:50:51,124 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 for GLD
2025-06-04 15:50:51,245 - src.tws_connection - INFO - Open Order - ID: 126, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-04 15:50:54,209 - src.tws_connection - INFO - Open Order - ID: 125, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-04 15:50:54,341 - src.order.base - INFO - Order e5a82e00-4def-462e-b1a3-ed8c088e7b25 status changed: submitted -> filled (Order fully filled)
2025-06-04 15:50:54,342 - src.order.base - INFO - Order e5a82e00-4def-462e-b1a3-ed8c088e7b25 filled: 100.0 @ 310.85 (100.0/100)
2025-06-04 15:50:54,341 - src.tws_connection - INFO - Open Order - ID: 125, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-04 15:50:54,347 - src.tws_connection - INFO - Open Order - ID: 125, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-04 15:51:00,129 - __main__ - INFO - 
============================================================
2025-06-04 15:51:00,152 - __main__ - INFO - STEP 2: Checking created orders
2025-06-04 15:51:00,167 - __main__ - INFO - ============================================================
2025-06-04 15:51:00,177 - __main__ - INFO - Found 4 orders for GLD
2025-06-04 15:51:00,181 - __main__ - INFO - Order e5a82e00-4def-462e-b1a3-ed8c088e7b25: limit sell -100 @ 310.85 - Status: filled
2025-06-04 15:51:00,182 - __main__ - INFO - Order 4a1b207e-b637-4656-979d-230b7cc89348: stop sell -100 @ 310.66 - Status: accepted
2025-06-04 15:51:00,182 - __main__ - INFO - Order 5817d957-af52-479d-a8c8-ddc7f14b2cb2: market buy 100 @ MARKET - Status: filled
2025-06-04 15:51:00,182 - __main__ - INFO - Order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed: limit buy 100 @ 310.75 - Status: submitted
2025-06-04 15:51:00,182 - __main__ - INFO - 
Main orders: 1
2025-06-04 15:51:00,183 - __main__ - INFO - Stop orders: 1
2025-06-04 15:51:00,183 - __main__ - INFO - Target orders: 1
2025-06-04 15:51:00,183 - __main__ - INFO - Double down orders: 1
2025-06-04 15:51:00,184 - __main__ - INFO - 
Target order details:
2025-06-04 15:51:00,184 - __main__ - INFO -   ID: e5a82e00-4def-462e-b1a3-ed8c088e7b25
2025-06-04 15:51:00,184 - __main__ - INFO -   Status: filled
2025-06-04 15:51:00,185 - __main__ - INFO -   Limit price: 310.85
2025-06-04 15:51:00,185 - __main__ - INFO - 
Active orders before fill: 2
2025-06-04 15:51:00,185 - __main__ - INFO - 
============================================================
2025-06-04 15:51:00,185 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-04 15:51:00,185 - __main__ - INFO - ============================================================
2025-06-04 15:51:00,185 - __main__ - INFO - Waiting for target order e5a82e00-4def-462e-b1a3-ed8c088e7b25 to fill at $310.85...
2025-06-04 15:51:00,186 - __main__ - INFO - ✅ Target order filled at $310.85!
2025-06-04 15:51:05,188 - __main__ - INFO - 
============================================================
2025-06-04 15:51:05,189 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-04 15:51:05,190 - __main__ - INFO - ============================================================
2025-06-04 15:51:05,190 - __main__ - INFO - Stop order 4a1b207e-b637-4656-979d-230b7cc89348 status: accepted
2025-06-04 15:51:05,191 - __main__ - ERROR - ❌ Stop order is still accepted
2025-06-04 15:51:05,191 - __main__ - INFO - Double down order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed status: submitted
2025-06-04 15:51:05,191 - __main__ - ERROR - ❌ Double down order is still submitted
2025-06-04 15:51:05,192 - __main__ - INFO - 
Active orders after fill: 2
2025-06-04 15:51:05,193 - __main__ - ERROR - ❌ TradeTracker still shows active trade for GLD
2025-06-04 15:51:05,193 - __main__ - INFO - 
============================================================
2025-06-04 15:51:05,193 - __main__ - INFO - TEST COMPLETE
2025-06-04 15:51:05,194 - __main__ - INFO - ============================================================
2025-06-04 15:51:05,194 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-04 15:51:05,195 - src.order.manager - WARNING - Cannot cancel inactive order e5a82e00-4def-462e-b1a3-ed8c088e7b25 with status filled
2025-06-04 15:51:05,195 - src.order.base - INFO - Order 4a1b207e-b637-4656-979d-230b7cc89348 status changed: accepted -> pending_cancel (Test cleanup)
2025-06-04 15:51:05,197 - src.order.manager - INFO - Cancelling order 4a1b207e-b637-4656-979d-230b7cc89348 with broker ID 124
2025-06-04 15:51:05,197 - src.order.manager - WARNING - Cannot cancel inactive order 5817d957-af52-479d-a8c8-ddc7f14b2cb2 with status filled
2025-06-04 15:51:05,198 - src.order.base - INFO - Order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed status changed: submitted -> pending_cancel (Test cleanup)
2025-06-04 15:51:05,198 - src.order.manager - INFO - Cancelling order 3b1d4164-b7ee-41cc-ae24-811bbf0395ed with broker ID 126
2025-06-04 15:51:05,199 - __main__ - INFO - Cancelled 2 orders
2025-06-04 15:51:05,199 - __main__ - INFO - 
Cleaning up...
2025-06-04 15:51:05,200 - src.rule.engine - INFO - Rule engine stopped
2025-06-04 15:51:05,212 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-04 15:51:05,214 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-04 15:51:05,224 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-04 15:51:05,224 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:27:51,103 - __main__ - INFO - ================================================================================
2025-06-05 10:27:51,104 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 10:27:51,105 - __main__ - INFO - ================================================================================
2025-06-05 10:27:51,108 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:27:51,109 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:27:51,111 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:27:53,026 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:27:53,028 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:27:53,092 - src.tws_connection - INFO - ✅ Next valid order ID received: 127
2025-06-05 10:27:53,093 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:27:53,093 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:27:53,095 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:27:53,095 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:27:53,096 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:27:53,096 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:27:53,097 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:27:53,097 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:27:53,097 - __main__ - INFO - 
============================================================
2025-06-05 10:27:53,097 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:27:53,098 - __main__ - INFO - ============================================================
2025-06-05 10:27:53,099 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:27:53,099 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:27:53,099 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:27:53,099 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:27:53,100 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:27:53,101 - src.order.base - INFO - Order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:27:53,102 - src.order.manager - INFO - Submitting order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e to TWS
2025-06-05 10:27:53,102 - src.order.manager - INFO - Got broker order ID 127 for order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e
2025-06-05 10:27:53,102 - src.order.manager - INFO - Calling placeOrder with ID 127, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:27:53,102 - src.order.manager - INFO - placeOrder called successfully for order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e
2025-06-05 10:27:53,103 - src.order.base - INFO - Order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:27:53,104 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:27:53,104 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:27:53,139 - src.tws_connection - INFO - ✅ Next valid order ID received: 127
2025-06-05 10:27:53,239 - src.tws_connection - INFO - ✅ Next valid order ID received: 127
2025-06-05 10:27:53,724 - src.tws_connection - INFO - Open Order - ID: 127, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:27:53,729 - src.order.base - INFO - Order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:27:53,792 - src.order.base - INFO - Order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e status changed: accepted -> filled (Order fully filled)
2025-06-05 10:27:53,792 - src.order.base - INFO - Order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e filled: 100.0 @ 311.24 (100.0/100)
2025-06-05 10:27:53,793 - src.tws_connection - INFO - Open Order - ID: 127, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:27:53,808 - src.tws_connection - INFO - Open Order - ID: 127, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:27:53,982 - src.tws_connection - WARNING - ⚠️ TWS Error 2176: Warning: Your API version does not support fractional share size rules. Please upgrade to a minimum version 163. Trimmed value 708.71 to 708 (reqId: 1000)
2025-06-05 10:27:54,113 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:27:54,114 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.97 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:27:54,115 - src.order.base - INFO - Order 0e49211e-d1c9-4a86-bc93-c12b808077ea status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:27:54,115 - src.order.manager - INFO - Submitting order 0e49211e-d1c9-4a86-bc93-c12b808077ea to TWS
2025-06-05 10:27:54,115 - src.order.manager - INFO - Got broker order ID 127 for order 0e49211e-d1c9-4a86-bc93-c12b808077ea
2025-06-05 10:27:54,115 - src.order.manager - INFO - Calling placeOrder with ID 127, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:27:54,116 - src.order.manager - INFO - placeOrder called successfully for order 0e49211e-d1c9-4a86-bc93-c12b808077ea
2025-06-05 10:27:54,120 - src.order.base - INFO - Order 0e49211e-d1c9-4a86-bc93-c12b808077ea status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:27:54,122 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 0e49211e-d1c9-4a86-bc93-c12b808077ea at $310.97
2025-06-05 10:27:54,122 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:27:54,123 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.25 (ATR: 0.0450 * 0.2 = 0.0090)
2025-06-05 10:27:54,123 - src.order.base - INFO - Order d3fb051f-647a-48a7-9231-9bd64bd0212f status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:27:54,124 - src.order.manager - INFO - Submitting order d3fb051f-647a-48a7-9231-9bd64bd0212f to TWS
2025-06-05 10:27:54,124 - src.order.manager - INFO - Got broker order ID 128 for order d3fb051f-647a-48a7-9231-9bd64bd0212f
2025-06-05 10:27:54,124 - src.order.manager - INFO - Calling placeOrder with ID 128, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.250000 DAY
2025-06-05 10:27:54,125 - src.order.manager - INFO - placeOrder called successfully for order d3fb051f-647a-48a7-9231-9bd64bd0212f
2025-06-05 10:27:54,125 - src.order.base - INFO - Order d3fb051f-647a-48a7-9231-9bd64bd0212f status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:27:54,126 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit d3fb051f-647a-48a7-9231-9bd64bd0212f at $311.25
2025-06-05 10:27:54,126 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:27:54,126 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:27:54,137 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 127)
2025-06-05 10:27:54,345 - src.tws_connection - INFO - Open Order - ID: 128, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:27:54,637 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['0e49211e-d1c9-4a86-bc93-c12b808077ea']
2025-06-05 10:27:54,637 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:27:56,227 - src.tws_connection - INFO - Open Order - ID: 128, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:27:56,231 - src.tws_connection - INFO - Open Order - ID: 128, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:27:56,241 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:27:56,242 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.28, stop_distance=$0.27, dd_distance=$0.13, dd_price=$311.14, original_qty=100, dd_qty=100
2025-06-05 10:27:56,242 - src.order.base - INFO - Order 49da2dfe-a92e-4015-8946-afb23fe931e7 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:27:56,242 - src.order.manager - INFO - Submitting order 49da2dfe-a92e-4015-8946-afb23fe931e7 to TWS
2025-06-05 10:27:56,242 - src.order.manager - INFO - Got broker order ID 129 for order 49da2dfe-a92e-4015-8946-afb23fe931e7
2025-06-05 10:27:56,242 - src.order.manager - INFO - Calling placeOrder with ID 129, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@311.140000 DAY
2025-06-05 10:27:56,243 - src.order.manager - INFO - placeOrder called successfully for order 49da2dfe-a92e-4015-8946-afb23fe931e7
2025-06-05 10:27:56,243 - src.order.base - INFO - Order 49da2dfe-a92e-4015-8946-afb23fe931e7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:27:56,243 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:27:56,244 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $311.14
2025-06-05 10:27:56,244 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:27:56,244 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e for GLD
2025-06-05 10:27:56,246 - src.order.base - INFO - Order d3fb051f-647a-48a7-9231-9bd64bd0212f status changed: submitted -> filled (Order fully filled)
2025-06-05 10:27:56,246 - src.order.base - INFO - Order d3fb051f-647a-48a7-9231-9bd64bd0212f filled: 100.0 @ 311.25 (100.0/100)
2025-06-05 10:27:56,344 - src.tws_connection - INFO - Open Order - ID: 129, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:28:03,109 - __main__ - INFO - 
============================================================
2025-06-05 10:28:03,110 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:28:03,111 - __main__ - INFO - ============================================================
2025-06-05 10:28:03,112 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:28:03,112 - __main__ - INFO - Order 49da2dfe-a92e-4015-8946-afb23fe931e7: limit buy 100 @ 311.14 - Status: submitted
2025-06-05 10:28:03,113 - __main__ - INFO - Order d3fb051f-647a-48a7-9231-9bd64bd0212f: limit sell -100 @ 311.25 - Status: filled
2025-06-05 10:28:03,113 - __main__ - INFO - Order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e: market buy 100 @ MARKET - Status: filled
2025-06-05 10:28:03,114 - __main__ - INFO - Order 0e49211e-d1c9-4a86-bc93-c12b808077ea: stop sell -100 @ 310.97 - Status: submitted
2025-06-05 10:28:03,114 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:28:03,114 - __main__ - INFO - Stop orders: 1
2025-06-05 10:28:03,114 - __main__ - INFO - Target orders: 1
2025-06-05 10:28:03,115 - __main__ - INFO - Double down orders: 1
2025-06-05 10:28:03,115 - __main__ - INFO - 
Target order details:
2025-06-05 10:28:03,116 - __main__ - INFO -   ID: d3fb051f-647a-48a7-9231-9bd64bd0212f
2025-06-05 10:28:03,116 - __main__ - INFO -   Status: filled
2025-06-05 10:28:03,118 - __main__ - INFO -   Limit price: 311.25
2025-06-05 10:28:03,119 - __main__ - INFO - 
Active orders before fill: 2
2025-06-05 10:28:03,119 - __main__ - INFO - 
============================================================
2025-06-05 10:28:03,119 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 10:28:03,120 - __main__ - INFO - ============================================================
2025-06-05 10:28:03,120 - __main__ - INFO - Waiting for target order d3fb051f-647a-48a7-9231-9bd64bd0212f to fill at $311.25...
2025-06-05 10:28:03,120 - __main__ - INFO - ✅ Target order filled at $311.25!
2025-06-05 10:28:08,127 - __main__ - INFO - 
============================================================
2025-06-05 10:28:08,128 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 10:28:08,128 - __main__ - INFO - ============================================================
2025-06-05 10:28:08,129 - __main__ - INFO - Stop order 0e49211e-d1c9-4a86-bc93-c12b808077ea status: submitted
2025-06-05 10:28:08,129 - __main__ - ERROR - ❌ Stop order is still submitted
2025-06-05 10:28:08,130 - __main__ - INFO - Double down order 49da2dfe-a92e-4015-8946-afb23fe931e7 status: submitted
2025-06-05 10:28:08,130 - __main__ - ERROR - ❌ Double down order is still submitted
2025-06-05 10:28:08,130 - __main__ - INFO - 
Active orders after fill: 2
2025-06-05 10:28:08,131 - __main__ - ERROR - ❌ TradeTracker still shows active trade for GLD
2025-06-05 10:28:08,131 - __main__ - INFO - 
============================================================
2025-06-05 10:28:08,131 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:28:08,131 - __main__ - INFO - ============================================================
2025-06-05 10:28:08,131 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:28:08,132 - src.order.base - INFO - Order 49da2dfe-a92e-4015-8946-afb23fe931e7 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 10:28:08,132 - src.order.manager - INFO - Cancelling order 49da2dfe-a92e-4015-8946-afb23fe931e7 with broker ID 129
2025-06-05 10:28:08,132 - src.order.manager - WARNING - Cannot cancel inactive order d3fb051f-647a-48a7-9231-9bd64bd0212f with status filled
2025-06-05 10:28:08,132 - src.order.manager - WARNING - Cannot cancel inactive order 4e1db9a6-f8de-46d8-a5d2-ad6151a7538e with status filled
2025-06-05 10:28:08,132 - src.order.base - INFO - Order 0e49211e-d1c9-4a86-bc93-c12b808077ea status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 10:28:08,133 - src.order.manager - INFO - Cancelling order 0e49211e-d1c9-4a86-bc93-c12b808077ea with broker ID 127
2025-06-05 10:28:08,133 - __main__ - INFO - Cancelled 2 orders
2025-06-05 10:28:08,133 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:28:08,135 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:28:08,135 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:28:08,136 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:28:08,137 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:28:08,137 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:32:51,239 - __main__ - INFO - ================================================================================
2025-06-05 10:32:51,240 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 10:32:51,244 - __main__ - INFO - ================================================================================
2025-06-05 10:32:51,249 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:32:51,250 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:32:51,251 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:32:53,456 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:32:53,458 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:32:53,483 - src.tws_connection - INFO - ✅ Next valid order ID received: 130
2025-06-05 10:32:53,484 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:32:53,484 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:32:53,485 - src.tws_connection - INFO - ✅ Next valid order ID received: 130
2025-06-05 10:32:53,485 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:32:53,486 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:32:53,486 - src.tws_connection - INFO - ✅ Next valid order ID received: 130
2025-06-05 10:32:53,487 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:32:53,487 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:32:53,487 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:32:53,488 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:32:53,488 - __main__ - INFO - 
============================================================
2025-06-05 10:32:53,488 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:32:53,489 - __main__ - INFO - ============================================================
2025-06-05 10:32:53,489 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:32:53,489 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:32:53,490 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:32:53,490 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:32:53,490 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:32:53,490 - src.order.base - INFO - Order 10996a2e-799c-4f68-b5f0-05bb155e4953 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:32:53,491 - src.order.manager - INFO - Submitting order 10996a2e-799c-4f68-b5f0-05bb155e4953 to TWS
2025-06-05 10:32:53,491 - src.order.manager - INFO - Got broker order ID 130 for order 10996a2e-799c-4f68-b5f0-05bb155e4953
2025-06-05 10:32:53,491 - src.order.manager - INFO - Calling placeOrder with ID 130, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:32:53,491 - src.order.manager - INFO - placeOrder called successfully for order 10996a2e-799c-4f68-b5f0-05bb155e4953
2025-06-05 10:32:53,491 - src.order.base - INFO - Order 10996a2e-799c-4f68-b5f0-05bb155e4953 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:32:53,492 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:32:53,492 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:32:53,623 - src.tws_connection - INFO - Open Order - ID: 130, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:32:53,624 - src.order.base - INFO - Order 10996a2e-799c-4f68-b5f0-05bb155e4953 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:32:53,628 - src.order.base - INFO - Order 10996a2e-799c-4f68-b5f0-05bb155e4953 status changed: accepted -> filled (Order fully filled)
2025-06-05 10:32:53,629 - src.order.base - INFO - Order 10996a2e-799c-4f68-b5f0-05bb155e4953 filled: 100.0 @ 311.4 (100.0/100)
2025-06-05 10:32:53,629 - src.tws_connection - INFO - Open Order - ID: 130, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:32:53,632 - src.tws_connection - INFO - Open Order - ID: 130, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:32:54,505 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:32:54,505 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $311.12 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:32:54,505 - src.order.base - INFO - Order 661dba10-3a13-4739-a97e-931e82b0bbf3 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:32:54,506 - src.order.manager - INFO - Submitting order 661dba10-3a13-4739-a97e-931e82b0bbf3 to TWS
2025-06-05 10:32:54,506 - src.order.manager - INFO - Got broker order ID 131 for order 661dba10-3a13-4739-a97e-931e82b0bbf3
2025-06-05 10:32:54,506 - src.order.manager - INFO - Calling placeOrder with ID 131, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:32:54,507 - src.order.manager - INFO - placeOrder called successfully for order 661dba10-3a13-4739-a97e-931e82b0bbf3
2025-06-05 10:32:54,507 - src.order.base - INFO - Order 661dba10-3a13-4739-a97e-931e82b0bbf3 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:32:54,507 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 661dba10-3a13-4739-a97e-931e82b0bbf3 at $311.12
2025-06-05 10:32:54,507 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:32:54,508 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.40 (ATR: 0.0450 * 0.2 = 0.0090)
2025-06-05 10:32:54,508 - src.order.base - INFO - Order c6c4957c-8532-4de3-9e68-8e3669ebd818 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:32:54,509 - src.order.manager - INFO - Submitting order c6c4957c-8532-4de3-9e68-8e3669ebd818 to TWS
2025-06-05 10:32:54,509 - src.order.manager - INFO - Got broker order ID 132 for order c6c4957c-8532-4de3-9e68-8e3669ebd818
2025-06-05 10:32:54,509 - src.order.manager - INFO - Calling placeOrder with ID 132, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.400000 DAY
2025-06-05 10:32:54,509 - src.order.manager - INFO - placeOrder called successfully for order c6c4957c-8532-4de3-9e68-8e3669ebd818
2025-06-05 10:32:54,510 - src.order.base - INFO - Order c6c4957c-8532-4de3-9e68-8e3669ebd818 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:32:54,511 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit c6c4957c-8532-4de3-9e68-8e3669ebd818 at $311.40
2025-06-05 10:32:54,511 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:32:54,514 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:32:54,592 - src.tws_connection - INFO - Open Order - ID: 131, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:32:54,592 - src.order.base - INFO - Order 661dba10-3a13-4739-a97e-931e82b0bbf3 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:32:54,720 - src.tws_connection - INFO - Open Order - ID: 132, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:32:55,022 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['661dba10-3a13-4739-a97e-931e82b0bbf3']
2025-06-05 10:32:55,022 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:32:55,194 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:32:55,197 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.39, stop_distance=$0.27, dd_distance=$0.13, dd_price=$311.25, original_qty=100, dd_qty=100
2025-06-05 10:32:55,195 - src.tws_connection - INFO - Open Order - ID: 132, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:32:55,198 - src.order.base - INFO - Order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:32:55,199 - src.order.manager - INFO - Submitting order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 to TWS
2025-06-05 10:32:55,199 - src.tws_connection - INFO - Open Order - ID: 132, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:32:55,200 - src.order.manager - INFO - Got broker order ID 133 for order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7
2025-06-05 10:32:55,202 - src.order.manager - INFO - Calling placeOrder with ID 133, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@311.250000 DAY
2025-06-05 10:32:55,203 - src.order.manager - INFO - placeOrder called successfully for order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7
2025-06-05 10:32:55,203 - src.order.base - INFO - Order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:32:55,204 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:32:55,204 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $311.25
2025-06-05 10:32:55,204 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:32:55,204 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 10996a2e-799c-4f68-b5f0-05bb155e4953 for GLD
2025-06-05 10:32:55,205 - src.order.base - INFO - Order c6c4957c-8532-4de3-9e68-8e3669ebd818 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:32:55,205 - src.order.base - INFO - Order c6c4957c-8532-4de3-9e68-8e3669ebd818 filled: 100.0 @ 311.4 (100.0/100)
2025-06-05 10:32:55,205 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - target order c6c4957c-8532-4de3-9e68-8e3669ebd818 filled at $311.4
2025-06-05 10:32:55,206 - src.order.base - INFO - Order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 status changed: submitted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:32:55,206 - src.order.manager - INFO - Cancelling order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 with broker ID 133
2025-06-05 10:32:55,206 - src.rule.linked_order_actions - INFO - Cancelled remaining order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 for GLD
2025-06-05 10:32:55,206 - src.order.manager - WARNING - Cannot cancel inactive order 10996a2e-799c-4f68-b5f0-05bb155e4953 with status filled
2025-06-05 10:32:55,206 - src.rule.linked_order_actions - INFO - Cancelled remaining order 10996a2e-799c-4f68-b5f0-05bb155e4953 for GLD
2025-06-05 10:32:55,207 - src.order.base - INFO - Order 661dba10-3a13-4739-a97e-931e82b0bbf3 status changed: accepted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:32:55,207 - src.order.manager - INFO - Cancelling order 661dba10-3a13-4739-a97e-931e82b0bbf3 with broker ID 131
2025-06-05 10:32:55,207 - src.rule.linked_order_actions - INFO - Cancelled remaining order 661dba10-3a13-4739-a97e-931e82b0bbf3 for GLD
2025-06-05 10:32:55,208 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 10:32:55,208 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 10:32:55,208 - src.order.manager - WARNING - Unknown IB order status: ApiCancelled for order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7
2025-06-05 10:32:55,266 - src.order.base - INFO - Order 661dba10-3a13-4739-a97e-931e82b0bbf3 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 10:32:55,265 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 131)
2025-06-05 10:33:03,501 - __main__ - INFO - 
============================================================
2025-06-05 10:33:03,501 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:33:03,502 - __main__ - INFO - ============================================================
2025-06-05 10:33:03,502 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:33:03,502 - __main__ - INFO - Order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7: limit buy 100 @ 311.25 - Status: pending_cancel
2025-06-05 10:33:03,503 - __main__ - INFO - Order 10996a2e-799c-4f68-b5f0-05bb155e4953: market buy 100 @ MARKET - Status: filled
2025-06-05 10:33:03,505 - __main__ - INFO - Order c6c4957c-8532-4de3-9e68-8e3669ebd818: limit sell -100 @ 311.4 - Status: filled
2025-06-05 10:33:03,505 - __main__ - INFO - Order 661dba10-3a13-4739-a97e-931e82b0bbf3: stop sell -100 @ 311.12 - Status: cancelled
2025-06-05 10:33:03,505 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:33:03,506 - __main__ - INFO - Stop orders: 1
2025-06-05 10:33:03,506 - __main__ - INFO - Target orders: 1
2025-06-05 10:33:03,507 - __main__ - INFO - Double down orders: 0
2025-06-05 10:33:03,507 - __main__ - INFO - 
Target order details:
2025-06-05 10:33:03,507 - __main__ - INFO -   ID: c6c4957c-8532-4de3-9e68-8e3669ebd818
2025-06-05 10:33:03,507 - __main__ - INFO -   Status: filled
2025-06-05 10:33:03,507 - __main__ - INFO -   Limit price: 311.4
2025-06-05 10:33:03,508 - __main__ - INFO - 
Active orders before fill: 0
2025-06-05 10:33:03,508 - __main__ - INFO - 
============================================================
2025-06-05 10:33:03,508 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 10:33:03,508 - __main__ - INFO - ============================================================
2025-06-05 10:33:03,508 - __main__ - INFO - Waiting for target order c6c4957c-8532-4de3-9e68-8e3669ebd818 to fill at $311.4...
2025-06-05 10:33:03,509 - __main__ - INFO - ✅ Target order filled at $311.4!
2025-06-05 10:33:08,515 - __main__ - INFO - 
============================================================
2025-06-05 10:33:08,516 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 10:33:08,516 - __main__ - INFO - ============================================================
2025-06-05 10:33:08,516 - __main__ - INFO - Stop order 661dba10-3a13-4739-a97e-931e82b0bbf3 status: cancelled
2025-06-05 10:33:08,517 - __main__ - ERROR - ❌ Stop order is still cancelled
2025-06-05 10:33:08,517 - __main__ - INFO - 
Active orders after fill: 0
2025-06-05 10:33:08,517 - __main__ - INFO - ✅ TradeTracker correctly shows no active trade for GLD
2025-06-05 10:33:08,517 - __main__ - INFO - 
============================================================
2025-06-05 10:33:08,517 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:33:08,517 - __main__ - INFO - ============================================================
2025-06-05 10:33:08,518 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:33:08,518 - src.order.manager - WARNING - Cannot cancel inactive order 1402c1e1-f75b-4d50-bf3d-f831f0a255e7 with status pending_cancel
2025-06-05 10:33:08,518 - src.order.manager - WARNING - Cannot cancel inactive order 10996a2e-799c-4f68-b5f0-05bb155e4953 with status filled
2025-06-05 10:33:08,518 - src.order.manager - WARNING - Cannot cancel inactive order c6c4957c-8532-4de3-9e68-8e3669ebd818 with status filled
2025-06-05 10:33:08,519 - src.order.manager - WARNING - Cannot cancel inactive order 661dba10-3a13-4739-a97e-931e82b0bbf3 with status cancelled
2025-06-05 10:33:08,519 - __main__ - INFO - Cancelled 0 orders
2025-06-05 10:33:08,519 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:33:08,520 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:33:08,520 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:33:08,520 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:33:08,521 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:33:08,521 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:33:54,028 - __main__ - INFO - ================================================================================
2025-06-05 10:33:54,028 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 10:33:54,028 - __main__ - INFO - ================================================================================
2025-06-05 10:33:54,030 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:33:54,030 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:33:54,032 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:33:55,156 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:33:55,157 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:33:55,181 - src.tws_connection - INFO - ✅ Next valid order ID received: 134
2025-06-05 10:33:55,181 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:33:55,181 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:33:55,182 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:33:55,183 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:33:55,183 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:33:55,183 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:33:55,184 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:33:55,184 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:33:55,184 - __main__ - INFO - 
============================================================
2025-06-05 10:33:55,184 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:33:55,184 - __main__ - INFO - ============================================================
2025-06-05 10:33:55,185 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:33:55,185 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:33:55,186 - src.trade_tracker - INFO - Started tracking BUY trade for SLV
2025-06-05 10:33:55,186 - src.position.position_manager - INFO - Opened BUY position for SLV
2025-06-05 10:33:55,186 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for SLV
2025-06-05 10:33:55,187 - src.order.base - INFO - Order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:33:55,187 - src.order.manager - INFO - Submitting order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd to TWS
2025-06-05 10:33:55,188 - src.order.manager - INFO - Got broker order ID 134 for order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd
2025-06-05 10:33:55,188 - src.order.manager - INFO - Calling placeOrder with ID 134, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:33:55,188 - src.order.manager - INFO - placeOrder called successfully for order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd
2025-06-05 10:33:55,188 - src.order.base - INFO - Order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:33:55,189 - src.rule.linked_order_actions - INFO - Created new order context for SLV BUY position
2025-06-05 10:33:55,189 - src.position.position_manager - INFO - Added 1 main orders to SLV position
2025-06-05 10:33:55,258 - src.tws_connection - INFO - ✅ Next valid order ID received: 134
2025-06-05 10:33:55,357 - src.tws_connection - INFO - ✅ Next valid order ID received: 134
2025-06-05 10:33:55,630 - src.tws_connection - INFO - Open Order - ID: 134, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-05 10:33:55,631 - src.order.base - INFO - Order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:33:55,636 - src.order.base - INFO - Order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd status changed: accepted -> filled (Order fully filled)
2025-06-05 10:33:55,636 - src.tws_connection - INFO - Open Order - ID: 134, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-05 10:33:55,637 - src.order.base - INFO - Order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd filled: 100.0 @ 32.69 (100.0/100)
2025-06-05 10:33:55,638 - src.tws_connection - INFO - Open Order - ID: 134, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-05 10:33:56,438 - src.tws_connection - WARNING - ⚠️ TWS Error 2176: Warning: Your API version does not support fractional share size rules. Please upgrade to a minimum version 163. Trimmed value 4667.14 to 4667 (reqId: 1000)
2025-06-05 10:34:05,187 - src.rule.linked_order_actions - INFO - ATR for SLV: 0.0129
2025-06-05 10:34:05,187 - src.rule.linked_order_actions - INFO - ATR-based stop: SLV stop at $32.61 (ATR: 0.0129 * 6.0 = 0.0771)
2025-06-05 10:34:05,188 - src.order.base - INFO - Order 9694e6a8-1213-4938-abe5-e9c39161a7e6 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:34:05,188 - src.order.manager - INFO - Submitting order 9694e6a8-1213-4938-abe5-e9c39161a7e6 to TWS
2025-06-05 10:34:05,189 - src.order.manager - INFO - Got broker order ID 134 for order 9694e6a8-1213-4938-abe5-e9c39161a7e6
2025-06-05 10:34:05,189 - src.order.manager - INFO - Calling placeOrder with ID 134, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:34:05,189 - src.order.manager - INFO - placeOrder called successfully for order 9694e6a8-1213-4938-abe5-e9c39161a7e6
2025-06-05 10:34:05,190 - src.order.base - INFO - Order 9694e6a8-1213-4938-abe5-e9c39161a7e6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:34:05,190 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9694e6a8-1213-4938-abe5-e9c39161a7e6 at $32.61
2025-06-05 10:34:05,190 - src.position.position_manager - INFO - Added 1 stop orders to SLV position
2025-06-05 10:34:05,191 - src.rule.linked_order_actions - INFO - ATR-based target: SLV target at $32.69 (ATR: 0.0129 * 0.2 = 0.0026)
2025-06-05 10:34:05,191 - src.order.base - INFO - Order e716a90e-18f0-44a4-95e3-688edb270977 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:34:05,191 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 134)
2025-06-05 10:34:05,192 - src.order.manager - INFO - Submitting order e716a90e-18f0-44a4-95e3-688edb270977 to TWS
2025-06-05 10:34:05,192 - src.order.manager - INFO - Got broker order ID 135 for order e716a90e-18f0-44a4-95e3-688edb270977
2025-06-05 10:34:05,192 - src.order.manager - INFO - Calling placeOrder with ID 135, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@32.690000 DAY
2025-06-05 10:34:05,193 - src.order.manager - INFO - placeOrder called successfully for order e716a90e-18f0-44a4-95e3-688edb270977
2025-06-05 10:34:05,193 - src.order.base - INFO - Order e716a90e-18f0-44a4-95e3-688edb270977 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:34:05,193 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit e716a90e-18f0-44a4-95e3-688edb270977 at $32.69
2025-06-05 10:34:05,194 - src.position.position_manager - INFO - Added 1 target orders to SLV position
2025-06-05 10:34:05,194 - src.rule.linked_order_actions - INFO - Starting double down order creation for SLV
2025-06-05 10:34:05,194 - __main__ - INFO - 
============================================================
2025-06-05 10:34:05,194 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:34:05,194 - __main__ - INFO - ============================================================
2025-06-05 10:34:05,195 - __main__ - INFO - Found 3 orders for SLV
2025-06-05 10:34:05,195 - __main__ - INFO - Order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd: market buy 100 @ MARKET - Status: filled
2025-06-05 10:34:05,195 - __main__ - INFO - Order e716a90e-18f0-44a4-95e3-688edb270977: limit sell -100 @ 32.69 - Status: submitted
2025-06-05 10:34:05,196 - __main__ - INFO - Order 9694e6a8-1213-4938-abe5-e9c39161a7e6: stop sell -100 @ 32.61 - Status: submitted
2025-06-05 10:34:05,196 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:34:05,196 - __main__ - INFO - Stop orders: 1
2025-06-05 10:34:05,196 - __main__ - INFO - Target orders: 1
2025-06-05 10:34:05,196 - __main__ - INFO - Double down orders: 0
2025-06-05 10:34:05,196 - __main__ - INFO - 
Target order details:
2025-06-05 10:34:05,198 - __main__ - INFO -   ID: e716a90e-18f0-44a4-95e3-688edb270977
2025-06-05 10:34:05,198 - __main__ - INFO -   Status: submitted
2025-06-05 10:34:05,199 - __main__ - INFO -   Limit price: 32.69
2025-06-05 10:34:05,199 - __main__ - INFO - 
Active orders before fill: 2
2025-06-05 10:34:05,199 - __main__ - INFO - 
============================================================
2025-06-05 10:34:05,199 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 10:34:05,199 - __main__ - INFO - ============================================================
2025-06-05 10:34:05,200 - __main__ - INFO - Waiting for target order e716a90e-18f0-44a4-95e3-688edb270977 to fill at $32.69...
2025-06-05 10:34:05,200 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 10:34:05,303 - src.tws_connection - INFO - Open Order - ID: 135, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-05 10:34:05,695 - src.rule.linked_order_actions - INFO - Found 1 stop orders for SLV: ['9694e6a8-1213-4938-abe5-e9c39161a7e6']
2025-06-05 10:34:05,696 - src.rule.linked_order_actions - INFO - Executing double down action for SLV
2025-06-05 10:34:07,291 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for SLV: 0.0771
2025-06-05 10:34:07,292 - src.rule.linked_order_actions - INFO - Double down calc for SLV (BUY): current=$32.68, stop_distance=$0.08, dd_distance=$0.04, dd_price=$32.64, original_qty=100, dd_qty=100
2025-06-05 10:34:07,292 - src.order.base - INFO - Order b0c4e599-f744-4748-b4b6-bcc760e2f1f0 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:34:07,292 - src.order.manager - INFO - Submitting order b0c4e599-f744-4748-b4b6-bcc760e2f1f0 to TWS
2025-06-05 10:34:07,292 - src.order.manager - INFO - Got broker order ID 136 for order b0c4e599-f744-4748-b4b6-bcc760e2f1f0
2025-06-05 10:34:07,293 - src.order.manager - INFO - Calling placeOrder with ID 136, contract 0,SLV,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@32.640000 DAY
2025-06-05 10:34:07,293 - src.order.manager - INFO - placeOrder called successfully for order b0c4e599-f744-4748-b4b6-bcc760e2f1f0
2025-06-05 10:34:07,293 - src.order.base - INFO - Order b0c4e599-f744-4748-b4b6-bcc760e2f1f0 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:34:07,293 - src.position.position_manager - INFO - Added 1 doubledown orders to SLV position
2025-06-05 10:34:07,294 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for SLV: 100 shares @ $32.64
2025-06-05 10:34:07,294 - src.rule.linked_order_actions - INFO - Auto-created double down order for SLV
2025-06-05 10:34:07,294 - src.rule.linked_order_actions - INFO - Created and linked BUY main order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd for SLV
2025-06-05 10:34:07,294 - __main__ - INFO - Waiting... (2s elapsed, order status: submitted)
2025-06-05 10:34:07,480 - src.tws_connection - INFO - Open Order - ID: 136, Symbol: SLV, Action: BUY, Quantity: 100.0
2025-06-05 10:34:09,308 - __main__ - INFO - Waiting... (4s elapsed, order status: submitted)
2025-06-05 10:34:10,417 - src.tws_connection - INFO - Open Order - ID: 135, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-05 10:34:11,316 - __main__ - INFO - Waiting... (6s elapsed, order status: submitted)
2025-06-05 10:34:13,333 - __main__ - INFO - Waiting... (8s elapsed, order status: submitted)
2025-06-05 10:34:15,345 - __main__ - INFO - Waiting... (10s elapsed, order status: submitted)
2025-06-05 10:34:17,351 - __main__ - INFO - Waiting... (12s elapsed, order status: submitted)
2025-06-05 10:34:19,358 - __main__ - INFO - Waiting... (14s elapsed, order status: submitted)
2025-06-05 10:34:21,367 - __main__ - INFO - Waiting... (16s elapsed, order status: submitted)
2025-06-05 10:34:23,378 - __main__ - INFO - Waiting... (18s elapsed, order status: submitted)
2025-06-05 10:34:25,392 - __main__ - INFO - Waiting... (20s elapsed, order status: submitted)
2025-06-05 10:34:25,404 - src.tws_connection - INFO - Open Order - ID: 135, Symbol: SLV, Action: SELL, Quantity: 100.0
2025-06-05 10:34:27,405 - __main__ - INFO - Waiting... (22s elapsed, order status: submitted)
2025-06-05 10:34:29,418 - __main__ - INFO - Waiting... (24s elapsed, order status: submitted)
2025-06-05 10:34:31,423 - __main__ - INFO - Waiting... (26s elapsed, order status: submitted)
2025-06-05 10:34:33,431 - __main__ - INFO - Waiting... (28s elapsed, order status: submitted)
2025-06-05 10:34:35,439 - __main__ - INFO - Waiting... (30s elapsed, order status: submitted)
2025-06-05 10:34:37,446 - __main__ - INFO - Waiting... (32s elapsed, order status: submitted)
2025-06-05 10:34:39,461 - __main__ - INFO - Waiting... (34s elapsed, order status: submitted)
2025-06-05 10:34:41,472 - __main__ - INFO - Waiting... (36s elapsed, order status: submitted)
2025-06-05 10:34:43,488 - __main__ - INFO - Waiting... (38s elapsed, order status: submitted)
2025-06-05 10:34:45,502 - __main__ - INFO - Waiting... (40s elapsed, order status: submitted)
2025-06-05 10:34:47,513 - __main__ - INFO - Waiting... (42s elapsed, order status: submitted)
2025-06-05 10:34:49,523 - __main__ - INFO - Waiting... (44s elapsed, order status: submitted)
2025-06-05 10:34:51,537 - __main__ - INFO - Waiting... (46s elapsed, order status: submitted)
2025-06-05 10:34:53,545 - __main__ - INFO - Waiting... (48s elapsed, order status: submitted)
2025-06-05 10:34:55,554 - __main__ - INFO - Waiting... (50s elapsed, order status: submitted)
2025-06-05 10:34:57,578 - __main__ - INFO - Waiting... (52s elapsed, order status: submitted)
2025-06-05 10:34:59,588 - __main__ - INFO - Waiting... (54s elapsed, order status: submitted)
2025-06-05 10:35:01,590 - __main__ - INFO - Waiting... (56s elapsed, order status: submitted)
2025-06-05 10:35:03,607 - __main__ - INFO - Waiting... (58s elapsed, order status: submitted)
2025-06-05 10:35:05,209 - src.order.base - INFO - Order b0c4e599-f744-4748-b4b6-bcc760e2f1f0 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 10:35:05,209 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 136)
2025-06-05 10:35:05,619 - __main__ - WARNING - ⚠️ Target order did not fill within 60 seconds
2025-06-05 10:35:05,621 - __main__ - INFO - Continuing with test anyway...
2025-06-05 10:35:05,824 - src.order.base - INFO - Order e716a90e-18f0-44a4-95e3-688edb270977 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 10:35:05,824 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 135)
2025-06-05 10:35:10,625 - __main__ - INFO - 
============================================================
2025-06-05 10:35:10,625 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 10:35:10,626 - __main__ - INFO - ============================================================
2025-06-05 10:35:10,626 - __main__ - INFO - Stop order 9694e6a8-1213-4938-abe5-e9c39161a7e6 status: submitted
2025-06-05 10:35:10,626 - __main__ - ERROR - ❌ Stop order is still submitted
2025-06-05 10:35:10,626 - __main__ - INFO - 
Active orders after fill: 1
2025-06-05 10:35:10,627 - __main__ - ERROR - ❌ TradeTracker still shows active trade for SLV
2025-06-05 10:35:10,627 - __main__ - INFO - 
============================================================
2025-06-05 10:35:10,627 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:35:10,627 - __main__ - INFO - ============================================================
2025-06-05 10:35:10,628 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:35:10,628 - src.order.manager - WARNING - Cannot cancel inactive order b0c4e599-f744-4748-b4b6-bcc760e2f1f0 with status cancelled
2025-06-05 10:35:10,649 - src.order.manager - WARNING - Cannot cancel inactive order b77ae565-34e3-43f9-b7ca-b2d0e0c657dd with status filled
2025-06-05 10:35:10,650 - src.order.manager - WARNING - Cannot cancel inactive order e716a90e-18f0-44a4-95e3-688edb270977 with status cancelled
2025-06-05 10:35:10,650 - src.order.base - INFO - Order 9694e6a8-1213-4938-abe5-e9c39161a7e6 status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 10:35:10,651 - src.order.manager - INFO - Cancelling order 9694e6a8-1213-4938-abe5-e9c39161a7e6 with broker ID 134
2025-06-05 10:35:10,651 - __main__ - INFO - Cancelled 1 orders
2025-06-05 10:35:10,651 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:35:10,652 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:35:10,652 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:35:10,653 - src.tws_connection - WARNING - ⚠️ TWS Error 10147: OrderId 134 that needs to be cancelled is not found. (reqId: 134)
2025-06-05 10:35:10,653 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:35:10,653 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 10:35:10,654 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:35:10,655 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 10:35:10,656 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:43:31,777 - __main__ - INFO - ================================================================================
2025-06-05 10:43:31,779 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 10:43:31,779 - __main__ - INFO - ================================================================================
2025-06-05 10:43:31,782 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:43:31,782 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:43:31,783 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:43:33,435 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:43:33,436 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:43:33,471 - src.tws_connection - INFO - ✅ Next valid order ID received: 144
2025-06-05 10:43:33,471 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:43:33,471 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:43:33,472 - src.tws_connection - INFO - ✅ Next valid order ID received: 144
2025-06-05 10:43:33,473 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:43:33,473 - src.tws_connection - INFO - ✅ Next valid order ID received: 144
2025-06-05 10:43:33,474 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:43:33,474 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:43:33,475 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:43:33,475 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:43:33,475 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:43:33,475 - __main__ - INFO - 
============================================================
2025-06-05 10:43:33,476 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:43:33,476 - __main__ - INFO - ============================================================
2025-06-05 10:43:33,476 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:43:33,477 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:43:33,477 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:43:33,477 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:43:33,477 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:43:33,478 - src.order.base - INFO - Order c742d342-7196-4dfe-bc17-cae3115762a6 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:33,478 - src.order.manager - INFO - Submitting order c742d342-7196-4dfe-bc17-cae3115762a6 to TWS
2025-06-05 10:43:33,479 - src.order.manager - INFO - Got broker order ID 144 for order c742d342-7196-4dfe-bc17-cae3115762a6
2025-06-05 10:43:33,479 - src.order.manager - INFO - Calling placeOrder with ID 144, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:43:33,479 - src.order.manager - INFO - placeOrder called successfully for order c742d342-7196-4dfe-bc17-cae3115762a6
2025-06-05 10:43:33,480 - src.order.base - INFO - Order c742d342-7196-4dfe-bc17-cae3115762a6 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:33,480 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:43:33,480 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:43:33,599 - src.tws_connection - INFO - Open Order - ID: 144, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:43:33,604 - src.order.base - INFO - Order c742d342-7196-4dfe-bc17-cae3115762a6 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:43:33,605 - src.order.base - INFO - Order c742d342-7196-4dfe-bc17-cae3115762a6 status changed: accepted -> filled (Order fully filled)
2025-06-05 10:43:33,606 - src.order.base - INFO - Order c742d342-7196-4dfe-bc17-cae3115762a6 filled: 100.0 @ 310.91 (100.0/100)
2025-06-05 10:43:33,605 - src.tws_connection - INFO - Open Order - ID: 144, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:43:33,608 - src.tws_connection - INFO - Open Order - ID: 144, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:43:34,500 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:43:34,501 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.66 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:43:34,503 - src.order.base - INFO - Order 1f936d66-39ff-42f7-9685-9a41e8ccc162 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:34,508 - src.order.manager - INFO - Submitting order 1f936d66-39ff-42f7-9685-9a41e8ccc162 to TWS
2025-06-05 10:43:34,509 - src.order.manager - INFO - Got broker order ID 145 for order 1f936d66-39ff-42f7-9685-9a41e8ccc162
2025-06-05 10:43:34,509 - src.order.manager - INFO - Calling placeOrder with ID 145, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:43:34,510 - src.order.manager - INFO - placeOrder called successfully for order 1f936d66-39ff-42f7-9685-9a41e8ccc162
2025-06-05 10:43:34,510 - src.order.base - INFO - Order 1f936d66-39ff-42f7-9685-9a41e8ccc162 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:34,511 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 1f936d66-39ff-42f7-9685-9a41e8ccc162 at $310.66
2025-06-05 10:43:34,511 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:43:34,511 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.93 (ATR: 0.0450 * 0.1 = 0.0045)
2025-06-05 10:43:34,512 - src.order.base - INFO - Order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:34,512 - src.order.manager - INFO - Submitting order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 to TWS
2025-06-05 10:43:34,512 - src.order.manager - INFO - Got broker order ID 146 for order 23cd18c7-d944-419e-a7f8-8ceffd4eb000
2025-06-05 10:43:34,513 - src.order.manager - INFO - Calling placeOrder with ID 146, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.930000 DAY
2025-06-05 10:43:34,513 - src.order.manager - INFO - placeOrder called successfully for order 23cd18c7-d944-419e-a7f8-8ceffd4eb000
2025-06-05 10:43:34,516 - src.order.base - INFO - Order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:34,517 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 23cd18c7-d944-419e-a7f8-8ceffd4eb000 at $310.93
2025-06-05 10:43:34,517 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:43:34,517 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:43:34,593 - src.tws_connection - INFO - Open Order - ID: 145, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:43:34,594 - src.order.base - INFO - Order 1f936d66-39ff-42f7-9685-9a41e8ccc162 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:43:34,661 - src.tws_connection - INFO - Open Order - ID: 146, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:43:35,031 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['1f936d66-39ff-42f7-9685-9a41e8ccc162']
2025-06-05 10:43:35,031 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:43:36,029 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:43:36,024 - src.tws_connection - INFO - Open Order - ID: 146, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:43:36,040 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.91, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.78, original_qty=100, dd_qty=100
2025-06-05 10:43:36,040 - src.order.base - INFO - Order 736250fe-9b89-4921-a0de-2c7fbdd84132 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:36,041 - src.order.manager - INFO - Submitting order 736250fe-9b89-4921-a0de-2c7fbdd84132 to TWS
2025-06-05 10:43:36,041 - src.order.manager - INFO - Got broker order ID 147 for order 736250fe-9b89-4921-a0de-2c7fbdd84132
2025-06-05 10:43:36,042 - src.order.manager - INFO - Calling placeOrder with ID 147, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.780000 DAY
2025-06-05 10:43:36,042 - src.order.manager - INFO - placeOrder called successfully for order 736250fe-9b89-4921-a0de-2c7fbdd84132
2025-06-05 10:43:36,043 - src.order.base - INFO - Order 736250fe-9b89-4921-a0de-2c7fbdd84132 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:36,043 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:43:36,044 - src.tws_connection - INFO - Open Order - ID: 146, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:43:36,044 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.78
2025-06-05 10:43:36,044 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:43:36,044 - src.rule.linked_order_actions - INFO - Created and linked BUY main order c742d342-7196-4dfe-bc17-cae3115762a6 for GLD
2025-06-05 10:43:36,045 - src.order.base - INFO - Order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:43:36,045 - src.order.base - INFO - Order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 filled: 100.0 @ 310.93 (100.0/100)
2025-06-05 10:43:36,045 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - target order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 filled at $310.93
2025-06-05 10:43:36,045 - src.order.base - INFO - Order 736250fe-9b89-4921-a0de-2c7fbdd84132 status changed: submitted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:43:36,046 - src.order.manager - INFO - Cancelling order 736250fe-9b89-4921-a0de-2c7fbdd84132 with broker ID 147
2025-06-05 10:43:36,047 - src.rule.linked_order_actions - INFO - Cancelled remaining order 736250fe-9b89-4921-a0de-2c7fbdd84132 for GLD
2025-06-05 10:43:36,047 - src.order.manager - WARNING - Cannot cancel inactive order c742d342-7196-4dfe-bc17-cae3115762a6 with status filled
2025-06-05 10:43:36,047 - src.rule.linked_order_actions - INFO - Cancelled remaining order c742d342-7196-4dfe-bc17-cae3115762a6 for GLD
2025-06-05 10:43:36,048 - src.order.base - INFO - Order 1f936d66-39ff-42f7-9685-9a41e8ccc162 status changed: accepted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:43:36,048 - src.order.manager - INFO - Cancelling order 1f936d66-39ff-42f7-9685-9a41e8ccc162 with broker ID 145
2025-06-05 10:43:36,048 - src.rule.linked_order_actions - INFO - Cancelled remaining order 1f936d66-39ff-42f7-9685-9a41e8ccc162 for GLD
2025-06-05 10:43:36,048 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 10:43:36,049 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 10:43:36,049 - src.order.manager - WARNING - Unknown IB order status: ApiCancelled for order 736250fe-9b89-4921-a0de-2c7fbdd84132
2025-06-05 10:43:36,125 - src.order.base - INFO - Order 1f936d66-39ff-42f7-9685-9a41e8ccc162 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 10:43:36,125 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 145)
2025-06-05 10:43:43,483 - __main__ - INFO - 
============================================================
2025-06-05 10:43:43,484 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:43:43,484 - __main__ - INFO - ============================================================
2025-06-05 10:43:43,485 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:43:43,485 - __main__ - INFO - Order 736250fe-9b89-4921-a0de-2c7fbdd84132: limit buy 100 @ 310.78 - Status: pending_cancel
2025-06-05 10:43:43,485 - __main__ - INFO - Order 23cd18c7-d944-419e-a7f8-8ceffd4eb000: limit sell -100 @ 310.93 - Status: filled
2025-06-05 10:43:43,497 - __main__ - INFO - Order c742d342-7196-4dfe-bc17-cae3115762a6: market buy 100 @ MARKET - Status: filled
2025-06-05 10:43:43,501 - __main__ - INFO - Order 1f936d66-39ff-42f7-9685-9a41e8ccc162: stop sell -100 @ 310.66 - Status: cancelled
2025-06-05 10:43:43,501 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:43:43,501 - __main__ - INFO - Stop orders: 1
2025-06-05 10:43:43,502 - __main__ - INFO - Target orders: 1
2025-06-05 10:43:43,502 - __main__ - INFO - Double down orders: 0
2025-06-05 10:43:43,502 - __main__ - INFO - 
Target order details:
2025-06-05 10:43:43,502 - __main__ - INFO -   ID: 23cd18c7-d944-419e-a7f8-8ceffd4eb000
2025-06-05 10:43:43,509 - __main__ - INFO -   Status: filled
2025-06-05 10:43:43,509 - __main__ - INFO -   Limit price: 310.93
2025-06-05 10:43:43,509 - __main__ - INFO - 
Active orders before fill: 0
2025-06-05 10:43:43,510 - __main__ - INFO - 
============================================================
2025-06-05 10:43:43,510 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 10:43:43,510 - __main__ - INFO - ============================================================
2025-06-05 10:43:43,511 - __main__ - INFO - Waiting for target order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 to fill at $310.93...
2025-06-05 10:43:43,511 - __main__ - INFO - ✅ Target order filled at $310.93!
2025-06-05 10:43:48,524 - __main__ - INFO - 
============================================================
2025-06-05 10:43:48,529 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 10:43:48,530 - __main__ - INFO - ============================================================
2025-06-05 10:43:48,532 - __main__ - INFO - Stop order 1f936d66-39ff-42f7-9685-9a41e8ccc162 status: cancelled
2025-06-05 10:43:48,532 - __main__ - ERROR - ❌ Stop order is still cancelled
2025-06-05 10:43:48,533 - __main__ - INFO - 
Active orders after fill: 0
2025-06-05 10:43:48,533 - __main__ - INFO - ✅ TradeTracker correctly shows no active trade for GLD
2025-06-05 10:43:48,533 - __main__ - INFO - 
============================================================
2025-06-05 10:43:48,534 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:43:48,534 - __main__ - INFO - ============================================================
2025-06-05 10:43:48,534 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:43:48,535 - src.order.manager - WARNING - Cannot cancel inactive order 736250fe-9b89-4921-a0de-2c7fbdd84132 with status pending_cancel
2025-06-05 10:43:48,535 - src.order.manager - WARNING - Cannot cancel inactive order 23cd18c7-d944-419e-a7f8-8ceffd4eb000 with status filled
2025-06-05 10:43:48,535 - src.order.manager - WARNING - Cannot cancel inactive order c742d342-7196-4dfe-bc17-cae3115762a6 with status filled
2025-06-05 10:43:48,536 - src.order.manager - WARNING - Cannot cancel inactive order 1f936d66-39ff-42f7-9685-9a41e8ccc162 with status cancelled
2025-06-05 10:43:48,541 - __main__ - INFO - Cancelled 0 orders
2025-06-05 10:43:48,541 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:43:48,541 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:43:48,542 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:43:48,543 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:43:48,544 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:43:48,546 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:43:57,157 - __main__ - INFO - ================================================================================
2025-06-05 10:43:57,158 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 10:43:57,158 - __main__ - INFO - ================================================================================
2025-06-05 10:43:57,160 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:43:57,160 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:43:57,161 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:43:58,836 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:43:58,837 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:43:58,876 - src.tws_connection - INFO - ✅ Next valid order ID received: 148
2025-06-05 10:43:58,877 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:43:58,877 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:43:58,878 - src.tws_connection - INFO - ✅ Next valid order ID received: 148
2025-06-05 10:43:58,879 - src.tws_connection - INFO - ✅ Next valid order ID received: 148
2025-06-05 10:43:58,879 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:43:58,880 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:43:58,880 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:43:58,881 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:43:58,881 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:43:58,881 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:43:58,882 - __main__ - INFO - 
============================================================
2025-06-05 10:43:58,882 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:43:58,882 - __main__ - INFO - ============================================================
2025-06-05 10:43:58,883 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:43:58,883 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:43:58,883 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:43:58,884 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:43:58,884 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:43:58,884 - src.order.base - INFO - Order aa6ea2d4-47b7-4ad3-ab24-dc139299867a status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:58,885 - src.order.manager - INFO - Submitting order aa6ea2d4-47b7-4ad3-ab24-dc139299867a to TWS
2025-06-05 10:43:58,885 - src.order.manager - INFO - Got broker order ID 148 for order aa6ea2d4-47b7-4ad3-ab24-dc139299867a
2025-06-05 10:43:58,885 - src.order.manager - INFO - Calling placeOrder with ID 148, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:43:58,886 - src.order.manager - INFO - placeOrder called successfully for order aa6ea2d4-47b7-4ad3-ab24-dc139299867a
2025-06-05 10:43:58,886 - src.order.base - INFO - Order aa6ea2d4-47b7-4ad3-ab24-dc139299867a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:58,886 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:43:58,886 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:43:58,988 - src.tws_connection - INFO - Open Order - ID: 148, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:43:58,989 - src.order.base - INFO - Order aa6ea2d4-47b7-4ad3-ab24-dc139299867a status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:43:58,992 - src.order.base - INFO - Order aa6ea2d4-47b7-4ad3-ab24-dc139299867a status changed: accepted -> filled (Order fully filled)
2025-06-05 10:43:58,992 - src.order.base - INFO - Order aa6ea2d4-47b7-4ad3-ab24-dc139299867a filled: 100.0 @ 311.0 (100.0/100)
2025-06-05 10:43:58,993 - src.tws_connection - INFO - Open Order - ID: 148, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:43:58,994 - src.tws_connection - INFO - Open Order - ID: 148, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:43:59,894 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:43:59,894 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.75 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:43:59,894 - src.order.base - INFO - Order d83ae202-c5ac-4551-8da1-9e5c13a52c68 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:59,894 - src.order.manager - INFO - Submitting order d83ae202-c5ac-4551-8da1-9e5c13a52c68 to TWS
2025-06-05 10:43:59,895 - src.order.manager - INFO - Got broker order ID 149 for order d83ae202-c5ac-4551-8da1-9e5c13a52c68
2025-06-05 10:43:59,895 - src.order.manager - INFO - Calling placeOrder with ID 149, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:43:59,895 - src.order.manager - INFO - placeOrder called successfully for order d83ae202-c5ac-4551-8da1-9e5c13a52c68
2025-06-05 10:43:59,896 - src.order.base - INFO - Order d83ae202-c5ac-4551-8da1-9e5c13a52c68 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:59,896 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss d83ae202-c5ac-4551-8da1-9e5c13a52c68 at $310.75
2025-06-05 10:43:59,896 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:43:59,896 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $311.02 (ATR: 0.0450 * 0.1 = 0.0045)
2025-06-05 10:43:59,897 - src.order.base - INFO - Order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:43:59,897 - src.order.manager - INFO - Submitting order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 to TWS
2025-06-05 10:43:59,898 - src.order.manager - INFO - Got broker order ID 150 for order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469
2025-06-05 10:43:59,898 - src.order.manager - INFO - Calling placeOrder with ID 150, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@311.020000 DAY
2025-06-05 10:43:59,898 - src.order.manager - INFO - placeOrder called successfully for order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469
2025-06-05 10:43:59,898 - src.order.base - INFO - Order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:43:59,899 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 at $311.02
2025-06-05 10:43:59,899 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:43:59,899 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:44:00,015 - src.tws_connection - INFO - Open Order - ID: 149, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:44:00,016 - src.order.base - INFO - Order d83ae202-c5ac-4551-8da1-9e5c13a52c68 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:44:00,058 - src.tws_connection - INFO - Open Order - ID: 150, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:44:00,215 - src.order.base - INFO - Order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:44:00,216 - src.order.base - INFO - Order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 filled: 100.0 @ 311.02 (100.0/100)
2025-06-05 10:44:00,216 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - target order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 filled at $311.02
2025-06-05 10:44:00,216 - src.tws_connection - INFO - Open Order - ID: 150, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:44:00,217 - src.order.base - INFO - Order d83ae202-c5ac-4551-8da1-9e5c13a52c68 status changed: accepted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:44:00,217 - src.order.manager - INFO - Cancelling order d83ae202-c5ac-4551-8da1-9e5c13a52c68 with broker ID 149
2025-06-05 10:44:00,217 - src.tws_connection - INFO - Open Order - ID: 150, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:44:00,217 - src.rule.linked_order_actions - INFO - Cancelled remaining order d83ae202-c5ac-4551-8da1-9e5c13a52c68 for GLD
2025-06-05 10:44:00,218 - src.order.manager - WARNING - Cannot cancel inactive order aa6ea2d4-47b7-4ad3-ab24-dc139299867a with status filled
2025-06-05 10:44:00,218 - src.rule.linked_order_actions - INFO - Cancelled remaining order aa6ea2d4-47b7-4ad3-ab24-dc139299867a for GLD
2025-06-05 10:44:00,218 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 10:44:00,218 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 10:44:00,252 - src.order.base - INFO - Order d83ae202-c5ac-4551-8da1-9e5c13a52c68 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 10:44:00,252 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 149)
2025-06-05 10:44:00,406 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['d83ae202-c5ac-4551-8da1-9e5c13a52c68']
2025-06-05 10:44:00,407 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:44:05,424 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:44:05,425 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$311.06, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.93, original_qty=100, dd_qty=100
2025-06-05 10:44:05,425 - src.order.base - INFO - Order e1ac693a-9550-4cca-aaef-3b58cd888d9d status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:44:05,426 - src.order.manager - INFO - Submitting order e1ac693a-9550-4cca-aaef-3b58cd888d9d to TWS
2025-06-05 10:44:05,426 - src.order.manager - INFO - Got broker order ID 151 for order e1ac693a-9550-4cca-aaef-3b58cd888d9d
2025-06-05 10:44:05,426 - src.order.manager - INFO - Calling placeOrder with ID 151, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.930000 DAY
2025-06-05 10:44:05,427 - src.order.manager - INFO - placeOrder called successfully for order e1ac693a-9550-4cca-aaef-3b58cd888d9d
2025-06-05 10:44:05,427 - src.order.base - INFO - Order e1ac693a-9550-4cca-aaef-3b58cd888d9d status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:44:05,428 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:44:05,428 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.93
2025-06-05 10:44:05,428 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:44:05,429 - src.rule.linked_order_actions - INFO - Created and linked BUY main order aa6ea2d4-47b7-4ad3-ab24-dc139299867a for GLD
2025-06-05 10:44:05,547 - src.tws_connection - INFO - Open Order - ID: 151, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:44:08,890 - __main__ - INFO - 
============================================================
2025-06-05 10:44:08,890 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:44:08,891 - __main__ - INFO - ============================================================
2025-06-05 10:44:08,891 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:44:08,892 - __main__ - INFO - Order d83ae202-c5ac-4551-8da1-9e5c13a52c68: stop sell -100 @ 310.75 - Status: cancelled
2025-06-05 10:44:08,892 - __main__ - INFO - Order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469: limit sell -100 @ 311.02 - Status: filled
2025-06-05 10:44:08,892 - __main__ - INFO - Order aa6ea2d4-47b7-4ad3-ab24-dc139299867a: market buy 100 @ MARKET - Status: filled
2025-06-05 10:44:08,893 - __main__ - INFO - Order e1ac693a-9550-4cca-aaef-3b58cd888d9d: limit buy 100 @ 310.93 - Status: submitted
2025-06-05 10:44:08,894 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:44:08,895 - __main__ - INFO - Stop orders: 1
2025-06-05 10:44:08,895 - __main__ - INFO - Target orders: 1
2025-06-05 10:44:08,895 - __main__ - INFO - Double down orders: 1
2025-06-05 10:44:08,895 - __main__ - INFO - 
Target order details:
2025-06-05 10:44:08,896 - __main__ - INFO -   ID: 349a7ec2-171c-4bd4-a58d-b9b1f32ed469
2025-06-05 10:44:08,896 - __main__ - INFO -   Status: filled
2025-06-05 10:44:08,896 - __main__ - INFO -   Limit price: 311.02
2025-06-05 10:44:08,896 - __main__ - INFO - 
Active orders before fill: 1
2025-06-05 10:44:08,897 - __main__ - INFO - 
============================================================
2025-06-05 10:44:08,897 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 10:44:08,897 - __main__ - INFO - ============================================================
2025-06-05 10:44:08,897 - __main__ - INFO - Waiting for target order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 to fill at $311.02...
2025-06-05 10:44:08,898 - __main__ - INFO - ✅ Target order filled at $311.02!
2025-06-05 10:44:13,913 - __main__ - INFO - 
============================================================
2025-06-05 10:44:13,913 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 10:44:13,914 - __main__ - INFO - ============================================================
2025-06-05 10:44:13,914 - __main__ - INFO - Stop order d83ae202-c5ac-4551-8da1-9e5c13a52c68 status: cancelled
2025-06-05 10:44:13,914 - __main__ - ERROR - ❌ Stop order is still cancelled
2025-06-05 10:44:13,915 - __main__ - INFO - Double down order e1ac693a-9550-4cca-aaef-3b58cd888d9d status: submitted
2025-06-05 10:44:13,915 - __main__ - ERROR - ❌ Double down order is still submitted
2025-06-05 10:44:13,915 - __main__ - INFO - 
Active orders after fill: 1
2025-06-05 10:44:13,916 - __main__ - INFO - ✅ TradeTracker correctly shows no active trade for GLD
2025-06-05 10:44:13,916 - __main__ - INFO - 
============================================================
2025-06-05 10:44:13,916 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:44:13,916 - __main__ - INFO - ============================================================
2025-06-05 10:44:13,916 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:44:13,917 - src.order.manager - WARNING - Cannot cancel inactive order d83ae202-c5ac-4551-8da1-9e5c13a52c68 with status cancelled
2025-06-05 10:44:13,917 - src.order.manager - WARNING - Cannot cancel inactive order 349a7ec2-171c-4bd4-a58d-b9b1f32ed469 with status filled
2025-06-05 10:44:13,918 - src.order.manager - WARNING - Cannot cancel inactive order aa6ea2d4-47b7-4ad3-ab24-dc139299867a with status filled
2025-06-05 10:44:13,918 - src.order.base - INFO - Order e1ac693a-9550-4cca-aaef-3b58cd888d9d status changed: submitted -> pending_cancel (Test cleanup)
2025-06-05 10:44:13,918 - src.order.manager - INFO - Cancelling order e1ac693a-9550-4cca-aaef-3b58cd888d9d with broker ID 151
2025-06-05 10:44:13,919 - __main__ - INFO - Cancelled 1 orders
2025-06-05 10:44:13,919 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:44:13,919 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:44:13,919 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:44:13,919 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:44:13,923 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:44:13,928 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 10:45:01,523 - __main__ - INFO - ================================================================================
2025-06-05 10:45:01,523 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 10:45:01,524 - __main__ - INFO - ================================================================================
2025-06-05 10:45:01,529 - __main__ - INFO - Connecting to TWS...
2025-06-05 10:45:01,529 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 10:45:01,533 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 10:45:03,281 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 10:45:03,282 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 10:45:03,762 - src.tws_connection - INFO - ✅ Next valid order ID received: 152
2025-06-05 10:45:03,763 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 10:45:03,764 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 10:45:03,765 - src.tws_connection - INFO - ✅ Next valid order ID received: 152
2025-06-05 10:45:03,768 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 10:45:03,768 - src.tws_connection - INFO - ✅ Next valid order ID received: 152
2025-06-05 10:45:03,770 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 10:45:03,771 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 10:45:03,772 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 10:45:03,775 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 10:45:03,776 - src.rule.engine - INFO - Rule engine started
2025-06-05 10:45:03,776 - __main__ - INFO - 
============================================================
2025-06-05 10:45:03,777 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 10:45:03,778 - __main__ - INFO - ============================================================
2025-06-05 10:45:03,780 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 10:45:03,780 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 10:45:03,781 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 10:45:03,782 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 10:45:03,782 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 10:45:03,783 - src.order.base - INFO - Order a51fa5ce-17bb-4252-bdd1-00650f52d200 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:45:03,784 - src.order.manager - INFO - Submitting order a51fa5ce-17bb-4252-bdd1-00650f52d200 to TWS
2025-06-05 10:45:03,785 - src.order.manager - INFO - Got broker order ID 152 for order a51fa5ce-17bb-4252-bdd1-00650f52d200
2025-06-05 10:45:03,785 - src.order.manager - INFO - Calling placeOrder with ID 152, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 10:45:03,787 - src.order.manager - INFO - placeOrder called successfully for order a51fa5ce-17bb-4252-bdd1-00650f52d200
2025-06-05 10:45:03,787 - src.order.base - INFO - Order a51fa5ce-17bb-4252-bdd1-00650f52d200 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:45:03,788 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 10:45:03,789 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 10:45:03,986 - src.tws_connection - INFO - Open Order - ID: 152, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:45:04,004 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 10:45:04,006 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $310.52 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 10:45:04,006 - src.tws_connection - INFO - Open Order - ID: 152, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:45:04,007 - src.order.base - INFO - Order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:45:04,011 - src.order.manager - INFO - Submitting order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a to TWS
2025-06-05 10:45:04,012 - src.tws_connection - INFO - Open Order - ID: 152, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:45:04,014 - src.order.manager - INFO - Got broker order ID 153 for order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a
2025-06-05 10:45:04,016 - src.order.manager - INFO - Calling placeOrder with ID 153, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 10:45:04,019 - src.order.manager - INFO - placeOrder called successfully for order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a
2025-06-05 10:45:04,019 - src.order.base - INFO - Order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:45:04,020 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a at $310.52
2025-06-05 10:45:04,022 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 10:45:04,023 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $310.81 (ATR: 0.0450 * 0.5 = 0.0225)
2025-06-05 10:45:04,024 - src.order.base - INFO - Order bf3b92c8-c096-422a-9f03-ad6c4e991c34 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:45:04,025 - src.order.manager - INFO - Submitting order bf3b92c8-c096-422a-9f03-ad6c4e991c34 to TWS
2025-06-05 10:45:04,027 - src.order.manager - INFO - Got broker order ID 154 for order bf3b92c8-c096-422a-9f03-ad6c4e991c34
2025-06-05 10:45:04,029 - src.order.manager - INFO - Calling placeOrder with ID 154, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@310.810000 DAY
2025-06-05 10:45:04,031 - src.order.manager - INFO - placeOrder called successfully for order bf3b92c8-c096-422a-9f03-ad6c4e991c34
2025-06-05 10:45:04,031 - src.order.base - INFO - Order bf3b92c8-c096-422a-9f03-ad6c4e991c34 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:45:04,032 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit bf3b92c8-c096-422a-9f03-ad6c4e991c34 at $310.81
2025-06-05 10:45:04,033 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 10:45:04,034 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 10:45:04,035 - src.order.base - INFO - Order a51fa5ce-17bb-4252-bdd1-00650f52d200 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:45:04,037 - src.order.base - INFO - Order a51fa5ce-17bb-4252-bdd1-00650f52d200 status changed: accepted -> filled (Order fully filled)
2025-06-05 10:45:04,037 - src.order.base - INFO - Order a51fa5ce-17bb-4252-bdd1-00650f52d200 filled: 100.0 @ 310.83 (100.0/100)
2025-06-05 10:45:04,149 - src.tws_connection - INFO - Open Order - ID: 153, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:45:04,151 - src.order.base - INFO - Order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 10:45:04,271 - src.tws_connection - INFO - Open Order - ID: 154, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:45:04,542 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['9ba8f66c-c445-4d15-84c9-e1fa10e65f5a']
2025-06-05 10:45:04,543 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 10:45:04,797 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 10:45:04,798 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$310.80, stop_distance=$0.27, dd_distance=$0.13, dd_price=$310.67, original_qty=100, dd_qty=100
2025-06-05 10:45:04,799 - src.order.base - INFO - Order 0eb129ed-38aa-4dc7-927a-06bef1a4148e status changed: created -> pending_submit (Submitting to broker)
2025-06-05 10:45:04,801 - src.order.manager - INFO - Submitting order 0eb129ed-38aa-4dc7-927a-06bef1a4148e to TWS
2025-06-05 10:45:04,802 - src.order.manager - INFO - Got broker order ID 155 for order 0eb129ed-38aa-4dc7-927a-06bef1a4148e
2025-06-05 10:45:04,806 - src.order.manager - INFO - Calling placeOrder with ID 155, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@310.670000 DAY
2025-06-05 10:45:04,808 - src.order.manager - INFO - placeOrder called successfully for order 0eb129ed-38aa-4dc7-927a-06bef1a4148e
2025-06-05 10:45:04,809 - src.order.base - INFO - Order 0eb129ed-38aa-4dc7-927a-06bef1a4148e status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 10:45:04,810 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 10:45:04,811 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $310.67
2025-06-05 10:45:04,812 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 10:45:04,813 - src.rule.linked_order_actions - INFO - Created and linked BUY main order a51fa5ce-17bb-4252-bdd1-00650f52d200 for GLD
2025-06-05 10:45:04,926 - src.tws_connection - INFO - Open Order - ID: 155, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 10:45:13,782 - __main__ - INFO - 
============================================================
2025-06-05 10:45:13,782 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 10:45:13,783 - __main__ - INFO - ============================================================
2025-06-05 10:45:13,783 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 10:45:13,783 - __main__ - INFO - Order 0eb129ed-38aa-4dc7-927a-06bef1a4148e: limit buy 100 @ 310.67 - Status: submitted
2025-06-05 10:45:13,783 - __main__ - INFO - Order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a: stop sell -100 @ 310.52 - Status: accepted
2025-06-05 10:45:13,784 - __main__ - INFO - Order a51fa5ce-17bb-4252-bdd1-00650f52d200: market buy 100 @ MARKET - Status: filled
2025-06-05 10:45:13,784 - __main__ - INFO - Order bf3b92c8-c096-422a-9f03-ad6c4e991c34: limit sell -100 @ 310.81 - Status: submitted
2025-06-05 10:45:13,784 - __main__ - INFO - 
Main orders: 1
2025-06-05 10:45:13,784 - __main__ - INFO - Stop orders: 1
2025-06-05 10:45:13,785 - __main__ - INFO - Target orders: 1
2025-06-05 10:45:13,785 - __main__ - INFO - Double down orders: 1
2025-06-05 10:45:13,785 - __main__ - INFO - 
Target order details:
2025-06-05 10:45:13,785 - __main__ - INFO -   ID: bf3b92c8-c096-422a-9f03-ad6c4e991c34
2025-06-05 10:45:13,786 - __main__ - INFO -   Status: submitted
2025-06-05 10:45:13,786 - __main__ - INFO -   Limit price: 310.81
2025-06-05 10:45:13,786 - __main__ - INFO - 
Active orders before fill: 3
2025-06-05 10:45:13,786 - __main__ - INFO - 
============================================================
2025-06-05 10:45:13,787 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 10:45:13,787 - __main__ - INFO - ============================================================
2025-06-05 10:45:13,787 - __main__ - INFO - Waiting for target order bf3b92c8-c096-422a-9f03-ad6c4e991c34 to fill at $310.81...
2025-06-05 10:45:13,787 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 10:45:14,035 - src.order.base - INFO - Order bf3b92c8-c096-422a-9f03-ad6c4e991c34 status changed: submitted -> filled (Order fully filled)
2025-06-05 10:45:14,038 - src.order.base - INFO - Order bf3b92c8-c096-422a-9f03-ad6c4e991c34 filled: 100.0 @ 310.81 (100.0/100)
2025-06-05 10:45:14,038 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - target order bf3b92c8-c096-422a-9f03-ad6c4e991c34 filled at $310.81
2025-06-05 10:45:14,035 - src.tws_connection - INFO - Open Order - ID: 154, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:45:14,039 - src.order.base - INFO - Order 0eb129ed-38aa-4dc7-927a-06bef1a4148e status changed: submitted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:45:14,039 - src.order.manager - INFO - Cancelling order 0eb129ed-38aa-4dc7-927a-06bef1a4148e with broker ID 155
2025-06-05 10:45:14,041 - src.rule.linked_order_actions - INFO - Cancelled remaining order 0eb129ed-38aa-4dc7-927a-06bef1a4148e for GLD
2025-06-05 10:45:14,041 - src.tws_connection - INFO - Open Order - ID: 154, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 10:45:14,042 - src.order.base - INFO - Order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a status changed: accepted -> pending_cancel (Position concluded via target fill)
2025-06-05 10:45:14,043 - src.order.manager - INFO - Cancelling order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a with broker ID 153
2025-06-05 10:45:14,043 - src.rule.linked_order_actions - INFO - Cancelled remaining order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a for GLD
2025-06-05 10:45:14,043 - src.order.manager - WARNING - Cannot cancel inactive order a51fa5ce-17bb-4252-bdd1-00650f52d200 with status filled
2025-06-05 10:45:14,044 - src.rule.linked_order_actions - INFO - Cancelled remaining order a51fa5ce-17bb-4252-bdd1-00650f52d200 for GLD
2025-06-05 10:45:14,044 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 10:45:14,044 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 10:45:14,117 - src.order.base - INFO - Order 0eb129ed-38aa-4dc7-927a-06bef1a4148e status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 10:45:14,117 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 155)
2025-06-05 10:45:14,176 - src.order.base - INFO - Order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 10:45:14,176 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 153)
2025-06-05 10:45:18,853 - __main__ - INFO - ✅ Target order filled at $310.81!
2025-06-05 10:45:23,862 - __main__ - INFO - 
============================================================
2025-06-05 10:45:23,863 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 10:45:23,863 - __main__ - INFO - ============================================================
2025-06-05 10:45:23,863 - __main__ - INFO - Stop order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a status: cancelled
2025-06-05 10:45:23,864 - __main__ - ERROR - ❌ Stop order is still cancelled
2025-06-05 10:45:23,864 - __main__ - INFO - Double down order 0eb129ed-38aa-4dc7-927a-06bef1a4148e status: cancelled
2025-06-05 10:45:23,864 - __main__ - ERROR - ❌ Double down order is still cancelled
2025-06-05 10:45:23,865 - __main__ - INFO - 
Active orders after fill: 0
2025-06-05 10:45:23,865 - __main__ - INFO - ✅ TradeTracker correctly shows no active trade for GLD
2025-06-05 10:45:23,865 - __main__ - INFO - 
============================================================
2025-06-05 10:45:23,866 - __main__ - INFO - TEST COMPLETE
2025-06-05 10:45:23,866 - __main__ - INFO - ============================================================
2025-06-05 10:45:23,866 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 10:45:23,866 - src.order.manager - WARNING - Cannot cancel inactive order 0eb129ed-38aa-4dc7-927a-06bef1a4148e with status cancelled
2025-06-05 10:45:23,866 - src.order.manager - WARNING - Cannot cancel inactive order 9ba8f66c-c445-4d15-84c9-e1fa10e65f5a with status cancelled
2025-06-05 10:45:23,867 - src.order.manager - WARNING - Cannot cancel inactive order a51fa5ce-17bb-4252-bdd1-00650f52d200 with status filled
2025-06-05 10:45:23,867 - src.order.manager - WARNING - Cannot cancel inactive order bf3b92c8-c096-422a-9f03-ad6c4e991c34 with status filled
2025-06-05 10:45:23,867 - __main__ - INFO - Cancelled 0 orders
2025-06-05 10:45:23,868 - __main__ - INFO - 
Cleaning up...
2025-06-05 10:45:23,869 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 10:45:23,869 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 10:45:23,869 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 10:45:23,870 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 10:45:23,871 - __main__ - INFO - ✅ Cleanup complete
2025-06-05 11:29:17,488 - __main__ - INFO - ================================================================================
2025-06-05 11:29:17,488 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 11:29:17,489 - __main__ - INFO - ================================================================================
2025-06-05 11:29:17,493 - __main__ - INFO - Connecting to TWS...
2025-06-05 11:29:17,493 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 11:29:17,495 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 11:29:18,877 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 11:29:18,878 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 11:29:18,919 - src.tws_connection - INFO - ✅ Next valid order ID received: 195
2025-06-05 11:29:18,920 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 11:29:18,920 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 11:29:18,921 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 11:29:18,922 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 11:29:18,922 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 11:29:18,922 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 11:29:18,922 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 11:29:18,923 - src.rule.engine - INFO - Rule engine started
2025-06-05 11:29:18,923 - __main__ - INFO - 
============================================================
2025-06-05 11:29:18,923 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 11:29:18,923 - __main__ - INFO - ============================================================
2025-06-05 11:29:18,923 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 11:29:18,924 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 11:29:18,924 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 11:29:18,924 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 11:29:18,924 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 11:29:18,925 - src.order.base - INFO - Order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:29:18,925 - src.order.manager - INFO - Submitting order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 to TWS
2025-06-05 11:29:18,926 - src.order.manager - INFO - Got broker order ID 195 for order 2f23df07-1da7-45f0-901f-0cdb5ab20e13
2025-06-05 11:29:18,926 - src.order.manager - INFO - Calling placeOrder with ID 195, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 11:29:18,927 - src.order.manager - INFO - placeOrder called successfully for order 2f23df07-1da7-45f0-901f-0cdb5ab20e13
2025-06-05 11:29:18,928 - src.order.base - INFO - Order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:29:18,928 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 11:29:18,928 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 11:29:19,013 - src.tws_connection - INFO - ✅ Next valid order ID received: 195
2025-06-05 11:29:19,084 - src.tws_connection - INFO - ✅ Next valid order ID received: 195
2025-06-05 11:29:19,421 - src.tws_connection - INFO - Open Order - ID: 195, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:29:19,442 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 11:29:19,447 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $309.60 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 11:29:19,447 - src.order.base - INFO - Order 818411cc-cd2c-480f-9ce3-82f2a55e4754 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:29:19,448 - src.order.manager - INFO - Submitting order 818411cc-cd2c-480f-9ce3-82f2a55e4754 to TWS
2025-06-05 11:29:19,449 - src.order.manager - INFO - Got broker order ID 195 for order 818411cc-cd2c-480f-9ce3-82f2a55e4754
2025-06-05 11:29:19,450 - src.order.manager - INFO - Calling placeOrder with ID 195, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 11:29:19,451 - src.order.manager - INFO - placeOrder called successfully for order 818411cc-cd2c-480f-9ce3-82f2a55e4754
2025-06-05 11:29:19,451 - src.order.base - INFO - Order 818411cc-cd2c-480f-9ce3-82f2a55e4754 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:29:19,452 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 818411cc-cd2c-480f-9ce3-82f2a55e4754 at $309.60
2025-06-05 11:29:19,452 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 11:29:19,452 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $309.89 (ATR: 0.0450 * 0.5 = 0.0225)
2025-06-05 11:29:19,453 - src.order.base - INFO - Order 42f91db0-0e41-473d-b115-0577db0f9915 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:29:19,454 - src.order.manager - INFO - Submitting order 42f91db0-0e41-473d-b115-0577db0f9915 to TWS
2025-06-05 11:29:19,454 - src.order.manager - INFO - Got broker order ID 196 for order 42f91db0-0e41-473d-b115-0577db0f9915
2025-06-05 11:29:19,454 - src.order.manager - INFO - Calling placeOrder with ID 196, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@309.890000 DAY
2025-06-05 11:29:19,455 - src.order.manager - INFO - placeOrder called successfully for order 42f91db0-0e41-473d-b115-0577db0f9915
2025-06-05 11:29:19,455 - src.order.base - INFO - Order 42f91db0-0e41-473d-b115-0577db0f9915 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:29:19,456 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit 42f91db0-0e41-473d-b115-0577db0f9915 at $309.89
2025-06-05 11:29:19,456 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 11:29:19,456 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 11:29:19,456 - src.order.base - INFO - Order 818411cc-cd2c-480f-9ce3-82f2a55e4754 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 11:29:19,961 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['818411cc-cd2c-480f-9ce3-82f2a55e4754']
2025-06-05 11:29:19,962 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 11:29:20,872 - src.order.base - INFO - Order 818411cc-cd2c-480f-9ce3-82f2a55e4754 status changed: accepted -> filled (Order fully filled)
2025-06-05 11:29:20,873 - src.order.base - INFO - Order 818411cc-cd2c-480f-9ce3-82f2a55e4754 filled: 100.0 @ 309.88 (100.0/100)
2025-06-05 11:29:20,890 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - stop order 818411cc-cd2c-480f-9ce3-82f2a55e4754 filled at $309.88
2025-06-05 11:29:20,897 - src.order.base - INFO - Order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:29:20,901 - src.order.manager - INFO - Cancelling order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 with broker ID 195
2025-06-05 11:29:20,901 - src.tws_connection - INFO - Open Order - ID: 195, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:29:20,903 - src.rule.linked_order_actions - INFO - Cancelled remaining order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 for GLD
2025-06-05 11:29:20,911 - src.order.base - INFO - Order 42f91db0-0e41-473d-b115-0577db0f9915 status changed: submitted -> pending_cancel (Position concluded via stop fill)
2025-06-05 11:29:20,913 - src.order.manager - INFO - Cancelling order 42f91db0-0e41-473d-b115-0577db0f9915 with broker ID 196
2025-06-05 11:29:20,916 - src.rule.linked_order_actions - INFO - Cancelled remaining order 42f91db0-0e41-473d-b115-0577db0f9915 for GLD
2025-06-05 11:29:20,917 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 11:29:20,922 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 11:29:20,924 - src.tws_connection - INFO - Open Order - ID: 195, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:29:21,000 - src.tws_connection - WARNING - ⚠️ TWS Error 104: Cannot modify a filled order. (reqId: 195)
2025-06-05 11:29:21,119 - src.tws_connection - WARNING - ⚠️ TWS Error 10148: OrderId 195 that needs to be cancelled cannot be cancelled, state: Filled. (reqId: 195)
2025-06-05 11:29:21,153 - src.tws_connection - INFO - Open Order - ID: 196, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 11:29:21,159 - src.rule.linked_order_actions - INFO - Using ATR-based stop distance for GLD: 0.2700
2025-06-05 11:29:21,159 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$309.84, stop_distance=$0.27, dd_distance=$0.03, dd_price=$309.81, original_qty=100, dd_qty=100
2025-06-05 11:29:21,160 - src.order.base - INFO - Order 816bd73d-b503-4c95-91c8-b8268a36ca7a status changed: created -> pending_submit (Submitting to broker)
2025-06-05 11:29:21,161 - src.order.manager - INFO - Submitting order 816bd73d-b503-4c95-91c8-b8268a36ca7a to TWS
2025-06-05 11:29:21,162 - src.order.manager - INFO - Got broker order ID 197 for order 816bd73d-b503-4c95-91c8-b8268a36ca7a
2025-06-05 11:29:21,162 - src.order.manager - INFO - Calling placeOrder with ID 197, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@309.810000 DAY
2025-06-05 11:29:21,163 - src.order.manager - INFO - placeOrder called successfully for order 816bd73d-b503-4c95-91c8-b8268a36ca7a
2025-06-05 11:29:21,163 - src.order.base - INFO - Order 816bd73d-b503-4c95-91c8-b8268a36ca7a status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 11:29:21,163 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 11:29:21,163 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $309.81
2025-06-05 11:29:21,164 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 11:29:21,164 - src.rule.linked_order_actions - INFO - Created and linked BUY main order 2f23df07-1da7-45f0-901f-0cdb5ab20e13 for GLD
2025-06-05 11:29:21,164 - src.order.base - INFO - Order 42f91db0-0e41-473d-b115-0577db0f9915 status changed: pending_cancel -> submitted (IB status: Submitted)
2025-06-05 11:29:21,270 - src.order.base - INFO - Order 42f91db0-0e41-473d-b115-0577db0f9915 status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:29:21,270 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 196)
2025-06-05 11:29:21,520 - src.tws_connection - INFO - Open Order - ID: 197, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 11:29:28,348 - src.order.base - INFO - Order 816bd73d-b503-4c95-91c8-b8268a36ca7a status changed: submitted -> cancelled (IB status: Cancelled)
2025-06-05 11:29:28,347 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 197)
2025-06-05 11:29:28,929 - __main__ - INFO - 
============================================================
2025-06-05 11:29:28,929 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 11:29:28,930 - __main__ - INFO - ============================================================
2025-06-05 11:29:28,930 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 11:29:28,931 - __main__ - INFO - Order 2f23df07-1da7-45f0-901f-0cdb5ab20e13: market buy 100 @ MARKET - Status: pending_cancel
2025-06-05 11:29:28,931 - __main__ - INFO - Order 42f91db0-0e41-473d-b115-0577db0f9915: limit sell -100 @ 309.89 - Status: cancelled
2025-06-05 11:29:28,931 - __main__ - INFO - Order 816bd73d-b503-4c95-91c8-b8268a36ca7a: limit buy 100 @ 309.81 - Status: cancelled
2025-06-05 11:29:28,932 - __main__ - INFO - Order 818411cc-cd2c-480f-9ce3-82f2a55e4754: stop sell -100 @ 309.6 - Status: filled
2025-06-05 11:29:28,932 - __main__ - INFO - 
Main orders: 1
2025-06-05 11:29:28,932 - __main__ - INFO - Stop orders: 1
2025-06-05 11:29:28,932 - __main__ - INFO - Target orders: 1
2025-06-05 11:29:28,933 - __main__ - INFO - Double down orders: 0
2025-06-05 11:29:28,933 - __main__ - INFO - 
Target order details:
2025-06-05 11:29:28,933 - __main__ - INFO -   ID: 42f91db0-0e41-473d-b115-0577db0f9915
2025-06-05 11:29:28,933 - __main__ - INFO -   Status: cancelled
2025-06-05 11:29:28,933 - __main__ - INFO -   Limit price: 309.89
2025-06-05 11:29:28,934 - __main__ - INFO - 
Active orders before fill: 0
2025-06-05 11:29:28,934 - __main__ - INFO - 
============================================================
2025-06-05 11:29:28,934 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 11:29:28,934 - __main__ - INFO - ============================================================
2025-06-05 11:29:28,934 - __main__ - INFO - Waiting for target order 42f91db0-0e41-473d-b115-0577db0f9915 to fill at $309.89...
2025-06-05 11:29:28,935 - __main__ - INFO - Waiting... (0s elapsed, order status: cancelled)
2025-06-05 11:29:33,948 - __main__ - INFO - Waiting... (5s elapsed, order status: cancelled)
2025-06-05 11:29:38,953 - __main__ - INFO - Waiting... (10s elapsed, order status: cancelled)
2025-06-05 12:03:51,696 - __main__ - INFO - ================================================================================
2025-06-05 12:03:51,698 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 12:03:51,698 - __main__ - INFO - ================================================================================
2025-06-05 12:03:51,699 - __main__ - INFO - Connecting to TWS...
2025-06-05 12:03:51,699 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 12:03:51,700 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 1)
2025-06-05 12:03:53,859 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 12:03:53,860 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 12:03:54,526 - src.tws_connection - WARNING - Not connected to TWS
2025-06-05 12:03:54,527 - src.tws_connection - INFO - Connection thread: Message loop ended
2025-06-05 12:04:01,708 - src.tws_connection - ERROR - ❌ Connection failed or timed out
2025-06-05 12:04:01,709 - src.tws_connection - ERROR - Connected: False, Next ID: None
2025-06-05 12:04:01,709 - src.tws_connection - INFO - Forcing connection cleanup
2025-06-05 12:04:01,710 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 12:04:01,711 - __main__ - ERROR - Failed to connect to TWS
2025-06-05 12:04:40,187 - __main__ - INFO - ================================================================================
2025-06-05 12:04:40,187 - __main__ - INFO - PROFIT TARGET FILL CANCELLATION TEST
2025-06-05 12:04:40,187 - __main__ - INFO - ================================================================================
2025-06-05 12:04:40,189 - __main__ - INFO - Connecting to TWS...
2025-06-05 12:04:40,190 - src.tws_connection - INFO - Connecting to TWS at 127.0.0.1:7497
2025-06-05 12:04:40,191 - src.tws_connection - INFO - Connection thread: Connecting to 127.0.0.1:7497 (client ID: 2)
2025-06-05 12:04:41,863 - src.tws_connection - INFO - ✅ Connection acknowledged by TWS
2025-06-05 12:04:41,864 - src.tws_connection - INFO - Connection thread: Socket connected, starting message loop
2025-06-05 12:04:41,919 - src.tws_connection - INFO - ✅ Next valid order ID received: 72
2025-06-05 12:04:41,920 - src.tws_connection - INFO - ✅ TWS connection fully established
2025-06-05 12:04:41,920 - src.tws_connection - INFO - Requesting additional order IDs from TWS
2025-06-05 12:04:41,921 - src.tws_connection - INFO - ✅ Next valid order ID received: 72
2025-06-05 12:04:41,922 - src.tws_connection - INFO - ✅ Successfully connected to TWS
2025-06-05 12:04:41,923 - src.tws_connection - INFO - ✅ Next valid order ID received: 72
2025-06-05 12:04:41,924 - __main__ - INFO - ✅ Connected to TWS
2025-06-05 12:04:41,925 - src.order.manager - INFO - OrderManager callbacks set up with TWSConnection
2025-06-05 12:04:41,925 - src.position.tracker - INFO - PositionTracker async initialization completed
2025-06-05 12:04:41,926 - src.rule.linked_order_actions - INFO - LinkedOrderConclusionManager initialized - monitoring for position conclusions
2025-06-05 12:04:41,926 - src.rule.engine - INFO - Rule engine started
2025-06-05 12:04:41,926 - __main__ - INFO - 
============================================================
2025-06-05 12:04:41,926 - __main__ - INFO - STEP 1: Creating position with stop, target, and double down orders
2025-06-05 12:04:41,927 - __main__ - INFO - ============================================================
2025-06-05 12:04:41,928 - src.trade_tracker - INFO - TradeTracker initialized
2025-06-05 12:04:41,928 - src.position.position_manager - INFO - PositionManager initialized
2025-06-05 12:04:41,929 - src.trade_tracker - INFO - Started tracking BUY trade for GLD
2025-06-05 12:04:41,929 - src.position.position_manager - INFO - Opened BUY position for GLD
2025-06-05 12:04:41,930 - src.rule.linked_order_actions - INFO - Using fixed position size: 100 shares for GLD
2025-06-05 12:04:41,930 - src.order.base - INFO - Order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:04:41,931 - src.order.manager - INFO - Submitting order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 to TWS
2025-06-05 12:04:41,931 - src.order.manager - INFO - Got broker order ID 72 for order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5
2025-06-05 12:04:41,931 - src.order.manager - INFO - Calling placeOrder with ID 72, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: MKT BUY 100@0.000000 DAY
2025-06-05 12:04:41,932 - src.order.manager - INFO - placeOrder called successfully for order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5
2025-06-05 12:04:41,932 - src.order.base - INFO - Order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:04:41,933 - src.rule.linked_order_actions - INFO - Created new order context for GLD BUY position
2025-06-05 12:04:41,933 - src.position.position_manager - INFO - Added 1 main orders to GLD position
2025-06-05 12:04:42,053 - src.tws_connection - INFO - Open Order - ID: 72, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:04:42,053 - src.order.base - INFO - Order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 12:04:42,063 - src.order.base - INFO - Order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 status changed: accepted -> filled (Order fully filled)
2025-06-05 12:04:42,064 - src.order.base - INFO - Order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 filled: 100.0 @ 308.14 (100.0/100)
2025-06-05 12:04:42,064 - src.tws_connection - INFO - Open Order - ID: 72, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:04:42,066 - src.tws_connection - INFO - Open Order - ID: 72, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:04:42,950 - src.rule.linked_order_actions - INFO - ATR for GLD: 0.0450
2025-06-05 12:04:42,950 - src.rule.linked_order_actions - INFO - ATR-based stop: GLD stop at $307.84 (ATR: 0.0450 * 6.0 = 0.2700)
2025-06-05 12:04:42,951 - src.order.base - INFO - Order 19de2964-090d-4adf-94c0-4b0b8de4dd7f status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:04:42,951 - src.order.manager - INFO - Submitting order 19de2964-090d-4adf-94c0-4b0b8de4dd7f to TWS
2025-06-05 12:04:42,951 - src.order.manager - INFO - Got broker order ID 73 for order 19de2964-090d-4adf-94c0-4b0b8de4dd7f
2025-06-05 12:04:42,951 - src.order.manager - INFO - Calling placeOrder with ID 73, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: STP SELL 100@0.000000 DAY
2025-06-05 12:04:42,952 - src.order.manager - INFO - placeOrder called successfully for order 19de2964-090d-4adf-94c0-4b0b8de4dd7f
2025-06-05 12:04:42,959 - src.order.base - INFO - Order 19de2964-090d-4adf-94c0-4b0b8de4dd7f status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:04:42,959 - src.rule.linked_order_actions - INFO - Auto-created BUY stop loss 19de2964-090d-4adf-94c0-4b0b8de4dd7f at $307.84
2025-06-05 12:04:42,959 - src.position.position_manager - INFO - Added 1 stop orders to GLD position
2025-06-05 12:04:42,960 - src.rule.linked_order_actions - INFO - ATR-based target: GLD target at $308.13 (ATR: 0.0450 * 0.5 = 0.0225)
2025-06-05 12:04:42,960 - src.order.base - INFO - Order f71b2eae-d846-428f-ba4a-02f9c7d751fd status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:04:42,960 - src.order.manager - INFO - Submitting order f71b2eae-d846-428f-ba4a-02f9c7d751fd to TWS
2025-06-05 12:04:42,961 - src.order.manager - INFO - Got broker order ID 74 for order f71b2eae-d846-428f-ba4a-02f9c7d751fd
2025-06-05 12:04:42,961 - src.order.manager - INFO - Calling placeOrder with ID 74, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT SELL 100@308.130000 DAY
2025-06-05 12:04:42,961 - src.order.manager - INFO - placeOrder called successfully for order f71b2eae-d846-428f-ba4a-02f9c7d751fd
2025-06-05 12:04:42,961 - src.order.base - INFO - Order f71b2eae-d846-428f-ba4a-02f9c7d751fd status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:04:42,962 - src.rule.linked_order_actions - INFO - Auto-created BUY take profit f71b2eae-d846-428f-ba4a-02f9c7d751fd at $308.13
2025-06-05 12:04:42,962 - src.position.position_manager - INFO - Added 1 target orders to GLD position
2025-06-05 12:04:42,962 - src.rule.linked_order_actions - INFO - Starting double down order creation for GLD
2025-06-05 12:04:43,030 - src.tws_connection - INFO - Open Order - ID: 73, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 12:04:43,032 - src.order.base - INFO - Order 19de2964-090d-4adf-94c0-4b0b8de4dd7f status changed: submitted -> accepted (IB status: PreSubmitted)
2025-06-05 12:04:43,093 - src.tws_connection - INFO - Open Order - ID: 74, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 12:04:43,465 - src.rule.linked_order_actions - INFO - Found 1 stop orders for GLD: ['19de2964-090d-4adf-94c0-4b0b8de4dd7f']
2025-06-05 12:04:43,465 - src.rule.linked_order_actions - INFO - Executing double down action for GLD
2025-06-05 12:04:48,471 - src.rule.linked_order_actions - INFO - Using hardcoded ATR stop distance for GLD: 0.2700
2025-06-05 12:04:48,473 - src.rule.linked_order_actions - INFO - Double down calc for GLD (BUY): current=$308.09, stop_distance=$0.27, dd_distance=$0.03, dd_price=$308.06, original_qty=100, dd_qty=100
2025-06-05 12:04:48,474 - src.order.base - INFO - Order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 status changed: created -> pending_submit (Submitting to broker)
2025-06-05 12:04:48,474 - src.order.manager - INFO - Submitting order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 to TWS
2025-06-05 12:04:48,475 - src.order.manager - INFO - Got broker order ID 75 for order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765
2025-06-05 12:04:48,475 - src.order.manager - INFO - Calling placeOrder with ID 75, contract 0,GLD,STK,,0.0,,,SMART,,USD,,,False,,combo:, order 0,0,0: LMT BUY 100@308.060000 DAY
2025-06-05 12:04:48,475 - src.order.manager - INFO - placeOrder called successfully for order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765
2025-06-05 12:04:48,476 - src.order.base - INFO - Order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 status changed: pending_submit -> submitted (Submitted to broker)
2025-06-05 12:04:48,476 - src.position.position_manager - INFO - Added 1 doubledown orders to GLD position
2025-06-05 12:04:48,476 - src.rule.linked_order_actions - INFO - Created BUY double down order 'doubledown1' for GLD: 100 shares @ $308.06
2025-06-05 12:04:48,476 - src.rule.linked_order_actions - INFO - Auto-created double down order for GLD
2025-06-05 12:04:48,477 - src.rule.linked_order_actions - INFO - Created and linked BUY main order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 for GLD
2025-06-05 12:04:48,587 - src.tws_connection - INFO - Open Order - ID: 75, Symbol: GLD, Action: BUY, Quantity: 100.0
2025-06-05 12:04:51,930 - __main__ - INFO - 
============================================================
2025-06-05 12:04:51,932 - __main__ - INFO - STEP 2: Checking created orders
2025-06-05 12:04:51,932 - __main__ - INFO - ============================================================
2025-06-05 12:04:51,933 - __main__ - INFO - Found 4 orders for GLD
2025-06-05 12:04:51,933 - __main__ - INFO - Order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5: market buy 100 @ MARKET - Status: filled
2025-06-05 12:04:51,934 - __main__ - INFO - Order 19de2964-090d-4adf-94c0-4b0b8de4dd7f: stop sell -100 @ 307.84 - Status: accepted
2025-06-05 12:04:51,935 - __main__ - INFO - Order f71b2eae-d846-428f-ba4a-02f9c7d751fd: limit sell -100 @ 308.13 - Status: submitted
2025-06-05 12:04:51,935 - __main__ - INFO - Order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765: limit buy 100 @ 308.06 - Status: submitted
2025-06-05 12:04:51,935 - __main__ - INFO - 
Main orders: 1
2025-06-05 12:04:51,936 - __main__ - INFO - Stop orders: 1
2025-06-05 12:04:51,936 - __main__ - INFO - Target orders: 1
2025-06-05 12:04:51,937 - __main__ - INFO - Double down orders: 1
2025-06-05 12:04:51,940 - __main__ - INFO - 
Target order details:
2025-06-05 12:04:51,940 - __main__ - INFO -   ID: f71b2eae-d846-428f-ba4a-02f9c7d751fd
2025-06-05 12:04:51,950 - __main__ - INFO -   Status: submitted
2025-06-05 12:04:51,950 - __main__ - INFO -   Limit price: 308.13
2025-06-05 12:04:51,951 - __main__ - INFO - 
Active orders before fill: 3
2025-06-05 12:04:51,951 - __main__ - INFO - 
============================================================
2025-06-05 12:04:51,952 - __main__ - INFO - STEP 3: Waiting for profit target to fill
2025-06-05 12:04:51,952 - __main__ - INFO - ============================================================
2025-06-05 12:04:51,952 - __main__ - INFO - Waiting for target order f71b2eae-d846-428f-ba4a-02f9c7d751fd to fill at $308.13...
2025-06-05 12:04:51,953 - __main__ - INFO - Waiting... (0s elapsed, order status: submitted)
2025-06-05 12:04:54,032 - src.order.base - INFO - Order f71b2eae-d846-428f-ba4a-02f9c7d751fd status changed: submitted -> filled (Order fully filled)
2025-06-05 12:04:54,033 - src.order.base - INFO - Order f71b2eae-d846-428f-ba4a-02f9c7d751fd filled: 100.0 @ 308.13 (100.0/100)
2025-06-05 12:04:54,034 - src.rule.linked_order_actions - INFO - 🎯 BUY position concluded for GLD - target order f71b2eae-d846-428f-ba4a-02f9c7d751fd filled at $308.13
2025-06-05 12:04:54,034 - src.order.manager - WARNING - Cannot cancel inactive order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 with status filled
2025-06-05 12:04:54,034 - src.rule.linked_order_actions - INFO - Cancelled remaining order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 for GLD
2025-06-05 12:04:54,035 - src.order.base - INFO - Order 19de2964-090d-4adf-94c0-4b0b8de4dd7f status changed: accepted -> pending_cancel (Position concluded via target fill)
2025-06-05 12:04:54,032 - src.tws_connection - INFO - Open Order - ID: 74, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 12:04:54,035 - src.order.manager - INFO - Cancelling order 19de2964-090d-4adf-94c0-4b0b8de4dd7f with broker ID 73
2025-06-05 12:04:54,035 - src.rule.linked_order_actions - INFO - Cancelled remaining order 19de2964-090d-4adf-94c0-4b0b8de4dd7f for GLD
2025-06-05 12:04:54,036 - src.order.base - INFO - Order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 status changed: submitted -> pending_cancel (Position concluded via target fill)
2025-06-05 12:04:54,035 - src.tws_connection - INFO - Open Order - ID: 74, Symbol: GLD, Action: SELL, Quantity: 100.0
2025-06-05 12:04:54,036 - src.order.manager - INFO - Cancelling order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 with broker ID 75
2025-06-05 12:04:54,036 - src.rule.linked_order_actions - INFO - Cancelled remaining order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 for GLD
2025-06-05 12:04:54,036 - src.trade_tracker - INFO - Closed trade for GLD
2025-06-05 12:04:54,036 - src.position.position_manager - INFO - Closed position for GLD
2025-06-05 12:04:54,086 - src.order.base - INFO - Order 19de2964-090d-4adf-94c0-4b0b8de4dd7f status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 12:04:54,086 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 73)
2025-06-05 12:04:54,195 - src.order.base - INFO - Order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 status changed: pending_cancel -> cancelled (IB status: Cancelled)
2025-06-05 12:04:54,195 - src.tws_connection - WARNING - ⚠️ TWS Error 202: Order Canceled - reason: (reqId: 75)
2025-06-05 12:04:56,969 - __main__ - INFO - ✅ Target order filled at $308.13!
2025-06-05 12:05:01,990 - __main__ - INFO - 
============================================================
2025-06-05 12:05:01,990 - __main__ - INFO - STEP 4: Checking if stop and double down orders were cancelled
2025-06-05 12:05:01,990 - __main__ - INFO - ============================================================
2025-06-05 12:05:01,991 - __main__ - INFO - Stop order 19de2964-090d-4adf-94c0-4b0b8de4dd7f status: cancelled
2025-06-05 12:05:01,991 - __main__ - ERROR - ❌ Stop order is still cancelled
2025-06-05 12:05:01,991 - __main__ - INFO - Double down order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 status: cancelled
2025-06-05 12:05:01,991 - __main__ - ERROR - ❌ Double down order is still cancelled
2025-06-05 12:05:01,991 - __main__ - INFO - 
Active orders after fill: 0
2025-06-05 12:05:01,992 - __main__ - INFO - ✅ TradeTracker correctly shows no active trade for GLD
2025-06-05 12:05:01,992 - __main__ - INFO - 
============================================================
2025-06-05 12:05:01,992 - __main__ - INFO - TEST COMPLETE
2025-06-05 12:05:01,992 - __main__ - INFO - ============================================================
2025-06-05 12:05:01,992 - __main__ - INFO - 
Cancelling all remaining orders for cleanup...
2025-06-05 12:05:01,992 - src.order.manager - WARNING - Cannot cancel inactive order aef0c0d9-83da-431c-8dca-5cbe5fe6a5e5 with status filled
2025-06-05 12:05:01,993 - src.order.manager - WARNING - Cannot cancel inactive order 19de2964-090d-4adf-94c0-4b0b8de4dd7f with status cancelled
2025-06-05 12:05:01,993 - src.order.manager - WARNING - Cannot cancel inactive order f71b2eae-d846-428f-ba4a-02f9c7d751fd with status filled
2025-06-05 12:05:01,993 - src.order.manager - WARNING - Cannot cancel inactive order ea51c4c9-1da8-4a8e-bfd4-fcd940e95765 with status cancelled
2025-06-05 12:05:01,993 - __main__ - INFO - Cancelled 0 orders
2025-06-05 12:05:01,993 - __main__ - INFO - 
Cleaning up...
2025-06-05 12:05:01,994 - src.rule.engine - INFO - Rule engine stopped
2025-06-05 12:05:01,994 - src.tws_connection - INFO - Disconnecting from TWS
2025-06-05 12:05:01,995 - src.tws_connection - INFO - ⚠️ Connection to TWS closed
2025-06-05 12:05:01,995 - src.tws_connection - INFO - ✅ Disconnect request sent
2025-06-05 12:05:01,996 - __main__ - INFO - ✅ Cleanup complete
